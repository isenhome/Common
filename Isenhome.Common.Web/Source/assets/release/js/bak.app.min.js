define("troopjs-requirejs/template!app/widget/calendar/main.html", [], function () {
	return function (a) {
		for (var b = '<div class="span12">\n    <div class="clearfix">\n        <div class="pull-left">\n            <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="Add Task" data-action="add/task"></button>\n            <a href="' + this.exportOutlook + '" target="_blank" class="btn btn-small" data-weave="shared/helper/translation" data-i18n="将日历同步到邮件客户端"></a>\n            <a href="#" data-action="export/mobile" class="btn btn-export-mobile hide" data-weave="shared/helper/translation" data-i18n="将日历同步到手机"></a>\n        </div>\n        <div class="pull-right action-bar">\n            <select name="category" class="input-medium sort" data-action="source(\'category\')">\n                <option value="" data-weave="shared/helper/translation" data-i18n="All Categories"></option>\n                ', c = 0, d = a.length; d > c; c++)
			b += '\n                <option value="' + a[c].code + '">' + a[c].value + "</option>\n                ";
		return b += '\n            </select>\n            <select name="status" class="input-medium sort" data-action="source(done__eq)">\n                <option value="" data-weave="shared/helper/translation" data-i18n="All Statuses"></option>\n                <option value="1" data-weave="shared/helper/translation" data-i18n="Done"></option>\n                <option value="0" data-weave="shared/helper/translation" data-i18n="Not done"></option>\n            </select>\n            <select data-action="source(\'user_id\')" data-placeholder="Choose a user..." name="name" class="input-medium" data-weave="shared/widget/common/user-list/main"></select>\n        </div>\n    </div>\n\n    <h2 class="heading calendar-heading text-center">\n        <span data-weave="shared/helper/translation" data-i18n="Calendar"></span>\n    </h2>\n\n    <div id="calendar">\n    </div>\n</div>'
	}
}), define("app/widget/calendar/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "shared/helper/blurb", "calendar"], function (a, b, c, d, e) {
	function f() {
		var a = [];
		for (var b in l)
			l[b] && "done__eq" !== b ? a.push(b + "=" + l[b]) : l[b].length && "done__eq" === b && a.push(b + "=" + ("1" === l[b] ? 1 : ""));
		return k.LIST + "&" + a.join("&")
	}
	function g(a, b, d) {
		var e = this;
		e.publish("ajax", {
			url : j,
			data : {
				paginate_by : 200,
				start : Math.round(a.getTime() / 1e3),
				end : Math.round(b.getTime() / 1e3)
			}
		}, c().done(function (a) {
				var b,
				c,
				e,
				f,
				g = a.list,
				h = [];
				g.forEach(function (a) {
					b = a.target && a.target.name ? a.category.value + ": " + a.target.name : a.target && a.target.candidate ? a.category.value + ": " + [a.target.candidate.englishName, a.target.candidate.chineseName].join(" ") : a.category.value + ": " + a.content,
					"joborder" === a.external_type ? (e = "job", c = a.target.id, f = a.content) : "client" === a.external_type ? (e = "company", c = a.target.id, f = a.content) : a.candidate_id ? (e = "candidate", c = a.candidate_id, f = a.content) : e = null,
					h.push({
						id : a.id,
						title : b,
						start : a.date,
						end : a.date,
						prefix : e,
						type_id : c,
						allDay : a.allday,
						color : a.category.color,
						textColor : "#FFF",
						className : a.done ? "muted" : null,
						done : a.done,
						origin : a,
						content : f
					})
				}),
				d(h)
			}))
	}
	function h() {
		var a = this;
		a.publish("ajax", {
			url : k.CATEGORY
		}, c().done(function (b) {
				a._json = b,
				c(function (b) {
					a.html(d, a._json, b)
				}).done(function () {
					i.call(a)
				})
			}))
	}
	function i() {
		var a = this,
		b = new Date;
		b.getDate(),
		b.getMonth(),
		b.getFullYear(),
		j = f(),
		a.$calendar = a.$element.find("#calendar"),
		a.$calendar.fullCalendar({
			header : {
				left : "prev next",
				center : "title,today",
				right : "month,agendaWeek,agendaDay"
			},
			events : function (b, c, d) {
				g.call(a, b, c, d)
			},
			eventColor : "#BCDEEE",
			textColor : "#FFFFFF",
			firstDay : 1,
			timeFormat : {
				"" : "H:mm"
			},
			allDayText : "全天",
			monthNames : ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"],
			monthNamesShort : ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"],
			dayNames : ["周日", "周一", "周二", "周三", "周四", "周五", "周六"],
			dayNamesShort : ["周日", "周一", "周二", "周三", "周四", "周五", "周六"],
			buttonText : {
				prev : "&nbsp;&#9668;&nbsp;",
				next : "&nbsp;&#9658;&nbsp;",
				prevYear : "&nbsp;&lt;&lt;&nbsp;",
				nextYear : "&nbsp;&gt;&gt;&nbsp;",
				today : "今天",
				month : "月",
				week : "周",
				day : "天"
			},
			eventRender : function (a, b) {
				var c = a.prefix;
				c ? (b.find(".fc-event-title").wrapInner('<a target="_blank" href="/' + a.prefix + "#detail!id=" + a.type_id + '"></a>'), a.content && b.find(".fc-event-title").after('<span class="fc-event-content">' + a.content + "</span>"), b.find(".fc-event-inner").prepend('<input type="checkbox" data-action="toggle/done(' + a.id + ')">'), a.done && b.find(":checkbox").prop("checked", !0)) : (b.find(".fc-event-inner").prepend('<input type="checkbox" data-action="toggle/done(' + a.id + ')">'), a.done && b.find(":checkbox").prop("checked", !0), a.content && b.find(".fc-event-title").after('<span class="fc-event-content">' + a.content + "</span>"))
			},
			eventAfterRender : function (a, b, c) {
				("agendaDay" === c.name || "agendaWeek" === c.name) && b.height("auto")
			},
			eventClick : function (b, c) {
				var d = c.target.tagName;
				if ("INPUT" !== d && "A" !== d) {
					var e = b.origin;
					e.external_type;
					var f = e.category.code;
					"Client Interview" !== f && "Onboard" !== f && "Probation End" !== f && "Estimated Delivery Date" !== f && a.publish("modal/add/task/show", {
						type : e.external_type,
						id : e.id,
						data : e,
						onSuccess : function () {
							a.$calendar.fullCalendar("refetchEvents")
						}
					})
				}
			},
			dayClick : function (b, c, d, e) {
				var f = "month" !== e.name && c,
				g = {
					date : b,
					users : [{
							id : a._user.id,
							englishName : a._user.englishName
						}
					],
					allday : f
				};
				a.publish("modal/add/task/show", {
					data : g,
					onSuccess : function () {
						l.user_id && parseInt(l.user_id, 10) !== parseInt(a._id, 10) || a.$calendar.fullCalendar("refetchEvents")
					}
				})
			}
		}),
		a.$element.find(".btn-export-mobile").popover({
			placement : "bottom",
			html : !0,
			content : "<a href='http://support.gllue.com/?p=624' target='_blank'>查看教程</a>后,请复制以下地址: <br><span class='text-info'>" + a.exportOutlook + "</span>",
			trigger : "click"
		})
	}
	var j,
	k = {
		LIST : "/rest/todo/list?unlimited=1",
		DONE : "/rest/todo/done",
		CATEGORY : "/rest/data/options?type=todo_category"
	},
	l = {
		user_id : "",
		category : "",
		done__eq : ""
	};
	return b.extend({
		"hub:memory/context" : function (a, b) {
			var c = this;
			c._user = b.user,
			c._id = b.user.id,
			l.user_id = c._id,
			c._publicKey = b.user.public_key,
			c.exportOutlook = "webcal://" + window.location.hostname + "/rest/calendar/ical?id=" + c._id + "&key=" + c._publicKey,
			h.call(c)
		},
		"dom/action.change.click" : a.noop,
		"dom/action/source.change" : function (b, c, d) {
			var e = this,
			g = a(c.target).val();
			l[d] = g,
			j = f(),
			e.$calendar.fullCalendar("removeEvents").fullCalendar("refresh").fullCalendar("refetchEvents")
		},
		"dom/action/toggle/done.click" : function (b, d, f) {
			d.stopPropagation();
			var g = this,
			h = a(d.target),
			i = h.is(":checked");
			g.publish("ajax", {
				url : k.DONE,
				data : {
					data : JSON.stringify({
						ids : [f],
						done : i
					})
				},
				type : "POST"
			}, c().done(function (a) {
					a.status ? (e.alert("success", "任务状态更改成功!"), i ? h.closest(".fc-event").addClass("muted") : h.closest(".fc-event").removeClass("muted")) : e.alert("error", a.message)
				}))
		},
		"dom/action/add/task.click" : function (a, b) {
			b.preventDefault();
			var c = this;
			c.publish("modal/add/task/show", {
				onSuccess : function () {
					l.user_id && parseInt(l.user_id, 10) !== parseInt(c._id, 10) || c.$calendar.fullCalendar("refetchEvents")
				}
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/candidate/add/education/item.html", [], function () {
	return function (a) {
		var b = "",
		c = "",
		d = "",
		e = "";
		a && (c = a.school || "", d = a.major || "", e = a.degree || ""),
		b += '\n<div class="control-group">\n    <label class="control-label" data-weave="shared/helper/translation" data-i18n="Time"></label>\n    <div class="controls">\n        <div class="pull-left">\n            <input type="text" class="input-mini digits" name="started-year-' + this.index + '" data-weave="shared/helper/translation(\'placeholder\')" data-i18n="Year" maxlength="4" minlength="4">&nbsp;\n            <select class="input-mini" name="started-month-' + this.index + '" data-action="month">\n                <option value="" data-weave="shared/helper/translation" data-i18n="Month"></option>\n                ';
		for (var f = 1, g = 12; g >= f; f++)
			b += '\n                <option value="' + f + '">' + f + "</option>\n                ";
		b += '\n            </select>&nbsp;&dash;&nbsp;\n        </div>\n        <div class="pull-left">\n            <input type="text" class="input-mini ended-position digits" name="ended-year-' + this.index + '" data-weave="shared/helper/translation(\'placeholder\')" data-i18n="Year" maxlength="4" minlength="4">&nbsp;\n            <select class="input-mini ended-position" name="ended-month-' + this.index + '" data-action="month">\n                <option value="" data-weave="shared/helper/translation" data-i18n="Month"></option>\n                ';
		for (var f = 1, g = 12; g >= f; f++)
			b += '\n                <option value="' + f + '">' + f + "</option>\n                ";
		return b += '\n            </select>\n            <label class="checkbox inline current-position hide">\n                <span data-weave="shared/helper/translation" data-i18n="Present"></span>    \n            </label>\n            <label class="checkbox inline">\n                <input type="checkbox" name="current-' + this.index + '" data-action="current/school" class="check-one-current"> <span data-weave="shared/helper/translation" data-i18n="In reading"></span>\n            </label>\n        </div>\n            \n    </div>\n</div>\n\n<div class="control-group">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="School"></span>\n    </label>\n    <div class="controls">\n        <input type="text" name="school-' + this.index + '" value="' + c + '" class="input-xxlarge">\n    </div>\n</div>\n\n<div class="control-group">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="Field of Study"></span>\n    </label>\n    <div class="controls">\n        <input type="text" name="major-' + this.index + '" value="' + d + '" class="input-xxlarge">\n    </div>\n</div>\n\n<div class="control-group">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="Degree"></span>\n    </label>\n    <div class="controls">\n        <select name="degree-' + this.index + "\" data-weave=\"app/widget/common/dropdown/main('education_background', '" + e + '\')"></select>\n    </div>\n</div>\n\n<div class="control-group">\n    <label class="control-label">\n    </label>\n    <div class="controls">\n        <a href="#" class="btn btn-small" data-weave="shared/helper/translation" data-i18n="Delete" data-action="remove/education"></a>\n    </div>\n</div>'
	}
}), define("app/widget/candidate/add/education/item", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./item.html", "shared/helper/utils"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		c(function (a) {
			b.html(d, b._json, a)
		}).done(function () {
			f.call(b, a)
		})
	}
	function f(b) {
		var c = this,
		d = c._json,
		e = c.$element,
		f = e.find('[name="started-year-' + c.index + '"]'),
		g = e.find('[name="started-month-' + c.index + '"]'),
		h = e.find('[name="ended-year-' + c.index + '"]'),
		i = e.find('[name="ended-month-' + c.index + '"]'),
		j = e.find('[name="current-' + c.index + '"]');
		if (!a.isEmptyObject(d)) {
			var k = d.start ? d.start.split("-") : [],
			l = d.end ? d.end.split("-") : [];
			f.val(k[0] || ""),
			g.val(parseInt(k[1], 10) || ""),
			h.val(l[0] || ""),
			i.val(parseInt(l[1], 10) || ""),
			e.data("id", d.id),
			d.is_current && (j.trigger("click").closest(".controls").find(".ended-position").addClass("hide"), c._isCurrent = !0)
		}
		c.$element.data("current") && j.attr("data-current", "true"),
		b.resolve()
	}
	var g = 0;
	return b.extend(function (a, b, c) {
		g++,
		this._json = c || {},
		this.index = g
	}, {
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		},
		"dom/action.click.change" : a.noop,
		"dom/action/remove/education.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target);
			d.closest(".education-item").remove()
		},
		"dom/action/current/school.change" : function (b, c) {
			var d = this,
			e = a(c.target),
			f = e.closest(".education-item"),
			g = e.closest(".education-block").find('[name*="current"]').not(e);
			e.is(":checked") ? (d._isCurrent = !0, f.find(".ended-position").addClass("hide"), f.find(".current-position").removeClass("hide"), g.filter(":checked").trigger("click")) : (d._isCurrent = !1, f.find(".ended-position").removeClass("hide"), f.find(".current-position").addClass("hide"))
		}
	})
}), define("troopjs-requirejs/template!app/widget/candidate/add/education/main.html", [], function () {
	return function () {
		var a = '<div class="header">\n    <strong data-weave="shared/helper/translation" data-i18n="Education Experiences"></strong>\n</div>\n<div class="footer">\n    <a href="#" data-weave="shared/helper/translation" data-i18n="Add new education experience" data-action="add/education"></a>\n</div>';
		return a
	}
}), define("app/widget/candidate/add/education/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "template!./item.html"], function (a, b, c, d, e) {
	function f(b) {
		var e = this;
		e.$element;
		var f,
		g,
		h = a("<div></div>"),
		j = [];
		if (e._json)
			for (var k = 0, l = e._json.length; l > k; k++) {
				var m = e._json[k],
				n = a('<div class="education-item"></div>').data("json", m).attr("data-weave", i + "(json)");
				f = c(),
				g = f.promise(),
				j.push(g),
				h.append(n.weave(f))
			}
		d.apply(a, j).then(function () {
			e.$footer.before(h),
			b.resolve()
		})
	}
	function g(a) {
		var b = this;
		b.html(e, a)
	}
	function h(a) {
		var b = this;
		b.$footer = b.$element.find(".footer"),
		f.call(b, a)
	}
	var i = "app/widget/candidate/add/education/item";
	return b.extend(function (a, b, c) {
		var d = this;
		d._json = c
	}, {
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"sig/start" : function (a, b) {
			var c = this;
			"reset" !== c._flag ? h.call(c, b) : b.resolve()
		},
		"hub:memory/education/reset" : function (a, b) {
			var d = this;
			b && (d._flag = "reset", d.$element.find(".education-item").remove(), d._json = b, h.call(d, c()), d.publish("education/reset", null))
		},
		"dom/action.click" : a.noop,
		"dom/action/add/education.click" : function (b, c) {
			c.preventDefault();
			var d = this;
			a(c.target);
			var e = a('<div class="education-item"></div>').attr("data-weave", i).weave();
			d.$footer.before(e)
		}
	})
}), define("troopjs-requirejs/template!app/widget/candidate/add/experience/item.html", [], function () {
	return function (a) {
		var b = "",
		c = "",
		d = "",
		e = "",
		f = "",
		g = "",
		h = "",
		i = this.mandatory;
		a && (c = a.client.name || "", d = a.title || "", e = a.function  ? a.function .id : "", f = a.function1 ? a.function1.id : "", g = a.function2 ? a.function2.id : "", h = a.description ? a.description : ""), b += '\n<div class="control-group">\n    <label class="control-label" data-weave="shared/helper/translation" data-i18n="Time"></label>\n    <div class="controls">\n        <div class="pull-left">\n            <input type="text" class="input-mini digits" name="started-year-' + this.index + '" data-weave="shared/helper/translation(\'placeholder\')" data-i18n="Year" maxlength="4" minlength="4">&nbsp;\n            <select class="input-mini" name="started-month-' + this.index + '" data-action="month">\n                <option value="" data-weave="shared/helper/translation" data-i18n="Month"></option>\n                ';
			for (var j = 1, k = 12; k >= j; j++)
				b += '\n                <option value="' + j + '">' + j + "</option>\n                ";
			b += '\n            </select>&nbsp;&dash;&nbsp;\n        </div>\n        <div class="pull-left">\n            <input type="text" class="input-mini ended-position digits" name="ended-year-' + this.index + '" data-weave="shared/helper/translation(\'placeholder\')" data-i18n="Year" maxlength="4" minlength="4">&nbsp;\n            <select class="input-mini ended-position" name="ended-month-' + this.index + '" data-action="month">\n                <option value="" data-weave="shared/helper/translation" data-i18n="Month"></option>\n                ';
			for (var j = 1, k = 12; k >= j; j++)
				b += '\n                <option value="' + j + '">' + j + "</option>\n                ";
			return b += '\n            </select>\n            <label class="checkbox inline current-position hide">\n                <span data-weave="shared/helper/translation" data-i18n="Present"></span>    \n            </label>\n            <label class="checkbox inline">\n                <input type="checkbox" name="current-' + this.index + '" data-action="current/job" class="check-one-current"> <span data-weave="shared/helper/translation" data-i18n="Current Job"></span>\n            </label>\n        </div>\n            \n    </div>\n</div>\n\n<div class="additional-group hide">\n    <div class="control-group control-group-reduce">\n        <label class="control-label"></label>\n        <div class="controls text_line">\n            <span class="text-error" data-weave="shared/helper/translation" data-i18n="Create new company, or click the input field to match the existing company"></span>\n        </div>\n    </div>\n</div>\n\n<div class="control-group">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="Company Name"></span>\n        ', i.company && (b += '\n        <span class="f_req">*</span>\n        '), b += '\n    </label>\n    <div class="controls">\n        <input type="text" name="company-' + this.index + '" value="' + c + '" class="input-xxlarge ', i.company && (b += "required"), b += ' experience" data-weave="app/widget/common/company-suggestion/main" autocomplete="off" data-action="company/name">\n    </div>\n</div>\n\n<div class="additional-group hide">\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="公司城市"></span>\n        </label>\n\n        <div class="controls">\n            <div class="comtree span3" data-name="company-city-' + this.index + '" data-url="/rest/data/city" data-weave="shared/widget/common/comtree/main" data-action="experience/city"></div>\n        </div>\n    </div>\n\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="公司行业"></span>\n        </label>\n        <div class="controls">\n            <div class="comtree span3" data-name="company-industry-' + this.index + '" data-url="/rest/data/industry" data-weave="shared/widget/common/comtree/main"></div>\n        </div>\n    </div>\n</div>\n\n<div class="control-group">\n    <label for="" class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="Function"></span>\n        ', i.function  && (b += '\n        <span class="f_req">*</span>\n        '), b += '\n    </label>                    \n    <div class="controls clearfix">\n        <div class="comtree span3" data-name="function1-' + this.index + '" data-url="/rest/data/function" data-weave="shared/widget/common/comtree/main(' + e + ')" ', i.function  && (b += 'data-required="required"'), b += '></div>\n    </div>\n\n    <div class="controls clearfix ', "number" != typeof f && (b += "hide"), b += '">\n        <div class="comtree span3" data-name="function2-' + this.index + '" data-url="/rest/data/function" data-weave="shared/widget/common/comtree/main(' + f + ')"></div>\n        <a class="remove" href="#" data-action="remove/field"><span class="icon-remove"></span></a>\n    </div>\n\n    <div class="controls clearfix ', "number" != typeof g && (b += "hide"), b += '">\n        <div class="comtree span3" data-name="function3-' + this.index + '" data-url="/rest/data/function" data-weave="shared/widget/common/comtree/main(' + g + ')"></div>\n        <a href="#" class="remove" data-action="remove/field"><span class="icon-remove"></span></a>\n    </div>\n\n    <div class="controls controls-add text_line">\n        <a href="#" data-action="add/fn" data-weave="shared/helper/translation" data-i18n="Add"></a>\n    </div>\n</div>\n\n<div class="control-group">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="Title"></span>\n        ', i.title && (b += '\n        <span class="f_req">*</span>\n        '), b += '\n    </label>\n    <div class="controls">\n        <input type="text" name="title-' + this.index + '" class="', i.title && (b += "required"), b += '" value="' + d + '" data-weave="app/widget/common/autocomplete/main(\'title\')" autocomplete="off">\n    </div>\n</div>\n\n<div class="control-group">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="Description"></span>\n        ', i.job_description && (b += '\n        <span class="f_req">*</span>\n        '), b += '\n    </label>\n    <div class="controls">\n        <textarea name="description-' + this.index + '" class="input-xxlarge ', i.job_description && (b += "required"), b += '" data-weave="shared/widget/common/autosize/main">' + h + '</textarea>\n    </div>\n</div>\n\n<div class="control-group">\n    <label class="control-label">\n    </label>\n    <div class="controls">\n        <a href="#" class="btn btn-small" data-weave="shared/helper/translation" data-i18n="Delete" data-action="remove/experience"></a>\n    </div>\n</div>'
}
}), define("app/widget/candidate/add/experience/item", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./item.html", "shared/helper/utils"], function (a, b, c, d) {
	function e() {
		var a = this;
		c(function (b) {
			a.html(d, a._json, b)
		}).done(function () {
			f.call(a)
		})
	}
	function f() {
		var b = this,
		c = b._json,
		d = b.$element,
		e = d.find('[name="started-year-' + b.index + '"]'),
		f = d.find('[name="started-month-' + b.index + '"]'),
		g = d.find('[name="ended-year-' + b.index + '"]'),
		h = d.find('[name="ended-month-' + b.index + '"]'),
		i = d.find('[name="current-' + b.index + '"]');
		if (b.$company = d.find('[name="company-' + b.index + '"]'), b.$title = d.find('[name="title-' + b.index + '"]'), b.$industry = d.find('[name="company-industry-' + b.index + '"]'), b.$city = d.find('[name="company-city-' + b.index + '"]'), b.$function1 = d.find('[name="function1-' + b.index + '"]'), b.cityCombo = d.find('[data-name="company-city-' + b.index + '"]').woven()[0], b.$additionalGroup = d.find(".additional-group"), !a.isEmptyObject(c)) {
			var j = c.start ? c.start.split("-") : [],
			k = c.end ? c.end.split("-") : [];
			e.val(j[0] || ""),
			f.val(parseInt(j[1], 10) || ""),
			g.val(k[0] || ""),
			h.val(parseInt(k[1], 10) || ""),
			d.data("id", c.id),
			c.is_current && (i.trigger("click").closest(".controls").find(".ended-position").addClass("hide"), b._isCurrent = !0)
		}
		b.$element.data("current") && i.attr("data-current", "true")
	}
	function g() {
		var a = this,
		b = a.$company.val().trim();
		return b ? (a.publish("ajax", {
				url : i.COMPANY_CHECK.replace("<name>", window.encodeURIComponent(b))
			}, c().done(function (b) {
					b.status ? (a.$additionalGroup.addClass("hide"), a._isCurrent && a.publish("location/set", b.data.city)) : (a.$additionalGroup.removeClass("hide"), a._json && a._json.city && (a.cityCombo.selectByName(a._json.city), delete a._json.city))
				})), void 0) : (a.$additionalGroup.addClass("hide"), void 0)
	}
	var h = 0,
	i = {
		COMPANY_CHECK : "/rest/client/check_exists?name=<name>"
	};
	return b.extend(function (a, b, c) {
		h++,
		this._json = c,
		this.index = h
	}, {
		"hub:memory/experience/mandatory" : function (a, b) {
			var c = this;
			c.mandatory = b,
			e.call(c)
		},
		"hub:memory/experience/switch/rules" : function (a, b) {
			var c = this,
			d = c.$element.find(".f_req");
			b ? (d.removeClass("hide"), c.$element.find(".not-required").addClass("required").removeClass("not-required")) : (d.addClass("hide"), c.$element.find(".required").removeClass("required").addClass("not-required"))
		},
		"dom/action.click.change" : a.noop,
		"dom/action/remove/experience.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target);
			d.closest(".experience-item").remove()
		},
		"dom/action/experience/city.change" : function (b, c) {
			var d = this,
			e = a(c.target).find("input:hidden");
			d._isCurrent && d.publish("location/set", e.val())
		},
		"dom/action/current/job.change" : function (b, c) {
			var d = this,
			e = a(c.target),
			f = e.closest(".experience-item"),
			g = e.closest(".experience-block").find('[name*="current"]').not(e);
			e.is(":checked") ? (d._isCurrent = !0, f.find(".ended-position").addClass("hide").removeClass("required").each(function () {
					a(this).val("")
				}), f.find(".current-position").removeClass("hide"), g.filter(":checked").trigger("click")) : (d._isCurrent = !1, f.find(".ended-position").removeClass("hide"), f.find(".current-position").addClass("hide"))
		},
		"dom/action/company/name.change.click" : function (b, c) {
			var d = this,
			e = a(c.target);
			if ("click" === c.namespace) {
				var f = e.val();
				f.length && (e.typeahead("setQuery", ""), e.typeahead("setQuery", f))
			} else
				"change" === c.namespace && e.one("blur", function () {
					window.setTimeout(function () {
						d.checkCompanyName()
					}, 200)
				})
		},
		"dom/action/month.change" : function (b, c) {
			var d = a(c.target);
			d.val().length ? d.prev().addClass("required") : d.prev().removeClass("required")
		},
		checkCompanyName : g
	})
}), define("troopjs-requirejs/template!app/widget/candidate/add/experience/main.html", [], function () {
	return function () {
		var a = '<div class="header">\n    <strong data-weave="shared/helper/translation" data-i18n="Work Experiences"></strong>\n</div>\n<div class="footer">\n    <a href="#" data-weave="shared/helper/translation" data-i18n="Add work experience" data-action="add/experience"></a>\n</div>';
		return a
	}
}), define("app/widget/candidate/add/experience/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "template!./item.html"], function (a, b, c, d, e) {
	function f(b) {
		var e,
		f,
		g = this,
		h = g.$element,
		j = a("<div></div>"),
		k = [];
		if (g._json) {
			for (var l = 0, m = g._json.length; m > l; l++) {
				var n = g._json[l],
				o = a('<div class="experience-item"></div>').data("json", n).attr("data-weave", i + "(json)");
				e = c(),
				f = e.promise(),
				k.push(f),
				j.append(o.weave(e))
			}
			d.apply(a, k).then(function () {
				h.children().not(".header").not(".footer").remove(),
				g.$footer.before(j),
				h.find(".btn:eq(0)").closest(".control-group").remove(),
				h.find(":checkbox").filter('[data-current="true"]').trigger("click").closest(".controls").find(".ended-position").addClass("hide"),
				h.find(".experience-item").each(function (b, c) {
					a(c).woven()[0].checkCompanyName()
				}),
				h.find("textarea").trigger("autosize.resize"),
				b.resolve()
			})
		} else
			e = c(), f = e.promise(), k.push(f), j.append(a('<div class="experience-item" data-current="true"></div>').attr("data-weave", i).weave(e)), d.apply(a, k).then(function () {
				h.children().not(".header").not(".footer").remove(),
				g.$footer.before(j),
				h.find(".btn:eq(0)").closest(".control-group").remove(),
				h.find(":checkbox").filter('[data-current="true"]').trigger("click").closest(".controls").find(".ended-position").addClass("hide"),
				h.find(".experience-item").each(function (b, c) {
					a(c).woven()[0].checkCompanyName()
				}),
				b.resolve()
			})
	}
	function g(a) {
		var b = this;
		b.html(e, a)
	}
	function h(a) {
		var b = this;
		b.$footer = b.$element.find(".footer"),
		f.call(b, a)
	}
	var i = "app/widget/candidate/add/experience/item";
	return b.extend(function (a, b, c) {
		var d = this;
		d._json = c
	}, {
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"sig/start" : function (a, b) {
			var c = this;
			"reset" !== c._flag ? h.call(c, b) : b.resolve()
		},
		"hub:memory/experience/reset" : function (a, b) {
			var d = this;
			b && (d._flag = "reset", d.$element.find(".experience-item").remove(), b.forEach(function (a) {
					a.client = {
						name : a.company
					}
				}), d._json = b, h.call(d, c()), d.publish("experience/reset", null))
		},
		"dom/action.click" : a.noop,
		"dom/action/add/experience.click" : function (b, c) {
			c.preventDefault();
			var d = this;
			a(c.target);
			var e = a('<div class="experience-item"></div>').attr("data-weave", i).weave();
			d.$footer.before(e)
		}
	})
}), define("troopjs-requirejs/template!app/widget/candidate/add/main.html", [], function () {
	return function (a) {
		var b = "",
		c = this.editMode;
		if (c) {
			var d = a.dateOfBirth,
			e = a.monthNull || !1,
			f = a.dayNull || !1,
			g = a.annualSalary || "";
			a.officeTel || "",
			a.homeTel || "";
			var h = a.location ? a.location.id : "",
			i = a.city ? a.city.id : "",
			j = a.city1 ? a.city1.id : "",
			k = a.city2 ? a.city2.id : "",
			l = a.linkedin || "",
			m = a.englishName || "",
			n = a.chineseName || "",
			o = a.email || "",
			p = a.email1 || "",
			q = a.email2 || "",
			r = a.mobile || "",
			s = a.mobile1 || "",
			t = a.mobile2 || "",
			u = a.address || "",
			v = a.is_mpc
		}
		return b += '\r\n<div class="span12">\r\n    <div class="pull-right">\r\n        <a href="#" class="btn" data-action="history/back"><i class="icon-arrow-left"></i></a>\r\n    </div>\r\n\r\n    ',
		b += c ? '\r\n    <h3 class="heading" data-weave="shared/helper/translation" data-i18n="Edit People"></h3>\r\n    ' : '\r\n    <h3 class="heading" data-weave="shared/helper/translation" data-i18n="New People"></h3>\r\n    ',
		b += '\r\n\r\n    <form action="#" class="form-horizontal" type="post" enctype="multipart/form-data">\r\n        <fieldset>\r\n            <div class="control-group formSep">\r\n                <label class="control-label" data-weave="shared/helper/translation" data-i18n="Resume upload"></label>\r\n                <div class="controls">\r\n                    <select name="attachment-type" class="input-medium" data-type="candidate" data-weave="app/widget/common/attachment-type/main"></select>\r\n                    <span class="upload-file"></span>\r\n                    <span>\r\n                        <button class="btn" data-weave="shared/helper/translation" data-i18n="Paste Resume" data-action="show/paste/modal"></button>\r\n                    </span>\r\n                </div>\r\n                <div class="controls text_line hide">\r\n                    <ul class="unstyled attachment-list"></ul>\r\n                </div>\r\n            </div>\r\n        </fieldset>\r\n    </form>\r\n    <form action="#" class="form-horizontal" type="post">\r\n        <fieldset>\r\n            <div class="control-group">\r\n                <label class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Type"></span>\r\n                </label>\r\n                <div class="controls">\r\n                    <label class="radio inline">\r\n                        <input type="radio" data-action="people/type" checked="checked" name="type" value="candidate" ',
		"candidate" === a.type && (b += 'checked="checked"'),
		b += '> \r\n                        <span class="label label-blue" data-weave="shared/helper/translation" data-i18n="Candidate"></span>\r\n                    </label>\r\n                    <label class="radio inline">\r\n                        <input type="radio" data-action="people/type" name="type" value="contact" ',
		"contact" === a.type && (b += 'checked="checked"'),
		b += '> \r\n                        <span class="label label-red" data-weave="shared/helper/translation" data-i18n="Contact"></span>\r\n                    </label>\r\n                    <label class="radio inline">\r\n                        <input type="radio" data-action="people/type" name="type" value="coldcall" ',
		"coldcall" === a.type && (b += 'checked="checked"'),
		b += '> \r\n                        <span class="label" data-weave="shared/helper/translation" data-i18n="Cold Call"></span>\r\n                    </label>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <label class="control-label">MPC</label>\r\n                <div class="controls">\r\n                    <label class="checkbox inline">\r\n                        <input type="checkbox" name="is_mpc" value="1" ',
		v && (b += 'checked="checked"'),
		b += '> \r\n                        <span class="label label-orange">MPC</span>\r\n                        <span class="hint">(Most Placeable Candidate, 最容易被客户录用的候选人)</span>\r\n                    </label>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <label for="email" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Email"></span>\r\n                </label>\r\n                <div class="controls">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Private email"></span>\r\n                    <input type="text" id="email" name="email" data-value="' + (c ? o : "") + '" value="' + (c ? o : "") + '">\r\n                </div>\r\n                <div class="controls">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Work email"></span>\r\n                    <input type="text" name="email1" value="' + (c ? p : "") + '">\r\n                </div>\r\n                <div class="controls">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Other"></span>\r\n                    <input type="text" name="email2" value="' + (c ? q : "") + '">\r\n                </div>\r\n                <div class="controls duplicate-info hide">\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <label for="mobile" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Phone"></span>\r\n                    ',
		this.mandatory.mobile && (b += '\r\n                    <span class="f_req">*</span>\r\n                    '),
		b += '\r\n                </label>\r\n                <div class="controls">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Mobile"></span>\r\n                    <input type="text" id="mobile" name="mobile" data-value="' + (c ? r : "") + '" value="' + (c ? r : "") + '" class="input-medium ',
		this.mandatory.mobile && (b += "required"),
		b += " ",
		this.mandatory.mobile_or_email && (b += "fill-one-contact"),
		b += '">\r\n                </div>\r\n                \r\n                <div class="controls">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Telephone"></span>\r\n                    <input type="text" class="input-medium" name="mobile1" value="' + (c ? s : "") + '">\r\n                </div>\r\n\r\n                <div class="controls">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Other"></span>\r\n                    <input type="text" class="input-medium" name="mobile2" value="' + (c ? t : "") + '">\r\n                </div>\r\n\r\n                <div class="controls duplicate-info hide"></div>\r\n            </div>\r\n            \r\n            ',
		this.mandatory.englishName_or_chineseName ? b += '\r\n            <div class="control-group">\r\n                <label for="englishName" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Name"></span>\r\n                    <span class="f_req always">*</span>\r\n                </label>\r\n                <div class="controls">\r\n                    <input type="text" id="englishName" name="englishName" placeholder="English Name" class="input-small fill-one-name" value="' + (c ? m : "") + '">\r\n                    <input type="text" id="chineseName" name="chineseName" placeholder="中文名" class="input-small fill-one-name" value="' + (c ? n : "") + '">\r\n                    <span class="hint" data-weave="shared/helper/translation" data-i18n="require one hint"></span>\r\n                </div>\r\n            </div>\r\n            ' : (b += '\r\n            <div class="control-group">\r\n                <label for="englishName" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="English Name"></span>\r\n                    ', this.mandatory.englishName && (b += '\r\n                    <span class="f_req">*</span>\r\n                    '), b += '\r\n                </label>\r\n                <div class="controls">\r\n                    <input type="text" id="englishName" name="englishName" class="input-medium ', this.mandatory.englishName && (b += "required"), b += '" value="' + (c ? m : "") + '">\r\n                </div>\r\n            </div>\r\n            <div class="control-group">\r\n                <label for="chineseName" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Chinese Name"></span>\r\n                    ', this.mandatory.chineseName && (b += '\r\n                    <span class="f_req">*</span>\r\n                    '), b += '\r\n                </label>\r\n                <div class="controls">\r\n                    <input type="text" id="chineseName" name="chineseName" class="input-medium ', this.mandatory.chineseName && (b += "required"), b += '" value="' + (c ? n : "") + '">\r\n                </div>\r\n            </div>\r\n            '),
		b += '\r\n\r\n            <div class="experience-block"></div>\r\n\r\n            <div class="education-block"></div>\r\n\r\n            <div class="control-group">\r\n                <label class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Current City"></span>\r\n                    ',
		this.mandatory.city && (b += '\r\n                    <span class="f_req">*</span>\r\n                    '),
		b += '\r\n                </label>\r\n                <div class="controls">\r\n                    <div class="comtree span3" data-name="location" ',
		this.mandatory.city && (b += 'data-required="true"'),
		b += ' data-url="/rest/data/city" data-weave="shared/widget/common/comtree/main(' + (c ? h : "") + ')"></div>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <label for="" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Intention City"></span>\r\n                    ',
		this.mandatory.intention_city && (b += '\r\n                    <span class="f_req">*</span>\r\n                    '),
		b += '\r\n                </label>\r\n\r\n                <div class="controls clearfix">\r\n                    <div class="comtree span3" ',
		this.mandatory.intention_city && (b += 'data-required="true"'),
		b += ' data-name="city" data-url="/rest/data/city" data-weave="shared/widget/common/comtree/main(' + (c ? i : "") + ')"></div>\r\n                </div>\r\n                <div class="controls clearfix ',
		(!c || c && !j) && (b += "hide"),
		b += '">\r\n                    <div class="comtree span3" data-name="city1" data-url="/rest/data/city" data-weave="shared/widget/common/comtree/main(' + (c ? j : "") + ')"></div>\r\n                    <a href="#" class="remove" data-action="remove/field"><span class="icon-remove"></span></a>\r\n                </div>\r\n                <div class="controls clearfix ',
		(!c || c && !k) && (b += "hide"),
		b += '">\r\n                    <div class="comtree span3" data-name="city2" data-url="/rest/data/city" data-weave="shared/widget/common/comtree/main(' + (c ? k : "") + ')"></div>\r\n                    <a href="#" class="remove" data-action="remove/field"><span class="icon-remove"></span></a>\r\n                </div>\r\n                <div class="controls controls-add text_line">\r\n                    <a href="#" data-action="add/city" data-weave="shared/helper/translation" data-i18n="Add"></a>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <label for="annualTarget" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Annual Salary"></span>\r\n                    ',
		this.mandatory.annual_salary && (b += '\r\n                    <span class="f_req">*</span>\r\n                    '),
		b += '\r\n                </label>\r\n                <div class="controls">\r\n                    <input type="text" id="annualSalary" name="annualSalary" class="input-small ',
		this.mandatory.annual_salary && (b += "required"),
		b += '" data-weave="shared/helper/translation(\'placeholder\')" data-i18n="Currency symbol" value="' + (c ? g / this.currencyEx : "") + '"> <span data-weave="shared/helper/translation" data-i18n="Currency unit"></span>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <label class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Gender"></span>\r\n                    ',
		this.mandatory.gender && (b += '\r\n                    <span class="f_req">*</span>\r\n                    '),
		b += '\r\n                </label>\r\n                <div class="controls">\r\n                    <label class="radio inline">\r\n                        <input type="radio" id="genderMale" class="',
		this.mandatory.gender && (b += "required"),
		b += '" name="gender" value="true"> <span data-weave="shared/helper/translation" data-i18n="Male"></span>\r\n                    </label>\r\n                    <label class="radio inline">\r\n                        <input type="radio" id="genderFemale" class="',
		this.mandatory.gender && (b += "required"),
		b += '" name="gender" value="false"> <span data-weave="shared/helper/translation" data-i18n="Female"></span>\r\n                    </label>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <label for="dateOfBirth" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Date of birth"></span>\r\n                    ',
		this.mandatory.date_of_birth && (b += '\r\n                    <span class="f_req">*</span>\r\n                    '),
		b += "\r\n                </label>\r\n                ",
		c && d ? (b += '\r\n                <div class="controls" ', this.mandatory.date_of_birth && (b += 'data-required="true"'), b += ' data-weave="app/widget/common/birthday/main(' + d + ", " + e + ", " + f + ')"></div>\r\n                ') : (b += '\r\n                <div class="controls" ', this.mandatory.date_of_birth && (b += 'data-required="true"'), b += ' data-weave="app/widget/common/birthday/main"></div>\r\n                '),
		b += '\r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <label for="address" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Address"></span>\r\n                    ',
		this.mandatory.address && (b += '\r\n                    <span class="f_req">*</span>\r\n                    '),
		b += '\r\n                </label>\r\n                <div class="controls">\r\n                    <input type="text" class="input-xxlarge ',
		this.mandatory.address && (b += "required"),
		b += '" id="address" name="address" value="' + (c ? u : "") + '" />\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <label for="" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Tags"></span>\r\n                    ',
		this.mandatory.tags && (b += '\r\n                    <span class="f_req">*</span>\r\n                    '),
		b += '\r\n                </label>\r\n                <div class="controls">\r\n                    <div class="span5">\r\n                        <input type="text" id="tags" class="',
		this.mandatory.tags && (b += "required"),
		b += '" name="tags" data-type="tag" autocomplete="off" data-weave="shared/widget/common/tagit/main" value="' + (c ? a.tags : "") + '">\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group formSep">\r\n                <label for="linkedin" class="control-label">\r\n                    Linkedin\r\n                    ',
		this.mandatory.linkedin && (b += '\r\n                    <span class="f_req">*</span>\r\n                    '),
		b += '\r\n                </label>\r\n                <div class="controls">\r\n                    <input type="text" id="linkedin" name="linkedin" class="span5 ',
		this.mandatory.linkedin && (b += "required"),
		b += '" data-action="linkedin" value="' + (c ? l : "") + '" placeholder="http://">\r\n                    <span class="has-linkedin hide">\r\n                        <span class="icon-loading-circle hide"></span>\r\n                        <a class="btn" data-weave="shared/helper/translation" data-i18n="Auto match" data-action="auto/match"></a>\r\n                    </span>\r\n                    <span class="no-linkedin hide">\r\n                        <p class="hint">请输入候选人的LinkedIn Public Profile URL</p>\r\n                    </span>\r\n                </div>\r\n                <div class="controls duplicate-info hide"></div>\r\n\r\n                <div class="linkedin-candidate"></div>\r\n            </div>\r\n\r\n            <div class="custom-fields"></div>\r\n            \r\n            ',
		c || (b += '\r\n            <div class="control-group">\r\n                <label class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Shortlist"></span>\r\n                </label>\r\n                <div class="controls">\r\n                    <select name="job" class="input-xxlarge" data-weave="app/widget/common/job-select/main" data-type="client_id"></select>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group formSep">\r\n                <label class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Add to Folder"></span>\r\n                </label>\r\n                <div class="controls">\r\n                    <div class="comtree span4" data-name="folder" data-url="/rest/folder/list?type=candidate" data-weave="shared/widget/common/comtree/main"></div>\r\n                </div>\r\n            </div>\r\n            '),
		b += '\r\n\r\n            <div class="control-group">\r\n                <label for="owner" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Owner"></span>\r\n                    <span class="f_req">*</span>\r\n                </label>\r\n                <div class="controls">\r\n                    <select ',
		c && this.userId !== a.owner.id && (b += 'disabled="disabled"'),
		b += ' name="owner" id="owner" class="input-medium required" data-weave="shared/widget/common/user-list/main(' + (c ? a.owner.id : "") + ')">\r\n                    </select>\r\n                </div>\r\n            </div>\r\n            \r\n            <div class="control-group formSep control-share">\r\n            </div>\r\n\r\n            ',
		c && (b += '\r\n            <div class="control-group">\r\n                <label class="control-label" data-weave="shared/helper/translation" data-i18n="Keyin By">\r\n                </label>\r\n                <div class="controls text_line">\r\n                    <a href="/user/preview#' + a.addedBy.id + '" data-action="profile/open">' + a.addedBy.englishName + '</a>\r\n                    <span class="hint">\r\n                        ' + a.dateAdded + "\r\n                    </span>\r\n                </div>\r\n            </div>\r\n            "),
		b += '\r\n\r\n            <div class="control-group">\r\n                <div class="controls">\r\n                    <button class="btn btn-primary" type="submit" data-action="candidate/add" data-weave="shared/helper/translation" data-i18n="Save"></button>\r\n                </div>\r\n            </div>\r\n        </fieldset>\r\n    </form>\r\n</div>'
	}
}), define("troopjs-requirejs/template!app/widget/candidate/add/linkedin-candidate.html", [], function () {
	return function (a) {
		var b = "",
		c = a.length,
		d = 10,
		e = 0;
		for (b += '\n<div class="controls text_line muted">\n    请选择一个正确的候选人:\n</div>\n'; c > e && d > e; ) {
			b += "\n";
			var f = a[e];
			if ("private" !== f.id) {
				if (b += '\n<div class="controls text_line clearfix">\n    <div class="thumbnail pull-left">\n        <img title="' + f.formattedName + '" src="' + (f.pictureUrl ? f.pictureUrl : "http://s.c.lnkd.licdn.com/scds/common/u/img/icon/icon_no_photo_50x50.png") + '" height="50" width="50">\n    </div>\n    <div class="pull-left muted">\n        <a href="#" data-action="pick/candidate(' + e + ", '" + (f.publicProfileUrl ? f.publicProfileUrl : "") + "')\">" + f.formattedName + "</a>\n        <span>" + f.location.name + "</span>\n        <br>\n        ", f.positions._total) {
					b += "\n        ";
					var g = f.positions.values[0];
					b += "\n        <span>" + g.title + " at " + g.company.name + "</span><br>\n        "
				}
				b += '\n        <button class="btn btn-mini" data-action="pick/candidate(' + e + ", '" + (f.publicProfileUrl ? f.publicProfileUrl : "") + "')\">选择</button>\n    </div>\n</div>\n"
			}
			e++
		}
		return b
	}
}), define("troopjs-requirejs/template!app/widget/candidate/add/attachments.html", [], function () {
	return function (a) {
		for (var b = "", c = 0, d = a.length; d > c; c++) {
			b += "\n";
			var e = a[c];
			b += "\n<li>\n    ",
			b += e.tag ? '\n    <span class="label editable editable-click" data-type="select" data-pk="' + e.id + '" style="background-color:' + e.tag.color + ';">' + e.tag.value + "</span>\n    " : '\n    <span class="label editable editable-click" data-type="select" data-pk="' + e.id + '" data-weave="shared/helper/translation" data-i18n="Unknown"></span>\n    ',
			b += '\n    <a href="#" data-id="' + e.id + '" class="attachment-item file-type-icon ' + e.ext.toLowerCase() + '" data-action="attachment/preview(\'' + e.uuidname + "')\">" + e.originname + '</a>\n    <a href="#" data-action="remove/attachment"><span class="icon-remove"></span></a>\n</li>\n'
		}
		return b
	}
}), define("app/widget/candidate/add/main", ["jquery", "shared/widget/base/main", "troopjs-utils/uri", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "template!./linkedin-candidate.html", "template!./attachments.html", "shared/helper/utils", "shared/helper/validate", "shared/helper/blurb", "config", "jquery.form", "bootstrap.editable"], function (a, b, c, d, e, f, g, h, i, j, k) {
	function l(a) {
		var b = this,
		c = b.$element.find(".f_req:not(.always):not(.experience)");
		a ? (c.removeClass("hide"), b.$element.find(".not-required:not(.experience)").addClass("required").removeClass("not-required"), b.publish("experience/switch/rules", !0)) : (c.addClass("hide"), b.$element.find(".required:not(.experience)").removeClass("required").addClass("not-required"), b.publish("experience/switch/rules", !1))
	}
	function m() {
		var b = this,
		c = {
			mobile : {
				phone : !0,
				checkDuplicate : {
					url : "/rest/candidate/check",
					type : "post",
					checkType : "mobile",
					dataFilter : function (a) {
						var c = JSON.parse(a),
						d = c.data === D ? !0 : !1,
						e = b.$mobile;
						return d || b._json.mobile === c.data.mobile ? (e.closest(".control-group").find(".duplicate-info").addClass("hide"), '"true"') : (n.call(b, e, c.data), '" "')
					}
				}
			},
			email : {
				email : !0,
				checkDuplicate : {
					url : "/rest/candidate/check",
					type : "post",
					checkType : "email",
					dataFilter : function (a) {
						var c = JSON.parse(a),
						d = c.data === D ? !0 : !1,
						e = b.$email;
						return d || b._json.email === c.data.email ? (e.closest(".control-group").find(".duplicate-info").addClass("hide"), '"true"') : (n.call(b, e, c.data), '" "')
					}
				}
			},
			email1 : {
				checkDuplicate : {
					url : "/rest/candidate/check",
					type : "post",
					checkType : "email",
					dataFilter : function (a) {
						var c = JSON.parse(a),
						d = c.data === D ? !0 : !1,
						e = b.$email;
						return d || b._json.email === c.data.email ? (e.closest(".control-group").find(".duplicate-info").addClass("hide"), '"true"') : (n.call(b, e, c.data), '" "')
					}
				}
			},
			email2 : {
				checkDuplicate : {
					url : "/rest/candidate/check",
					type : "post",
					checkType : "email",
					dataFilter : function (a) {
						var c = JSON.parse(a),
						d = c.data === D ? !0 : !1,
						e = b.$email;
						return d || b._json.email === c.data.email ? (e.closest(".control-group").find(".duplicate-info").addClass("hide"), '"true"') : (n.call(b, e, c.data), '" "')
					}
				}
			},
			linkedin : {
				linkedin : !0,
				checkDuplicate : {
					url : "/rest/candidate/check",
					type : "post",
					checkType : "linkedin",
					dataFilter : function (a) {
						var c = JSON.parse(a),
						d = c.data === D ? !0 : !1,
						e = b.$linkedin;
						return d || b._json.linkedin === c.data.linkedin ? (e.closest(".control-group").find(".duplicate-info").addClass("hide"), '"true"') : (n.call(b, e, c.data), '" "')
					}
				}
			},
			owner : {
				required : !0
			},
			annualSalary : {
				number : !0,
				min : 0,
				max : 1e4
			}
		};
		b.mandatory.englishName_or_chineseName && (c = a.extend(!0, c, {
					englishName : {
						require_from_group : [1, ".fill-one-name"]
					},
					chineseName : {
						require_from_group : [1, ".fill-one-name"]
					}
				})),
		j(b.$form, {
			rules : c,
			messages : {
				mobile : {
					require_from_group : "邮箱或手机必须填写一项"
				},
				email : {
					require_from_group : "邮箱或手机必须填写一项"
				}
			}
		})
	}
	function n(a, b) {
		var c = a.closest(".control-group").find(".duplicate-info").removeClass("hide");
		c.data("json", {
			islimited : b.islimited,
			candidate : {
				id : b.id,
				englishName : b.englishName,
				chineseName : b.chineseName,
				title : b.title,
				company : b.company
			},
			owner : {
				id : b.owner.id,
				englishName : b.owner.englishName,
				chineseName : b.owner.chineseName
			}
		}).attr("data-weave", G + "(json)").weave()
	}
	function o(b) {
		var c,
		d = this;
		c = a.isArray(b) ? b : b.split(",");
		for (var e = c.length; e--; )
			d.$tags.tagit("createTag", c[e])
	}
	function p(a) {
		this.$email.val(a),
		this.$email.blur()
	}
	function q(a) {
		this.$chineseName.val(a)
	}
	function r(a) {
		this.$englishName.val(a)
	}
	function s(a) {
		this.$mobile.val(a),
		this.$mobile.blur()
	}
	function t(a) {
		this.$gender.filter('[value="' + a + '"]').prop("checked", !0)
	}
	function u(a) {
		this.$linkedin.val(a)
	}
	function v(a) {
		var b = a.split("-"),
		c = b[0],
		d = b[1],
		e = b[2];
		c && this.$year.val(c).trigger("change"),
		d && this.$month.val(d),
		e && this.$day.val(e)
	}
	function w(a) {
		var b = this;
		a.email && p.call(b, a.email),
		a.chineseName && q.call(b, a.chineseName),
		a.englishName && r.call(b, a.englishName),
		a.mobile && s.call(b, a.mobile),
		a.tags && o.call(b, a.tags),
		a.gender && t.call(b, Boolean(parseInt(a.gender, 10))),
		a.dateOfBirth && v.call(b, a.dateOfBirth),
		a.linkedin && u.call(b, a.linkedin),
		a.education.length && b.publish("education/reset", a.education),
		a.experiences.length && (a.city && (a.experiences[0].city = a.city), b.publish("experience/reset", a.experiences))
	}
	function x() {
		var b = this;
		b.$btnFile.data("json", {
			multiple : !0,
			data : {
				type : "candidate"
			},
			beforeSubmit : function (a, c, d) {
				b.$btnFile.prev().addClass("hide"),
				this.$controls = b.$btnFile.closest(".controls"),
				this.$controls.addClass("text_line");
				var e = JSON.parse(d.data.data);
				e.tag = b.$attachmentType.val(),
				d.data.data = JSON.stringify(e)
			},
			success : function (c) {
				if (b.$btnFile.prev().removeClass("hide"), this.$controls.removeClass("text_line"), c.status) {
					var d = a(h(c.data));
					b.$attachmentList.append(d),
					b.$attachmentList.closest(".controls").removeClass("hide"),
					d.find('a[data-action*="attachment/preview"]').eq(0).trigger("click"),
					d.find("[data-weave]").weave(),
					c.data.forEach(function (a, c) {
						0 === c && !b.editMode && a.extract && w.call(b, a.extract),
						b._attachmentsUuidname.push(a.uuidname)
					})
				} else
					i.alert("error", c.message)
			},
			error : function () {
				this.$controls.removeClass("text_line")
			}
		}).attr("data-weave", "shared/widget/common/upload/main(json)").weave()
	}
	function y(b) {
		var c = this,
		e = {},
		f = [];
		c.publish("ajax", {
			url : I.TEMP_FILE.replace("<uuidname>", b)
		}, d().done(function (b) {
				var d = a(h(b));
				c.$attachmentList.append(d),
				c.$attachmentList.closest(".controls").removeClass("hide"),
				d.find("[data-weave]").weave();
				for (var g = 0, i = b.length; i > g; g++) {
					var j = b[g];
					j.extract.englishName || delete j.extract.englishName,
					j.extract.chineseName || delete j.extract.chineseName,
					e = a.extend(!0, j.extract, e),
					f = a.extend(!0, f, j.extract.tags),
					d.find('.controls a[data-action*="attachment/preview').eq(0).data("guess", e).data("tags", f),
					c._attachmentsUuidname.push(j.uuidname)
				}
				d.find('a[data-action*="attachment/preview"]').eq(0).trigger("click"),
				w.call(c, e),
				o.call(c, f)
			}))
	}
	function z() {
		var a = this;
		a.editMode !== D && a.userId !== D && a.publish("ajax", {
			url : I.CONFIG_KEYS
		}, d().done(function (b) {
				a.mandatory = JSON.parse(b[0].value),
				a.publish("experience/mandatory", a.mandatory),
				a.editMode ? A.call(a) : B.call(a)
			}))
	}
	function A() {
		var a = this;
		a.publish("ajax", {
			url : I.CANDIDATE.replace("<id>", a._cid)
		}, d().done(function (b) {
				a._json = b,
				B.call(a)
			}))
	}
	function B() {
		var a = this;
		d(function (b) {
			a.html(f, a._json, b)
		}).then(function () {
			C.call(a)
		})
	}
	function C() {
		var b = this,
		e = b.$element.find("form").eq(1),
		f = "",
		g = null,
		j = c(window.location.hash.replace(/^#/, ""));
		if (b.$form = e, b.$attachments = a("#attachments"), b.$type = e.find('[name="type"]'), b.$email = a("#email"), b.$chineseName = a("#chineseName"), b.$englishName = a("#englishName"), b.$gender = a('[name="gender"]:radio'), b.$mobile = a('[name="mobile"]'), b.$location = e.find('[name="location"]'), b.locationWidget = e.find('[data-name="location"]'), b.$city = e.find('[name="city"]'), b.$city1 = e.find('[name="city1"]'), b.$city2 = e.find('[name="city2"]'), b.$year = a("#birthYear"), b.$month = a("#birthMonth"), b.$day = a("#birthDay"), b.$linkedin = a("#linkedin"), b.$ajaxLoader = b.$element.find(".icon-loading-circle"), b.$linkedinArea = b.$element.find(".linkedin-candidate"), b.$tags = b.$element.find("#tags"), b.$btnFile = b.$element.find(".upload-file"), b.$expBlock = e.find(".experience-block"), b.$eduBlock = e.find(".education-block"), b.$education = e.find("#education"), b.$school = e.find("#school"), b.$job = e.find('[name="job"]'), b.$controlShare = e.find(".control-share"), b.$mpc = e.find('[name="is_mpc"]'), b.$attachmentList = b.$element.find(".attachment-list"), b.$attachmentType = b.$element.find('[name="attachment-type"]'), x.call(b), b.publish("ajax", {
				url : I.ISBINDED
			}, d().done(function (a) {
					a.data.binded && a.data.expire >= 0 ? e.find(".has-linkedin").removeClass("hide") : e.find(".no-linkedin").removeClass("hide")
				})), b.editMode && (b.$gender.filter('[value="' + b._json.gender + '"]').prop("checked", !0), f = b._json.share, g = b._json.tags, b.userId !== b._json.owner.id && b.$controlShare.data("disabled", !0), b.publish("ajax", {
					url : I.GET_ATTACHMENTS.replace("<id>", b._cid)
				}, d().done(function (c) {
						var d = a(h(c));
						b.$attachmentList.append(d),
						d.find("[data-weave]").weave(),
						b.$attachmentList.closest(".controls").removeClass("hide")
					}))), b.$controlShare.data("json", f).attr("data-weave", H + "(json)").weave(), b.$expBlock.data("json", a.isEmptyObject(b._json.experiences) ? null : b._json.experiences).attr("data-weave", E + "(json)").weave(d().done(function () {
					var a = b.$type.filter(":checked").data("checked", !0);
					if ("coldcall" === a.val() && l.call(b, !1), j.path)
						for (var c = j.path, e = 0, f = c.length; f > e; e++)
							if (c[e].match(/^company=(\d+)/)) {
								b.publish("ajax", {
									url : I.COMPANY.replace("<id>", RegExp.$1)
								}, d().done(function (a) {
										b.$element.find('[name*="company-"]').eq(0).val(a.name)
									}));
								break
							}
				})), b.$eduBlock.data("json", a.isEmptyObject(b._json.education) ? null : b._json.education).attr("data-weave", F + "(json)").weave(), b.uuidname && y.call(b, b.uuidname), j.path)
			for (var k = j.path, n = 0, o = k.length; o > n; n++)
				if (k[n].match(/^job=(\d+)/)) {
					b.$job.val(RegExp.$1).trigger("change");
					break
				}
		m.call(b),
		b.$element.find("form").eq(0).editable({
			selector : "span.label",
			mode : "inline",
			emptytext : "未知",
			source : I.CATEGORY,
			sourceCache : !0,
			url : I.EDIT_CATE,
			params : function (a) {
				return a.id = a.pk,
				a.tag = a.value,
				delete a.value,
				delete a.pk,
				delete a.name, {
					data : JSON.stringify(a)
				}
			},
			success : function (b) {
				a(this).css("background-color", b.data.tag.color).text(b.data.tag.value)
			},
			error : function (a) {
				var b = JSON.parse(a.responseText);
				i.alert("error", b.message)
			}
		}),
		b.$element.find(".custom-fields").data("json", b._json).attr("data-weave", "app/widget/common/custom-fields/main('candidate', json)").weave(),
		i.widgetLoaded.call(b)
	}
	var D,
	E = "app/widget/candidate/add/experience/main",
	F = "app/widget/candidate/add/education/main",
	G = "app/widget/common/share-request/main",
	H = "shared/widget/common/add-share/main",
	I = {
		ADD : "/rest/candidate/add",
		LIST : "/rest/data/<type>/list",
		CANDIDATE : "/rest/candidate/<id>",
		ISBINDED : "/rest/linkedin/isbinded",
		SEARCH_LINKEDIN : "/rest/linkedin/search?first-name=<firstName>&last-name=<lastName>",
		TEMP_FILE : "/rest/file/list/temp/<uuidname>",
		CONFIG_KEYS : "/rest/data/configvalue?keys=candidate_require_fields",
		MERGE_ATTACHMENT : "/rest/file/bind_candidate",
		GET_ATTACHMENTS : "/rest/file/list/candidate/<id>",
		CATEGORY : "/rest/data/options?type=candidate_attachment_category",
		EDIT_CATE : "/rest/file/edit",
		COMPANY : "/rest/client/<id>"
	},
	J = {
		SUCCESSFULLY : k.t("Operate successfully")
	};
	return b.extend(function () {
		this._attachmentsUuidname = []
	}, {
		"hub:memory/add/id/change" : function (a, b) {
			var c = this;
			c._cid = b,
			c.uuidname = D,
			c._json = {},
			c.editMode = c._cid !== D ? !0 : !1,
			c.subscribe("context", !0, function (a, b) {
				switch (c.userId = b.user.id, b.user.lang) {
				case "cn":
					c.currencyEx = 1e4;
					break;
				case "en":
					c.currencyEx = 1e3;
					break;
				default:
					c.currencyEx = 1e4
				}
				z.call(c)
			})
		},
		"hub:memory/add/other/change" : function (a, b) {
			var c = this;
			b && (c.uuidname = b, c.editMode = !1, c.subscribe("context", !0, function (a, b) {
					switch (c.userId = b.user.id, b.user.lang) {
					case "cn":
						c.currencyEx = 1e4;
						break;
					case "en":
						c.currencyEx = 1e3;
						break;
					default:
						c.currencyEx = 1e4
					}
					z.call(c)
				}))
		},
		"hub:memory/location/set" : function (a, b) {
			var c = this;
			c.$location.val() || c.locationWidget.woven()[0].selectById(b)
		},
		"hub/merge/attachment" : function (a, b, c) {
			var e = this;
			return e._attachmentsUuidname.length ? (c.prop("disabled", !0), e.publish("ajax", {
					url : I.MERGE_ATTACHMENT,
					data : {
						data : JSON.stringify({
							candidate_id : b,
							uuidname : e._attachmentsUuidname
						})
					},
					type : "post"
				}, d().done(function (a) {
						a.status ? i.alert("success", J.SUCCESSFULLY) : i.alert("error", a.message)
					})), void 0) : (i.alert("error", "No file selected!"), void 0)
		},
		"dom/action.click.change" : a.noop,
		"dom/action/people/type.click" : function (b, c) {
			var d = this,
			e = a(c.target);
			"coldcall" === e.val() ? l.call(d, !1) : l.call(d, !0)
		},
		"dom/action/linkedin.change" : function (b, c) {
			var d = a(c.target),
			e = "",
			f = /^(.*)(\/)$/,
			g = d.val();
			e = g.replace(f, "$1"),
			g.length && !/^http:\/\/.*/.test(e) && (e = "http://" + e),
			d.val(e)
		},
		"dom/action/attachment/preview.click" : function (b, c, d) {
			c.preventDefault();
			var e = this;
			a(c.target),
			e.publish("slide-helper/attachment/reload", d)
		},
		"dom/action/history/back.click" : function (a, b) {
			b.preventDefault(),
			window.history.back()
		},
		"dom/action/auto/match.click" : function (b, c) {
			c.preventDefault();
			var e = this,
			f = a(c.target);
			f.closest(".controls");
			var h = e.$englishName.val().trim().length ? e.$englishName.val().trim().split(" ") : null,
			j = h ? h[0] : "",
			k = h && h[1] ? h[1] : "";
			f.addClass("hide"),
			e.$ajaxLoader.removeClass("hide"),
			e.$linkedinArea.children().remove(),
			e.publish("ajax", {
				url : I.SEARCH_LINKEDIN.replace("<firstName>", j).replace("<lastName>", k)
			}, d().done(function (a) {
					if (a.status) {
						if (a.data && a.data.people && a.data.people._total) {
							var b = g(a.data.people.values);
							e.$linkedinArea.html(b),
							e.linkedinCandidates = a.data.people.values
						}
					} else
						401 === a.message ? i.alert("error", 'Linkedin绑定已过期，请点击<a href="/bind/oauth" tagert="_blank">此处</a>重新绑定!') : i.alert("error", a.message)
				}).always(function () {
					f.removeClass("hide"),
					e.$ajaxLoader.addClass("hide")
				}))
		},
		"dom/action/pick/candidate.click" : function (a, b, c, d) {
			b.preventDefault();
			var e = this,
			f = e.linkedinCandidates[c],
			g = {
				city : null,
				experiences : []
			};
			e.$linkedinArea.children().remove(),
			d ? (e.$linkedin.val(d), e.$form.validate().element("#linkedin")) : alert("该候选人没有共享Linkedin主页!"),
			f && f.positions && f.positions._total && f.positions.values.forEach(function (a) {
				g.experiences.push({
					start : a.startDate.year + "-" + a.startDate.month,
					company : a.company.name,
					end : a.isCurrent ? null : a.endDate.year + "-" + a.endDate.month,
					is_current : a.isCurrent,
					title : a.title || ""
				})
			}),
			w.call(e, g)
		},
		"dom/action/candidate/add.click" : function (b, c) {
			c.preventDefault();
			var e = this,
			f = a(c.target);
			if (e.$form.valid() && e.$form.valid()) {
				var g,
				h = function () {
					var b = [];
					return e.$element.find('[name="share_with"]').each(function () {
						var c = a(this),
						d = c.val(),
						e = function () {
							var a;
							return c.next().find("select").length ? a = c.next().find("select").val() : c.next().find("input").length && (a = c.next().find("input").val()),
							a
						}
						();
						b.push({
							type : d,
							value : e
						})
					}),
					b
				}
				(),
				j = a("#birthYear").val(),
				k = a("#birthMonth").val(),
				l = a("#birthDay").val();
				g = j ? j + "-" + (k || "01") + "-" + (l || "01") : null;
				var m = function () {
					var a = null;
					return e.$gender.filter(":checked").length && (a = "true" === e.$gender.filter(":checked").val()),
					a
				}
				(),
				n = function () {
					var b = [],
					c = e.$expBlock.find(".experience-item");
					return c.each(function () {
						var c = a(this),
						d = c.data("id"),
						e = c.find('[name*="current"]').is(":checked") ? 1 : 0,
						f = c.find('[name*="started-year"]').val() + "-" + c.find('[name*="started-month"]').val(),
						g = e ? null : c.find('[name*="ended-year"]').val() + "-" + c.find('[name*="ended-month"]').val(),
						h = c.find('[name*="company"]').val().trim();
						h.length && b.push({
							is_current : e,
							company_name : c.find('[name*="company"]').val().trim(),
							title : c.find('[name*="title"]').val().trim(),
							company_industry : c.find('[name*="company-industry"]').val(),
							start : f ? f.replace(/-$/, "") : f,
							end : g ? g.replace(/-$/, "") : g,
							company_city : c.find('[name*="company-city"]').val(),
							id : d,
							"function" : c.find("[name*=function1]").val(),
							function2 : c.find("[name*=function2]").val(),
							function3 : c.find("[name*=function3]").val(),
							description : c.find('[name*="description"]').val()
						})
					}),
					b
				}
				(),
				o = function () {
					var b = [],
					c = e.$eduBlock.find(".education-item");
					return c.each(function () {
						var c = a(this),
						d = c.data("id"),
						e = c.find('[name*="current"]').is(":checked") ? 1 : 0,
						f = c.find('[name*="started-year"]').val() + "-" + c.find('[name*="started-month"]').val(),
						g = e ? null : c.find('[name*="ended-year"]').val() + "-" + c.find('[name*="ended-month"]').val(),
						h = c.find('[name*="school"]').val().trim(),
						i = c.find('[name*="major"]').val().trim(),
						j = c.find('[name*="degree"]').val().trim();
						b.push({
							is_current : e,
							school : h,
							major : i,
							degree : j,
							start : f ? f.replace(/-$/, "") : f,
							end : g ? g.replace(/-$/, "") : g,
							id : d
						})
					}),
					b
				}
				(),
				p = function () {
					var b = [];
					return e.$element.find(".attachment-item").each(function () {
						b.push(a(this).data("id"))
					}),
					b.join(",")
				}
				(),
				q = {
					englishName : a("#englishName").val().trim(),
					chineseName : a("#chineseName").val().trim(),
					dateOfBirth : g,
					monthNull : !k,
					dayNull : !l,
					gender : m,
					annualSalary : a("#annualSalary").val() * e.currencyEx,
					tags : e.$tags.val(),
					location : e.$location.val(),
					city : e.$city.val(),
					city1 : e.$city1.val(),
					city2 : e.$city2.val(),
					email : e.$email.val().trim(),
					email1 : e.$element.find('[name="email1"]').val().trim(),
					email2 : e.$element.find('[name="email2"]').val().trim(),
					mobile : e.$mobile.val().trim(),
					mobile1 : e.$element.find('[name="mobile1"]').val().trim(),
					mobile2 : e.$element.find('[name="mobile2"]').val().trim(),
					type : e.$type.filter(":checked").val(),
					owner : a("#owner").val(),
					attachments : p,
					shares : h,
					linkedin : e.$linkedin.val().trim(),
					experiences : n,
					education : o,
					address : a("#address").val().trim(),
					is_mpc : e.$mpc.is(":checked") ? 1 : 0,
					folder_id : e.$element.find('[name="folder"]').val(),
					joborder_id : e.$job.val()
				};
				e.$element.find(".custom-fields .control-group").each(function () {
					var b = a(this),
					c = b.find('[name*="ext"]'),
					d = c.attr("name"),
					e = c.attr("type");
					q[d] = "radio" === e ? c.filter(":checked").val() : "checkbox" === e ? function () {
						var b = [];
						return c.filter(":checked").each(function () {
							b.push(a(this).val())
						}),
						b.join(",")
					}
					() : c.val().trim()
				}),
				e.editMode && (q.id = e._json.id),
				e.publish("ajax", {
					url : I.ADD,
					data : {
						data : JSON.stringify(q)
					},
					type : "post"
				}, d().done(function (a) {
						a.status ? (i.alert("success", J.SUCCESSFULLY), window.location.hash = e.editMode ? "detail!id=" + e._json.id : "list") : i.alert("error", a.message)
					}), f)
			}
		},
		"dom/action/remove/field.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = d.closest(".controls").addClass("hide");
			e.find("input").val(""),
			e.find('[data-woven*="shared/widget/common/comtree/main"]').length && e.find('[data-woven*="shared/widget/common/comtree/main"]').woven()[0].reset()
		},
		"dom/action/add/fn.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = d.closest(".control-group").find(".controls").filter(".hide").eq(0);
			return e.length ? (e.removeClass("hide"), void 0) : (alert("Add up to three items"), void 0)
		},
		"dom/action/add/city.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = d.closest(".control-group").find(".controls").filter(".hide").eq(0);
			return e.length ? (e.removeClass("hide"), void 0) : (alert("Add up to three items"), void 0)
		},
		"dom/action/profile/open.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = d.attr("href");
			i.window({
				url : e,
				name : "User Profile",
				width : "1024"
			})
		},
		"dom/action/remove/attachment.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = window.confirm("确定要删除此附件吗?");
			e && (1 === d.closest(".controls").find("li").length && d.closest(".controls").addClass("hide"), d.closest("li").remove())
		},
		"dom/action/show/paste/modal.click" : function (a, b) {
			b.preventDefault();
			var c = this;
			c.publish("modal/paste-resume/show", {
				onSuccess : function (a) {
					var b = a.data.replace(/^.*file=(.*)$/, "$1");
					y.call(c, b)
				}
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/candidate/detail/changelog/main.html", [], function () {
	return function (a) {
		for (var b = "", c = 0, d = a.length; d > c; c++) {
			var e = a[c],
			f = e.dateAdded.split(" "),
			g = f[0],
			h = f[1],
			i = e.user,
			j = i.id,
			k = i.englishName,
			l = e.log;
			b += '\n<div class="activity-item clearfix">\n    <div class="pull-left span2 activity-time">\n        <p>\n            <span>' + h + "</span>\n            <span>" + g + '</span>\n            <a href="/user/preview#' + j + '" data-action="profile/open">' + k + '</a>\n        </p>\n    </div>\n    <div class="pull-left span10 activity-detail">\n        <div class="well">\n            <div class="content">\n                <ul class="unstyled">\n                    ';
			for (var m in l)
				b += "\n                    ", l.hasOwnProperty(m) && (b += "\n                    <li>" + this.getField(m) + ": <strike>" + this.getValue(m, l[m][0]) + "</strike> " + this.getValue(m, l[m][1]) + "</li>\n                    "), b += "\n                    ";
			b += "\n                </ul>\n            </div>\n        </div>\n    </div>\n</div>\n"
		}
		return b
	}
}), define("app/widget/candidate/detail/changelog/main", ["compose", "jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "shared/helper/blurb", "shared/helper/utils", "config"], function (a, b, c, d, e, f, g, h, i) {
	function j(a) {
		var c = this,
		g = d(),
		h = d(),
		i = [g.promise(), h.promise()];
		c.publish("ajax", {
			url : l.LOG.replace("<id>", c._id)
		}, g.done(function (a) {
				c._json = a,
				c.publish(m, "change", a.length)
			})),
		c.publish("ajax", {
			url : l.TABLE
		}, h.done(function (a) {
				a.forEach(function (a) {
					o[a.mapping] = a.label
				})
			})),
		e.apply(b, i).done(function () {
			c.html(f, c._json, a)
		})
	}
	var k,
	l = {
		LOG : "/rest/updatelog/list?type=candidate&external_id=<id>",
		TABLE : "/rest/data/fields?table=candidate"
	},
	m = "candidate/action/count",
	n = {
		CURRENCY_UNIT : g.t("Currency unit"),
		CURRENCY_SYM : g.t("Currency symbol")
	};
	switch (i.userLang) {
	case "zh_CN":
		k = 1e4;
		break;
	case "en":
		k = 1e3;
		break;
	default:
		k = 1e4
	}
	var o = {
		industry : g.t("Industry"),
		"function" : g.t("Function"),
		function1 : g.t("Function"),
		function2 : g.t("Function"),
		location : g.t("City"),
		city : g.t("Intention City"),
		city1 : g.t("Intention City"),
		city2 : g.t("Intention City"),
		gender : g.t("Gender"),
		title : g.t("Title"),
		mobile : g.t("Mobil"),
		mobile1 : g.t("Telephone"),
		mobile2 : g.t("Other"),
		dateOfBirth : g.t("Date of birth"),
		chineseName : g.t("Chinese Name"),
		englishName : g.t("English Name"),
		attachment : g.t("Attachment"),
		company : g.t("Company"),
		nationality : g.t("Nationality"),
		address : g.t("address"),
		linkedin : "LinkedIn",
		annualSalary : g.t("Annual Salary"),
		type : g.t("Type"),
		email : g.t("Private email"),
		email1 : g.t("Work email"),
		email2 : g.t("Other"),
		owner : g.t("Owner"),
		is_mpc : "MPC"
	};
	return c.extend(function (a, b, c) {
		this._id = c
	}, {
		"sig/initialize" : function (a, b) {
			j.call(this, b)
		},
		getField : function (a) {
			var b = "";
			return b = o[a] || a
		},
		getValue : function (a, b) {
			var c = b;
			switch (a) {
			case "type":
				"candidate" === b ? c = g.t("Candidate") : "contact" === b ? c = g.t("Contact") : "coldcall" === b && (c = g.t("Cold Call"));
				break;
			case "annualSalary":
				c = n.CURRENCY_SYM + " " + (b / k).toFixed(0) + n.CURRENCY_UNIT;
				break;
			case "is_mpc":
				c = g.t("True" === b ? "Yes" : "No")
			}
			return c
		},
		"dom/action.click" : b.noop,
		"dom/action/profile/open.click" : function (a, c) {
			c.preventDefault();
			var d = b(c.target),
			e = d.attr("href");
			h.window({
				url : e,
				name : "User Profile",
				width : "1024"
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/candidate/detail/email-tab/main.html", [], function () {
	return function (a) {
		var b = '<table class="table table_vam mbox_table" >\n    <colgroup>\n        <col width="">\n        <col width="">\n        <col width="">\n        <col width="125">\n        <col width="50">\n    </colgroup>\n    <thead>\n        <tr>\n            <th><span data-weave="shared/helper/translation" data-i18n="Sender"></span></th>\n            <th><span data-weave="shared/helper/translation" data-i18n="To"></span></th>\n            <th><span data-weave="shared/helper/translation" data-i18n="Subject"></span></th>\n            <th><span data-weave="shared/helper/translation" data-i18n="Date"></span></th>\n            <th><span data-weave="shared/helper/translation" data-i18n="Attachment"></span></th>\n        </tr>\n    </thead>\n    <tbody data-weave="app/widget/candidate/detail/email-tab/row(\'' + a + "')\"></tbody>\n</table>\n\n<!-- pagination -->\n<div class=\"pagination clearfix hide\" data-weave=\"shared/widget/pagination/main('candidate-email', 'load')\"></div>";
		return b
	}
}), define("app/widget/candidate/detail/email-tab/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "shared/helper/blurb"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		b.html(d, this._id, a)
	}
	function g(a) {
		var b = this;
		e.widgetLoaded.call(b),
		a.resolve()
	}
	return b.extend(function (a, b, c) {
		this._id = c
	}, {
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"sig/start" : function (a, b) {
			g.call(this, b)
		}
	})
}), define("troopjs-requirejs/template!app/widget/candidate/detail/email-tab/row.html", [], function () {
	return function (a) {
		var b = "",
		c = a.list,
		d = 0,
		e = c.length;
		if (b += "\n", e) {
			for (b += "\n", d; e > d; d++) {
				b += "\n";
				var f = c[d];
				b += '\n<tr class="',
				f.status || (b += "unread"),
				b += '" data-action="view/detail" data-id="' + f.id + '">\n    <td>' + this.formatEmail(f._from) + "</td>\n    ";
				var g = f.to.split(","),
				h = g.length,
				i = this.formatEmail(g[0]);
				h > 1 && (i += " ..."),
				b += "\n    <td>" + i + "</td>\n    <td>" + f.subject + "</td>\n    <td>" + (f.dateAdded ? f.dateAdded : "") + "</td>\n    <td> \n        ",
				f.attachment && (b += '\n        <span class="icon-paper-clip"></span>\n        '),
				b += "\n    </td>\n</tr>\n"
			}
			b += "\n"
		} else
			b += '\n<tr>\n    <td colspan="5">\n        <p class="text-center" data-weave="shared/helper/translation" data-i18n="No data available in table">\n        </p>\n    </td>\n</tr>\n';
		return b
	}
}), define("app/widget/candidate/detail/email-tab/row", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./row.html", "shared/helper/utils", "shared/helper/blurb"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		b._id ? b.publish("ajax", {
			url : g.LIST.replace("<id>", b._id).replace("<page>", h)
		}, c().done(function (c) {
				b._json = c,
				b.publish(j, "email", c.count),
				b.publish(i, c),
				b.html(d, c, a)
			})) : a.resolve()
	}
	function f(a) {
		a.resolve()
	}
	var g = {
		LIST : "/rest/mail/list?paginate_by=20&candidate_id=<id>&page=<page>",
		DETAIL : "/mail/center#detail!<id>"
	},
	h = 1,
	i = "candidate-email/paging/set",
	j = "candidate/action/count";
	return b.extend(function (a, b, c) {
		this._id = c
	}, {
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		},
		"sig/start" : function (a, b) {
			f.call(this, b)
		},
		"hub/make/load" : function (a, b) {
			var d = this;
			h = b.page,
			e.call(d, c())
		},
		"hub/candidate/email/tab/reload" : function () {
			var a = this;
			h = 1,
			e.call(a, c())
		},
		"dom/action.click" : a.noop,
		"dom/action/view/detail.click" : function (b, c) {
			var d = a(c.target),
			e = d.closest("tr");
			e.hasClass("unread") && e.removeClass("unread"),
			window.open(g.DETAIL.replace("<id>", e.data("id")), "_blank")
		},
		formatEmail : function (a) {
			return a ? a.replace(/</g, "&lt;").replace(/>/g, "&gt;") : ""
		}
	})
}), define("troopjs-requirejs/template!app/widget/candidate/detail/floating-tab/main.html", [], function () {
	return function () {
		var a = '<table class="table table-striped table-bordered">\n    <colgroup>\n        <col width="30">\n        <col width="50">\n        <col width="">\n        <col>\n        <col width="">\n        <col width="">\n        <col width="">\n        <col width="">\n        <col width="70">\n    </colgroup>\n    <thead>\n        <tr>\n            <th>\n                <input type="checkbox" data-action="check/all">\n            </th>\n            <th data-weave="shared/helper/translation" data-i18n="Email"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Candidate"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Contact"></th> \n            <th data-weave="shared/helper/translation" data-i18n="Company"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Note"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Time"></th>\n            <th data-weave="shared/helper/translation" data-i18n="User"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Feedback"></th>\n        </tr>\n    </thead>\n    <tbody></tbody>\n</table>';
		return a
	}
}), define("app/widget/candidate/detail/floating-tab/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "shared/helper/utils", "template!./main.html", "shared/helper/blurb", "jquery.datatables"], function (a, b, c, d, e, f, g) {
	function h(a) {
		var b = this;
		b.html(f, a)
	}
	function i(b) {
		var f,
		h,
		i = this,
		j = [];
		i.$table = i.$element.find("table"),
		i.publish("ajax", {
			url : i._url
		}, c().done(function (k) {
				k.list.length && k.list.forEach(function (a) {
					f = c(),
					h = f.promise(),
					j.push(h),
					i.appendItem(a, f)
				}),
				d.apply(a, j).then(function () {
					i.$table.dataTable({
						sDom : "ft",
						bPaginate : !1,
						bLengthChange : !1,
						aaSorting : [],
						oLanguage : {
							sSearch : "",
							sEmptyTable : g.t("No data available in table")
						},
						aoColumnDefs : [{
								bSortable : !1,
								aTargets : [0]
							}, {
								bSortable : !1,
								aTargets : [1]
							}
						],
						fnInitComplete : function () {
							var a = i.$table.closest(".dataTables_wrapper").find(".dataTables_filter"),
							b = a.find("label");
							a.prepend('<div class="input-prepend pull-right"><span class="add-on"><i class="icon-search"></i></span></div>'),
							a.find(".input-prepend").append(b),
							b.find("input").attr("placeholder", "搜索")
						}
					})
				}),
				e.widgetLoaded.call(i),
				b.resolve()
			}))
	}
	var j = {
		DONE : "/rest/todo/done"
	};
	return b.extend(function (a, b, c, d) {
		var e = d || "candidate";
		this._url = ("/rest/floating/list?paginate_by=50&<type>=" + c).replace("<type>", e)
	}, {
		"sig/initialize" : function (a, b) {
			h.call(this, b)
		},
		"sig/start" : function (a, b) {
			var c = this;
			i.call(c, b)
		},
		"hub/add/task/count" : function () {
			var a = this;
			a.$element.find("tbody").children().remove(),
			i.call(a, c())
		},
		appendItem : function (a, b) {
			var c = this;
			c.$element.find("tbody").append("<tr></tr>"),
			c.$element.find("tbody").children().last().data("json", a).attr("data-weave", "app/widget/floating/item(json)").weave(b)
		},
		"dom/action.change" : a.noop,
		"dom/action/check/all.change" : function (b, d) {
			var f,
			g = this,
			h = a(d.target),
			i = h.is(":checked"),
			k = [];
			i ? (f = g.$element.find("tbody :checkbox").filter(":not(:disabled)").filter(":not(:checked)"), f.prop("checked", !0)) : (f = g.$element.find("tbody :checkbox").filter(":not(:disabled)").filter(":checked"), f.prop("checked", !1)),
			f.each(function () {
				k.push(a(this).data("id"))
			}),
			k.length && g.publish("ajax", {
				url : j.DONE,
				data : {
					data : JSON.stringify({
						ids : k,
						done : i
					})
				},
				type : "POST"
			}, c().done(function (a) {
					a.status ? e.alert("success", "任务状态更改成功!") : e.alert("error", a.data || a.message)
				}))
		}
	})
}), define("troopjs-requirejs/template!app/widget/candidate/detail/linkedin-tab/main.html", [], function () {
	return function (a) {
		var b = "",
		c = a.data,
		d = c.positions && c.positions.values ? c.positions.values : [],
		e = c.skills;
		if (b += '\n<div class="linkedin-content clear">\n    <div class="sepH_b clearfix">\n        <div class="thumbnail pull-left" style="margin-right: 10px">\n            <img alt="' + c.formattedName + '" src="' + (c.pictureUrl ? c.pictureUrl : "http://s.c.lnkd.licdn.com/scds/common/u/img/icon/icon_no_photo_100x100.png") + '">\n        </div>\n        <div class="pull-left">\n            <h3>' + c.formattedName + "</h3>\n            <div>\n                ", c.location && c.location.name && (b += '\n                <span class="muted">' + c.location.name + "</span>\n                "), b += "\n                ", c.industry && (b += '\n                | <span class="muted"><span data-weave="shared/helper/translation" data-i18n="Industry"></span>: ' + c.industry + "</span>\n                "), b += "\n                ", c.years_of_experience && (b += '\n                | <span class="muted"><span data-weave="shared/helper/translation" data-i18n="Years of experience"></span>: <strong>' + c.years_of_experience + "年</strong></span>\n                "), b += "\n            </div>\n            <div>\n                ", c.publicProfileUrl && (b += '\n                <a href="' + c.publicProfileUrl + '" target="_blank" class="icon-link">\n                   <span class="icon-linkedin icon-blue"></span>\n                </a>\n                '), b += "\n                ", c.numConnections && (b += '\n                <span class="muted"><span class="icon-connection icon-blue"></span><strong>' + c.numConnections, c.numConnections >= 500 && (b += "+"), b += "</strong></span>\n                "), b += "\n            </div>\n        </div>\n    </div>\n\n    ", c.summary && (b += '\n    <h3 data-weave="shared/helper/translation" data-i18n="简介"></h3>\n    <div class="entity">\n        ' + c.summary + "\n    </div>\n    "), b += "\n\n    ", d.length) {
			b += '\n    \n    <h3 data-weave="shared/helper/translation" data-i18n="Work Experiences"></h3>\n    ';
			for (var f = 0, g = d.length; g > f; f++) {
				b += "\n    ";
				var h = d[f];
				b += '\n    <div class="entity sepH_b">\n        ',
				h.company && (b += "\n        <div>\n            <strong>" + h.company.name + "</strong>\n        </div>\n        "),
				b += '\n\n        <span class="muted">' + (h.company.type ? h.company.type + "; " : "") + (h.company.size ? h.company.size + "; " : "") + (h.company.industry ? h.company.industry : "") + '</span>\n\n        <div class="muted">' + h.startDate.year + "-" + h.startDate.month + " – " + (h.endDate ? h.endDate.year + "-" + h.endDate.month : "Present") + "</div>\n\n        ",
				h.title && (b += "\n        <div>" + h.title + "</div>\n        "),
				b += "\n\n        ",
				h.summary && (b += "\n        <div>" + h.summary + "</div>\n        "),
				b += "\n\n    </div>\n    "
			}
			b += "\n    \n    "
		}
		if (b += "\n\n    \n\n    ", c.specialties && (b += '\n    <h3 data-weave="shared/helper/translation" data-i18n="Specialties"></h3>\n    <div class="entity sepH_b">\n        ' + c.specialties + "\n    </div>\n    "), b += "\n\n    ", e && e.length) {
			b += '\n    <h3 data-weave="shared/helper/translation" data-i18n="工作技能"></h3>\n    <div class="entity sepH_b">\n        ';
			for (var f = 0, g = e.length; g > f; f++) {
				b += "    \n        ";
				var i = e[f];
				b += '\n        <span class="label tag">' + i + "</span>\n        "
			}
			b += "\n    </div>\n    "
		}
		return b += "\n</div>"
	}
}), define("app/widget/candidate/detail/linkedin-tab/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "shared/helper/utils", "template!./main.html"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		b.publish("ajax", {
			url : g.PROFILE.replace("<url>", b._url)
		}, c().done(function (c) {
				c.status ? (b._json = c, b.html(e, b._json, a)) : 401 === c.message ? d.alert("error", 'Linkedin绑定已过期，请点击<a href="/bind/oauth" tagert="_blank">此处</a>重新绑定!') : 404 === c.message ? d.alert("error", "此Linkedin的PublicURL已经移除!") : d.alert("error", c.message)
			}))
	}
	var g = {
		PROFILE : "/rest/linkedin/profile/url=<url>"
	};
	return b.extend(function (a, b, c) {
		this._url = c
	}, {
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"sig/start" : function (a, b) {
			d.widgetLoaded.call(this),
			b.resolve()
		}
	})
}), define("troopjs-requirejs/template!app/widget/candidate/detail/main.html", [], function () {
	return function (a) {
		var b = "",
		c = a.email || "",
		d = a.email1 || "",
		e = a.email2 || "",
		f = a.mobile || "",
		g = a.mobile1 || "",
		h = a.mobile2 || "",
		i = a.city || "",
		j = a.city1 || "",
		k = a.city2 || "",
		l = a.current ? a.current.client : null,
		m = a.annualSalary ? a.annualSalary : "",
		n = a.dateOfBirth,
		o = a.monthNull,
		p = a.dayNull;
		p && n && (n = n.slice(0, -3)),
		o && n && (n = n.slice(0, -3));
		var q = a.experiences,
		r = a.education,
		s = a.linkedin || "",
		t = a.status;
		if (b += '\r\n\r\n<div class="text-right">\r\n    ', this._isAdmin && (b += '\r\n    <button class="btn btn-danger" data-weave="shared/helper/translation" data-i18n="Delete" data-action="people/delete"></button>\r\n    '), b += '\r\n</div>\r\n\r\n<h3 class="heading no-bottom-line clear">\r\n\r\n    ', "candidate" === a.type ? b += '\r\n    <span class="label industry" data-weave="shared/helper/translation" data-i18n="candidate"></span>\r\n    ' : "coldcall" === a.type ? b += '\r\n    <span class="label">Cold Call</span>\r\n    ' : "contact" === a.type && (b += '\r\n    <span class="label label-red" data-weave="shared/helper/translation" data-i18n="Contact"></span>\r\n    '), b += "\r\n\r\n    ", a.is_mpc && (b += '\r\n    <span class="label label-orange">MPC</span>\r\n    '), b += "\r\n\r\n    " + [a.englishName, a.chineseName].join(" ").trim() + '\r\n\r\n    <span id="cid">ID: ' + a.id + '</span>\r\n\r\n    <span class="dropdown" data-paste="true" data-weave="app/widget/common/attachment-view/main(' + a.attachment_count + ", 'candidate', " + a.id + ')">\r\n    </span>\r\n</h3>\r\n\r\n<div class="pull-right heading-bar">\r\n\r\n    ', a.islimited || !s.length || this._isAdmin || (b += '\r\n    <a href="' + s + '" target="_blank" class="icon-link">\r\n       <span class="icon-linkedin icon-blue"></span>\r\n    </a>\r\n    '), b += "\r\n\r\n    ", b += t ? '\r\n    <span class="label status" style="background-color: ' + t.color + ';">' + t.value + "</span>\r\n    " : '\r\n    <span class="label status"></span>\r\n    ', b += "\r\n    \r\n    ", l && l.industry && l.industry.id && (b += '\r\n    <span class="label industry" data-toggle="tooltip" title="' + l.industry.name, l.industry1 && (b += ", " + l.industry1.name), l.industry2 && (b += ", " + l.industry2.name), b += '">' + l.industry.name, (l.industry1 || l.industry2) && (b += "..."), b += "</span>\r\n    "), b += "\r\n    ", a.current && (b += "\r\n    ", a.current.function  && a.current.function .id && (b += '\r\n    <span class="label function" data-toggle="tooltip" title="' + a.current.function .name, a.current.function1 && (b += ", " + a.current.function1.name), a.current.function2 && (b += ", " + a.current.function2.name), b += '">' + a.current.function .name, (a.current.function1 || a.current.function2) && (b += "..."), b += "</span>\r\n    "), b += "\r\n    "), b += '\r\n\r\n    <div class="btn-group">\r\n        <a class="btn btn-small dropdown-toggle" data-toggle="dropdown" href="#">\r\n            <span data-weave="shared/helper/translation" data-i18n="Actions"></span>\r\n            <span class="caret"></span>\r\n        </a>\r\n        <ul class="dropdown-menu">\r\n            <li>\r\n                <a href="#" data-action="note">\r\n                    <!-- <i class="icon-comment icon-blue"></i> -->\r\n                    <span data-weave="shared/helper/translation" data-i18n="Note"></span>\r\n                </a>\r\n            </li>\r\n            <li>\r\n                <a href="#" data-action="email">\r\n                    <!-- <i class="icon-envelope icon-blue"></i> -->\r\n                    <span data-weave="shared/helper/translation" data-i18n="Email"></span>\r\n                </a>\r\n            </li>\r\n            <li>\r\n                <a href="#" data-action="task">\r\n                    <!-- <i class="icon-time icon-blue"></i> -->\r\n                    <span data-weave="shared/helper/translation" data-i18n="Task"></span>\r\n                </a>\r\n            </li>\r\n            <li>\r\n                <a href="#" data-action="target">\r\n                    <!-- <i class="icon-target icon-blue"></i> -->\r\n                    <span data-weave="shared/helper/translation" data-i18n="Intention"></span>\r\n                </a>\r\n            </li>\r\n            <li class="floating-action">\r\n                <a href="#" data-action="floating">\r\n                    <!-- <i class="icon-floating icon-blue"></i> -->\r\n                    <span>Floating</span>\r\n                </a>\r\n            </li>\r\n            <li>\r\n                <a href="#" data-action="shortlist">\r\n                    <!-- <i class="icon-share icon-blue"></i> -->\r\n                    <span data-weave="shared/helper/translation" data-i18n="Job"></span>\r\n                </a>\r\n            </li>\r\n            <li>\r\n                <a href="#" data-action="add/to/folder">\r\n                    <!-- <i class="icon-folder-open icon-blue"></i> -->\r\n                    <span data-weave="shared/helper/translation" data-i18n="Folder"></span>\r\n                </a>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n    ', (!a.islimited || this._isAdmin) && (b += '\r\n    <a href="#add!id=' + a.id + '" data-i18n="Edit" data-weave="shared/helper/translation" class="btn btn-small"></a>\r\n    '), b += '\r\n</div>\r\n\r\n<ul class="nav nav-tabs">\r\n    <li class="active">\r\n        <a href="#resume-tab" data-toggle="tab">\r\n            <span data-weave="shared/helper/translation" data-i18n="Resume"></span>\r\n        </a>\r\n    </li>\r\n    <li>\r\n        <a href="#note-tab" data-toggle="tab">\r\n            <span class="note-count">' + a.note_count + '</span>\r\n            <span data-weave="shared/helper/translation" data-i18n="Note"></span>\r\n        </a>\r\n    </li>\r\n    ', (a.email || a.email1 || a.email2) && (b += '\r\n    <li>\r\n        <a href="#email-tab" data-toggle="tab">\r\n            <span class="email-count">' + a.email_count + '</span>\r\n            <span data-weave="shared/helper/translation" data-i18n="Email"></span>\r\n        </a>\r\n    </li>\r\n    '), b += '\r\n    \r\n    <li>\r\n        <a href="#task-tab" data-toggle="tab">\r\n            <span class="task-count">' + a.todo_count + '</span>\r\n            <span data-weave="shared/helper/translation" data-i18n="Task"></span>\r\n        </a>\r\n    </li>\r\n\r\n    <li>\r\n        <a href="#target-tab" data-toggle="tab">\r\n            <span class="intention-count">' + a.targetcompany_count + '</span>\r\n            <span data-weave="shared/helper/translation" data-i18n="Intention"></span>\r\n        </a>\r\n    </li>\r\n\r\n    <li>\r\n        <a href="#floating-tab" data-toggle="tab">\r\n            <span class="floating-count">' + a.floating_out_count + '</span>\r\n            <span data-weave="shared/helper/translation" data-i18n="Floating CV"></span>\r\n        </a>\r\n    </li>\r\n\r\n    ', "contact" === a.type && (b += '\r\n    <li>\r\n        <a href="#floating-in-tab" data-toggle="tab">\r\n            <span class="floating-in-count">' + a.floating_in_count + '</span>\r\n            <span data-weave="shared/helper/translation" data-i18n="Get Floating"></span>\r\n        </a>\r\n    </li>\r\n    '), b += '\r\n\r\n    <li>\r\n        <a href="#shortlist-tab" data-toggle="tab">\r\n            <span class="shortlist-count">' + a.shortlist_count + '</span>\r\n            <span data-weave="shared/helper/translation" data-i18n="Job"></span>\r\n        </a>\r\n    </li>\r\n\r\n    <li class="linkedin hide">\r\n        <a href="#linkedin-tab" data-toggle="tab">\r\n            <span data-weave="shared/helper/translation" data-i18n="LinkedIn"></span>\r\n        </a>\r\n    </li>\r\n\r\n    <li>\r\n        <a href="#change-log" data-toggle="tab">\r\n            <span class="change-count">0</span>\r\n            <span data-weave="shared/helper/translation" data-i18n="Change Log"></span>\r\n        </a>\r\n    </li>\r\n</ul>\r\n\r\n<div class="tab-content">\r\n\r\n    <div class="tab-pane active" id="resume-tab">\r\n        <div class="vcard">\r\n            <ul class="full-width">\r\n                <li class="v-heading">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Basic Info"></span>\r\n\r\n                    ', a.islimited || !a.mobile && !a.email || !a.englishName && !a.chineseName || (b += '\r\n                    <a href="#" class="qrcode-action">\r\n                        <span class="icon-qrcode"></span>\r\n                    </a>\r\n                    '), b += '\r\n                </li>\r\n    \r\n                <li class="clearfix">\r\n                    <div class="span6">\r\n                        <span class="item-key" data-weave="shared/helper/translation" data-i18n="Email"></span>\r\n                        <div class="vcard-item">\r\n                            ', c || d || e ? (b += "\r\n                            ", c && (b += '\r\n                            <span data-weave="shared/helper/translation" data-i18n="Private email"></span>:\r\n                            <a href="#" data-action="email" data-type=\'email\' data-email="' + c + '">' + c + "</a>\r\n                            "), b += "\r\n                            ", d && (b += '\r\n                            <span data-weave="shared/helper/translation" data-i18n="Work email"></span>:\r\n                            <a href="#" data-action="email" data-type=\'email1\' data-email="' + d + '">' + d + "</a>\r\n                            "), b += "\r\n                            ", e && (b += '\r\n                            <span data-weave="shared/helper/translation" data-i18n="Other"></span>:\r\n                            <a href="#" data-action="email" data-type=\'email2\' data-email="' + e + '">' + e + "</a>\r\n                            "), b += "\r\n                            ") : b += "\r\n                            &nbsp;\r\n                            ", b += '\r\n                        </div>\r\n                    </div>\r\n                    <div class="span6">\r\n                        <span class="item-key" data-weave="shared/helper/translation" data-i18n="Phone"></span>\r\n                        <div class="vcard-item">\r\n                            ', f || g || h ? (b += "\r\n                            ", f && (b += '\r\n                            <span data-weave="shared/helper/translation" data-i18n="Mobile"></span>:\r\n                            <a href="tel:' + f + '">' + f + "</a>\r\n                            "), b += "\r\n                            ", g && (b += '\r\n                            <span data-weave="shared/helper/translation" data-i18n="Telephone"></span>:\r\n                            <a href="tel:' + g + '">' + g + "</a>\r\n                            "), b += "\r\n                            ", h && (b += '\r\n                            <span data-weave="shared/helper/translation" data-i18n="Other"></span>:\r\n                            <a href="tel:' + h + '">' + h + "</a>\r\n                            "), b += "\r\n                            ") : b += "\r\n                            &nbsp;\r\n                            ", b += '\r\n                        </div>\r\n                    </div>\r\n                </li>\r\n\r\n                <li class="clearfix">\r\n                    <div class="span6">\r\n                        <span class="item-key" data-weave="shared/helper/translation" data-i18n="Working place"></span>\r\n                        <div class="vcard-item">' + (a.location ? a.location.name : "&nbsp;") + '</div>\r\n                    </div>\r\n                    <div class="span6">\r\n                        <span class="item-key" data-weave="shared/helper/translation" data-i18n="Intention City"></span>\r\n                        <div class="vcard-item">\r\n                            ', i || j || k ? (b += "\r\n                            ", i && (b += "\r\n                            " + i.name + "\r\n                            "), b += "\r\n                            ", j && (b += "\r\n                            , " + j.name + "\r\n                            "), b += "\r\n                            ", k && (b += "\r\n                            , " + k.name + "\r\n                            "), b += "\r\n                            ") : b += "\r\n                            &nbsp;\r\n                            ", b += '\r\n                        </div>\r\n                    </div>\r\n                </li>\r\n                \r\n                <li class="clearfix">\r\n                    <div class="span6">\r\n                        <span class="item-key" data-weave="shared/helper/translation" data-i18n="Annual Salary"></span>\r\n                        <div class="vcard-item"><span data-weave="shared/helper/translation" data-i18n="Currency symbol"></span> ' + (m ? this.formatCurrency(m) : "&nbsp;") + '</div>\r\n                    </div>\r\n                    <div class="span6">\r\n                        <span class="item-key" data-weave="shared/helper/translation" data-i18n="Gender"></span>\r\n                        <div class="vcard-item">\r\n                            ', null !== a.gender && (b += "\r\n                            " + (a.gender ? "男" : "女") + "\r\n                            "), b += '\r\n                        </div>\r\n                    </div>\r\n                </li>\r\n\r\n                <li class="clearfix">\r\n                    <div class="span6">\r\n                        <span class="item-key" data-weave="shared/helper/translation" data-i18n="Date of birth"></span>\r\n                        <div class="vcard-item">' + (n ? n : "&nbsp;") + "</div>\r\n                    </div>\r\n\r\n                    ", this.table.length && (b += "\r\n                    ", this.table[0] && (b += '\r\n                    <div class="span6">\r\n                        <span class="item-key">' + this.table[0].label + '</span>\r\n                        <div class="vcard-item">' + (a[this.table[0].mapping].value || "") + "</div>\r\n                    </div>\r\n                    "), b += "\r\n                    "), b += "\r\n                </li>\r\n                \r\n                ", this.table.length) {
						b += "\r\n                ";
						for (var u = 1, v = this.table.length; v > u; u += 2) {
							if (b += '\r\n\r\n                <li class="clearfix">\r\n                    <div class="span6">\r\n                        <span class="item-key">' + this.table[u].label + '</span>\r\n                        <div class="vcard-item">' + (a[this.table[u].mapping].value || "") + "</div>\r\n                    </div>\r\n                    ", v > u + 1)
								b += '\r\n                    <div class="span6">\r\n                        <span class="item-key">' + this.table[u + 1].label + '</span>\r\n                        <div class="vcard-item">' + (a[this.table[u + 1].mapping].value || "")
									 + "</div>\r\n                    </div>\r\n                    ";
								else {
									b += "\r\n                    ";
									var w = !0;
									b += '\r\n                    <div class="span6">\r\n                        <span class="item-key" data-weave="shared/helper/translation" data-i18n="Keyin By"></span>\r\n                        <div class="vcard-item">\r\n                            <a href="/user/preview#' + a.addedBy.id + '" data-action="open/profile">' + a.addedBy.englishName + '</a>\r\n                            <span class="muted">' + a.dateAdded + "</span>\r\n                        </div>\r\n                    </div>\r\n                    "
								}
								b += "\r\n                </li>\r\n                "
							}
							b += "\r\n                "
						}
						if (b += "\r\n                \r\n                ", w) {
							b += '\r\n                <li class="clearfix">\r\n                    <div class="span6">\r\n                        <span class="item-key" data-weave="shared/helper/translation" data-i18n="Owner"></span>\r\n                        <div class="vcard-item"><a href="/user/preview#' + a.owner.id + '" data-action="open/profile">' + a.owner.englishName + '</a></div>\r\n                    </div>\r\n                    <div class="span6">\r\n                        <span class="item-key" data-weave="shared/helper/translation" data-i18n="Share with"></span>\r\n                        <div class="vcard-item share-with">\r\n                            ';
							for (var u = 0, v = a.share.length; v > u; u++)
								b += '\r\n                            <span data-weave="shared/helper/translation" data-i18n="share with ' + a.share[u].type + '"></span> \r\n                            ', "team" === a.share[u].type ? b += "\r\n                            - " + a.share[u].value_name + "\r\n                            " : "people" === a.share[u].type && (b += '\r\n                            - <a href="/user/preview#' + a.share[u].value + '" data-action="open/profile">' + a.share[u].value_name + "</a>\r\n                            "), b += "\r\n                            <br>\r\n                            ";
							b += "\r\n                        </div>\r\n                    </div>\r\n                </li>\r\n                "
						} else {
							b += '\r\n                <li class="clearfix">\r\n                    <div class="span6">\r\n                        <span class="item-key" data-weave="shared/helper/translation" data-i18n="Keyin"></span>\r\n                        <div class="vcard-item"><a href="/user/preview#' + a.addedBy.id + '" data-action="open/profile">' + a.addedBy.englishName + '</a></div>\r\n                    </div>\r\n                    <div class="span6">\r\n                        <span class="item-key" data-weave="shared/helper/translation" data-i18n="Owner"></span>\r\n                        <div class="vcard-item"><a href="/user/preview#' + a.owner.id + '" data-action="open/profile">' + a.owner.englishName + '</a></div>\r\n                    </div>\r\n                </li>\r\n                <li class="clearfix">\r\n                    <div class="span6">\r\n                        <span class="item-key" data-weave="shared/helper/translation" data-i18n="Share with"></span>\r\n                        <div class="vcard-item">\r\n                            ';
							for (var u = 0, v = a.share.length; v > u; u++)
								b += '\r\n                            <span data-weave="shared/helper/translation" data-i18n="share with ' + a.share[u].type + '"></span> - \r\n                            ', "team" === a.share[u].type ? b += "\r\n                            " + a.share[u].value_name + "\r\n                            " : "people" === a.share[u].type && (b += '\r\n                            <a href="/user/preview#' + a.share[u].value + '" data-action="open/profile">' + a.share[u].value_name + "</a>\r\n                            "), b += "\r\n                            <br>\r\n                            ";
							b += "\r\n                        </div>\r\n                    </div>\r\n                </li>\r\n                "
						}
						if (b += "\r\n\r\n                ", q && q.length) {
							b += '\r\n                <li class="v-heading clear">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Work Experiences"></span>\r\n\r\n                    <span class="muted pull-right">\r\n                        ',
							a.work_years && (b += '\r\n                        <span data-weave="shared/helper/translation" data-i18n="Years of experience"></span>:\r\n                        ' + a.work_years + ' <span data-weave="shared/helper/translation" data-i18n="Year(s)"></span>\r\n                        '),
							b += "\r\n                        ",
							a.current_years && (b += '\r\n                        &nbsp;&nbsp;\r\n                        <span data-weave="shared/helper/translation" data-i18n="On Job"></span>:\r\n                        ' + a.current_years + ' <span data-weave="shared/helper/translation" data-i18n="Year(s)"></span>\r\n                        '),
							b += "\r\n                    </span>\r\n                </li>\r\n                <li>\r\n                    ";
							for (var u = 0, v = q.length; v > u; u++) {
								b += "\r\n                    ";
								var x = q[u];
								b += '\r\n                    <div class="entity">\r\n                        <dl class="dl-horizontal">\r\n                            <dt>' + x.start + " - ",
								b += x.is_current ? '<span data-weave="shared/helper/translation" data-i18n="Present"></span>' : "" + x.end,
								b += '</dt>\r\n                            <dd>\r\n                                <strong><a href="/company#detail!id=' + x.client.id + '" target="_blank">' + x.client.name + "</a></strong>\r\n                                ",
								x.client.type && "normal" !== x.client.type && "generated" !== x.client.type && (b += '\r\n                                <span class="red">(<span data-weave="shared/helper/translation" data-i18n="' + x.client.type + ' company"></span>)</span>\r\n                                '),
								b += "\r\n                                ",
								x.client.industry && x.client.industry.name && (b += '\r\n                                <span class="label industry">' + x.client.industry.name + "</span>\r\n                                "),
								b += '\r\n                            </dd>\r\n                            <dt></dt>\r\n                            <dd>\r\n                                <strong class="muted">' + (x.title || "") + "</strong>\r\n                                ",
								x.function  && (b += '\r\n                                <span class="label function">' + x.function .name, x.function1 && (b += ", " + x.function1.name), x.function2 && (b += ", " + x.function2.name), b += "</span>\r\n                                "), b += "\r\n                            </dd>\r\n                        </dl>\r\n                        ", x.description && (b += '\r\n                        <div class="description">\r\n                            ' + this.convertText(x.description) + "\r\n                        </div>\r\n                        "), b += "\r\n                    </div>\r\n                    "
						}
						b += "\r\n                </li>\r\n                "
					}
					if (b += "\r\n\r\n                ", r && r.length) {
						b += '\r\n                <li class="v-heading clear">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Education Experiences"></span>\r\n                </li>\r\n                <li>\r\n                    ';
						for (var u = 0, v = r.length; v > u; u++) {
							b += "\r\n                    ";
							var y = r[u];
							b += '\r\n                    <div class="entity">\r\n                        <dl class="dl-horizontal">\r\n                            <dt>' + (y.start || "") + " - ",
							b += y.is_current ? '<span data-weave="shared/helper/translation" data-i18n="In reading"></span>' : "" + (y.end || ""),
							b += "</dt>\r\n                            <dd>\r\n                                ",
							y.school && (b += "\r\n                                <strong>" + y.school + "</strong>\r\n                                "),
							b += "\r\n                            </dd>\r\n\r\n                            ",
							(y.degree || y.major) && (b += "\r\n                            <dt></dt>\r\n                            <dd>\r\n                                " + (y.degree || "") + " ", y.degree && y.major && (b += ","), b += " " + (y.major || "") + "\r\n                            </dd>\r\n                            "),
							b += "\r\n                        </dl>\r\n                    </div>\r\n                    "
						}
						b += "\r\n                </li>\r\n                "
					}
					if (b += "\r\n\r\n                ", a.tags.length) {
						b += '\r\n                <li class="v-heading clear">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Tags"></span>\r\n                </li>\r\n                <li>\r\n                    ';
						for (var u = 0, v = a.tags.length; v > u; u++)
							b += '\r\n                    <span class="label tag">' + a.tags[u] + "</span>\r\n                    ";
						b += "\r\n                </li>\r\n                "
					}
					return b += '\r\n            </ul>    \r\n        </div>\r\n        \r\n    </div>\r\n\r\n    <div class="tab-pane widget-spin" id="note-tab">\r\n    </div>\r\n\r\n    <div class="tab-pane widget-spin" id="email-tab"></div>\r\n\r\n    <div class="tab-pane widget-spin" id="task-tab"></div>\r\n\r\n    <div class="tab-pane widget-spin" id="target-tab"></div>\r\n\r\n    <!-- target company -->\r\n    <div class="tab-pane widget-spin" id="floating-tab">\r\n    </div>\r\n    \r\n    ', "contact" === a.type && (b += '\r\n    <div class="tab-pane widget-spin" id="floating-in-tab">\r\n    </div>\r\n    '), b += '\r\n\r\n    <div class="tab-pane" id="shortlist-tab">\r\n        <div class="activity-history widget-spin"></div>\r\n    </div>\r\n\r\n    <div class="tab-pane linkedin hide" id="linkedin-tab">\r\n        <div class="linkedin-content widget-spin"></div>\r\n    </div>\r\n\r\n    <div class="tab-pane" id="change-log">\r\n        <div class="activity-history" data-weave="app/widget/candidate/detail/changelog/main(' + a.id + ')"></div>\r\n    </div>\r\n</div>'
}
}), define("app/widget/candidate/detail/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "shared/helper/utils", "template!./main.html", "shared/helper/blurb"], function (a, b, c, d, e, f, g) {
	function h() {
		var a = this,
		b = a._json,
		c = ["BEGIN:VCARD", "VERSION:2.1"];
		return c.push("FN:" + (b.englishName || b.chineseName)),
		c.push("ORG:" + b.current.client.name),
		c.push("TITLE:" + b.current.title),
		c.push("TEL;WORK;VOICE;PREF:" + b.mobile),
		c.push("EMAIL;INTERNET;PREF:" + b.email),
		c.push("NOTE", "END:VCARD"),
		m.QRCODE + c.join("%0A")
	}
	function i(a) {
		var b = this;
		b.uid !== l && b._isAdmin !== l && b.publish("ajax", {
			url : m.CANDIDATE.replace("<id>", b.uid)
		}, c().done(function (c) {
				b._json = c,
				j.call(b, a)
			}))
	}
	function j() {
		var a = this;
		a.publish("ajax", {
			url : m.TABLE
		}, c().done(function (b) {
				a.table = b,
				c(function (b) {
					a.html(f, a._json, b)
				}).done(function () {
					k.call(a)
				})
			}))
	}
	function k() {
		var b = this,
		d = b._json.id,
		f = b.$element;
		b.$noteCount = f.find(".nav-tabs .note-count"),
		b.$emailCount = f.find(".nav-tabs .email-count"),
		b.$taskCount = f.find(".nav-tabs .task-count"),
		b.$shortlistCount = f.find(".nav-tabs .shortlist-count"),
		b.$intentionCount = f.find(".nav-tabs .intention-count"),
		a('a[href="#note-tab"]').one("shown", function () {
			f.find("#note-tab").data("content", b._json).attr("data-weave", q + "(content)").weave()
		}),
		b._json.linkedin && a('a[href="#linkedin-tab"]').one("shown", function () {
			f.find(".linkedin-content").attr("data-weave", o + '("' + b._json.linkedin + '")').weave()
		}),
		a('a[href="#email-tab"]').one("shown", function () {
			f.find("#email-tab").attr("data-weave", p + '("' + d + '")').weave()
		}),
		a('a[href="#task-tab"]').one("shown", function () {
			f.find("#task-tab").attr("data-weave", r + '("' + d + '")').weave()
		}),
		a('a[href="#shortlist-tab"]').one("shown", function () {
			f.find("#shortlist-tab .activity-history").attr("data-weave", s + '("' + d + '")').weave()
		}),
		a('a[href="#target-tab"]').one("shown", function () {
			f.find("#target-tab").attr("data-weave", u + '("' + d + '", "candidate")').weave()
		}),
		a('a[href="#floating-tab"]').one("shown", function () {
			f.find("#floating-tab").attr("data-weave", t + '("' + d + '", "candidate")').weave()
		}),
		a('a[href="#floating-in-tab"]').one("shown", function () {
			f.find("#floating-in-tab").attr("data-weave", t + '("' + d + '", "clientContact")').weave()
		}),
		b.publish("ajax", {
			url : m.ISBINDED
		}, c().done(function (a) {
				a.data.binded && a.data.expire >= 0 && b._json.linkedin && f.find(".linkedin").removeClass("hide")
			})),
		b.$element.find(".qrcode-action").popover({
			html : !0,
			placement : "bottom",
			content : function () {
				var a = (new Date).getTime(),
				c = new Image;
				return c.onload = function () {
					b.$element.find(".qrcode-image-" + a).html(c).removeClass("widget-spin"),
					c.onload = null
				},
				c.onerror = function () {
					b.publish("error/log", "QR Code load error", {
						url : h.call(b)
					})
				},
				c.src = h.call(b),
				c.width = 200,
				c.height = 200,
				'<div class="widget-spin qrcode-image-' + a + '" style="width: 200px;"></div>'
			},
			trigger : "click"
		}).click(function (a) {
			a.preventDefault()
		}),
		b.isSlide && b.publish("candidate/detail/rendered"),
		e.widgetLoaded.call(b)
	}
	var l,
	m = {
		ISBINDED : "/rest/linkedin/isbinded",
		CANDIDATE : "/rest/candidate/<id>",
		DELETE : "/rest/candidate/delete",
		TABLE : "/rest/data/fields?table=candidate",
		QRCODE : "http://www.gllue.com/qrcode?text="
	},
	n = {
		email : g.t("Private email"),
		email1 : g.t("Work email"),
		email2 : g.t("Other")
	},
	o = "app/widget/candidate/detail/linkedin-tab/main",
	p = "app/widget/candidate/detail/email-tab/main",
	q = "app/widget/candidate/detail/note-tab/main",
	r = "app/widget/candidate/detail/task-tab/main",
	s = "app/widget/candidate/detail/shortlist-tab/main",
	t = "app/widget/candidate/detail/floating-tab/main",
	u = "app/widget/candidate/detail/target-tab/main";
	return b.extend(function (a, b, c) {
		var d = this;
		d.isSlide = c,
		d.isSlide ? d.subscribe("candidate/slide/detail/id", !0, function (a, b) {
			d.uid = b,
			i.call(d)
		}) : d.subscribe("detail/id/change", !0, function (a, b) {
			d.uid = b,
			i.call(d)
		})
	}, {
		"hub/candidate/show/resume" : function () {
			var a = this,
			b = a.$element.find('a[href="#resume-tab"]');
			b.parent().hasClass("active") || b.trigger("click")
		},
		"hub/candidate/show/note" : function () {
			var a = this,
			b = a.$element.find('a[href="#note-tab"]');
			b.parent().hasClass("active") || b.trigger("click")
		},
		"hub:memory/context" : function (a, b) {
			var c = this;
			c._isAdmin = "Admin" === b.user.role,
			i.call(c)
		},
		"dom/action.click" : a.noop,
		"dom/action/people/delete.click" : function (b, d) {
			d.preventDefault(),
			a(d.target);
			var f,
			g = this;
			if (f = window.confirm("确定要删除所选的人才吗?")) {
				var h = [g._json.id];
				g.publish("ajax", {
					url : m.DELETE,
					data : {
						data : JSON.stringify({
							ids : h
						})
					},
					type : "post"
				}, c().done(function (a) {
						a.status ? (e.alert("success", "人才删除成功!"), window.history.back()) : e.alert("error", a.message)
					}))
			}
		},
		"dom/action/open/profile.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			f = d.attr("href");
			e.window({
				url : f,
				name : "User Profile",
				width : "1024"
			})
		},
		"dom/action/note.click" : function (b, c) {
			c.preventDefault();
			var d = this;
			a(c.target),
			d._json.islimited || d._isAdmin || d.publish("modal/add-note/show", {
				externalType : "candidate",
				optionType : "candidate_note_category",
				id : d._json.id,
				onSuccess : function (a) {
					"started" === d.phase && (a.data.status, a.status && d.publish("canddiate/note/tab/reload"))
				}
			})
		},
		"dom/action/email.click" : function (b, c) {
			c.preventDefault();
			var d = this;
			if (!d._json.islimited && !d._isAdmin) {
				var e = a(c.target);
				e.find("b");
				var f = d._json,
				g = [f.englishName, f.chineseName].join(" ").trim(),
				h = e.attr("data-email"),
				i = e.attr("data-type");
				i || (f.email ? (i = "email", h = f.email) : f.email1 ? (i = "email1", h = f.email1) : f.email2 && (i = "email2", h = f.email2)),
				d.publish("modal/sendemail/show", {
					names : ['"' + g + '" ' + "[" + n[i] + "]"],
					emails : [h],
					emailTemplate : "candidate_email",
					onSuccess : function () {
						"started" === d.phase && d.publish("candidate/email/tab/reload")
					},
					attachment : {
						joborder : 0,
						clientcompany : 0
					},
					templateVariable : {
						candidate_id : d._json.id
					}
				})
			}
		},
		"dom/action/task.click" : function (b, c, d) {
			c.preventDefault();
			var e = this;
			if (!e._json.islimited && !e._isAdmin) {
				var f = a(c.target);
				f.find("b"),
				e.publish("modal/add/task/show", {
					name : d,
					id : e._json.id,
					onSuccess : function () {
						"started" === e.phase && e.publish("candidate/task/tab/reload")
					},
					type : "candidate"
				})
			}
		},
		"dom/action/shortlist.click" : function (b, c) {
			c.preventDefault();
			var d = this;
			if (!d._json.islimited && !d._isAdmin) {
				var e = a(c.target);
				e.find("b");
				var f = d._json,
				g = f.id,
				h = [f.englishName, f.chineseName].join(" ").trim();
				d.publish("modal/addshortlist/show", {
					ids : [g],
					names : [h],
					onSuccess : function () {
						"started" === d.phase && d.publish("candidate/shortlist/tab/reload")
					},
					type : "people"
				})
			}
		},
		"dom/action/add/to/folder.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target),
			f = [];
			d._json.islimited || d._isAdmin || (function () {
				d._json.folders.forEach(function (a) {
					f.push(a.id)
				})
			}
				(), d.publish("modal/add-to-folder/show", {
					ids : [d._json.id],
					type : "candidate",
					folders : f,
					multiSelect : !0,
					onSuccess : function (a) {
						"started" === d.phase && (d._json.folders = a, e.find(".muted").text(d.getFolderName(a)))
					}
				}))
		},
		"dom/action/floating.click" : function (a, b) {
			b.preventDefault();
			var c = this;
			if (!c._json.islimited && !c._isAdmin) {
				var d = c._json,
				e = [d.englishName, d.chineseName].join(" ").trim();
				c.publish("modal/add-floating/show", {
					names : [e],
					onSuccess : function () {
						"started" === c.phase && c.publish("candidate/floating/tab/reload")
					},
					attachment : [{
							name : e,
							id : c._json.id
						}
					],
					checkAttachment : !0
				})
			}
		},
		"dom/action/target.click" : function (a, b) {
			b.preventDefault();
			var c = this;
			c._json.islimited || c._isAdmin || c.publish("modal/target-company/show", {
				id : c._json.id,
				onSuccess : function () {
					"started" === c.phase && c.publish("candidate/intention/tab/reload")
				}
			})
		},
		getFolderName : function (a) {
			var b = "",
			c = [];
			return a.length && (a.forEach(function (a) {
					c.push(a.name)
				}), b = c.join(", ")),
			b
		},
		"hub/candidate/action/count" : function (a, b, c) {
			var d = this;
			if (d.$element.is(":visible"))
				switch (b) {
				case "note":
					d.$noteCount && d.$noteCount.text(c);
					break;
				case "email":
					d.$emailCount && d.$emailCount.text(c);
					break;
				case "task":
					d.$taskCount && d.$taskCount.text(c);
					break;
				case "shortlist":
					d.$shortlistCount && d.$shortlistCount.text(c);
					break;
				case "intention":
					d.$intentionCount && d.$intentionCount.text(c);
					break;
				case "change":
					d.$element.find(".change-count") && d.$element.find(".change-count").text(c)
				}
		}
	})
}), define("troopjs-requirejs/template!app/widget/candidate/detail/note-tab/main.html", [], function () {
	return function (a) {
		var b = "",
		c = this._category;
		b += '\r\n<div class="btn-group" >\r\n    <button class="btn btn-small active" data-action="buttons-toggle"><span class="note-count">' + a.list.length + '</span> <span data-weave="shared/helper/translation" data-i18n="All Notes"></span></button>\r\n\r\n    ';
		for (var d in c)
			b += '\r\n    <button class="btn btn-small" data-action="buttons-toggle(' + d + ')"><span class="' + d.replace(" ", "-").toLowerCase() + '-count">' + this._counts[d] + "</span> " + c[d].value + "</button>\r\n    ";
		b += "\r\n</div>\r\n\r\n";
		for (var e = 0, f = a.list.length; f > e; e++) {
			b += "\r\n";
			var g = a.list[e],
			h = g.dateAdded.split(" "),
			i = h[0],
			j = h[1],
			k = g.user,
			l = k.id,
			m = k.englishName;
			b += '\r\n<div class="activity-item clearfix" data-type="' + g.category.code + '">\r\n    <div class="pull-left span2 activity-time">\r\n        <p>\r\n            <span>' + j + "</span>\r\n            <span>" + i + '</span>\r\n            <a href="/user/preview#' + l + '" data-action="profile/open">' + m + '</a>\r\n        </p>\r\n    </div>\r\n    <div class="pull-left span10 activity-detail">\r\n        <div class="well">\r\n            <div class="title clearfix">\r\n                ',
			g.jobsubmission && (b += '\r\n                <span class="label label-orange" data-weave="shared/helper/translation" data-i18n="Job Note"></span>\r\n                '),
			b += '\r\n                <span class="label" style="background-color: ' + g.category.color + '">' + g.category.value + "</span>\r\n\r\n                ",
			g.status && (b += '\r\n                <span class="label" style="background-color: ' + g.status.color + ';" data-name="status">' + g.status.value + "</span>\r\n                "),
			b += "\r\n\r\n                ",
			g.jobsubmission && (b += '\r\n                <span class="muted" data-weave="shared/helper/translation" data-i18n="From Job"></span>: <a href="/job#detail!id=' + g.jobsubmission.joborder.id + '" target="_blank">' + g.jobsubmission.joborder.jobTitle + "</a>\r\n                "),
			b += "\r\n                ",
			g.date && (b += '\r\n                <span class="muted"><span data-weave="shared/helper/translation" data-i18n="Event Date"></span>: ' + g.date + "</span>\r\n                "),
			b += "\r\n                ",
			l === this._userId && (b += '\r\n                <button class="btn btn-mini btn-edit" data-weave="shared/helper/translation" data-i18n="Edit" data-action="edit/note(' + e + ')"></button>\r\n                '),
			b += "\r\n                ",
			this._isAdmin && (b += '\r\n                <button class="btn btn-mini btn-danger btn-edit" data-weave="shared/helper/translation" data-i18n="Delete" data-action="delete/note(' + g.id + ')"></button>\r\n                '),
			b += '\r\n                \r\n                \r\n            </div>\r\n            <div class="content" data-name="notes">\r\n                ';
			for (var n = 0, o = g.items.length; o > n; n++)
				b += "\r\n                ", g.items[n].field && (b += "\r\n                <h4>" + g.items[n].field + "</h4>\r\n                "), b += "\r\n                <p>\r\n                    " + this.convertText(g.items[n].value) + "\r\n                </p>\r\n                ";
			b += "\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n"
		}
		return b
	}
}), define("app/widget/candidate/detail/note-tab/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "shared/helper/utils"], function (a, b, c, d, e, f) {
	function g() {
		var b = this,
		e = j.NOTE.replace("<type>", "candidate").replace("<id>", b._cid),
		f = [],
		g = c(),
		i = c();
		f.push(g.promise(), i.promise()),
		b.publish("ajax", {
			url : e
		}, g.done(function (a) {
				b._json.list = a.list,
				b.publish(k, "note", b._json.list.length)
			})),
		b.publish("ajax", {
			url : j.CATEGORY
		}, i.done(function (a) {
				b._category = {},
				b._counts = {},
				a.forEach(function (a) {
					b._category[a.code] = {
						value : a.value
					},
					b._counts[a.code] = 0
				})
			})),
		d.apply(a, f).done(function () {
			h.call(b)
		})
	}
	function h() {
		var a = this;
		a._reference,
		c(function (b) {
			a._json.list.forEach(function (b) {
				a._counts[b.category.code]++
			}),
			a.html(e, a._json, b)
		}).done(function () {
			i.call(a)
		})
	}
	function i() {
		var a = this;
		a.$items = a.$element.find(".activity-item"),
		f.widgetLoaded.call(a)
	}
	var j = {
		NOTE : "/rest/note/list?paginate_by=200&external_type=<type>&external_id=<id>",
		CATEGORY : "/rest/data/options?type=candidate_note_category",
		DELETE : "/rest/note/delete"
	},
	k = "candidate/action/count";
	return b.extend(function (a, b, c) {
		this._reference = c,
		this._cid = c.id
	}, {
		"sig/finalize" : function (a, b) {
			var c = this;
			c.$element.empty(),
			b.resolve()
		},
		"hub/canddiate/note/tab/reload" : function () {
			g.call(this)
		},
		"hub:memory/context" : function (a, b) {
			var c = this;
			c._isAdmin = "Admin" === b.user.role,
			c._userId = b.user.id,
			g.call(c)
		},
		"dom/action.click" : a.noop,
		"dom/action/edit/note.click" : function (a, b, c) {
			b.preventDefault();
			var d = this,
			e = d._json.list[c];
			d.publish("modal/add-note/show", {
				externalType : "candidate",
				optionType : e.jobsubmission ? "jobsubmission_note_category" : "candidate_note_category",
				data : e,
				id : d._cid,
				onSuccess : function () {
					g.call(d)
				}
			})
		},
		"dom/action/buttons-toggle.click" : function (b, c, d) {
			c.preventDefault();
			var e = this,
			f = a(c.target);
			f.siblings().removeClass("active"),
			f.addClass("active"),
			d ? e.$items.addClass("hide").filter('[data-type="' + d + '"]').removeClass("hide") : e.$items.removeClass("hide")
		},
		"dom/action/delete/note.click" : function (a, b, d) {
			b.preventDefault();
			var e = this,
			h = [d],
			i = window.confirm("确定要删除此备注吗?");
			i && e.publish("ajax", {
				url : j.DELETE,
				data : {
					data : JSON.stringify({
						ids : h
					})
				},
				type : "post"
			}, c().done(function (a) {
					a.status ? (f.alert("success", "备注删除成功!"), g.call(e)) : f.alert("error", a.message)
				}))
		},
		"dom/action/profile/open.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = d.attr("href");
			f.window({
				url : e,
				name : "User Profile",
				width : "1024"
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/candidate/detail/shortlist-tab/main.html", [], function () {
	return function (a) {
		for (var b = "", c = 0, d = a.length; d > c; c++) {
			b += "\n";
			var e = a[c],
			f = e.lastUpdateDate.split(" ");
			f[0],
			f[1];
			var g = "",
			h = e.joborder.jobStatus;
			switch (h) {
			case "Live":
				g = "label-warning";
				break;
			case "Failed":
				g = "label-inverse";
				break;
			case "Successful":
				g = "label-red"
			}
			b += '\n<div class="activity-item clearfix">\n    <div class="activity-detail">\n        <div class="well">\n            <div class="title">\n                <span class="label ' + g + '" data-weave="shared/helper/translation" data-i18n="' + h + ' Jobs"></span>&nbsp;\n                <a href="/job#detail!id=' + e.joborder.id + '" target="_blank">' + e.joborder.jobTitle + " (ID: " + e.joborder.id + ')</a> of <a href="/company#detail!id=' + e.joborder.client.id + '" target="_blank">' + e.joborder.client.name + "</a>\n                ",
			!e.joborder.client.type || "client" !== e.joborder.client.type && "bding" !== e.joborder.client.type || (b += '\n                (<span class="red" data-weave="shared/helper/translation" data-i18n="' + e.joborder.client.type + ' company"></span>)\n                '),
			b += '\n            </div>\n            <div class="content">\n                <dl class="dl-horizontal dl-shortlist"></dl>\n            </div>\n        </div>\n    </div>\n</div>\n\n'
		}
		return b
	}
}), define("app/widget/candidate/detail/shortlist-tab/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "shared/helper/utils"], function (a, b, c, d, e, f) {
	function g(a) {
		var b = this;
		b.publish("ajax", {
			url : i.replace("<id>", b._id)
		}, c().done(function (c) {
				b._json = c,
				b.html(e, b._json, a),
				b.publish(j, "shortlist", c.length)
			}).always(function () {
				a.resolve()
			}))
	}
	function h(b) {
		var e = this,
		g = [];
		e._json.forEach(function (a, b) {
			var d = c();
			d.promise();
			var f = e.$element.find(".dl-shortlist").eq(b);
			f.data("json", a.detail).attr("data-weave", 'app/widget/shortlist/history(json, "view")').weave(d)
		}),
		d.apply(a, g).done(function () {
			f.widgetLoaded.call(e),
			b.resolve()
		})
	}
	var i = "/rest/joborder/candidate_shortlist/<id>",
	j = "candidate/action/count";
	return b.extend(function (a, b, c) {
		this._id = c
	}, {
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"sig/start" : function (a, b) {
			h.call(this, b)
		},
		"hub/candidate/shortlist/tab/reload" : function () {
			var a = this;
			g.call(a, c())
		}
	})
}), define("troopjs-requirejs/template!app/widget/candidate/detail/target-tab/main.html", [], function () {
	return function (a) {
		for (var b = '<table class="table table-striped table-bordered">\n    <colgroup>\n        <col width="">\n        <col width="">\n        <col width="">\n        <col width="">\n        <col width="70">\n    </colgroup>\n    <thead>\n        <tr>\n            <th data-weave="shared/helper/translation" data-i18n="Target Company"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Note"></th> \n    \n            <th data-weave="shared/helper/translation" data-i18n="Time"></th>\n            <th data-weave="shared/helper/translation" data-i18n="User"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Operation"></th>\n        </tr>\n    </thead>\n    <tbody>\n        ', c = 0, d = a.length; d > c; c++) {
			b += "\n        ";
			var e = a[c];
			b += '\n        <tr>\n            <td><a href="/company#detail!id=' + e.client.id + '" target="_blank">' + e.client.name + "</a></td>\n            <td>" + e.note + "</td>\n            <td>" + e.date + '</td>\n            <td><a href="/user/preview#' + e.user.id + '" data-action="profile/open">' + e.user.englishName + "</a></td>\n            <td>\n                ",
			this.userId === e.user.id && (b += '\n                <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="Edit" data-action="edit/target(' + c + ')"></button>\n                '),
			b += "\n            </td>\n        </tr>\n        "
		}
		return b += "\n    </tbody>\n</table>"
	}
}), define("app/widget/candidate/detail/target-tab/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "shared/helper/utils", "template!./main.html"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		b.publish("ajax", {
			url : g.LIST.replace("<id>", b._id)
		}, c().done(function (c) {
				b._json = c,
				b.html(e, b._json, a),
				b.publish(h, "intention", c.length)
			}).always(function () {
				d.widgetLoaded.call(b)
			}))
	}
	var g = {
		LIST : "/rest/candidate/targetcompany/list?candidate=<id>"
	},
	h = "candidate/action/count";
	return b.extend(function (a, b, c) {
		this._id = c
	}, {
		"hub:memory/context" : function (a, b) {
			this.userId = b.user.id,
			f.call(this)
		},
		"hub/candidate/intention/tab/reload" : function () {
			f.call(this, c())
		},
		"dom/action.click" : a.noop,
		"dom/action/profile/open.click" : function (b, c) {
			c.preventDefault();
			var e = a(c.target),
			f = e.attr("href");
			d.window({
				url : f,
				name : "User Profile",
				width : "1024"
			})
		},
		"dom/action/edit/target.click" : function (a, b, d) {
			b.preventDefault();
			var e = this,
			g = e._json[d];
			e.publish("modal/target-company/show", {
				id : g.candidate.id,
				data : g,
				onSuccess : function () {
					f.call(e, c())
				}
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/candidate/detail/task-tab/main.html", [], function () {
	return function () {
		var a = '<table class="table table-striped table-bordered">\n    <colgroup>\n        <col width="30">\n        <col width="150">\n        <col width="150">\n        <col>\n        <col width="150">\n        <col width="150">\n        <col width="150">\n        <col width="70">\n    </colgroup>\n    <thead>\n        <tr>\n            <th>\n                <input type="checkbox" data-action="check/all">\n            </th>\n            <th data-weave="shared/helper/translation" data-i18n="Task type"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Task object"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Task note"></th> \n            <th data-weave="shared/helper/translation" data-i18n="Task date"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Participant"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Creator"></th> \n            <th data-weave="shared/helper/translation" data-i18n="Operation"></th>\n        </tr>\n    </thead>\n    <tbody></tbody>\n</table>\n\n<!-- pagination -->\n<div class="pagination clearfix hide" data-weave="shared/widget/pagination/main(\'candidate-task\', \'load\')"></div>';
		return a
	}
}), define("app/widget/candidate/detail/task-tab/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "shared/helper/utils", "template!./main.html"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		c(function (a) {
			b.html(e, a)
		}).done(function () {
			b.$tbody = b.$element.find("tbody"),
			a.resolve()
		})
	}
	function g(a) {
		var b = this;
		b.publish("ajax", {
			url : b._url.replace("<page>", i)
		}, c().done(function (c) {
				b.$tbody.empty(),
				c.list.length && c.list.forEach(function (a) {
					b.appendItem(a)
				}),
				b.publish(j, c),
				b.publish(k, "task", c.count),
				d.widgetLoaded.call(b),
				a.resolve()
			}))
	}
	var h = {
		DONE : "/rest/todo/done"
	},
	i = 1,
	j = "candidate-task/paging/set",
	k = "candidate/action/count";
	return b.extend(function (a, b, c) {
		this._url = "/rest/todo/list?page=<page>&candidate_id=" + c
	}, {
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"sig/start" : function (a, b) {
			var c = this;
			g.call(c, b)
		},
		"hub/make/load" : function (a, b) {
			var d = this;
			i = b.page,
			g.call(d, c())
		},
		"hub/candidate/task/tab/reload" : function () {
			var a = this;
			i = 1,
			g.call(a, c())
		},
		appendItem : function (a) {
			var b = this;
			b.$tbody.append("<tr></tr>"),
			b.$tbody.children().last().data("json", a).attr("data-weave", "app/widget/task/item(json)").weave()
		},
		"dom/action.change" : a.noop,
		"dom/action/check/all.change" : function (b, e) {
			var f,
			g = this,
			i = a(e.target),
			j = i.is(":checked"),
			k = [];
			j ? (f = g.$element.find("tbody :checkbox").filter(":not(:disabled)").filter(":not(:checked)"), f.prop("checked", !0)) : (f = g.$element.find("tbody :checkbox").filter(":not(:disabled)").filter(":checked"), f.prop("checked", !1)),
			f.each(function () {
				k.push(a(this).data("id"))
			}),
			k.length && g.publish("ajax", {
				url : h.DONE,
				data : {
					data : JSON.stringify({
						ids : k,
						done : j
					})
				},
				type : "POST"
			}, c().done(function (a) {
					a.status ? d.alert("success", "任务状态更改成功!") : d.alert("error", a.data || a.message)
				}))
		}
	})
}), define("troopjs-requirejs/template!app/widget/candidate/filter/main.html", [], function () {
	return function () {
		var a = '<ul class="nav nav-pills line_sep">\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Attachment"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <label data-weave="shared/helper/translation" data-i18n="Contains the keywords"></label>\r\n                    <input type="text" name="keyword" data-weave="shared/widget/common/tagit/main">\r\n                    <p class="hint" data-weave="shared/helper/translation" data-i18n="Please use \'Enter\' to confirm the keyword"></p>\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'keyword\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Note"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <label data-weave="shared/helper/translation" data-i18n="Contains the keywords"></label>\r\n                    <input type="text" name="note" class="input-large" autocomplete="off">\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'note\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Tags"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <label data-weave="shared/helper/translation" data-i18n="Contains the keywords"></label>\r\n                    <input type="text" data-type="tag" name="tags" data-weave="shared/widget/common/tagit/main">\r\n                    <p class="hint" data-weave="shared/helper/translation" data-i18n="Please use \'Enter\' to confirm the keyword"></p>\r\n                </div>\r\n                \r\n                <button class="btn" type="submit" data-action="form(\'tags\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Status"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <select name="status__eq">\r\n                </select>\r\n                <button class="btn" type="submit" data-action="form(\'status__eq\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Last Contact"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#">\r\n                <ul class="nav nav-pills">\r\n                    <li>\r\n                        <a href="#lastUpdateDate__today=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="Today"></a>\r\n                    </li>\r\n                    <li>\r\n                        <a href="#lastUpdateDate__this_week=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="This week"></a>\r\n                    </li>\r\n                    <li>\r\n                        <a href="#lastUpdateDate__this_month=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="This month"></a>\r\n                    </li>\r\n                    <li>\r\n                        <a href="#lastUpdateDate__three_days_ago=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="> 3 days"></a>\r\n                    </li>\r\n                    <li>\r\n                        <a href="#lastUpdateDate__one_week_ago=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="> 1 week"></a>\r\n                    </li>\r\n                    <li>\r\n                        <a href="#lastUpdateDate__one_month_ago=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="> 1 month"></a>\r\n                    </li>\r\n                    <li>\r\n                        <a href="#lastUpdateDate__three_months_ago=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="> 3 months"></a>\r\n                    </li>\r\n                    <li>\r\n                        <a href="#lastUpdateDate__six_months_ago=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="> 6 months"></a>\r\n                    </li>\r\n                    <li>\r\n                        <a href="#lastUpdateDate__one_year_ago=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="> 1 year"></a>\r\n                    </li>\r\n                </ul>\r\n                <input type="text" name="from" class="date input-small" data-weave="shared/widget/common/date-picker/main">\r\n                -\r\n                <input type="text" name="to" class="date input-small" data-weave="shared/widget/common/date-picker/main">\r\n                <button class="btn" type="submit" data-action="form(\'update\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Company"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <label class="radio inline">\r\n                        <input type="radio" name="company-status" value="latest" checked="checked" data-action="working/status"> <span data-weave="shared/helper/translation" data-i18n="Latest"></span>\r\n                    </label>\r\n                    <label class="radio inline">\r\n                        <input type="radio" name="company-status" value="past" data-action="working/status"> <span data-weave="shared/helper/translation" data-i18n="Past"></span>\r\n                    </label>\r\n                    <label class="radio inline">\r\n                        <input type="radio" name="company-status" value="all" data-action="working/status"> <span data-weave="shared/helper/translation" data-i18n="All"></span>\r\n                    </label>\r\n                </div>\r\n                <div class="control-group">\r\n                    <input type="text" name="company_name" class="input-large" data-weave="app/widget/common/company-suggestion/main" autocomplete="off">\r\n                </div>\r\n                \r\n                <button class="btn" type="submit" data-action="form(\'company_name\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Industry"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <label class="radio inline">\r\n                        <input type="radio" name="industry-status" value="latest" checked="checked" data-action="working/status"> <span data-weave="shared/helper/translation" data-i18n="Latest"></span>\r\n                    </label>\r\n                    <label class="radio inline">\r\n                        <input type="radio" name="industry-status" value="past" data-action="working/status"> <span data-weave="shared/helper/translation" data-i18n="Past"></span>\r\n                    </label>\r\n                    <label class="radio inline">\r\n                        <input type="radio" name="industry-status" value="all" data-action="working/status"> <span data-weave="shared/helper/translation" data-i18n="All"></span>\r\n                    </label>\r\n                </div>\r\n                <div class="control-group">\r\n                    <div class="comtree span" data-name="company_industry" data-url="/rest/data/industry" data-weave="shared/widget/common/comtree/main"></div>\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'company_industry\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Function"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <label class="radio inline">\r\n                        <input type="radio" name="function-status" value="latest" checked="checked" data-action="working/status"> <span data-weave="shared/helper/translation" data-i18n="Latest"></span>\r\n                    </label>\r\n                    <label class="radio inline">\r\n                        <input type="radio" name="function-status" value="past" data-action="working/status"> <span data-weave="shared/helper/translation" data-i18n="Past"></span>\r\n                    </label>\r\n                    <label class="radio inline">\r\n                        <input type="radio" name="function-status" value="all" data-action="working/status"> <span data-weave="shared/helper/translation" data-i18n="All"></span>\r\n                    </label>\r\n                </div>\r\n                <div class="control-group">\r\n                    <div class="comtree span" data-name="function_id" data-url="/rest/data/function" data-weave="shared/widget/common/comtree/main"></div>\r\n                </div>\r\n\r\n                <button class="btn" type="submit" data-action="form(\'function_id\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Title"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <label class="radio inline">\r\n                        <input type="radio" name="title-status" value="latest" checked="checked" data-action="working/status"> <span data-weave="shared/helper/translation" data-i18n="Latest"></span>\r\n                    </label>\r\n                    <label class="radio inline">\r\n                        <input type="radio" name="title-status" value="past" data-action="working/status"> <span data-weave="shared/helper/translation" data-i18n="Past"></span>\r\n                    </label>\r\n                    <label class="radio inline">\r\n                        <input type="radio" name="title-status" value="all" data-action="working/status"> <span data-weave="shared/helper/translation" data-i18n="All"></span>\r\n                    </label>\r\n                </div>\r\n                <div class="control-group">\r\n                    <input type="text" class="input-large" name="title" data-weave="app/widget/common/autocomplete/main(\'title\')" autocomplete="off">\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'title\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Years of experience"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <input type="text" name="work_start__year_gt" class="input-mini">\r\n                    -\r\n                    <input type="text" name="work_start__year_lt" class="input-mini">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Year(s)"></span>\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'work_start\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="On Job"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <input type="text" name="last_work_start__year_gt" class="input-mini">\r\n                    -\r\n                    <input type="text" name="last_work_start__year_lt" class="input-mini">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Year(s)"></span>\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'last_work_start\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="City"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Current City"></span>\r\n                    <div class="comtree span" data-name="location_id" data-url="/rest/data/city" data-weave="shared/widget/common/comtree/main"></div>\r\n                </div>\r\n                <div class="control-group">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Intention City"></span>\r\n                    <div class="comtree span" data-name="city_id" data-url="/rest/data/city" data-weave="shared/widget/common/comtree/main"></div>\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'city\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Annual Salary"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#">\r\n\r\n                <div class="control-group">\r\n                    <input type="text" name="from" class="input-mini"> <span data-weave="shared/helper/translation" data-i18n="Currency unit"></span>\r\n                    -\r\n                    <input type="text" name="to" class="input-mini"> <span data-weave="shared/helper/translation" data-i18n="Currency unit"></span>\r\n                    <p class="help-block">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Digits only"></span>, <span data-weave="shared/helper/translation" data-i18n="eg"></span> 30 - 50\r\n                    </p>\r\n                </div>\r\n                \r\n                <button class="btn" type="submit" data-action="form(\'salary\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Name"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <input type="text" class="input-large" autocomplete="off">\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'name\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Phone"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <input type="text" class="input-large" autocomplete="off">\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'mobile\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Email"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <input type="text" class="input-large" autocomplete="off">\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'email\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Date of birth"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <select name="birthday" class="input-large">\r\n                        <option value="today" data-weave="shared/helper/translation" data-i18n="Today"></option>\r\n                        <option value="month" data-weave="shared/helper/translation" data-i18n="This month"></option>\r\n                    </select>\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'birthday\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Age"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#">\r\n\r\n                <div class="control-group">\r\n                    <input type="text" name="from" class="input-small">\r\n                    -\r\n                    <input type="text" name="to" class="input-small">\r\n                    <p class="help-block">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Digits only"></span>, <span data-weave="shared/helper/translation" data-i18n="eg"></span> 25 - 35\r\n                    </p>\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'age\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Gender"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#">\r\n\r\n                <div class="control-group">\r\n                    <label class="radio inline">\r\n                        <input type="radio" name="gender" value="1"> <span data-weave="shared/helper/translation" data-i18n="Male"></span>\r\n                    </label>\r\n                    <label class="radio inline">\r\n                        <input type="radio" name="gender" value=""> <span data-weave="shared/helper/translation" data-i18n="Female"></span>\r\n                    </label>\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'gender\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider last-show"></li>\r\n    \r\n    <li class="dropdown hide">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="School"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <input type="text" name="school">\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'school\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider hide"></li>\r\n    <li class="dropdown hide">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Field of Study"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <input type="text" name="major">\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'major\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider hide"></li>\r\n    <li class="dropdown hide">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Degree"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <select name="degree" data-weave="app/widget/common/dropdown/main(\'education_background\')"></select>\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'degree\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider hide"></li>\r\n    <li class="dropdown hide">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="User"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <select name="name" class="input-large" data-weave="shared/widget/common/user-list/main">\r\n                    </select>\r\n                </div>\r\n                <div class="control-group">\r\n                    <select name="type">\r\n                        <option value="user_id" data-weave="shared/helper/translation" data-i18n="Own and shared"></option>\r\n                        <option value="owner__eq" data-weave="shared/helper/translation" data-i18n="Own"></option>\r\n                        <option value="addedBy__eq" data-weave="shared/helper/translation" data-i18n="Keyin"></option>\r\n                        <option value="share_id" data-weave="shared/helper/translation" data-i18n="Shared"></option>\r\n                    </select>\r\n                </div>\r\n\r\n                <button class="btn" type="submit" data-action="form(\'user\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider hide"></li>\r\n    <li class="dropdown hide">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Team"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <div class="comtree span" data-name="team_id" data-url="/rest/data/team" data-weave="shared/widget/common/comtree/main"></div>\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'team_id\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider hide"></li>\r\n    <li class="dropdown hide">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Type"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <label class="radio inline">\r\n                        <input type="radio" name="type__eq" value="candidate"> <span data-weave="shared/helper/translation" data-i18n="Candidate"></span>\r\n                    </label>\r\n                    <label class="radio inline">\r\n                        <input type="radio" name="type__eq" value="contact"> <span data-weave="shared/helper/translation" data-i18n="Contact"></span>\r\n                    </label>\r\n                    <label class="radio inline">\r\n                        <input type="radio" name="type__eq" value="coldcall"> <span>Cold Call</span>\r\n                    </label>\r\n                </div>\r\n\r\n                <button class="btn" type="submit" data-action="form(\'type__eq\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider hide"></li>\r\n    <li class="dropdown hide">\r\n        <a href="#" data-action="dropdown">MPC</a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <label class="checkbox inline">\r\n                        <input type="checkbox" name="is_mpc" value="1"> <span>MPC</span>\r\n                    </label>\r\n                </div>\r\n\r\n                <button class="btn" type="submit" data-action="form(\'is_mpc\')" data-weave="shared/helper/translation" data-i18n="Add"></button>\r\n\r\n            </form>\r\n        </div>\r\n    </li>\r\n\r\n    <li class="divider hide"></li>\r\n    <li class="dropdown hide">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Attachment Related"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <label data-weave="shared/helper/translation" data-i18n="Attachment Type"></label>\r\n                    <select name="attachment_type" data-type="candidate" data-weave="app/widget/common/attachment-type/main"></select>\r\n                </div>\r\n\r\n                <div class="control-group">\r\n                    <label data-weave="shared/helper/translation" data-i18n="Has attachment"></label>\r\n                    <label class="radio inline">\r\n                        <input type="radio" name="has_attachment" value="1" data-action="radio/uncheckable"> <span data-weave="shared/helper/translation" data-i18n="Has"></span>\r\n                    </label>\r\n                    <label class="radio inline">\r\n                        <input type="radio" name="has_attachment" value="0" data-action="radio/uncheckable"> <span data-weave="shared/helper/translation" data-i18n="Hasn\'t"></span>\r\n                    </label>\r\n                </div>\r\n                \r\n                <button class="btn" type="submit" data-action="form(\'attachment\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider hide"></li>\r\n    <li class="dropdown hide">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Note Related"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <label data-weave="shared/helper/translation" data-i18n="Note Type"></label>\r\n                    <select name="note_category" class="input-large" data-weave="app/widget/common/dropdown/main(\'candidate_note_category\')">\r\n                        <option value="" data-weave="shared/helper/translation" data-i18n="Please select"></option>\r\n                    </select>\r\n                </div>\r\n\r\n                <div class="control-group">\r\n                    <label data-weave="shared/helper/translation" data-i18n="Note User"></label>\r\n                    <select name="note_user" class="input-large" data-weave="shared/widget/common/user-list/main">\r\n                    </select>\r\n                </div>\r\n                \r\n                <div class="control-group">\r\n                    <label data-weave="shared/helper/translation" data-i18n="Has Note"></label>\r\n                    <label class="radio inline">\r\n                        <input type="radio" name="has_note" value="1" data-action="radio/uncheckable"> <span data-weave="shared/helper/translation" data-i18n="Has"></span>\r\n                    </label>\r\n                    <label class="radio inline">\r\n                        <input type="radio" name="has_note" value="0" data-action="radio/uncheckable"> <span data-weave="shared/helper/translation" data-i18n="Hasn\'t"></span>\r\n                    </label>\r\n                </div>\r\n\r\n                <button class="btn" type="submit" data-action="form(\'note_related\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider hide"></li>\r\n    <li class="dropdown hide">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Folder"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <div class="comtree span" data-name="folder_id" data-weave="shared/widget/common/comtree/main" data-hub="update/candidate/folder"></div>\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'folder_id\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <!-- <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Duplicate Name"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <label class="radio inline">\r\n                        <input type="radio" name="has_distinct" value="chineseName"> <span data-weave="shared/helper/translation" data-i18n="Chinese Name"></span>\r\n                    </label>\r\n                    <label class="radio inline">\r\n                        <input type="radio" name="has_distinct" value="englishName"> <span data-weave="shared/helper/translation" data-i18n="English Name"></span>\r\n                    </label>\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'has_distinct\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li> -->\r\n\r\n    <li class="filter-toggle">\r\n        <a href="#" data-action="moreless">\r\n            <span class="icon-arrow-right icon-blue"></span>\r\n        </a>\r\n    </li>\r\n</ul>\r\n\r\n<p class="sepH_b">\r\n    <span class="tag label label-info deletable hide" data-query="keyword" data-action="tag/remove"><b data-i18n="Keywords" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="attachment_type" data-action="tag/remove"><b data-i18n="Attachment Type" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="note" data-action="tag/remove"><b data-i18n="Note Text" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="note_category" data-action="tag/remove"><b data-i18n="Note Category" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="has_attachment" data-action="tag/remove"><b data-i18n="Attachment" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="note_user" data-action="tag/remove"><b data-i18n="Note Added" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="has_note" data-action="tag/remove"><b data-i18n="Note" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="tags" data-action="tag/remove"><b data-i18n="Tags" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="status__eq" data-action="tag/remove"><b data-i18n="Status" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n\r\n    <span class="tag label label-info deletable hide" data-query="folder_id" data-action="tag/remove"><b data-i18n="Folder" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    \r\n\r\n    <span class="tag label label-info deletable hide" data-query="company_name" data-action="tag/remove"><b data-i18n="Company" data-weave="shared/helper/translation"></b>: <b class="current"></b> <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="company_industry" data-action="tag/remove"><b data-i18n="Industry" data-weave="shared/helper/translation"></b>: <b class="current"></b> <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="function_id" data-action="tag/remove"><b data-i18n="Function" data-weave="shared/helper/translation"></b>: <b class="current"></b> <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="title" data-action="tag/remove"><b data-i18n="Title" data-weave="shared/helper/translation"></b>: <b class="current"></b> <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n\r\n    <span class="tag label label-info deletable hide" data-query="work_start" data-action="tag/remove"><b data-i18n="Years of experience" data-weave="shared/helper/translation"></b>: <span></span> <b data-weave="shared/helper/translation" data-i18n="Year(s)"></b> <i class="icon-remove-small icon-transparent"></i></span>\r\n\r\n    <span class="tag label label-info deletable hide" data-query="last_work_start" data-action="tag/remove"><b data-i18n="On Job" data-weave="shared/helper/translation"></b>: <span></span> <b data-weave="shared/helper/translation" data-i18n="Year(s)"></b> <i class="icon-remove-small icon-transparent"></i></span>\r\n\r\n    <span class="tag label label-info deletable hide" data-query="location_id" data-action="tag/remove"><b data-i18n="Current City" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n\r\n    <span class="tag label label-info deletable hide" data-query="city_id" data-action="tag/remove"><b data-i18n="Intention City" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n\r\n    <span class="tag label label-info deletable hide" data-query="name" data-action="tag/remove"><b data-i18n="Name" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="birthday" data-action="tag/remove"><b data-i18n="Date of birth" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="salary" data-action="tag/remove"><b data-i18n="Salary" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    \r\n    <span class="tag label label-info deletable hide" data-query="update" data-action="tag/remove"><b data-i18n="Last Contact" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="user" data-action="tag/remove"><b data-i18n="User" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="type__eq" data-action="tag/remove"><b data-i18n="Type" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="is_mpc" data-action="tag/remove"><span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="email" data-action="tag/remove"><b data-i18n="Email" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="mobile" data-action="tag/remove"><b data-i18n="Phone" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="age" data-action="tag/remove"><b data-i18n="Age" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="gender" data-action="tag/remove"><b data-i18n="Gender" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n\r\n    <span class="tag label label-info deletable hide" data-query="school" data-action="tag/remove"><b data-i18n="School" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="major" data-action="tag/remove"><b data-i18n="Field of Study" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="degree" data-action="tag/remove"><b data-i18n="Degree" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n\r\n    <span class="tag label label-info deletable hide" data-query="team_id" data-action="tag/remove"><b data-i18n="Team" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="ext" data-action="tag/remove"><b data-i18n="Other Fields" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="has_distinct" data-action="tag/remove"><b data-i18n="Duplicate Name" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <a href="#" class="hide save-filter" data-action="filter/save/toggle" data-weave="shared/helper/translation" data-i18n="Save as"></a>\r\n</p>\r\n\r\n<form action="#" class="form-horizontal save-filter-form hide">\r\n    <input type="text" class="input-large">\r\n    <button class="btn" data-action="filter/save" data-weave="shared/helper/translation" data-i18n="Save"></button>\r\n    <button class="btn" data-action="filter/save/toggle" data-weave="shared/helper/translation" data-i18n="Close"></button>\r\n</form>';
		return a
	}
}), define("troopjs-requirejs/template!app/widget/common/custom-filters/main.html", [], function () {
	return function (a) {
		var b = "",
		c = a.type,
		d = a.mapping,
		e = a.options.length ? JSON.parse(a.options) : [];
		if (b += '\n<li class="divider hide"></li>\n<li class="dropdown hide">\n    <a href="#" data-action="dropdown" data-mapping="' + d + '">' + a.label + '</a>\n    <div class="dropdown-menu filter-content">\n        <form action="#" class="form-horizontal">\n            <div class="control-group">\n                ', "text" === c || "date" === c || "multiline" === c)
			b += '\n                <input type="text" name="' + d + '" ', "date" === c && (b += 'data-weave="shared/widget/common/date-picker/main"'), b += ">\n                ";
		else if ("dropdown" === c) {
			b += '\n                <select name="' + d + '">\n                    <option value="" data-weave="shared/helper/translation" data-i18n="Please select"></option>\n                    ';
			for (var f = 0, g = e.length; g > f; f++)
				b += '\n                    <option value="' + e[f] + '">' + e[f] + "</option>\n                    ";
			b += "\n                </select>\n                "
		} else if ("radio" === c) {
			b += "\n                ";
			for (var f = 0, g = e.length; g > f; f++)
				b += '\n                <label class="radio inline">\n                    <input type="radio" name="' + d + '" value="' + e[f] + '" > ' + e[f] + "\n                </label>\n                ";
			b += "\n                "
		} else if ("checkbox" === c) {
			b += "\n                ";
			for (var f = 0, g = e.length; g > f; f++)
				b += '\n                <label class="checkbox inline">\n                    <input type="checkbox" name="' + d + '" value="' + e[f] + '" > ' + e[f] + "\n                </label>\n                ";
			b += "\n                "
		}
		return b += '\n            </div>\n            <button class="btn" type="submit" data-action="form(\'' + d + '\')" data-weave="shared/helper/translation" data-i18n="Add"></button>\n        </form>\n    </div>\n</li>'
	}
}), define("app/widget/candidate/filter/main", ["compose", "jquery", "shared/widget/filter/base", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "template!app/widget/common/custom-filters/main.html", "shared/widget/filter/query", "shared/helper/utils", "shared/helper/blurb", "config"], function (a, b, c, d, e, f, g, h, i, j, k) {
	function l() {
		h.addAttr({
			keyword : function (a) {
				var b = a.find("input").val();
				b ? this.addQuery("keyword", "keyword=" + window.encodeURIComponent(b)) : this.deleteQuery("keyword")
			},
			attachment : function (a) {
				var b = a.find("select").val(),
				c = a.find('[name="has_attachment"]:checked');
				b.length ? this.addQuery("attachment_type", "attachment_type=" + window.encodeURIComponent(b)) : this.deleteQuery("attachment_type"),
				c.length ? this.addQuery("has_attachment", "has_attachment=" + c.val()) : this.deleteQuery("has_attachment")
			},
			note : function (a) {
				var b = a.find("input").val().trim();
				b.length ? this.addQuery("note", "note=" + window.encodeURIComponent(b)) : this.deleteQuery("note")
			},
			note_related : function (a) {
				var b = a.find('[name="note_user"]').val(),
				c = a.find('[name="note_category"]').val();
				c ? this.addQuery("note_category", "note_category=" + c) : this.addQuery("note_category", ""),
				b.length ? this.addQuery("note_user", "note_user=" + window.encodeURIComponent(b)) : this.deleteQuery("note_user"),
				a.find('[name="has_note"]:checked').length ? this.addQuery("has_note", "has_note=" + window.encodeURIComponent(a.find('[name="has_note"]:checked').val())) : this.deleteQuery("has_note")
			},
			name : function (a) {
				var b = a.find("input").val().trim();
				b.length && this.addQuery("name", "name=" + encodeURIComponent(b))
			},
			school : function (a) {
				var b = a.find("input").val().trim();
				b.length && this.addQuery("school", "school=" + encodeURIComponent(b))
			},
			major : function (a) {
				var b = a.find("input").val().trim();
				b.length && this.addQuery("major", "major=" + encodeURIComponent(b))
			},
			degree : function (a) {
				var b = a.find("select").val().trim();
				b.length && this.addQuery("degree", "degree=" + encodeURIComponent(b))
			},
			folder_id : function (a) {
				var b = a.find('[name="folder_id"]').val();
				b.length && this.addQuery("folder_id", "folder_id=" + b)
			},
			email : function (a) {
				var c = b.trim(a.find("input").val());
				c.length && this.addQuery("email", "email=" + window.encodeURIComponent(c))
			},
			mobile : function (a) {
				var c = a.find("input").val().trim();
				c.length && (b('[data-query="mobile"]').removeClass("hide").find("span").text(c), this.addQuery("mobile", "mobile=" + encodeURIComponent(c)))
			},
			company_name : function (a) {
				var b = a.find('[name="company_name"]').val().trim();
				b.length && (this.addQuery("company_name", "company_name=" + encodeURIComponent(b)), this.addQuery("current", "current=" + a.find("input:radio:checked").val()))
			},
			company_industry : function (a) {
				var b = a.find('[name="company_industry"]').val();
				b.length && (this.addQuery("company_industry", "company_industry=" + b), this.addQuery("current", "current=" + a.find("input:radio:checked").val()))
			},
			function_id : function (a) {
				var b = a.find('[name="function_id"]').val();
				b.length && (this.addQuery("function_id", "function_id=" + b), this.addQuery("current", "current=" + a.find("input:radio:checked").val()))
			},
			title : function (a) {
				var b = a.find('[name="title"]').val().trim();
				b.length && (this.addQuery("title", "title=" + encodeURIComponent(b)), this.addQuery("current", "current=" + a.find("input:radio:checked").val()))
			},
			city : function (a) {
				var b = a.find('[name="location_id"]').val(),
				c = a.find('[name="city_id"]').val();
				b.length ? this.addQuery("location_id", "location_id=" + b) : this.deleteQuery("location_id"),
				c.length ? this.addQuery("city_id", "city_id=" + c) : this.deleteQuery("city_id")
			},
			team_id : function (a) {
				var b = a.find('[name="team_id"]').val();
				b.length && this.addQuery("team_id", "team_id=" + b)
			},
			salary : function (a) {
				var b = a.find('input[name="from"]').val().trim(),
				c = a.find('input[name="to"]').val().trim();
				b.length && c.length && this.addQuery("salary", "annualSalary__gte=" + encodeURIComponent(b * q) + "&annualSalary__lte=" + encodeURIComponent(c * q))
			},
			tags : function (a) {
				var b = a.find("input").val();
				b && this.addQuery("tags", "tags=" + window.encodeURIComponent(b))
			},
			status__eq : function (a) {
				var b = a.find("select").val();
				b.length && this.addQuery("status__eq", "status__eq=" + b)
			},
			birthday : function (a) {
				var b = a.find('[name="birthday"]').val();
				b.length && this.addQuery("birthday", "birthday=" + b)
			},
			user : function (a) {
				var b = a.find('select[name="type"]').val(),
				c = a.find('select[name="name"]').val();
				b.length && c.length && this.addQuery("user", b + "=" + c)
			},
			update : function (a) {
				var b = a.find('input[name="from"]').val(),
				c = a.find('input[name="to"]').val();
				b && c && this.addQuery("update", "lastUpdateDate__gt=" + b + "&lastUpdateDate__lt=" + c)
			},
			age : function (a) {
				var b = parseInt(a.find('[name="from"]').val(), 10),
				c = parseInt(a.find('[name="to"]').val(), 10);
				if (b && c) {
					var d = s.YEAR - b,
					e = s.YEAR - c;
					return b > c ? (i.alert("error", "First 'Age' should be less than second 'Age'."), void 0) : (this.addQuery("age", "dateOfBirth__year_gt=" + encodeURIComponent(e) + "&dateOfBirth__year_lt=" + encodeURIComponent(d)), void 0)
				}
			},
			type__eq : function (a) {
				var b = a.find(":radio:checked"),
				c = b.val();
				c && this.addQuery("type__eq", "type__eq=" + c)
			},
			is_mpc : function (a) {
				var b = a.find(":checkbox");
				b.is(":checked") ? this.addQuery("is_mpc", "is_mpc=1") : this.deleteQuery("is_mpc")
			},
			gender : function (a) {
				var b,
				c = a.find(":radio").filter(":checked");
				c.length && (b = c.val(), this.addQuery("gender", "gender=" + b))
			},
			ext : function (a) {
				var b = a.find('select[name="ext-type"] :selected').val(),
				c = a.find("input").val();
				b.length && c.length && this.addQuery("ext", b + "=" + window.encodeURIComponent(c))
			},
			has_distinct : function (a) {
				var b = a.find(":checked").val();
				b.length && this.addQuery("has_distinct", "has_distinct=" + window.encodeURIComponent(b))
			},
			work_start : function (a) {
				var b = a.find('[name="work_start__year_gt"]').val().trim(),
				c = a.find('[name="work_start__year_lt"]').val().trim();
				c.length && (b.length ? this.addQuery("work_start", "work_start__year_gt=" + (s.YEAR - c) + "&work_start__year_lt=" + (s.YEAR - b)) : this.addQuery("work_start", "work_start__year_eq=" + (s.YEAR - c)))
			},
			last_work_start : function (a) {
				var b = a.find('[name="last_work_start__year_gt"]').val().trim(),
				c = a.find('[name="last_work_start__year_lt"]').val().trim();
				c.length && (b.length ? this.addQuery("work_start", "last_work_start__year_gt=" + (s.YEAR - c) + "&last_work_start__year_lt=" + (s.YEAR - b)) : this.addQuery("work_start", "last_work_start__year_eq=" + (s.YEAR - c)))
			}
		})
	}
	function m() {
		var a = this;
		this.ageFrom = null,
		this.maxYear = null,
		this.ageTo = null,
		this.minYear = null,
		this.salaryFrom = null,
		this.salaryTo = null,
		this.city = null,
		this.updateFrom = null,
		this.updateTo = null,
		a.company_industry = null,
		a.industry_name = null,
		a.function_id = null,
		a.function_name = null
	}
	function n(a) {
		var c = this,
		i = [],
		j = d(),
		k = d();
		i.push(j.promise(), k.promise()),
		c.publish("ajax", {
			url : u.STATUS
		}, j.done(function (a) {
				c._status = a
			})),
		c.publish("ajax", {
			url : u.TABLE
		}, k.done(function (a) {
				c._fields = a
			})),
		e.apply(b, i).done(function () {
			d(function (a) {
				c.html(f, c._json, a)
			}).done(function () {
				c._fields.forEach(function (a) {
					var d = b(g(a)),
					e = {};
					c.$element.find(".nav .filter-toggle").before(d),
					d.find("[data-weave]").weave(),
					e[a.mapping] = b.proxy(t[a.type], a),
					h.addAttr(e)
				}),
				o.call(c, a)
			})
		})
	}
	function o(a) {
		var b = this;
		b.folderWidget = b.$element.find('[data-name="folder"]').woven()[0],
		b.$status = b.$element.find('[name="status__eq"]'),
		b.$workingStatus = b.$element.find('[data-action="working/status"]'),
		b.$current = b.$element.find(".current"),
		b._status.forEach(function (a) {
			b.$status.append('<option value="' + a.code + '">' + a.value + "</option>")
		}),
		a.resolve()
	}
	function p(a) {
		var c,
		d,
		e,
		f = this,
		g = a[0],
		i = a[1];
		switch (g.indexOf("lastUpdateDate") > -1 && (g = g.substring(0, g.indexOf("_"))), (g.indexOf("work_start") > -1 || g.indexOf("last_work_start") > -1) && (g = g.substring(0, g.indexOf("__"))), /ext/.test(g) && (g = "ext"), g) {
		case "ext":
			var j = f.$element.find('[name="' + a[0] + '"]');
			j.prop("tagName"),
			j.attr("type");
			var k = f.$element.find('li.dropdown a[data-mapping="' + a[0] + '"]').text();
			f.$element.find('[data-query="' + a[0] + '"]').remove(),
			f.$element.find(".save-filter").before('<span class="tag label label-info deletable" data-query="' + a[0] + '" data-action="tag/remove">' + k + ": " + window.decodeURIComponent(i) + ' <i class="icon-remove-small icon-transparent"></i></span>'),
			h.addQuery(a[0], a[0] + "=" + i);
			break;
		case "work_start":
			"work_start__year_eq" === a[0] && (f.$element.find('[data-query="work_start"]').removeClass("hide").find("span").text(s.YEAR - window.decodeURIComponent(i)), h.addQuery("work_start", "work_start__year_eq=" + i), f.work_start_from = null, f.work_start_from_condition = null, f.work_start_to = null, f.work_start_to_condition = null),
			"work_start__year_lt" === a[0] && (f.work_start_from = s.YEAR - window.decodeURIComponent(i), f.work_start_from_condition = i),
			"work_start__year_gt" === a[0] && (f.work_start_to = s.YEAR - window.decodeURIComponent(i), f.work_start_to_condition = i),
			f.work_start_to && f.work_start_from && (f.$element.find('[data-query="work_start"]').removeClass("hide").find("span").text(f.work_start_from + "-" + f.work_start_to), h.addQuery("work_start", "work_start__year_lt=" + f.work_start_from_condition + "&" + "work_start__year_gt=" + f.work_start_to_condition), f.work_start_from = null, f.work_start_from_condition = null, f.work_start_to = null, f.work_start_to_condition = null);
			break;
		case "last_work_start":
			"last_work_start__year_eq" === a[0] && (f.$element.find('[data-query="last_work_start"]').removeClass("hide").find("span").text(s.YEAR - window.decodeURIComponent(i)), h.addQuery("last_work_start", "last_work_start__year_eq=" + i), f.last_work_start_from = null, f.last_work_start_from_condition = null, f.last_work_start_to = null, f.last_work_start_to_condition = null),
			"last_work_start__year_lt" === a[0] && (f.last_work_start_from = s.YEAR - window.decodeURIComponent(i), f.last_work_start_from_condition = i),
			"last_work_start__year_gt" === a[0] && (f.last_work_start_to = s.YEAR - window.decodeURIComponent(i), f.last_work_start_to_condition = i),
			f.last_work_start_to && f.last_work_start_from && (f.$element.find('[data-query="last_work_start"]').removeClass("hide").find("span").text(f.last_work_start_from + "-" + f.last_work_start_to), h.addQuery("last_work_start", "last_work_start__year_lt=" + f.last_work_start_from_condition + "&" + "last_work_start__year_gt=" + f.last_work_start_to_condition), f.last_work_start_from = null, f.last_work_start_from_condition = null, f.last_work_start_to = null, f.last_work_start_to_condition = null);
			break;
		case "current":
			e = f.$workingStatus.filter('[value="' + i + '"]').eq(0).next().text(),
			f.$element.find(".current").text(e),
			h.addQuery("current", "current=" + i);
			break;
		case "dateOfBirth__year_gt":
		case "dateOfBirth__year_lt":
			"dateOfBirth__year_gt" === g ? (f.ageTo = s.YEAR - i, f.minYear = i) : "dateOfBirth__year_lt" === g && (f.ageFrom = s.YEAR - i, f.maxYear = i),
			f.maxYear && f.minYear && (f.$element.find('[data-query="age"]').removeClass("hide").find("span").text(decodeURIComponent(f.ageFrom) + " - " + decodeURIComponent(f.ageTo)), h.addQuery("age", "dateOfBirth__year_gt=" + f.minYear + "&dateOfBirth__year_lt=" + f.maxYear));
			break;
		case "annualSalary__gte":
		case "annualSalary__lte":
			"annualSalary__gte" === g ? f.salaryFrom = i : "annualSalary__lte" === g && (f.salaryTo = i),
			f.salaryFrom && f.salaryTo && (f.$element.find('[data-query="salary"]').removeClass("hide").find("span").text(decodeURIComponent(f.salaryFrom) / q + v.CURRENCY_UNIT + " - " + decodeURIComponent(f.salaryTo) / q + v.CURRENCY_UNIT), h.addQuery("salary", "annualSalary__gte=" + f.salaryFrom + "&annualSalary__lte=" + f.salaryTo));
			break;
		case "user_id":
		case "owner__eq":
		case "addedBy__eq":
		case "share_id":
			d = f.$element.find('select[name="type"]').find('[value="' + g + '"]').text(),
			c = f.$element.find('select[name="name"]').find('[value="' + i + '"]').text(),
			f.$element.find('[data-query="user"]').removeClass("hide").find("span").text(c + " " + d),
			h.addQuery("user", g + "=" + i);
			break;
		case "lastUpdateDate":
			if (a[0].indexOf("gt") > -1 || a[0].indexOf("lt") > -1) {
				if (a[0].indexOf("gt") > -1 ? f.updateFrom = i : a[0].indexOf("lt") > -1 && (f.updateTo = i), f.updateFrom && f.updateTo)
					return f.$element.find('[data-query="update"]').removeClass("hide").find("span").text(f.updateFrom + " - " + f.updateTo), h.addQuery("update", "lastUpdateDate__gt=" + f.updateFrom + "&lastUpdateDate__lt=" + f.updateTo), void 0
			} else
				f.$element.find('a[data-action="lastupdate"]').each(function () {
					return b(this).attr("href").substring(1) == a[0] + "=" ? (c = b(this).text(), !1) : void 0
				}), f.$element.find('[data-query="update"]').removeClass("hide").find("span").text(c), h.addQuery("update", a[0] + "=");
			break;
		case "type__eq":
			"contact" === a[1] ? c = "客户联系人" : "coldcall" === a[1] ? c = "Cold Call" : "candidate" === a[1] && (c = "候选人"),
			f.$element.find('[data-query="type__eq"]').removeClass("hide").find("span").text(c),
			h.addQuery("type__eq", "type__eq=" + i);
			break;
		case "gender":
		case "has_attachment":
		case "has_note":
		case "has_distinct":
		case "is_mpc":
			c = f.$element.find('[name="' + g + '"]').filter('[value="' + i + '"]').next().text(),
			f.$element.find('[data-query="' + g + '"]').removeClass("hide").find("span").text(c),
			h.addQuery(g, g + "=" + i);
			break;
		case "note_user":
		case "status__eq":
		case "attachment_type":
		case "birthday":
		case "note_category":
		case "degree":
			c = f.$element.find('[name="' + g + '"]').find('[value="' + window.decodeURIComponent(i) + '"]').text(),
			f.$element.find('[data-query="' + g + '"]').removeClass("hide").find("span").text(c),
			h.addQuery(g, g + "=" + i);
			break;
		case "team_id":
		case "location_id":
		case "city_id":
		case "folder_id":
		case "company_industry":
		case "function_id":
			c = f.$element.find('[data-name="' + g + '"]').woven()[0].getNodeNameById(window.decodeURIComponent(i)),
			f.$element.find('[data-query="' + g + '"]').removeClass("hide").find("span").text(c),
			h.addQuery(g, g + "=" + i);
			break;
		case "byfilter":
			break;
		default:
			f.$element.find('[data-query="' + g + '"]').removeClass("hide").find("span").text(window.decodeURIComponent(i)),
			h.addQuery(g, g + "=" + i)
		}
	}
	var q,
	r = new Date,
	s = {
		YEAR : r.getFullYear(),
		MONTH : r.getMonth(),
		DATE : r.getDate(),
		DAY : r.getDay()
	},
	t = {
		text : function (a) {
			var b = a.find("input").val();
			b.length && h.addQuery(this.mapping, this.mapping + "=" + window.encodeURIComponent(b))
		},
		dropdown : function (a) {
			var b = a.find("select").val();
			b.length && h.addQuery(this.mapping, this.mapping + "=" + window.encodeURIComponent(b))
		},
		multiline : function (a) {
			var b = a.find("input").val();
			b.length && h.addQuery(this.mapping, this.mapping + "=" + window.encodeURIComponent(b))
		},
		radio : function (a) {
			var b = a.find("input:checked").val();
			b.length && h.addQuery(this.mapping, this.mapping + "=" + window.encodeURIComponent(b))
		},
		checkbox : function (a) {
			var c = a.find("input:checked"),
			d = [];
			c.length && (c.each(function () {
					d.push(b(this).val())
				}), d = d.join(","), h.addQuery(this.mapping, this.mapping + "=" + window.encodeURIComponent(d)))
		},
		date : function (a) {
			var b = a.find("input").val();
			b.length && h.addQuery(this.mapping, this.mapping + "=" + window.encodeURIComponent(b))
		}
	},
	u = {
		SAVE_FILTER : "/rest/data/queryfilter/candidate/add",
		STATUS : "/rest/data/options?type=candidate_status",
		TABLE : "/rest/data/fields?table=candidate"
	},
	v = {
		CURRENCY_UNIT : j.t("Currency unit")
	};
	switch (k.userLang) {
	case "zh_CN":
		q = 1e4;
		break;
	case "en":
		q = 1e3;
		break;
	default:
		q = 1e4
	}
	return c.extend(function () {
		var a = this;
		m.call(a),
		h.url = u.SAVE_FILTER,
		a._setFilter = p,
		l.call(a)
	}, {
		extFields : ["ext1", "ext2", "ext3", "ext4", "ext5", "ext6"],
		"sig/initialize" : function (a, b) {
			n.call(this, b)
		},
		"hub:momery/filter/set" : a.around(function (a) {
			return function (b, c) {
				a.call(this, b, c),
				m.call(this)
			}
		}),
		"dom/action.change" : b.noop,
		"dom/action/lastupdate.click" : function (a, c) {
			c.preventDefault();
			var d = b(c.target);
			b('[data-query="update"]').removeClass("hide").find("span").text(d.text()),
			h.addQuery("update", d.attr("href").substring(1)),
			d.closest("form").find("button").trigger("click")
		},
		"dom/action/radio/uncheckable.click" : function (a, c) {
			var d = b(c.target);
			d.data("checked") ? (d.prop("checked", !1), d.data("checked", !1)) : (d.prop("checked", !0), d.data("checked", !0))
		},
		"dom/action/working/status.change" : function (a, c) {
			var d = this,
			e = b(c.target),
			f = e.val();
			d.$workingStatus.filter('[value="' + f + '"]').prop("checked", !0)
		}
	})
}), define("troopjs-requirejs/template!app/widget/candidate/item/detail.html", [], function () {
	return function (a) {
		var b = "",
		c = a.email || "",
		d = a.email1 || "",
		e = a.email2 || "",
		f = a.mobile || "",
		g = a.mobile1 || "",
		h = a.mobile2 || "",
		i = a.englishName || "",
		j = a.chineseName || "",
		k = (i + " " + j).trim(),
		l = a.dateOfBirth,
		m = a.monthNull,
		n = a.dayNull,
		o = "icon-blue",
		p = this.hideContact,
		q = a.linkedin || "",
		r = a.islimited,
		s = a.status,
		t = a.annualSalary ? a.annualSalary : "",
		u = a.current ? a.current.client : null,
		v = this.actions,
		w = this.isList;
		if (n && l && (l = l.slice(0, -3)), m && l && (l = l.slice(0, -3)), (a.islimited || this._isAdmin) && (o = "icon-transparent"), b += '\r\n<div class="search_content full-width">\r\n    <div class="search_item_tags pull-right clearfix">\r\n        \r\n        ', a.islimited || !a.mobile && !a.email || !a.englishName && !a.chineseName || (b += '\r\n        <a href="#" class="qrcode-action ', v.qrcode || (b += "hide"), b += '">\r\n            <span class="icon-qrcode"></span>\r\n        </a>\r\n        '), b += "\r\n\r\n        ", r || !q.length || this._isAdmin || (b += '\r\n        <a href="' + q + '" target="_blank" class="icon-link">\r\n           <span class="icon-linkedin icon-blue"></span>\r\n        </a>\r\n        '), b += "\r\n\r\n        ", b += s ? '\r\n        <span class="label status" style="background-color: ' + s.color + ';">' + s.value + "</span>\r\n        " : '\r\n        <span class="label status"></span>\r\n        ', b += "\r\n        \r\n        ", u && u.industry && u.industry.id && (b += '\r\n        <span class="label industry" data-toggle="tooltip" title="' + u.industry.name, u.industry1 && (b += ", " + u.industry1.name), u.industry2 && (b += ", " + u.industry2.name), b += '">' + u.industry.name, (u.industry1 || u.industry2) && (b += "..."), b += "</span>\r\n        "), b += "\r\n        ", a.current && (b += "\r\n        ", a.current.function  && a.current.function .id && (b += '\r\n        <span class="label function" data-toggle="tooltip" title="' + a.current.function .name, a.current.function1 && (b += ", " + a.current.function1.name), a.current.function2 && (b += ", " + a.current.function2.name), b += '">' + a.current.function .name, (a.current.function1 || a.current.function2) && (b += "..."), b += "</span>\r\n        "), b += "\r\n        "), b += '\r\n    </div>\r\n\r\n    <div class="pull-left item-title sepH_a">\r\n        ', (!r || this._isAdmin) && (b += '\r\n        <input type="checkbox" data-action="list/check">\r\n        '), b += "\r\n\r\n        ", "contact" === a.type ? b += '\r\n        <b class="label label-red" data-weave="shared/helper/translation" data-i18n="Contact"></b>\r\n        ' : "coldcall" === a.type && (b += '\r\n        <b class="label" data-weave="shared/helper/translation" data-i18n="Cold Call"></b>\r\n        '), b += "\r\n\r\n        ", a.is_mpc && (b += '\r\n        <b class="label label-orange">MPC</b>\r\n        '), b += "\r\n\r\n        ", b += a.islimited ? '\r\n        <span class="title">ID: ' + a.id + "</span>\r\n        " : '\r\n        <a href="/candidate#detail!id=' + a.id + '" class="title">' + (k ? k : "Noname") + '</a>\r\n        <a href="/candidate#detail!id=' + a.id + '" target="_blank" title="Open in new tab"><span class="icon-new-window icon-blue"></span></a>\r\n        ', b += " \r\n        ", l && (b += "\r\n        <span>(" + l + ")</span>\r\n        "), b += "\r\n\r\n        ", a.location && (b += "\r\n        <span>(" + a.location.name + ")</span>\r\n        "), b += '\r\n\r\n        <span>(<span data-weave="shared/helper/translation" data-i18n="Annual Salary"></span>: <a class="salary" data-type="text" data-value="' + t + '"></a>)</span>\r\n\r\n        ', a.current_years && (b += '\r\n        <span>(<span data-weave="shared/helper/translation" data-i18n="On job"></span>: ' + a.current_years + ' <span data-weave="shared/helper/translation" data-i18n="Year(s)"></span>)</span>\r\n        '), b += "\r\n\r\n        ", r || this._isAdmin || (b += '\r\n        <span class="dropdown" data-paste="true" data-weave="app/widget/common/attachment-view/main(' + a.attachment_count + ", 'candidate', " + a.id + ')">\r\n        </span>\r\n        '), b += "\r\n\r\n        ", r || (b += '\r\n        <a href="/candidate#add!id=' + a.id + '" target="_blank" class="content-actions" data-weave="shared/helper/translation(\'title\')" data-i18n="Edit">\r\n            <i class="icon-edit icon-blue"></i>\r\n        </a>\r\n        '), b += '\r\n    </div>\r\n                                    \r\n    <div class="sepH_a item_description clearfix">\r\n        <div class="pull-right">\r\n            ', r ? (b += '\r\n            <span class="contacts">\r\n                <span><span data-weave="shared/helper/translation" data-i18n="Owner"></span>: <a href="/user/preview#' + a.owner.id + '" data-action="profile/open">' + a.owner.englishName + '</a></span>\r\n                <span class="request-share ', a.inrequest && (b += "request-sending"), b += '">\r\n                    <button class="btn" data-action="request/share(' + a.id + ')" data-weave="shared/helper/translation" data-i18n="Request Share"></button>\r\n                    <span>请求已发送</span>\r\n                </span>\r\n            </span>\r\n            ') : (b += '\r\n            <span class="contacts muted">\r\n                ', (f || g || h) && (b += '\r\n\r\n                <span data-weave="shared/helper/translation" data-i18n="Phone"></span>:\r\n\r\n                ', p || (b += '\r\n                <span data-weave="shared/helper/toggle">\r\n                    <a href="#" data-weave="shared/helper/translation" data-i18n="View" data-action="helper/toggle/show" class="helper-toggle-show"></a>\r\n                    <span class="hide" data-toggle="view">\r\n                '), b += "\r\n                        ", f && (b += '\r\n                        <a href="tel:' + f + '">' + f + '</a> (<span data-weave="shared/helper/translation" data-i18n="Mobile"></span>)\r\n                        '), b += "\r\n                        ", g && (b += '\r\n                        , <a href="tel:' + g + '">' + g + '</a> (<span data-weave="shared/helper/translation" data-i18n="Telephone"></span>)\r\n                        '), b += "\r\n                        ", h && (b += '\r\n                        , <a href="tel:' + h + '">' + h + '</a> (<span data-weave="shared/helper/translation" data-i18n="Other"></span>)\r\n                        '), b += "\r\n\r\n                ", p || (b += "        \r\n                    </span>\r\n                </span>\r\n                "), b += "\r\n                "), b += "\r\n\r\n\r\n                ", (c || d || e) && (b += "\r\n                <span>Email</span>:\r\n                \r\n                ", p || (b += '\r\n                <span data-weave="shared/helper/toggle">\r\n                    <a href="#" data-weave="shared/helper/translation" data-i18n="View" data-action="helper/toggle/show" class="helper-toggle-show"></a>\r\n                    <span class="hide" data-toggle="view">\r\n                '), b += "\r\n                        ", c && (b += '\r\n                        <a href="#" data-action="email" data-type="email" data-email="' + c + '">' + c + '</a> (<span data-weave="shared/helper/translation" data-i18n="Private email"></span>)\r\n                        '), b += "\r\n                        ", d && (b += '\r\n                        , <a href="#" data-action="email" data-type="email1" data-email="' + d + '">' + d + '</a> (<span data-weave="shared/helper/translation" data-i18n="Work email"></span>)\r\n                        '), b += "\r\n                        ", e && (b += '\r\n                        , <a href="#" data-action="email" data-type="email2" data-email="' + e + '">' + e + '</a> (<span data-weave="shared/helper/translation" data-i18n="Other"></span>)\r\n                        '), b += "\r\n                ", p || (b += "\r\n                    </span>\r\n                </span>\r\n                "), b += "\r\n                "), b += '\r\n\r\n                <span><span data-weave="shared/helper/translation" data-i18n="Owner"></span>: <a href="/user/preview#' + a.owner.id + '" data-action="profile/open">' + a.owner.englishName + '</a></span>\r\n                <span data-weave="shared/helper/translation" data-i18n="Last Contact"></span>: <span class="update-date" data-toggle="tooltip" title="' + a.lastUpdateDate + '">' + a.lastUpdate + "</span>\r\n            </span>\r\n            "), b += "\r\n        </div>\r\n\r\n        ", a.experiences && a.experiences.length > 0) {
						b += '\r\n        <dl class="dl-horizontal dl-horizontal-small">\r\n            <dt>\r\n                <div class="muted text-left" data-i18n="Current Company - data" data-weave="shared/helper/translation"></div>\r\n            </dt>\r\n            <dd>\r\n                ',
						a.experiences[0] && (b += '\r\n                <a href="/company#detail!id=' + a.experiences[0].client.id + '" target="_blank">' + a.experiences[0].client.name + "</a>\r\n                ", a.experiences[0].client && a.experiences[0].client.type && "normal" !== a.experiences[0].client.type && "generated" !== a.experiences[0].client.type && (b += '\r\n                <span class="red">(<span data-weave="shared/helper/translation" data-i18n="' + a.experiences[0].client.type + " company" + '"></span>)</span>\r\n                '), b += "\r\n                "),
						b += "\r\n                 - " + (a.experiences[0].title || "") + "\r\n             </dd>\r\n\r\n            ";
						var x = !1;
						b += "\r\n            ";
						for (var y = 1, z = a.experiences.length; z > y; y++) {
							b += "\r\n            ";
							var A = a.experiences[y];
							b += "\r\n            <dt>\r\n                ",
							x || (b += '\r\n                <div class="muted text-left" data-i18n="Past Company - data" data-weave="shared/helper/translation"></div>\r\n                ', x = !0, b += "\r\n                "),
							b += '\r\n            </dt>\r\n            <dd>\r\n                <a href="/company#detail!id=' + A.client.id + '" target="_blank">' + A.client.name + "</a>\r\n                ",
							A.client.type && "normal" !== A.client.type && "generated" !== A.client.type && (b += '\r\n                <span class="red">(<span data-weave="shared/helper/translation" data-i18n="' + A.client.type + " company" + '"></span>)</span>\r\n                '),
							b += "\r\n                 - " + A.title + "\r\n            </dd>\r\n            "
						}
						b += "\r\n            \r\n        </dl>\r\n        "
					}
					return b += '\r\n    </div>\r\n\r\n    <div class="sepH_a tags-area hide">\r\n        <input type="text" class="tags" data-type="tag" value="' + a.tags + '">\r\n    </div>\r\n\r\n    <p class="pull-right last-update">\r\n        \r\n    </p>\r\n    \r\n    <ul class="nav nav-pills line_sep actions ', (r || this._isAdmin) && (b += "disabled"), b += '">\r\n        <li class="note-action ', v.note || (b += "hide"), b += '">\r\n            <a href="#" data-action="note" data-preview="' + w + '">\r\n                <i class="icon-comment ' + o + '"></i>\r\n                <b class="note-count">' + a.note_count + '</b> \r\n                <span data-weave="shared/helper/translation" data-i18n="Note"></span>\r\n            </a>\r\n        </li>\r\n        <li class="email-action ', v.email || (b += "hide"), b += '">\r\n            <a href="#" data-action="email" data-preview="' + w + '">\r\n                <i class="icon-envelope ' + o + '"></i>\r\n                <b class="email-count">' + a.email_count + '</b>\r\n                <span data-weave="shared/helper/translation" data-i18n="Email"></span>\r\n            </a>\r\n        </li>\r\n        <li class="task-action ', v.task || (b += "hide"), b += '">\r\n            <a class="todoCount" href="#" data-action="task" data-preview="' + w + '">\r\n                <i class="icon-time ' + o + '"></i>\r\n                <b>' + a.todo_count + '</b> \r\n                <span data-weave="shared/helper/translation" data-i18n="Task"></span>\r\n            </a>\r\n        </li>\r\n        <li class="intention-action ', v.intention || (b += "hide"), b += '">\r\n            <a href="#" data-action="target" data-preview="' + w + '">\r\n                <i class="icon-target ' + o + '"></i>\r\n                <b class="target-count">' + a.targetcompany_count + '</b> \r\n                <span data-weave="shared/helper/translation" data-i18n="Intention"></span>\r\n            </a>\r\n        </li>\r\n        <li class="floating-action ', v.floating || (b += "hide"), b += '">\r\n            <a href="#" data-action="floating" data-preview="' + w + '">\r\n                <i class="icon-floating ' + o + '"></i>\r\n                <b class="floating-count">' + a.floating_out_count + '</b> \r\n                <span>Floating</span>\r\n            </a>\r\n        </li>\r\n        <li class="job-action ', v.job || (b += "hide"), b += '">\r\n            <a class="shortlistCount" href="#" data-action="shortlist" data-preview="' + w + '">\r\n                <i class="icon-share ' + o + '"></i>\r\n                <b class="shortlist-count">' + a.shortlist_count + '</b>\r\n                <span data-weave="shared/helper/translation" data-i18n="Job"></span>\r\n            </a>\r\n        </li>\r\n        <li class="tag-action ', v.tag || (b += "hide"), b += '">\r\n            <a href="#" data-action="toggle/tags">\r\n                <i class="icon-tag ' + o + '"></i>\r\n                <b class="tags-count">' + a.tags.length + '</b>\r\n                <span data-weave="shared/helper/translation" data-i18n="Tags"></span>\r\n            </a>\r\n        </li>\r\n        <li class="folder-action ', v.folder || (b += "hide"), b += '">\r\n            <a href="#" data-action="add/to/folder">\r\n                <i class="icon-folder-open ' + o + '"></i>\r\n                <b class="folder-count">' + a.folders.length + '</b>\r\n                <span data-weave="shared/helper/translation" data-i18n="Folder"></span>\r\n                <span class="muted">' + this.getFolderName(a.folders) + "</span>\r\n            </a>\r\n        </li>\r\n    </ul>\r\n</div>"
}
}), define("troopjs-requirejs/template!app/widget/candidate/item/list.html", [], function () {
	return function (a) {
		var b = "",
		c = a.englishName || "",
		d = a.chineseName || "",
		e = [c, d].join(" ").trim(),
		f = this.hideContact;
		a.linkedin || "";
		var g = a.islimited,
		h = a.status,
		i = a.mobile || "",
		j = a.mobile1 || "",
		k = a.mobile2 || "",
		l = "icon-blue",
		m = this.actions;
		(a.islimited || this._isAdmin) && (l = "icon-transparent"),
		b += "\n\n<td>\n    ",
		(!g || this._isAdmin) && (b += '\n    <input type="checkbox" data-action="list/check">\n    '),
		b += "\n</td>\n<td>\n    ",
		g || this._isAdmin || (b += '\n    <span class="dropdown" data-paste="true" data-weave="app/widget/common/attachment-view/main(' + a.attachment_count + ", 'candidate', " + a.id + ')">\n    </span>\n    '),
		b += '\n</td>\n<td>\n    <a href="#" data-action="note" ',
		(a.islimited || this._isAdmin) && (b += 'class="disabled"'),
		b += '>\n        <i class="icon-comment ' + l + '"></i>\n        <b class="note-count">' + a.note_count + "</b> \n    </a>\n</td>\n<td>\n    ",
		a.islimited || !a.mobile && !a.email || !a.englishName && !a.chineseName || (b += '\n        <a href="#" class="qrcode-action ', m.qrcode || (b += "hide"), b += '">\n            <span class="icon-qrcode"></span>\n        </a>\n        '),
		b += "\n    ",
		a.islimited ? b += '\n    <span class="title">ID: ' + a.id + "</span>\n    " : (b += '\n    <a href="/candidate#detail!id=' + a.id + '" class="title ', "contact" === a.type && (b += "red"), b += '">\n        ' + e + '\n    </a>\n    <a href="/candidate#detail!id=' + a.id + '" target="_blank" title="Open in new tab"><span class="icon-new-window icon-blue"></span></a>\n    '),
		b += "\n</td>\n<td>\n    ",
		f ? (b += "\n    ", i && (b += '\n    <a href="tel:' + i + '">' + i + "</a>\n    "), b += "\n    ", j && (b += '\n    , <a href="tel:' + j + '">' + j + "</a>\n    "), b += "\n    ", k && (b += '\n    , <a href="tel:' + k + '">' + k + "</a>\n    "), b += "\n    ") : (b += "\n    ", (i || j || k) && (b += '\n    <span data-weave="shared/helper/toggle">\n        <a href="#" data-weave="shared/helper/translation" data-i18n="View" data-action="helper/toggle/show" class="helper-toggle-show"></a>\n        <span class="hide" data-toggle="view">\n            ', i && (b += '\n            <a href="tel:' + i + '">' + i + "</a>\n            "), b += "\n            ", j && (b += '\n            , <a href="tel:' + j + '">' + j + "</a>\n            "), b += "\n            ", k && (b += '\n            , <a href="tel:' + k + '">' + k + "</a>\n            "), b += "\n        </span>\n    </span>\n    "), b += "\n    "),
		b += "\n</td>\n<td>\n    ",
		a.location && (b += "\n    " + a.location.name + "\n    "),
		b += "\n</td>\n<td>\n    ",
		a.company && (b += '\n    <a href="/company#detail!id=' + a.company.id + '" class="', a.company && a.company.type && "normal" !== a.company.type && "generated" !== a.company.type && (b += "red"), b += '" target="_blank" title="' + a.company.name + '">' + a.company.name + "</a>\n    "),
		b += "\n</td>\n<td>\n    " + (a.work_years || 0) + ' <span data-weave="shared/helper/translation" data-i18n="Year(s)"></span>\n</td>\n<td>\n    ' + (a.current_years || 0) + ' <span data-weave="shared/helper/translation" data-i18n="Year(s)"></span>\n</td>\n<td>\n    ',
		a.current && a.current.title && (b += "\n    " + a.current.title + "\n    "),
		b += "\n</td>\n<td>\n    ",
		b += h ? '\n    <span class="label status" style="background-color: ' + h.color + ';">' + h.value + "</span>\n    " : '\n    <span class="label status"></span>\n    ',
		b += '\n</td>\n<td class="update-date">\n    <span data-toggle="tooltip" title="' + a.lastUpdateDate + '">' + a.lastUpdate + '</span>\n</td>\n<td>\n    <div class="dropdown">\n        <a href="javascript: void(0);" class="',
		b += this.islimited || this._isAdmin ? "disabled" : "dropdown-toggle",
		b += '" data-toggle="dropdown"><i class="icon-list-alt"></i> <i class="caret"></i></a>\n        <ul class="dropdown-menu">\n            ',
		g || (b += '\n            <li>\n                <a href="/candidate#add!id=' + a.id + '" target="_blank" data-weave="shared/helper/translation" data-i18n="Edit People"></a>\n            </li>\n            '),
		b += '\n            <li class="',
		m.email || (b += "hide"),
		b += '">\n                <a href="#" data-action="email">\n                    <b class="email-count">' + a.email_count + '</b>\n                    <span data-weave="shared/helper/translation" data-i18n="Email"></span>\n                </a>\n            </li>\n            <li class="',
		m.task || (b += "hide"),
		b += '">\n                <a href="#" data-action="task">\n                    <b>' + a.todo_count + '</b> \n                    <span data-weave="shared/helper/translation" data-i18n="Task"></span>\n                </a>\n            </li>\n            <li class="',
		m.intention || (b += "hide"),
		b += '">\n                <a href="#" data-action="target">\n                    <b class="target-count">' + a.targetcompany_count + '</b> \n                    <span data-weave="shared/helper/translation" data-i18n="Intention"></span>\n                </a>\n            </li>\n            <li class="',
		m.floating || (b += "hide"),
		b += '">\n                <a href="#" data-action="floating">\n                    <b class="floating-count">' + a.floating_out_count + '</b> \n                    <span>Floating</span>\n                </a>\n            </li>\n            <li class="',
		m.shortlist || (b += "hide"),
		b += '">\n                <a href="#" data-action="shortlist">\n                    <b class="shortlist-count">' + a.shortlist_count + '</b>\n                    <span data-weave="shared/helper/translation" data-i18n="Job"></span>\n                </a>\n            </li>\n            <li class="',
		m.folder || (b += "hide"),
		b += '">\n                <a href="#" data-action="add/to/folder">\n                    <b class="folder-count">' + a.folders.length + '</b>\n                    <span data-weave="shared/helper/translation" data-i18n="Folder"></span>\n                </a>\n            </li>\n        </ul>\n    </div>\n</td>\n\n';
		for (var n = 0, o = this.table.length; o > n; n++)
			b += "\n<td>" + (a[this.table[n].mapping].value || "")
				 + "</td>\n";
			return b
		}
	}), define("app/widget/candidate/item/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "shared/widget/filter/query", "template!./detail.html", "template!./list.html", "shared/helper/utils", "shared/helper/blurb", "shared/helper/validate", "bootstrap.editable"], function (a, b, c, d, e, f, g, h) {
		function i() {
			var a = this,
			b = a._json,
			c = ["BEGIN:VCARD", "VERSION:2.1"];
			return c.push("FN:" + (b.englishName || b.chineseName)),
			c.push("ORG:" + b.current.client.name),
			c.push("TITLE:" + b.current.title),
			c.push("TEL;WORK;VOICE;PREF:" + b.mobile),
			c.push("EMAIL;INTERNET;PREF:" + b.email),
			c.push("NOTE", "END:VCARD"),
			q.QRCODE + c.join("%0A")
		}
		function j(a) {
			var b = this;
			c(function (a) {
				b.viewType ? b.html(f, b._json, a) : c(function (a) {
					b._json.experience_count > 1 ? b.publish("ajax", {
						url : q.EXPERIENCE.replace("<id>", b._json.id)
					}, c().done(function (c) {
							b._json.working_experience = c,
							a.resolve()
						})) : a.resolve()
				}).done(function () {
					b.html(e, b._json, a)
				})
			}).then(function () {
				k.call(b, a)
			})
		}
		function k(b) {
			var e = this,
			f = e.$element;
			e._json.id;
			var h = e._json;
			e.$listCheck = f.find('[data-action="list/check"]').data("json", h),
			e.$noteCount = f.find(".note-count"),
			e.$floatCount = f.find(".floating-count"),
			e.$targetCount = f.find(".target-count"),
			e.$folderCount = f.find(".folder-count"),
			e.$lastUpdate = f.find(".update-date"),
			e.$interviewForm = f.find(".interview-form"),
			e.$tagsArea = f.find(".tags-area"),
			e.$tagCount = f.find(".tags-count"),
			e.$tag = f.find(".tags").data("onSaveTags", function (a, b) {
					a.preventDefault(),
					e.publish("ajax", {
						url : q.ADD_TAG.replace("<id>", e._json.id),
						data : {
							data : b.join(",")
						},
						type : "post",
						dataType : "json"
					}, c().done(function (a) {
							a.status ? (e.$tagCount.text(b.length), g.alert("success", r.SUCCESSFULLY)) : g.alert("error", a.message)
						}))
				}).attr("data-weave", s + "(true, " + !e._json.islimited + ", onSaveTags)").weave(),
			e.$element.on("click", ".tagit-choice-read-only", function (b) {
				var c,
				f,
				g = a(b.target);
				c = "LI" === g[0].tagName ? g.find(".tagit-label").text() : g.text(),
				d.items.tags = "tags=" + window.encodeURIComponent(c),
				f = d.toString(),
				e.publish(t, {
					filter : f,
					page : 1
				})
			}),
			e.$element.find(".qrcode-action").popover({
				html : !0,
				placement : "bottom",
				content : function () {
					var a = (new Date).getTime(),
					b = new Image;
					return b.onload = function () {
						e.$element.find(".qrcode-image-" + a).html(b).removeClass("widget-spin"),
						b.onload = null
					},
					b.onerror = function () {
						e.publish("error/log", "QR Code load error", {
							url : i.call(e)
						})
					},
					b.src = i.call(e),
					b.width = 200,
					b.height = 200,
					'<div class="widget-spin qrcode-image-' + a + '" style="width: 200px;"></div>'
				},
				trigger : "click"
			}).click(function (a) {
				a.preventDefault()
			}),
			e.$element.find("a.salary").editable({
				emptytext : "未知",
				validate : function (a) {
					return isNaN(a) ? r.ANNUAL_NUMBER : 0 > a ? r.NUMBER_SMALL : a > 1e4 ? r.NUMBER_LARGE : void 0
				},
				display : function (b) {
					b && (arguments[1] ? a(this).html(r.CURRENCY_SYM + " " + b + " " + r.CURRENCY_UNIT) : a(this).html(r.CURRENCY_SYM + " " + b / m + " " + r.CURRENCY_UNIT))
				},
				pk : e._json.id,
				url : q.ADD,
				params : function (a) {
					return a.annualSalary = a.value * m,
					a.id = a.pk,
					a.simple = 1,
					delete a.value,
					delete a.pk,
					delete a.name, {
						data : JSON.stringify(a)
					}
				},
				success : function (a) {
					a.status ? g.alert("success", r.SUCCESSFULLY) : g.alert("error", a.message)
				},
				error : function (a) {
					var b = JSON.parse(a.responseText);
					g.alert("error", b.message)
				},
				inputclass : "input-mini",
				disabled : e._json.islimited || e._isAdmin
			}).on("shown", function (b, c) {
				if (c && a(this).data("value")) {
					var d = a(this).text().match(/((\d+)(\.(\d+))?)/);
					d && c.$form.find("input").val(d[1])
				}
				c && c.$form.find("input").closest("div").after('<span style="display: inline-block; margin: 6px 0 0 5px;">' + r.CURRENCY_UNIT + "</span>")
			});
			var j,
			k;
			e.$element.on("mouseenter", 'a.title, a[data-action="note"]', function (b) {
				var c = a(b.target);
				"A" !== c.prop("tagName") && (c = c.closest("a")),
				e._json.islimited || "0" === c.find('[class*="count"]').text() || (j = function (b) {
					clearTimeout(o),
					a(this).off(b)
				}, k = function (b) {
					p = setTimeout(function () {
							e.publish("slide-helper/detail/close"),
							a(this).off(b)
						}, 600)
				}, a(".slide-helper").off("mouseenter.helper", j).off("mouseleave.helper", k), clearTimeout(n), clearTimeout(o), clearTimeout(p), n = setTimeout(function () {
							var a = "note" === c.attr("data-action");
							e.publish("slide-helper/detail/reload", e._json.id, "candidate", a)
						}, 500), c.on("mouseleave", function (b) {
						clearTimeout(n),
						o = setTimeout(function () {
								e.publish("slide-helper/detail/close"),
								a(".slide-helper").off("mouseenter.helper", j).off("mouseleave.helper", k)
							}, 600),
						a(".slide-helper").on("mouseenter.helper", j).on("mouseleave.helper", k),
						c.off(b)
					}))
			}),
			e.$element.find('[data-toggle="tooltip"]').tooltip(),
			b && b.resolve()
		}
		var l,
		m,
		n,
		o,
		p,
		q = {
			ADD : "/rest/candidate/add",
			REQUEST_SHARE : "/rest/candidate/<id>/requestshare",
			ADD_INTERVIEW : "/rest/candidate/<id>/addinterview",
			ADD_FOLLOWUP : "/rest/candidate/<id>/addfollowup",
			ADD_TAG : "/rest/candidate/<id>/addtag",
			QRCODE : "http://www.gllue.com/qrcode?text=",
			TABLE : "/rest/data/fields?table=candidate",
			EXPERIENCE : "/rest/candidate/experience/<id>"
		},
		r = {
			SUCCESSFULLY : h.t("Operate successfully"),
			CURRENCY_SYM : h.t("Currency symbol"),
			CURRENCY_UNIT : h.t("Currency unit"),
			ANNUAL_NUMBER : h.t("Annual salary must be a number"),
			NUMBER_SMALL : h.t("The number is too small"),
			NUMBER_LARGE : h.t("The number is too large"),
			email : h.t("Private email"),
			email1 : h.t("Work email"),
			email2 : h.t("Other")
		},
		s = "shared/widget/common/tagit/main",
		t = "make/route";
		return b.extend(function (b, c, d, e, f) {
			var g = this;
			g._json = d,
			g._moreInfo = function () {
				var a = {};
				d.city && (a.city = d.city),
				d.city1 && (a.city1 = d.city1),
				d.city2 && (a.city2 = d.city2),
				null !== d.gender && (a.gender = d.gender),
				d.address && (a.address = d.address),
				d.work_years && (a.work_years = d.work_years);
				for (var b = 1; 20 >= b; b++)
					d["ext" + b] && d["ext" + b].value && (a["ext" + b] = d["ext" + b]);
				return a
			}
			(),
			g.showMoreInfo = !a.isEmptyObject(g._moreInfo),
			g.viewType = e,
			g.hideContact = f !== l ? f : !0,
			g.isList = !(arguments[3] == l && arguments[4] === l)
		}, {
			"sig/initialize" : function (a, b) {
				var d = this;
				d.publish("ajax", {
					url : q.TABLE
				}, c().done(function (a) {
						d.table = a,
						b.resolve()
					}))
			},
			"sig/stop" : function (a, b) {
				var c = this;
				clearTimeout(n),
				clearTimeout(o),
				clearTimeout(p),
				c.publish("slide/helper/close"),
				b.resolve()
			},
			"hub:memory/context" : function (a, b) {
				var c = this;
				switch (c._context = b, c._isAdmin = "Admin" === b.user.role, c.actions = b.user.listview.candidate.action_display, b.user.lang) {
				case "cn":
					m = 1e4;
					break;
				case "en":
					m = 1e3;
					break;
				default:
					m = 1e4
				}
				j.call(c)
			},
			"hub/list/check/all" : function () {
				var a = this;
				a.$listCheck.length && a.$listCheck.filter(":not(:disabled)").prop("checked", !0)
			},
			"hub/list/uncheck/all" : function () {
				var a = this;
				a.$listCheck.length && a.$listCheck.filter(":not(:disabled)").prop("checked", !1)
			},
			"hub/candidate/action/toggle" : function (a, b) {
				var c = this;
				c.$element.find("." + b + "-action").toggleClass("hide")
			},
			"dom/action.click.change" : a.noop,
			"dom/action/note.click" : function (b, c) {
				c.preventDefault();
				var d = this;
				a(c.target),
				d._json.islimited || d._isAdmin || d.publish("modal/add-note/show", {
					externalType : "candidate",
					optionType : "candidate_note_category",
					id : d._json.id,
					onSuccess : function (a) {
						if ("started" === d.phase) {
							var b = a.data.status;
							d.publish("add/note/count"),
							d.$noteCount.text(parseInt(d.$noteCount.text(), 10) + 1),
							d.$lastUpdate.text(a.data.lastUpdate);
							var c = d.$element.find(".search_item_tags .status").eq(0);
							b && c.css("background-color", b.color).text(b.value)
						}
					}
				})
			},
			"dom/action/email.click" : function (b, c) {
				c.preventDefault();
				var d = this,
				e = a(c.target),
				f = e.attr("data-email");
				if (!d._json.islimited && !d._isAdmin) {
					var g = e.find("b"),
					h = d._json,
					i = [h.englishName, h.chineseName].join(" ").trim(),
					j = e.attr("data-type");
					j || (h.email ? (j = "email", f = h.email) : h.email1 ? (j = "email1", f = h.email1) : h.email2 && (j = "email2", f = h.email2)),
					d.publish("modal/sendemail/show", {
						names : ['"' + i + '" [' + r[j] + "]"],
						emails : [f],
						emailTemplate : "candidate_email",
						onSuccess : function () {
							"started" === d.phase && (g.text(parseInt(g.text(), 10) + 1), d.publish("candidate/email/tab/reload"))
						},
						attachment : {
							joborder : 0,
							clientcompany : 0
						},
						templateVariable : {
							candidate_id : d._json.id
						}
					})
				}
			},
			"dom/action/task.click" : function (b, c, d) {
				c.preventDefault();
				var e = this;
				if (!e._json.islimited && !e._isAdmin) {
					var f = a(c.target),
					g = f.find("b");
					e.publish("modal/add/task/show", {
						name : d,
						id : e._json.id,
						onSuccess : function () {
							"started" === e.phase && (e.publish("candidate/task/tab/reload"), g.text(parseInt(g.text(), 10) + 1))
						},
						type : "candidate"
					})
				}
			},
			"dom/action/shortlist.click" : function (b, c) {
				c.preventDefault();
				var d = this;
				if (!d._json.islimited && !d._isAdmin) {
					var e = a(c.target),
					f = e.find("b"),
					g = d._json,
					h = g.id,
					i = [g.englishName, g.chineseName].join(" ").trim();
					d.publish("modal/addshortlist/show", {
						ids : [h],
						names : [i],
						onSuccess : function () {
							"started" === d.phase && (d.publish("candidate/shortlist/tab/reload"), f.text(parseInt(f.text(), 10) + 1))
						},
						type : "people"
					})
				}
			},
			"dom/action/request/share.click" : function (b, d, e) {
				d.preventDefault();
				var f = this,
				h = a(d.target),
				i = window.confirm("确认要请求共享此候选人?");
				i && f.publish("ajax", {
					url : q.REQUEST_SHARE.replace("<id>", e)
				}, c().done(function (a) {
						"started" === f.phase && (a.status ? (g.alert("success", r.SUCCESSFULLY), h.closest(".request-share").addClass("request-sending")) : g.alert("error", "Request share error: " + a.message))
					}))
			},
			"dom/action/open/linkedin.click" : function (a, b) {
				b.preventDefault();
				var c = this;
				c.publish("modal/linkedin-preview/show")
			},
			"dom/action/add/to/folder.click" : function (b, c) {
				c.preventDefault();
				var d = this,
				e = a(c.target),
				f = [];
				d._json.islimited || d._isAdmin || (function () {
					d._json.folders.forEach(function (a) {
						f.push(a.id)
					})
				}
					(), d.publish("modal/add-to-folder/show", {
						ids : [d._json.id],
						type : "candidate",
						folders : f,
						multiSelect : !0,
						onSuccess : function (a) {
							"started" === d.phase && (d._json.folders = a, d.$folderCount.text(a.length), e.find(".muted").text(d.getFolderName(a)))
						}
					}))
			},
			"dom/action/floating.click" : function (a, b) {
				b.preventDefault();
				var c = this;
				if (!c._json.islimited && !c._isAdmin) {
					var d = c._json,
					e = [d.englishName, d.chineseName].join(" ").trim();
					c.publish("modal/add-floating/show", {
						names : [e],
						onSuccess : function () {
							"started" === c.phase && (c.publish("candidate/floating/tab/reload"), c.$floatCount.text(parseInt(c.$floatCount.text(), 10) + 1))
						},
						attachment : [{
								name : e,
								id : c._json.id
							}
						],
						checkAttachment : !0
					})
				}
			},
			"dom/action/target.click" : function (a, b) {
				b.preventDefault();
				var c = this;
				c._json.islimited || c._isAdmin || c.publish("modal/target-company/show", {
					id : c._json.id,
					onSuccess : function () {
						"started" === c.phase && (c.publish("candidate/intention/tab/reload"), c.$targetCount.text(parseInt(c.$targetCount.text(), 10) + 1))
					}
				})
			},
			"dom/action/toggle/tags.click" : function (a, b) {
				b.preventDefault();
				var c = this;
				c.$tagsArea.toggleClass("hide")
			},
			"dom/action/profile/open.click" : function (b, c) {
				c.preventDefault();
				var d = a(c.target),
				e = d.attr("href");
				g.window({
					url : e,
					name : "User Profile",
					width : "1024"
				})
			},
			"dom/action/list/check.click" : function () {
				var a = this;
				a.publish("toggle/mass/action")
			},
			getFolderName : function (a) {
				var b = "",
				c = [];
				return a.length && (a.forEach(function (a) {
						c.push(a.name)
					}), b = c.join(", ")),
				b
			}
		})
	}), define("troopjs-requirejs/template!app/widget/candidate/list/main.html", [], function () {
		return function () {
			var a = "",
			b = "Admin" === this.context.user.role,
			c = this.context.user.listview.candidate.action_display;
			if (a += '\n<div class="well well-small action-bar clearfix">\n    \n    <div class="pull-left mass-action">\n        <label class="checkbox inline">\n            <input type="checkbox" data-action="list/toggle/all"> <span data-weave="shared/helper/translation" data-i18n="Select All"></span>\n        </label>\n        ', a += b ? '\n        <button class="btn btn-small btn-danger disabled" data-weave="shared/helper/translation" data-i18n="Delete" data-action="mass/delete"></button>\n        <button class="btn btn-small disabled" data-weave="shared/helper/translation" data-i18n="Mass Edit" data-action="mass/edit"></button>\n        ' : '\n        <div class="btn-group">\n            <button class="btn btn-small disabled" data-weave="shared/helper/translation" data-i18n="Email" data-action="mass/send/mail"></button>\n            <button class="btn btn-small dropdown-toggle disabled" data-toggle="dropdown">\n                <span class="caret"></span>\n            </button>\n            <ul class="dropdown-menu">\n                <li>\n                    <a href="#" data-action="mass/send/mail">发任意邮箱</a>\n                    <a href="#" data-action="mass/send/mail(\'email\')">发私人邮箱</a>\n                    <a href="#" data-action="mass/send/mail(\'email1\')">发工作邮箱</a>\n                    <a href="#" data-action="mass/send/mail(\'email2\')">发其他邮箱</a>\n                </li>\n            </ul>\n        </div>\n        <button class="btn btn-small disabled" data-weave="shared/helper/translation" data-i18n="Shortlist" data-action="mass/add/shortlist"></button>\n        <button class="btn btn-small disabled" data-action="mass/floating">Floating</button>\n        <button class="btn btn-small disabled" data-weave="shared/helper/translation" data-i18n="Add to Folder" data-action="mass/to/folder"></button>\n        <button class="btn btn-small disabled" data-weave="shared/helper/translation" data-i18n="Mass Edit" data-action="mass/edit"></button>\n        ', a += '\n    </div>\n\n    <div class="pull-right">\n        <span data-weave="shared/helper/translation" data-i18n="Display rows">显示</span>:\n        <select class="sort input-small" data-weave="shared/widget/list-paginate/main(' + this._listType + ')" data-action="paginate">\n            <option value="10">10</option>\n            <option value="25">25</option>\n            <option value="50">50</option>\n        </select>\n        <select class="sort input-medium" data-weave="shared/widget/list-ordering/main(' + this._listType + ')" data-action="ordering">\n            <option value="-lastUpdateDate" data-weave="shared/helper/translation" data-i18n="Sort by last contact (Descend)"></option>\n            <option value="lastUpdateDate" data-weave="shared/helper/translation" data-i18n="Sort by last contact (Ascend)"></option>\n            <option value="-dateAdded" data-weave="shared/helper/translation" data-i18n="Sort by Keyin Date (Descend)"></option>\n            <option value="dateAdded" data-weave="shared/helper/translation" data-i18n="Sort by Keyin Date (Ascend)"></option>\n            <option value="-annualSalary" data-weave="shared/helper/translation" data-i18n="Sort by Annual Salary (Descend)"></option>\n            <option value="annualSalary" data-weave="shared/helper/translation" data-i18n="Sort by Annual Salary (Ascend)"></option>\n            <option value="company_id" data-weave="shared/helper/translation" data-i18n="Sort by Company"></option>\n            <option value="status" data-weave="shared/helper/translation" data-i18n="Sort by Status"></option>\n            <option value="industry_id" data-weave="shared/helper/translation" data-i18n="Sort by Industry"></option>\n            <option value="function_id" data-weave="shared/helper/translation" data-i18n="Sort by Function"></option>\n            <option value="englishName" data-weave="shared/helper/translation" data-i18n="Sort by English Name"></option>\n            <option value="chineseName" data-weave="shared/helper/translation" data-i18n="Sort by Chinese Name"></option>\n        </select>\n\n        <button class="btn btn-small" data-action="listview" data-toggle="tooltip" data-weave="shared/helper/translation(\'title\')" data-i18n="Switch View"><span></span></button>\n\n        <span class="dropdown actions-toggle-button">\n            <button class="btn btn-small" data-action="dropdown"><span data-weave="shared/helper/translation" data-i18n="Actions"></span> <b class="caret"></b></button>\n            <div class="dropdown-menu">\n                <form action="#">\n                    <label class="checkbox">\n                        <input type="checkbox" name="note" data-action="act/toggle" ', c.note && (a += 'checked="checked"'), a += '> <span data-weave="shared/helper/translation" data-i18n="Note"></span>\n                    </label>\n                    <label class="checkbox">\n                        <input type="checkbox" name="email" data-action="act/toggle" ', c.email && (a += 'checked="checked"'), a += '> <span data-weave="shared/helper/translation" data-i18n="Email"></span>\n                    </label>\n                    <label class="checkbox">\n                        <input type="checkbox" name="task" data-action="act/toggle" ', c.task && (a += 'checked="checked"'), a += '> <span data-weave="shared/helper/translation" data-i18n="Task"></span>\n                    </label>\n                    <label class="checkbox">\n                        <input type="checkbox" name="intention" data-action="act/toggle" ', c.intention && (a += 'checked="checked"'), a += '> <span data-weave="shared/helper/translation" data-i18n="Intention"></span>\n                    </label>\n                    <label class="checkbox">\n                        <input type="checkbox" name="floating" data-action="act/toggle" ', c.floating && (a += 'checked="checked"'), a += '> <span data-weave="shared/helper/translation" data-i18n="Floating"></span>\n                    </label>\n                    <label class="checkbox">\n                        <input type="checkbox" name="job" data-action="act/toggle" ', c.job && (a += 'checked="checked"'), a += '> <span data-weave="shared/helper/translation" data-i18n="Job"></span>\n                    </label>\n                    <label class="checkbox">\n                        <input type="checkbox" name="tag" data-action="act/toggle" ', c.tag && (a += 'checked="checked"'), a += '> <span data-weave="shared/helper/translation" data-i18n="Tags"></span>\n                    </label>\n                    <label class="checkbox">\n                        <input type="checkbox" name="folder" data-action="act/toggle" ', c.folder && (a += 'checked="checked"'), a += '> <span data-weave="shared/helper/translation" data-i18n="Folder"></span>\n                    </label>\n                    <label class="checkbox">\n                        <input type="checkbox" name="qrcode" data-action="act/toggle" ', c.qrcode && (a += 'checked="checked"'), a += '> <span data-weave="shared/helper/translation" data-i18n="QR Code"></span>\n                    </label>\n                    <div>\n                        <button class="btn btn-small btn-primary" data-weave="shared/helper/translation" data-i18n="Save" data-action="save/acts"></button>\n                    </div>\n                </form>\n            </div>\n        </span>\n\n    </div>\n</div>\n\n<!-- pagination -->\n<div class="pagination clearfix hide" data-weave="shared/widget/pagination/main(\'' + this._listType + '\')"></div>\n\n<div class="loading-area widget-spin">\n    ', this.viewType) {
				a += '\n    <table class="table table-striped table-nowrap">\n        <thead>\n            <tr>\n                <th></th>\n                <th class="reorderable">\n                    <span class="invisible" data-weave="shared/helper/translation" data-i18n="Attachment"></span>\n                </th>\n                <th class="reorderable">\n                    <span class="invisible" data-weave="shared/helper/translation" data-i18n="Note"></span>\n                </th>\n                <th class="reorderable" data-weave="shared/helper/translation" data-i18n="Name"></th>\n                <th class="reorderable" data-weave="shared/helper/translation" data-i18n="Mobile"></th>\n                <th class="reorderable" data-weave="shared/helper/translation" data-i18n="City"></th>\n                <th class="reorderable" data-weave="shared/helper/translation" data-i18n="Company"></th>\n                <th class="reorderable" data-weave="shared/helper/translation" data-i18n="On job"></th>\n                <th class="reorderable" data-weave="shared/helper/translation" data-i18n="Years of experience"></th>\n                <th class="reorderable" data-weave="shared/helper/translation" data-i18n="Title"></th>\n                <th class="reorderable" data-weave="shared/helper/translation" data-i18n="Status"></th>\n                <th class="reorderable" data-weave="shared/helper/translation" data-i18n="Last Contact"></th>\n                <th class="reorderable" data-weave="shared/helper/translation" data-i18n="Operation"></th>\n                ';
				for (var d = 0, e = this.table.length; e > d; d++)
					a += '\n                <th class="reorderable">' + this.table[d].label + "</th>\n                ";
				a += '\n            </tr>\n        </thead>\n        <tbody class="list-container">\n        </tbody>\n    </table>\n    '
			} else
				a += '\n    <div class="search_panel list-container clearfix"></div>\n    ';
			return a += '\n</div>\n\n<!-- pagination -->\n<div class="pagination clearfix hide" data-weave="shared/widget/pagination/main(\'' + this._listType + "')\"></div>"
		}
	}), define("app/widget/candidate/list/main", ["jquery", "shared/widget/list/base", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "shared/helper/utils", "shared/helper/blurb", "jquery.datatables.ColVis", "jquery.datatables.ColReorder"], function (a, b, c, d, e, f, g) {
		function h(b) {
			var f = this,
			g = [],
			h = c(),
			j = c();
			g.push(h.promise(), j.promise()),
			f.publish("ajax", {
				url : i.CONFIG
			}, h.done(function (a) {
					f._hideContact = "1" === a[0].value
				})),
			f.publish("ajax", {
				url : i.TABLE
			}, j.done(function (a) {
					f.table = a
				})),
			d.apply(a, g).done(function () {
				c(function (a) {
					f.html(e, a)
				}).done(function () {
					f.$container = f.$element.find(".list-container"),
					f.$massActions = f.$element.find(".mass-action .btn"),
					f.$toggleAll = f.$element.find('[data-action="list/toggle/all"]'),
					f.$listview = f.$element.find('[data-action="listview"]'),
					f.$toggleAction = f.$element.find(".actions-toggle-button"),
					f.$table = f.$element.find("table"),
					f.viewType ? (f.$listview.addClass("table-view").find("span").attr("class", "icon-sqaures"), f.$toggleAction.addClass("hide")) : (f.$listview.addClass("detail-view").find("span").attr("class", "icon-list"), f.$toggleAction.removeClass("hide")),
					f.$element.tooltip({
						selector : '[data-toggle="tooltip"]',
						trigger : "hover"
					}),
					b.resolve()
				})
			})
		}
		var i = {
			LIST : "/rest/candidate/list?",
			DETELE : "/rest/candidate/delete",
			CONFIG : "/rest/data/configvalue?keys=hide_contactinfo",
			TABLE : "/rest/data/fields?table=candidate",
			LISTVIEW : "/rest/user/listview"
		},
		j = {
			SUCCESSFUL : g.t("Operate successfully"),
			Columns : g.t("Columns"),
			email : g.t("Private email"),
			email1 : g.t("Work email"),
			email2 : g.t("Other")
		},
		k = ["email", "email1", "email2"],
		l = "app/widget/candidate/item/main";
		return b.extend(function () {
			this._url = i.LIST,
			this._listType = "candidate"
		}, {
			render : function (a) {
				h.call(this, a || c())
			},
			appendItems : function (b) {
				var e = this;
				if (e.$toggleAll.prop("checked", !1), e.$toggleAll.prop("indeterminate", !1), e.viewType) {
					var f = [];
					e.$table && e.$table.fnClearTable && (e.$table.fnClearTable(), e.$table.fnDestroy()),
					b.forEach(function (a) {
						var b = c();
						f.push(b.promise()),
						e.$container.append("<tr></tr>"),
						e.$container.children().last().data("json", a).attr("data-weave", l + "(json, " + e.viewType + ", " + e._hideContact + ")").weave(b)
					}),
					d.apply(a, f).done(function () {
						var a = {
							sDom : "Ctr",
							bProcessing : !0,
							bSort : !1,
							bLengthChange : !1,
							bSearchable : !1,
							bPaginate : !1,
							bDestroy : !0,
							sScrollX : "100%",
							bScrollCollapse : !0,
							oColVis : {
								aiExclude : [0],
								buttonText : j.Columns,
								fnStateChange : function (a, b) {
									e.columns = e.columns || [],
									b ? e.columns = e.columns.filter(function (b) {
											return b !== a
										}) : e.columns.push(a),
									e.columns.sort(),
									e.publish("ajax", {
										url : i.LISTVIEW,
										type : "post",
										data : {
											data : JSON.stringify({
												list : e._listType,
												key : "columns",
												value : e.columns
											})
										}
									}, c())
								}
							},
							fnInitComplete : function () {
								e.$element.find(".action-bar .pull-right .ColVis_MasterButton").remove(),
								e.$element.find(".action-bar .pull-right").append(e.$element.find(".ColVis_MasterButton")),
								e.$element.find(".ColVis").remove()
							}
						};
						e.columns ? a.aoColumnDefs = [{
								bVisible : !1,
								aTargets : e.columns
							}
						] : (e.columns = function () {
							for (var a = [], b = e.$table.find("thead th").length - 1, d = b - e.table.length; b > d; b--)
								a.push(b);
							return a.sort(),
							e.publish("ajax", {
								url : i.LISTVIEW,
								type : "post",
								data : {
									data : JSON.stringify({
										list : e._listType,
										key : "columns",
										value : a
									})
								}
							}, c()),
							a
						}
							(), a.aoColumnDefs = [{
									bVisible : !1,
									aTargets : e.columns
								}
							]),
						e.$table.dataTable(a)
					})
				} else
					b.forEach(function (a) {
						e.$container.append('<div class="search_item clearfix"></div>'),
						e.$container.children().last().data("json", a).attr("data-weave", l + "(json, " + e.viewType + ", " + e._hideContact + ")").weave()
					})
			},
			"dom/action/mass/send/mail" : function (b, c, d) {
				c.preventDefault();
				var e = this,
				g = a(c.target),
				h = null,
				i = k;
				if (!g.hasClass("disabled")) {
					var m,
					n,
					o = e.$element.find('[data-action="list/check"]').filter(":checked"),
					p = [],
					q = [],
					r = [];
					d && (i = [d]),
					o.each(function () {
						n = a(this).data("json"),
						m = [n.englishName, n.chineseName].join(" ").trim(),
						i.length > 1 && (n.email ? d = "email" : n.email1 ? d = "email1" : n.email2 && (d = "email2")),
						n[d] ? (p.push(n[d]), q.push('"' + m + '" [' + j[d] + "]")) : r.push('<a href="/candidate#detail!id=' + n.id + '" target="_blank">' + m + "</a>")
					}),
					r.length && (i.length > 1 ? f.alert("info", "以下人才没有任何邮箱:<br>" + r.join(", ")) : f.alert("info", "以下人才没有" + j[d] + "邮箱:<br>" + r.join(", ")));
					var s = {
						names : q,
						emails : p,
						onSuccess : function () {
							o.closest('[data-woven*="' + l + '"]').find(".email-count").each(function () {
								var b = a(this);
								b.text(parseInt(b.text(), 10) + 1)
							})
						},
						emailTemplate : "candidate_email",
						attachment : {
							joborder : 0,
							clientcompany : 0
						}
					};
					o.length && (h = o.data("json").id, s.candidate_id = h),
					e.publish("modal/sendemail/show", s)
				}
			},
			"dom/action/mass/edit.click" : function (b, c) {
				c.preventDefault();
				var d = this,
				e = a(c.target);
				if (!e.hasClass("disabled")) {
					var f = d.$element.find('[data-action="list/check"]').filter(":checked"),
					g = [];
					f.each(function () {
						g.push(a(this).data("json").id)
					}),
					d.publish("modal/mass-edit/show", g, function () {
						d.publish("list/reload")
					})
				}
			},
			"dom/action/mass/to/folder.click" : function (b, c) {
				c.preventDefault();
				var d = this,
				e = a(c.target);
				if (!e.hasClass("disabled")) {
					var f = d.$element.find('[data-action="list/check"]').filter(":checked"),
					g = [];
					f.each(function () {
						g.push(a(this).data("json").id)
					}),
					d.publish("modal/add-to-folder/show", {
						ids : g,
						type : "candidate",
						multiSelect : !0,
						onSuccess : function (b) {
							f.each(function () {
								a(this).data("json").folders = b
							}),
							f.closest('[data-woven*="' + l + '"]').find(".folder-count").text(b.length).closest("a").find(".muted").text(d.getFolderName(b))
						}
					})
				}
			},
			"dom/action/mass/add/shortlist.click" : function (b, c) {
				c.preventDefault();
				var d = this,
				e = a(c.target);
				if (!e.hasClass("disabled")) {
					var g = d.$element.find('[data-action="list/check"]').filter(":checked"),
					h = [],
					i = [];
					g.each(function () {
						var b = a(this).data("json");
						h.push(b.id),
						i.push([b.englishName, b.chineseName].join(" ").trim())
					}),
					d.publish("modal/addshortlist/show", {
						ids : h,
						names : i,
						onSuccess : function (a) {
							for (var b, c = a.data, d = g.closest('[data-woven*="' + l + '"]').find(".shortlist-count"), e = 0, h = c.length; h > e; e++)
								b = c[e].status, b ? d.eq(e).text(parseInt(d.eq(e).text(), 10) + 1) : f.alert("info", i[e] + ": " + c[e].msg)
						},
						type : "people"
					})
				}
			},
			"dom/action/mass/floating.click" : function (b, c) {
				c.preventDefault();
				var d = this,
				e = a(c.target);
				if (!e.hasClass("disabled")) {
					var f = d.$element.find('[data-action="list/check"]').filter(":checked"),
					g = [],
					h = [];
					f.each(function () {
						var b = a(this).data("json"),
						c = [b.englishName, b.chineseName].join(" ").trim();
						h.push(c),
						g.push({
							name : c,
							id : b.id
						})
					}),
					d.publish("modal/add-floating/show", {
						names : h,
						onSuccess : function () {
							f.closest('[data-woven*="' + l + '"]').find(".floating-count").each(function () {
								var b = a(this);
								b.text(parseInt(b.text(), 10) + 1)
							})
						},
						attachment : g,
						checkAttachment : !0
					})
				}
			},
			"dom/action/mass/delete.click" : function (b, d) {
				d.preventDefault();
				var e,
				g = this,
				h = a(d.target);
				if (!h.hasClass("disabled") && (e = window.confirm("确定要删除所选的人才吗?"))) {
					var j = g.$element.find('[data-action="list/check"]').filter(":checked"),
					k = [];
					j.each(function () {
						k.push(a(this).data("json").id)
					}),
					g.publish("ajax", {
						url : i.DETELE,
						data : {
							data : JSON.stringify({
								ids : k
							})
						},
						type : "post"
					}, c().done(function (a) {
							a.status ? (f.alert("success", "人才删除成功!"), j.closest('[data-woven*="' + l + '"]').remove()) : f.alert("error", a.message)
						}))
				}
			},
			"dom/action/act/toggle.change" : function (b, c) {
				var d = this,
				e = a(c.target);
				d.publish("candidate/action/toggle", e.attr("name"))
			},
			"dom/action/dropdown.click" : function (b, c) {
				c.preventDefault();
				var d = this,
				e = a(c.target),
				f = e.siblings(".dropdown-menu"),
				g = a(document),
				h = e.closest(".dropdown");
				d.$element.find(".btn-group").removeClass("open"),
				h.addClass("open"),
				g.on("click.btn.dropdown", function (b) {
					var c = a(b.target);
					!c.closest(f).length && h.hasClass("open") && (h.removeClass("open"), g.off("click.btn.dropdown"))
				})
			},
			"dom/action/save/acts.click" : function (b, d) {
				d.preventDefault();
				var e = this,
				g = a(d.target),
				h = {};
				g.closest("form").find(":checkbox").each(function () {
					h[a(this).attr("name")] = a(this).is(":checked")
				}),
				e.publish("ajax", {
					url : i.LISTVIEW,
					data : {
						data : JSON.stringify({
							list : "candidate",
							key : "action_display",
							value : h
						})
					},
					type : "post"
				}, c().done(function (a) {
						a.status ? (e.$element.find(".dropdown").removeClass("open"), f.alert("success", j.SUCCESSFUL)) : f.alert("error", a.message)
					}), g)
			},
			getFolderName : function (a) {
				var b = "",
				c = [];
				return a.length && (a.forEach(function (a) {
						c.push(a.name)
					}), b = c.join(", ")),
				b
			}
		})
	}), define("troopjs-requirejs/template!app/widget/candidate/work-experience/main.html", [], function () {
		return function (a) {
			for (var b = '<div class="table-scrollable">\n    <table class="table table-bordered">\n        <colgroup>\n            <col width="25%">\n            <col width="">\n            <col width="">\n            <col width="">\n            <col width="">\n        </colgroup>\n        <thead>\n            <tr>\n                <th data-weave="shared/helper/translation" data-i18n="Time"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Company"></th>\n                <th data-weave="shared/helper/translation" data-i18n="City"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Title"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Function"></th>\n            </tr>\n        </thead>\n        <tbody>\n            ', c = 0, d = a.length; d > c; c++) {
				b += "\n            ";
				var e = a[c],
				f = e.client.type;
				b += "\n            <tr>\n                <td>\n                    ",
				e.start && (b += "\n                    " + e.start + "\n                    "),
				b += "\n                    ",
				e.is_current ? b += '\n                    - \n                    <span data-weave="shared/helper/translation" data-i18n="Present"></span>\n                    ' : (b += "\n                        ", e.end && (b += "\n                        - \n                        " + e.end + "\n                        "), b += "\n                    "),
				b += '\n                </td>\n                <td>\n                    <a href="/company#detail!id=' + e.client.id + '" target="_blank">' + e.client.name + "</a>\n                    ",
				f && "normal" !== f && "generated" !== f && (b += '\n                    <span class="red">(<span data-weave="shared/helper/translation" data-i18n="' + f + ' company"></span>)</span>\n                    '),
				b += "\n                    ",
				e.client.bd && (b += '\n                    (BD: <a href="user/preview#' + e.client.bd.id + '" data-action="profile/open">' + e.client.bd.englishName + "</a>)\n                    "),
				b += "\n                </td>\n                <td>" + (e.client.city ? e.client.city.name : "") + "</td>\n                <td>" + e.title + "</td>\n                <td>\n                    ",
				e.function  && e.function .id && (b += '\n                    <span class="label function" title="' + e.function .name, e.function1 && (b += ", " + e.function1.name), e.function2 && (b += ", " + e.function2.name), b += '">' + e.function .name, (e.function1 || e.function2) && (b += "..."), b += "</span>\n                    "), b += "\n                </td>\n            </tr>\n            "
}
return b += "\n        </tbody>\n    </table>\n</div>"
}
}), define("app/widget/candidate/work-experience/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		a.done(function () {
			e.widgetLoaded.call(b)
		}),
		b.publish("ajax", {
			url : h.replace("<id>", b.id)
		}, c().done(function (e) {
				b._json = e,
				c(function (a) {
					b.html(d, b._json, a)
				}).done(function () {
					g.call(b, a)
				})
			}))
	}
	function g(a) {
		var b = this;
		b.$element.find(".function").tooltip(),
		a.resolve()
	}
	var h = "/rest/candidate/experience/<id>";
	return b.extend(function (a, b, c) {
		this.id = c
	}, {
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		}
	})
}), define("troopjs-requirejs/template!app/widget/common/add-consultant/main.html", [], function () {
	return function () {
		var a = '<label for="" class="control-label" data-weave="shared/helper/translation" data-i18n="Others"></label>\r\n<div class="controls text_line" >\r\n    <a id="add" href="#" data-action="consultant/add" data-weave="shared/helper/translation" data-i18n="Add">Add</a>\r\n</div>';
		return a
	}
}), define("troopjs-requirejs/template!app/widget/common/add-consultant/consultant.html", [], function () {
	return function () {
		var a = '<div class="controls">\r\n    <select name="type" class="input-medium" data-action="consultant/type.change">\r\n    	<option value="Researcher">Researcher</option>\r\n        <option value="Consultant">Consultant</option>\r\n    </select>\r\n    <select data-placeholder="Choose a user..." name="Consultant" class="input-medium user">\r\n    </select>\r\n    <a href="#" class="remove" data-action="consultant/remove">\r\n        <span class="icon-remove"></span>\r\n    </a>\r\n</div>';
		return a
	}
}), define("app/widget/common/add-consultant/main", ["compose", "jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "template!./consultant.html", "shared/helper/utils"], function (a, b, c, d, e, f, g) {
	function h(a, b) {
		a.data("woven") || (b ? a.attr("data-weave", "shared/widget/common/user-list/main(" + b + ")").weave() : a.attr("data-weave", "shared/widget/common/user-list/main").weave())
	}
	function i(a, c) {
		var d = b("#add"),
		e = d.closest(".controls"),
		f = b(g());
		f.find("[data-weave]").each(function () {
			b(this).weave()
		});
		var i = f.find("select[name=type]"),
		j = i.next();
		i.val(a),
		j.attr("name", a),
		h(j, c),
		e.before(f)
	}
	function j() {
		for (var a = this._consultant, b = 0, c = a.length; c > b; b += 1)
			i.call(this, a[b].type, a[b].user.id)
	}
	function k(a) {
		var b = this;
		d(function (a) {
			b.html(f, b._json, a)
		}).then(function () {
			l.call(b, a)
		}, a.reject, a.notify)
	}
	function l(a) {
		var b = this;
		b.$addBtn = b.$element.find(".text_line"),
		b.publish("ajax", {
			url : m.USERLIST
		}, d().done(function (a) {
				b._json.userList = a
			}).then(function () {
				b._consultant && j.call(b)
			}).always(function () {
				a.resolve()
			}))
	}
	var m = {
		USERLIST : "/rest/data/userlist"
	};
	return c.extend(function (a, b, c) {
		var d = this;
		d._consultant = c
	}, {
		"sig/initialize" : function (a, b) {
			k.call(this, b)
		},
		"dom/action.click.change" : b.noop,
		"dom/action/consultant/add.click" : function (a, c) {
			c.preventDefault();
			var d = this;
			b(c.target);
			var e = b(g());
			e.find("[data-weave]").each(function () {
				b(this).weave()
			}),
			d.$addBtn.before(e),
			d.$addBtn.prev().find('[name="type"]').trigger("change")
		},
		"dom/action/consultant/type.change" : function (a, c) {
			var d = b(c.target),
			e = d.siblings("select"),
			f = d.val();
			e.attr("name", f),
			h(e)
		},
		"dom/action/consultant/remove.click" : function (a, c) {
			var d = b(c.target),
			e = d.closest(".controls");
			window.confirm("Are you really to remove it?") && (e.remove(), c.preventDefault())
		}
	})
}), define("troopjs-requirejs/template!app/widget/common/add-contract/main.html", [], function () {
	return function () {
		var a = '<label class="control-label">\n    <span data-weave="shared/helper/translation" data-i18n="Contract"></span>\n    <span class="f_req">*</span>\n</label>\n            \n<div class="controls text_line">\n    <input type="hidden" name="contract">\n    <a href="#" data-action="add/contract" data-weave="shared/helper/translation" data-i18n="Add"></a>\n</div>';
		return a
	}
}), define("troopjs-requirejs/template!app/widget/common/add-contract/item.html", [], function () {
	return function (a) {
		var b = '<div class="controls text_line contract">\n    ' + a.contractName + '\n    <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="Edit" data-action="edit/contract"></button>\n    <a class="remove" href="#" data-action="remove/contract">\n        <span class="icon-remove"></span>\n    </a>\n</div>';
		return b
	}
}), define("app/widget/common/add-contract/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "template!./item.html", "shared/helper/utils", "shared/helper/blurb"], function (a, b, c, d, e) {
	function f(b, c) {
		var d = a(e(c));
		d.data("contract", c).find("[data-weave]").weave(),
		b.before(d)
	}
	function g(a) {
		var b = this;
		b.html(d, a)
	}
	function h(a) {
		var b = this;
		if (b.$contract = b.$element.find('[name="contract"]'), b.$addControl = b.$element.find("a").closest(".controls"), b._data.length) {
			b.$contract.val(!0);
			for (var c = 0, d = b._data.length; d > c; c++)
				f(b.$addControl, b._data[0])
		}
		a.resolve()
	}
	return b.extend(function (a, b, c) {
		"object" == typeof c && (this._data = c)
	}, {
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"sig/start" : function (a, b) {
			h.call(this, b)
		},
		"dom/action.click" : a.noop,
		"dom/action/add/contract.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target);
			e.closest(".controls"),
			d.publish("modal/add/contract/show", null, null, function (a) {
				d.$contract.val(!0),
				f(d.$addControl, a)
			})
		},
		"dom/action/edit/contract.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target),
			f = e.closest(".controls");
			d.publish("modal/add/contract/show", null, null, function (a) {
				f.data("contract", a)
			}, f.data("contract"))
		},
		"dom/action/remove/contract.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target),
			f = e.closest(".controls");
			f.remove(),
			d.$element.find(".contract").length || d.$contract.val("")
		}
	})
}), define("troopjs-requirejs/template!app/widget/common/attachment-type/main.html", [], function () {
	return function (a) {
		for (var b = "", c = 0, d = a.length; d > c; c++) {
			b += "\n";
			var e = a[c];
			b += '\n<option value="' + e.code + '">' + e.value + "</option>\n"
		}
		return b
	}
}), define("app/widget/common/attachment-type/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		b.publish("ajax", {
			url : f.CATEGORY.replace("<type>", g[b._type])
		}, c().done(function (c) {
				b._json = c,
				b.html(d, b._json, a)
			}))
	}
	var f = {
		CATEGORY : "/rest/data/options?type=<type>"
	},
	g = {
		candidate : "candidate_attachment_category",
		company : "client_attachment_category",
		job : "joborder_attachment_category"
	};
	return b.extend(function (b) {
		this._type = a(b).data("type")
	}, {
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		}
	})
}), define("troopjs-requirejs/template!app/widget/common/attachment-view/main.html", [], function () {
	return function (a) {
		var b = '<a href="javascript: void(0);" class="dropdown-toggle" data-action="show/attachments"><i class="icon-paper-clip"></i> <span class="count">' + a.attachment_count + "</span></a>";
		return b
	}
}), define("troopjs-requirejs/template!app/widget/common/attachment-view/item.html", [], function () {
	return function (a) {
		for (var b = "", c = a.list.length; c--; ) {
			var d = a.list[c];
			b += '\r\n\r\n<li>\r\n    <div class="clearfix">\r\n        <div class="sepH_a">\r\n            <span class="pull-right view">' + d.dateAdded + "</span>\r\n            ",
			b += d.tag ? '\r\n            <i class="label editable editable-click" data-type="select" data-pk="' + d.id + '" style="background-color: ' + d.tag.color + ';">' + d.tag.value + "</i>\r\n            " : '\r\n            <i class="label editable editable-click" data-type="select" data-pk="' + d.id + '" data-weave="shared/helper/translation" data-i18n="Unknown"></i>\r\n            ',
			b += '\r\n            <a href="#" class="file-type-icon ' + d.ext.toLowerCase() + ' view" data-action="preview(' + d.uuidname + ", '" + d.ext + "')\">" + d.originname + '</a>\r\n        </div>\r\n        <div class="sepH_a view">\r\n            <span class="pull-right">\r\n                <button class="btn btn-mini" data-action="preview(' + d.uuidname + ", '" + d.ext + '\')" data-weave="shared/helper/translation" data-i18n="Preview"></button>\r\n                ',
			a.userId === d.addedBy.id && (b += '\r\n                <button class="btn btn-mini btn-delete" data-action="attachment/delete(' + d.uuidname + ')" data-weave="shared/helper/translation" data-i18n="Delete"></button>\r\n                '),
			b += "\r\n                ",
			(a.userId === d.addedBy.id || a.allowDownload) && (b += '\r\n                <button class="btn btn-mini" data-action="attachment/download(' + d.uuidname + ')" data-weave="shared/helper/translation" data-i18n="Download"></button>\r\n                '),
			b += "\r\n            </span>\r\n            <span><em>" + (d.filesize / 1024).toFixed(2) + 'KB</em></span>\r\n            <span><span data-weave="shared/helper/translation" data-i18n="Uploader"></span>:<a href="user/preview#' + d.addedBy.id + '" data-action="attachment/profile/open">' + d.addedBy.englishName + "</a></span>\r\n        </div>\r\n    </div>\r\n</li>\r\n"
		}
		return b
	}
}), define("app/widget/common/attachment-view/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "template!./item.html", "shared/helper/utils", "bootstrap.editable"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		b.html(d, b._json, a)
	}
	return b.extend(function (b, c, d, e, f, g) {
		var h = this;
		h._json.attachment_count = d,
		h._type = e,
		h._id = f,
		h._readOnly = g,
		h._paste = a(b).data("paste")
	}, {
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		},
		"sig/start" : function (a, b) {
			var c = this;
			c.$count = c.$element.find(".count"),
			b.resolve()
		},
		"hub:memory/context" : function (a, b) {
			var c = this;
			c._userId = b.user.id,
			c._allowDownload = "1" === b.config.attachment_allow_download
		},
		"dom/action.click" : a.noop,
		"dom/action/show/attachments.click" : function (b, c) {
			var d = this;
			a(c.target);
			var e = a("body"),
			f = e.find(".dropdown-resume"),
			g = c.originalEvent.pageX,
			h = c.originalEvent.pageY;
			f.length && f.remove(),
			e.append('<div class="dropdown-menu dropdown-resume"></div>'),
			f = e.find(".dropdown-resume"),
			f.css({
				positon : "absolute",
				left : g,
				top : h,
				display : "block"
			}),
			f.data("$count", d.$count).data("paste", d._paste).data("userId", d._userId).data("type", d._type).data("id", d._id).data("readOnly", d._readonly).data("allowDownload", d._allowDownload).attr("data-weave", "app/widget/common/attachment-view/resume").weave()
		}
	})
}), define("troopjs-requirejs/template!app/widget/common/attachment-view/resume.html", [], function () {
	return function () {
		var a = "",
		b = {
			candidate : "candidate",
			clientcompany : "company",
			joborder : "job"
		};
		return a += '\n<form action="#" class="form-horizontal">\n	<select name="tag" class="input-medium" data-type="' + b[this._type] + '" data-weave="app/widget/common/attachment-type/main"></select>\n    <span class="upload-file"></span>\n    ',
		this._paste && (a += '\n    <span>\n        <button class="btn" data-weave="shared/helper/translation" data-i18n="Paste Resume" data-action="show/paste/modal"></button>\n    </span>\n    '),
		a += '\n</form>\n\n<ul class="nav nav-stack attachment-list hide">\n</ul>'
	}
}), define("app/widget/common/attachment-view/resume", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./resume.html", "template!./item.html", "shared/helper/utils", "bootstrap.editable"], function (a, b, c, d, e, f) {
	function g(b) {
		var d = this;
		d.publish("ajax", {
			url : j.FILE_LIST.replace("<type>", d._type).replace("<id>", d._id)
		}, c().done(function (c) {
				c.length && d.$list.removeClass("hide");
				var f = a(e({
							list : c,
							allowDownload : d._allowDownload,
							userId : d._userId
						}));
				f.find("[data-weave]").each(function () {
					a(this).weave()
				}),
				d.$list.html(f),
				b && b(),
				f.find("i.label").on("shown", function () {
					a(this).closest("li").addClass("editing")
				}).on("hidden", function () {
					a(this).closest("li").removeClass("editing")
				})
			}))
	}
	function h(a) {
		var b = this;
		c(function (a) {
			b.html(d, b._json, a)
		}).then(function () {
			i.call(b, a)
		})
	}
	function i(b) {
		var c = this;
		return g.call(c),
		c._readOnly ? (c.$element.find(".dropdown-menu").addClass("read-only"), void 0) : (c.$element.find(".upload-file").data("json", {
				multiple : !0,
				data : {
					type : c._type,
					external_id : c._id
				},
				beforeSubmit : function (a, b, d) {
					var e = JSON.parse(d.data.data);
					e.tag = b.find('[name="tag"]').val(),
					d.data.data = JSON.stringify(e),
					c.$element.find(".upload-file").prev().addClass("hide")
				},
				success : function (a) {
					a.status ? (f.alert("success", "Upload file successfully!"), g.call(c, function () {
							c.$count.text(parseInt(c.$count.text(), 10) + 1)
						})) : f.alert("error", "Upload file error!"),
					c.$element.find(".upload-file").prev().removeClass("hide")
				}
			}).attr("data-weave", "shared/widget/common/upload/main(json)").weave(), c.$element.editable({
				selector : "i.label",
				mode : "inline",
				emptytext : "未知",
				source : j.CATEGORY.replace("<type>", k[c._type]),
				sourceCache : !0,
				url : j.EDIT_CATE,
				params : function (a) {
					return a.id = a.pk,
					a.tag = a.value,
					delete a.value,
					delete a.pk,
					delete a.name, {
						data : JSON.stringify(a)
					}
				},
				success : function (b) {
					a(this).css("background-color", b.data.tag.color).text(b.data.tag.value)
				},
				error : function (a) {
					var b = JSON.parse(a.responseText);
					f.alert("error", b.message)
				}
			}), a(document).on("click.resume", function (b) {
				a(b.target).closest(c.$element).length || (c.$element.remove(), a(document).off(b))
			}), b.resolve(), void 0)
	}
	var j = {
		FILE_LIST : "/rest/file/list/<type>/<id>",
		PREVIEW : "/rest/file/preview/",
		DOWNLOAD : "/rest/file/download/<uuidname>",
		DELETE : "/rest/file/del",
		CATEGORY : "/rest/data/options?type=<type>",
		EDIT_CATE : "/rest/file/edit"
	},
	k = {
		candidate : "candidate_attachment_category",
		clientcompany : "client_attachment_category",
		joborder : "joborder_attachment_category"
	};
	return b.extend(function (b) {
		var c = a(b),
		d = this;
		d._type = c.data("type"),
		d._id = c.data("id"),
		d._readOnly = c.data("readOnly"),
		d._allowDownload = c.data("allowDownload"),
		d._userId = c.data("userId"),
		d.$count = c.data("$count"),
		d._paste = c.data("paste")
	}, {
		"sig/initialize" : function (a, b) {
			h.call(this, b)
		},
		"sig/start" : function (a, b) {
			this.$list = this.$element.find(".nav-stack"),
			b.resolve()
		},
		"sig/stop" : function (b, c) {
			a(document).off("click.resume"),
			c.resolve()
		},
		"dom/action.click" : a.noop,
		"dom/action/preview.click" : function (b, c, d, e) {
			c.preventDefault();
			var f = this,
			g = a(c.target);
			g.closest(".dropdown").removeClass("open"),
			f.$element.remove(),
			f.publish("slide-helper/attachment/reload", d, null, e)
		},
		"dom/action/attachment/delete.click" : function (b, d, e) {
			d.preventDefault();
			var g = this,
			h = a(d.target),
			i = window.confirm("你确认要删除文件吗？");
			i && g.publish("ajax", {
				url : j.DELETE,
				type : "post",
				data : {
					data : JSON.stringify({
						uuidnames : [e]
					})
				}
			}, c().done(function () {
					f.alert("success", "Delete attachment successfully!"),
					h.closest("li").remove(),
					g.$count.text(parseInt(g.$count.text(), 10) - 1)
				}))
		},
		"dom/action/attachment/profile/open.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = d.attr("href");
			f.window({
				url : e,
				name : "User Profile",
				width : "1024"
			})
		},
		"dom/action/attachment/download.click" : function (a, b, c) {
			b.preventDefault(),
			window.open(j.DOWNLOAD.replace("<uuidname>", c), "target=_blank")
		},
		"dom/action/show/paste/modal.click" : function (a, b) {
			b.preventDefault();
			var c = this;
			c.publish("modal/paste-resume/show", {
				external_id : c._id,
				onSuccess : function () {
					g.call(c, function () {
						c.$count.text(parseInt(c.$count.text(), 10) + 1)
					})
				}
			})
		}
	})
}), define("app/widget/common/autocomplete/main", ["jquery", "shared/widget/base/main", "typeahead"], function (a, b) {
	function c(a) {
		var b = this,
		c = d.replace("<type>", b.type);
		b.$element.typeahead({
			name : b.type,
			remote : c
		}),
		a.resolve()
	}
	var d = "/rest/data/autocomplete?type=<type>&name=%QUERY";
	return b.extend(function (a, b, c) {
		this.type = c
	}, {
		"sig/initialize" : function (a, b) {
			c.call(this, b)
		}
	})
}), define("troopjs-requirejs/template!app/widget/common/birthday/main.html", [], function () {
	return function () {
		var a = '<select id="birthYear" name="birthYear" class="input-small ';
		return this._required && (a += "required"),
		a += '" data-action="year">\r\n    <option value="">Year</option>\r\n    <option value="1950">1950</option>\r\n    <option value="1951">1951</option>\r\n    <option value="1952">1952</option>\r\n    <option value="1953">1953</option>\r\n    <option value="1954">1954</option>\r\n    <option value="1955">1955</option>\r\n    <option value="1956">1956</option>\r\n    <option value="1957">1957</option>\r\n    <option value="1958">1958</option>\r\n    <option value="1959">1959</option>\r\n    <option value="1960">1960</option>\r\n    <option value="1961">1961</option>\r\n    <option value="1962">1962</option>\r\n    <option value="1963">1963</option>\r\n    <option value="1964">1964</option>\r\n    <option value="1965">1965</option>\r\n    <option value="1966">1966</option>\r\n    <option value="1967">1967</option>\r\n    <option value="1968">1968</option>\r\n    <option value="1969">1969</option>\r\n    <option value="1970">1970</option>\r\n    <option value="1971">1971</option>\r\n    <option value="1972">1972</option>\r\n    <option value="1973">1973</option>\r\n    <option value="1974">1974</option>\r\n    <option value="1975">1975</option>\r\n    <option value="1976">1976</option>\r\n    <option value="1977">1977</option>\r\n    <option value="1978">1978</option>\r\n    <option value="1979">1979</option>\r\n    <option value="1980">1980</option>\r\n    <option value="1981">1981</option>\r\n    <option value="1982">1982</option>\r\n    <option value="1983">1983</option>\r\n    <option value="1984">1984</option>\r\n    <option value="1985">1985</option>\r\n    <option value="1986">1986</option>\r\n    <option value="1987">1987</option>\r\n    <option value="1988">1988</option>\r\n    <option value="1989">1989</option>\r\n    <option value="1990">1990</option>\r\n    <option value="1991">1991</option>\r\n    <option value="1992">1992</option>\r\n    <option value="1993">1993</option>\r\n    <option value="1994">1994</option>\r\n    <option value="1995">1995</option>\r\n    <option value="1996">1996</option>\r\n    <option value="1997">1997</option>\r\n    <option value="1998">1998</option>\r\n    <option value="1999">1999</option>\r\n    <option value="2000">2000</option>\r\n</select>\r\n<select id="birthMonth" name="birthMonth" class="input-small" disabled="disabled">\r\n    <option value="">Month</option>\r\n    <option value="01">01</option>\r\n    <option value="02">02</option>\r\n    <option value="03">03</option>\r\n    <option value="04">04</option>\r\n    <option value="05">05</option>\r\n    <option value="06">06</option>\r\n    <option value="07">07</option>\r\n    <option value="08">08</option>\r\n    <option value="09">09</option>\r\n    <option value="10">10</option>\r\n    <option value="11">11</option>\r\n    <option value="12">12</option>\r\n</select>\r\n<select id="birthDay" name="birthDay" class="input-mini" disabled="disabled">\r\n    <option value="">Day</option>\r\n    <option value="01">01</option>\r\n    <option value="02">02</option>\r\n    <option value="03">03</option>\r\n    <option value="04">04</option>\r\n    <option value="05">05</option>\r\n    <option value="06">06</option>\r\n    <option value="07">07</option>\r\n    <option value="08">08</option>\r\n    <option value="09">09</option>\r\n    <option value="10">10</option>\r\n    <option value="11">11</option>\r\n    <option value="12">12</option>\r\n    <option value="13">13</option>\r\n    <option value="14">14</option>\r\n    <option value="15">15</option>\r\n    <option value="16">16</option>\r\n    <option value="17">17</option>\r\n    <option value="18">18</option>\r\n    <option value="19">19</option>\r\n    <option value="20">20</option>\r\n    <option value="21">21</option>\r\n    <option value="22">22</option>\r\n    <option value="23">23</option>\r\n    <option value="24">24</option>\r\n    <option value="25">25</option>\r\n    <option value="26">26</option>\r\n    <option value="27">27</option>\r\n    <option value="28">28</option>\r\n    <option value="29">29</option>\r\n    <option value="30">30</option>\r\n    <option value="31">31</option>\r\n</select>'
	}
}), define("app/widget/common/birthday/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "shared/helper/blurb", "app/widget/common/select2/main"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		b.html(d, b._json, a)
	}
	function f(a) {
		var b,
		c = this,
		d = c.$element.find("#birthMonth"),
		e = c.$element.find("#birthDay");
		c.$year = c.$element.find("#birthYear"),
		c._dateOfBirth && (b = c._dateOfBirth.split("-"), c.$year.val(b[0]), d.prop("disabled", !1), e.prop("disabled", !1), c._monthNull || d.val(b[1]), c._dayNull || e.val(b[2])),
		c.$year.select2(),
		a.resolve()
	}
	return b.extend(function (b, c, d, e, f) {
		var g = this;
		g._dateOfBirth = d,
		g._monthNull = e,
		g._dayNull = f,
		g._required = a(b).data("required") === !0
	}, {
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		},
		"sig/start" : function (a, b) {
			f.call(this, b)
		},
		"sig/stop" : function (a, b) {
			this.$year.select2("destroy"),
			b.resolve()
		},
		"dom/action.change" : a.noop,
		"dom/action/year.change" : function (b, c) {
			var d = a(c.target).val(),
			e = this.$element.find("#birthMonth"),
			f = this.$element.find("#birthDay");
			d ? (e.val("").prop("disabled", !1), f.val("").prop("disabled", !1)) : (e.val("").prop("disabled", !0), f.val("").prop("disabled", !0))
		}
	})
}), define("troopjs-requirejs/template!app/widget/common/company-suggestion/main.html", [], function () {
	return function (a) {
		var b,
		c = "",
		d = a.ctype,
		e = a.count !== b ? a.count : a.people_count;
		return c += '\n\n<p class="clearfix">\n    <span class="',
		"normal" !== a.type && "generated" !== a.type && (c += "red"),
		c += '">\n        ' + a.name + '\n    </span>\n\n    <span class="pull-right">\n        ',
		d && (c += '\n        <span class="red">' + d + "</span>&nbsp;\n        "),
		c += '\n        <span class="muted">' + e + " 人才</span>\n        ",
		a.city && (c += '\n        <span class="muted">' + a.city.name + "</span>\n        "),
		c += "\n\n        ",
		a.industry && a.industry.id && (c += '\n        <span class="label industry" title="' + a.industry.name, a.industry1 && (c += ", " + a.industry1.name), a.industry2 && (c += ", " + a.industry2.name), c += '">' + a.industry.name, (a.industry1 || a.industry2) && (c += "..."), c += "</span>\n        "),
		c += "\n    </span>\n</p>\n",
		a.name1 && (c += '\n<p class="muted">' + a.name1 + "</p>\n"),
		c += "\n",
		a.name2 && (c += '\n<p class="muted">' + a.name2 + "</p>\n"),
		c
	}
}), define("app/widget/common/company-suggestion/main", ["jquery", "shared/widget/base/main", "template!./main.html", "shared/helper/blurb", "typeahead"], function (a, b, c, d) {
	function e(a) {
		var b = this,
		d = b.$element,
		e = d.attr("class");
		d.typeahead({
			name : "company",
			remote : f,
			valueKey : "name",
			template : function (a) {
				return a.ctype = g[a.type],
				c(a)
			},
			limit : 200
		}).on("typeahead:initialized", function () {
			d.prev().addClass(e)
		}).on("typeahead:selected", function () {
			d.trigger("change")
		}).on("typeahead:opened", function () {}),
		a.resolve()
	}
	var f = "/rest/data/autocomplete?type=company&name=%QUERY",
	g = {
		client : d.t("client company"),
		bding : d.t("bding company"),
		normal : "",
		generated : ""
	};
	return b.extend({
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		},
		"dom/action.click" : a.noop,
		"dom/action/new/company.click" : function (a, b) {
			b.preventDefault();
			var c = this;
			c.$element.typeahead("close")
		}
	})
}), define("troopjs-requirejs/template!app/widget/common/custom-fields/text.html", [], function () {
	return function (a) {
		var b = '<div class="control-group">\n    <label for="' + a.mapping + '" class="control-label">\n        ' + a.label + "\n        ";
		return a.required && (b += '<span class="f_req">*</span>'),
		b += '\n    </label>\n    <div class="controls">\n        <input name="' + a.mapping + '" id="' + a.mapping + '" type="text" class="input-medium ',
		a.required && (b += "required"),
		b += '">\n        <p class="hint ',
		a.help.length || (b += "hide"),
		b += '">' + a.help + "</p>\n    </div>\n</div>"
	}
}), define("troopjs-requirejs/template!app/widget/common/custom-fields/multiline.html", [], function () {
	return function (a) {
		var b = '<div class="control-group" data-action="component">\n    <label for="' + a.mapping + '" class="control-label">\n        ' + a.label + "\n        ";
		return a.required && (b += '<span class="f_req">*</span>'),
		b += '\n    </label>\n    <div class="controls">\n        <textarea name="' + a.mapping + '" id="' + a.mapping + '" cols="30" rows="10" class="',
		a.required && (b += "required"),
		b += '"></textarea>\n        <p class="hint ',
		a.help.length || (b += "hide"),
		b += '">' + a.help + "</p>\n    </div>\n</div>"
	}
}), define("troopjs-requirejs/template!app/widget/common/custom-fields/radio.html", [], function () {
	return function (a) {
		var b = '<div class="control-group">\n    <label for="' + a.mapping + '" class="control-label">\n        ' + a.label + "\n        ";
		a.required && (b += '<span class="f_req">*</span>'),
		b += '\n    </label>\n    <div class="controls">\n        ';
		for (var c = 0, d = a.options.length; d > c; c++)
			b += '\n            <label class="radio">\n                <input type="radio" value="' + a.options[c] + '" name="' + a.mapping + '" class="', a.required && (b += "required"), b += '"> ' + a.options[c] + "\n            </label>\n        ";
		return b += '\n        <p class="hint ',
		a.help.length || (b += "hide"),
		b += '">' + a.help + "</p>\n    </div>\n</div>"
	}
}), define("troopjs-requirejs/template!app/widget/common/custom-fields/checkbox.html", [], function () {
	return function (a) {
		var b = '<div class="control-group">\n    <label class="control-label">\n        ' + a.label + "\n        ";
		a.required && (b += '<span class="f_req">*</span>'),
		b += '\n    </label>\n    <div class="controls">\n        ';
		for (var c = 0, d = a.options.length; d > c; c++)
			b += '\n            <label class="checkbox">\n                <input type="checkbox" value="' + a.options[c] + '" name="' + a.mapping + '" class="', a.required && (b += "required"), b += '"> ' + a.options[c] + "\n            </label>\n        ";
		return b += '\n        <p class="hint ',
		a.help.length || (b += "hide"),
		b += '">' + a.help + "</p>\n    </div>\n</div>"
	}
}), define("troopjs-requirejs/template!app/widget/common/custom-fields/dropdown.html", [], function () {
	return function (a) {
		var b = '<div class="control-group">\n    <label for="' + a.mapping + '" class="control-label">\n        ' + a.label + "\n        ";
		a.required && (b += '<span class="f_req">*</span>'),
		b += '\n    </label>\n    <div class="controls">\n        <select name="' + a.mapping + '" id="' + a.mapping + '" class="',
		a.required && (b += "required"),
		b += '">\n            <option value="" data-weave="shared/helper/translation" data-i18n="Please select"></option>\n            ';
		for (var c = 0, d = a.options.length; d > c; c++)
			b += '\n                <option value="' + a.options[c] + '">' + a.options[c] + "</option>\n            ";
		return b += '\n        </select>\n        <p class="hint ',
		a.help.length || (b += "hide"),
		b += '">' + a.help + "</p>\n    </div>\n</div>"
	}
}), define("troopjs-requirejs/template!app/widget/common/custom-fields/date.html", [], function () {
	return function (a) {
		var b = '<div class="control-group">\n    <label for="' + a.mapping + '" class="control-label">\n        ' + a.label + "\n        ";
		return a.required && (b += '<span class="f_req">*</span>'),
		b += '\n    </label>\n    <div class="controls">\n        <input name="' + a.mapping + '" id="' + a.mapping + '" type="text" class="input-medium date ',
		a.required && (b += "required"),
		b += '" data-weave="shared/widget/common/date-picker/main">\n        <p class="hint ',
		a.help.length || (b += "hide"),
		b += '">' + a.help + "</p>\n    </div>\n</div>"
	}
}), define("app/widget/common/custom-fields/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "shared/helper/utils", "template!./text.html", "template!./multiline.html", "template!./radio.html", "template!./checkbox.html", "template!./dropdown.html", "template!./date.html"], function (a, b, c, d, e, f, g, h, i, j, k) {
	function l(a) {
		var b = this;
		b.publish("ajax", {
			url : o.TABLE.replace("<table>", b._table)
		}, c().done(function (c) {
				b._fields = c,
				a.resolve()
			}))
	}
	function m(b) {
		var e,
		f = this,
		g = [];
		f._fields.length ? (f._fields.forEach(function (a) {
				e = c(),
				e.done(function () {
					var b = a.mapping,
					c = f._json[b] ? f._json[b].value : "";
					if (c)
						switch (a.type) {
						case "dropdown":
							f.$element.find('select[name="' + b + '"]').val(c);
							break;
						case "radio":
							f.$element.find('input[name="' + b + '"]').filter('[value="' + c + '"]').prop("checked", !0);
							break;
						case "checkbox":
							var d = c.split(",");
							d.forEach(function (a) {
								f.$element.find('input[name="' + b + '"]').filter('[value="' + a + '"]').prop("checked", !0)
							});
							break;
						default:
							f.$element.find('input[name="' + b + '"]').val(c)
						}
				}),
				g.push(e.promise()),
				a.options && (a.options = JSON.parse(a.options)),
				f.append(n[a.type], a, e)
			}), d.apply(a, g).done(function () {
				f.$element.find(".control-group").last().addClass("formSep"),
				b.resolve()
			})) : b.resolve()
	}
	var n = {
		text : f,
		multiline : g,
		radio : h,
		checkbox : i,
		dropdown : j,
		date : k
	},
	o = {
		TABLE : "/rest/data/fields?table=<table>"
	};
	return b.extend(function (a, b, c, d) {
		this._table = c,
		this._json = d
	}, {
		"sig/initialize" : function (a, b) {
			l.call(this, b)
		},
		"sig/start" : function (a, b) {
			m.call(this, b)
		}
	})
}), define("troopjs-requirejs/template!app/widget/common/dropdown/main.html", [], function () {
	return function (a) {
		for (var b = '<option value="" data-weave="shared/helper/translation" data-i18n="Please select"></option>\n', c = 0, d = a.length; d > c; c++) {
			b += "\n";
			var e = a[c];
			b += '\n<option value="' + e.code + '">' + e.value + "</option>\n"
		}
		return b
	}
}), define("app/widget/common/dropdown/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		if (!b._type)
			throw "Please specific dropdown type";
		b.publish("ajax", {
			url : h.replace("<type>", b._type)
		}, c().done(function (c) {
				return "undefined" == typeof c.status || c.status ? (b._json = c, b.append(d, b._json, a), void 0) : (e.alert("error", c.message), void 0)
			}).fail(function () {
				a.resolve()
			}))
	}
	function g(b) {
		var c = this;
		c._selected && (c.$element.val(c._selected), c.$element.find("option").each(function () {
				var b = a(this);
				return b.text() === c._selected ? (b.prop("selected", !0), !1) : void 0
			})),
		b.resolve()
	}
	var h = "/rest/data/options?type=<type>";
	return b.extend(function (a, b, c, d) {
		this._type = c,
		this._selected = d
	}, {
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"sig/start" : function (a, b) {
			g.call(this, b)
		}
	})
}), define("app/widget/common/email-suggestion/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "shared/helper/utils", "shared/helper/blurb", "jquery.tagit"], function (a, b, c, d, e) {
	function f(b) {
		var d = this,
		e = {
			tagLimit : d.tagLimit
		};
		a.extend(!0, e, {
			allowSpaces : !0,
			autocomplete : {
				source : function (a, b) {
					var e = this,
					f = e.element.tagit("assignedTags");
					d.publish("ajax", {
						url : g + window.encodeURIComponent(a.term)
					}, c().done(function (a) {
							var c = [],
							e = d.$element.data("emailType"),
							g = i;
							e && (g = e),
							a.forEach(function (a) {
								var b,
								d = [a.englishName, a.chineseName].join(" ").trim();
								g.forEach(function (e) {
									a[e] && (b = '"' + d + '" [' + h[e] + "]" + " <" + a[e] + ">", f.indexOf(b) < 0 && c.push(b))
								})
							}),
							b(c)
						}))
				}
			}
		}),
		d.$element.tagit(e),
		b.resolve()
	}
	var g = "/rest/candidate/email_autocomplete?email=",
	h = {
		email : e.t("Private email"),
		email1 : e.t("Work email"),
		email2 : e.t("Other")
	},
	i = ["email", "email1", "email2"];
	return b.extend(function () {
		this.tagLimit = this.$element.data("max")
	}, {
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		}
	})
}), define("troopjs-requirejs/template!app/widget/common/fee-structure/main.html", [], function () {
	return function () {
		var a = '<label for="" class="control-label" data-weave="shared/helper/translation" data-i18n="Fee structure"></label>\n<div class="controls">\n    <select name="structure" class="input-medium">\n        <option value="Contingency" data-weave="shared/helper/translation" data-i18n="Contingency"></option>\n        <option value="Minimun Charge" data-weave="shared/helper/translation" data-i18n="Minimun Charge"></option>\n        <option value="Flat Fee" data-weave="shared/helper/translation" data-i18n="Flat Fee"></option>\n        <option value="Retainer" data-weave="shared/helper/translation" data-i18n="Retainer"></option>\n        <option value="Shortlist" data-weave="shared/helper/translation" data-i18n="Shortlist"></option>\n        <option value="Others" data-weave="shared/helper/translation" data-i18n="Others"></option>\n    </select>\n    <input type="text" class="input-medium">\n</div>\n<div class="controls text_line" >\n    <a href="#" data-action="add/structure">Add other</a>\n</div>';
		return a
	}
}), define("troopjs-requirejs/template!app/widget/common/fee-structure/structure.html", [], function () {
	return function () {
		var a = '<div class="controls">\n    <select name="structure" class="input-medium">\n        <option value="Contingency" data-weave="shared/helper/translation" data-i18n="Contingency"></option>\n        <option value="Minimun Charge" data-weave="shared/helper/translation" data-i18n="Minimun Charge"></option>\n        <option value="Flat Fee" data-weave="shared/helper/translation" data-i18n="Flat Fee"></option>\n        <option value="Retainer" data-weave="shared/helper/translation" data-i18n="Retainer"></option>\n        <option value="Shortlist" data-weave="shared/helper/translation" data-i18n="Shortlist"></option>\n        <option value="Others" data-weave="shared/helper/translation" data-i18n="Others"></option>\n    </select>\n    <input type="text" class="input-medium">\n    <a href="#" data-action="remove/structure">\n        <span class="icon-remove"></span>\n    </a>\n</div>';
		return a
	}
}), define("app/widget/common/fee-structure/main", ["compose", "jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "template!./structure.html"], function (a, b, c, d, e, f) {
	function g(a) {
		var b = this;
		b.html(e, b._json, a)
	}
	return c.extend({
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"dom/action.click" : b.noop,
		"dom/action/add/structure.click" : function (a, c) {
			c.preventDefault();
			var d = b(c.target);
			d.parent().before(f)
		},
		"dom/action/remove/structure.click" : function (a, c) {
			c.preventDefault();
			var d = b(c.target);
			d.closest(".controls").remove()
		}
	})
}), define("app/widget/common/inputmask/main", ["compose", "jquery", "troopjs-utils/deferred", "troopjs-core/component/widget", "jquery.inputmask"], function (a, b, c, d) {
	return d.extend(function (a, b, c, d) {
		var e = this;
		e.mask = c,
		e.placeholder = d
	}, {
		"sig/initialize" : function (a, b) {
			var c = this;
			c.$element.inputmask(c.mask, c.placeholder ? {
				placeholder : c.placeholder
			}
				 : {}),
			b.resolve()
		}
	})
}), define("troopjs-requirejs/template!app/widget/common/job-select/main.html", [], function () {
	return function (a) {
		for (var b = '<option value=""></option>\n', c = 0, d = a.length; d > c; c++)
			b += "\n", b += a[c].inshortlist || a[c].intargetcompany ? '\n<option value="' + a[c].id + '" disabled="disabled" style="color:#ccc;" data-type="' + a[c].client.type + '">' + a[c].jobTitle + " (ID:" + a[c].id + ") of " + a[c].client.name + "</option>\n" : '\n<option value="' + a[c].id + '" data-type="' + a[c].client.type + '">' + a[c].jobTitle + " (ID:" + a[c].id + ") of " + a[c].client.name + "</option>\n", b += "\n";
		return b
	}
}), define("app/widget/common/job-select/main", ["jquery", "shared/widget/modal/base", "troopjs-utils/deferred", "template!./main.html", "shared/helper/blurb", "app/widget/common/select2/main"], function (a, b, c, d, e) {
	function f(b) {
		var c = b.element,
		d = "",
		f = a(c).data("type");
		return !f || "client" !== f && "bding" !== f || (d = ' (<span class="red">' + e.t(f + " company") + "</span>)"),
		b.text + d
	}
	function g(a) {
		var b = this,
		d = j.JOBLIST.replace("<type>", b._type);
		b._id && (d += b._id),
		b.publish("ajax", {
			url : d
		}, c().done(function (c) {
				b._json = c,
				h.call(b, a)
			}))
	}
	function h(a) {
		var b = this;
		b.html(d, b._json, a)
	}
	function i(a) {
		var b = this;
		b.$element.select2({
			placeholder : e.t("Please select"),
			allowClear : !0,
			formatResult : f,
			formatSelection : f,
			escapeMarkup : function (a) {
				return a
			}
		}),
		a.resolve()
	}
	var j = {
		JOBLIST : "rest/joborder/livejobs?<type>="
	};
	return b.extend(function (b) {
		this._type = a(b).data("type"),
		this._id = a(b).data("typeId")
	}, {
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"sig/start" : function (a, b) {
			i.call(this, b)
		},
		"sig/stop" : function (a, b) {
			this.$element.select2("destroy"),
			b.resolve()
		}
	})
}), define("troopjs-requirejs/template!app/widget/common/nationality/main.html", [], function () {
	return function (a) {
		var b = "",
		c = 0,
		d = a.length;
		for (b += '\n<option value=""></option>\n'; d > c; c += 1)
			b += '\n    <option value="' + a[c].code + '">' + a[c].value + "</option>\n";
		return b
	}
}), define("app/widget/common/nationality/main", ["jquery", "shared/widget/base/main", "template!./main.html", "troopjs-utils/deferred", "shared/helper/utils", "app/widget/common/select2/main"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		b.publish("ajax", {
			url : f.LIST
		}, d().done(function (d) {
				b._json = d,
				b.html(c, b._json, a)
			}).done(function () {
				b.code ? b.$element.val(b.code).select2() : b.$element.select2()
			}))
	}
	var f = {
		LIST : "/rest/data/options?type=nationality"
	};
	return b.extend(function (a, b, c) {
		this.code = c
	}, {
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		},
		"sig/stop" : function (a, b) {
			this.$element.select2("destroy"),
			b.resolve()
		}
	})
}), define("troopjs-requirejs/template!app/widget/common/notification/main.html", [], function () {
	return function (a) {
		function b(a) {
			return [a.englishName, a.chineseName].join(" ")
		}
		var c,
		d = "",
		e = a.type;
		switch (e) {
		case "Request for Share":
		case "Offer Signed":
		case "Candidate Edited":
			c = "label-pink";
			break;
		case "Shared":
		case "Invoice Received":
			c = "label-red";
			break;
		case "Invoice Added":
		case "Invoice edited":
		case "Shortlist":
			c = "label-purple";
			break;
		case "Invoice To be sent":
			c = "label-lightblue";
			break;
		case "Invoice Sent":
			c = "label-blue";
			break;
		case "Job Rejected":
			c = "label-inverse"
		}
		return d += '\n<p class="sepH_a">\n    ',
		d += "Reminder" !== e ? '\n    <span class="label ' + c + '" data-weave="shared/helper/translation" data-i18n="' + e + '">' + e + "</span>\n    " : '\n    <input type="checkbox" value="' + a.id + '">\n    <span class="label" style="background-color: ' + a.category.color + ';">' + a.category.value + "</span>\n    ",
		d += "\n    ",
		a.start && (d += '\n    <span class="pull-right">\n        ' + a.start + "\n    </span>\n    "),
		d += "\n</p>\n",
		"Request for Share" === e ? d += '\n<p>\n    候选人: <a href="/candidate#detail!id=' + a.candidate.id + '" target="_blank">' + b(a.candidate) + '</a> \n</p>\n<p>\n    请求者: <a href="/uer/preview#' + a.fromuser.id + '" data-action="profile/open">' + a.fromuser.englishName + "</a> \n</p>\n" : "Shared" === e ? d += '\n<p>\n    候选人: <a href="/candidate#detail!id=' + a.candidate.id + '" target="_blank">' + b(a.candidate) + '</a> \n</p>\n<p>\n    拥有者: <a href="/uer/preview#' + a.touser.id + '" data-action="profile/open">' + a.touser.englishName + "</a> \n</p>\n" : "Reminder" === e ? (d += "\n\n    ", a.target && a.target.joborder && (d += '\n    <p>\n        <a href="job#detail!id=' + a.target.joborder.id + '">' + a.target.joborder.jobTitle + " (ID: " + a.target.joborder.id + ")</a>\n    </p>\n    "), d += "\n\n    ", a.target && a.target.candidate && (d += "\n    <p>\n        ", candidate = a.target.candidate, d += '\n        <a href="/candidate#detail!id=' + candidate.id + '" target="_blank">' + [candidate.englishName, candidate.chineseName].join(" ") + "</a>\n    </p>\n    "), d += "\n\n    ", a.target && a.target.name && (d += '\n    <p>\n        <a href="/candidate#detail!id=' + a.target.id + '" target="_blank">' + a.target.name + "</a>\n    </p>\n    "), d += "\n\n    ", a.content && (d += "\n    <p>\n        " + a.content + "\n    </p>\n    "), d += "\n\n") : "Offer Signed" === e || "Invoice Added" === e || "Invoice edited" === e || "Invoice To be sent" === e || "Invoice Sent" === e || "Invoice Received" === e || "Job Rejected" === e || "Shortlist" === e ? d += '\n<p>\n    <a href="/job#detail!id=' + a.joborder.id + '" target="_blank">' + a.joborder.jobTitle + " (ID: " + a.joborder.id + ')</a> \n</p>\n<p>\n    <a href="/candidate#detail!id=' + a.candidate.id + '" target="_blank">' + b(a.candidate) + "</a> \n</p>\n" : "Candidate Edited" === e && (d += '\n<p>\n    候选人: <a href="/candidate#detail!id=' + a.candidate.id + '" target="_blank">' + b(a.candidate) + '</a> \n</p>\n<p>\n    编辑者: <a href="/user/preview#' + a.fromuser.id + '" data-action="profile/open">' + a.fromuser.englishName + "</a> \n</p>\n"),
		d
	}
}), define("app/widget/common/notification/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "shared/helper/utils", "template!./main.html"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		b.html(e, b._json, a)
	}
	return b.extend(function (a, b, c) {
		this._json = c
	}, {
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"dom/action.click" : a.noop,
		"dom/action/profile/open.click" : function (b, c) {
			c.preventDefault();
			var e = a(c.target),
			f = e.attr("href");
			d.window({
				url : f,
				name : "User Profile",
				width : "1024"
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/common/people-list/option.html", [], function () {
	return function (a) {
		var b = '<div class="clearfix">\n    <strong>' + [a.englishName, a.chineseName].join(" ").trim() + '</strong>\n    <p class="muted">' + a.title + " @ " + a.company.name + "</p>\n</div>";
		return b
	}
}), define("app/widget/common/people-list/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./option.html", "shared/helper/blurb", "app/widget/common/select2/main"], function (a, b, c, d, e) {
	function f(b) {
		var c = this;
		c.$element.select2({
			placeholder : e.t("Please select"),
			minimumInputLength : 1,
			ajax : {
				url : function () {
					return c.$element.data("url") || "/"
				},
				dataType : "json",
				quietMillis : 100,
				data : function (a, b) {
					return {
						name : a,
						page : b
					}
				},
				results : function (a) {
					var b = a.current < a.pages;
					return {
						results : a.list,
						more : b
					}
				}
			},
			initSelection : function (b, d) {
				var e = a(b).val();
				"" !== e && a.ajax(c.$element.data("url"), {
					data : {
						id : e
					},
					dataType : "json"
				}).done(function (a) {
					a.list.length && d(a.list[0])
				})
			},
			formatResult : function (a) {
				return d(a)
			},
			formatSelection : function (a, b) {
				b.text([a.englishName, a.chineseName].join(" ").trim())
			},
			escapeMarkup : function (a) {
				return a
			}
		}),
		b.resolve()
	}
	return b.extend(function (b) {
		this._id = a(b).data("id")
	}, {
		"sig/start" : function (a, b) {
			f.call(this, b)
		},
		"sig/stop" : function (a, b) {
			this.$element.select2("destroy"),
			b.resolve()
		},
		load : function (a) {
			var b = this;
			b.$element.select2("destroy").html(),
			b.html(d, a, c().done(function () {
					a.forEach(function (a, c) {
						b.$element.find("option").eq(c + 1).data("json", a)
					})
				})),
			b.$element.select2({
				placeholder : "请选择"
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/common/phone/main.html", [], function () {
	return function () {
		var a = '<label for="" class="control-label">\n    <span data-weave="shared/helper/translation" data-i18n="Phone"></span>\n    <span class="f_req">*</span>\n</label>\n<div class="controls mobile">\n    <select name="phones" class="phones input-small" data-action="phone.change">\n        <option value="mobile" data-weave="shared/helper/translation" data-i18n="Mobile"></option>\n        <option value="officeTel" data-weave="shared/helper/translation" data-i18n="Office Tel"></option>\n        <option value="fax" data-weave="shared/helper/translation" data-i18n="Fax"></option>\n    </select>\n    <input type="text" class="input-medium" name="mobile"/>\n    <span class="ext">Ext:&nbsp;<input type="text" class="input-mini"/></span>\n    <span class="hint" data-weave="shared/helper/translation" data-i18n="phone hint"></span>\n    \n</div>\n<div class="controls duplicate-info hide">\n</div>\n<div class="controls text_line">\n    <a id="addphone" href="#" data-action="phone/add">Add another</a>\n</div>';
		return a
	}
}), define("troopjs-requirejs/template!app/widget/common/phone/phone.html", [], function () {
	return function () {
		var a = '<div class="controls">\n    <select name="phones" class="phones input-small" data-action="phone.change">\n        <option value="mobile" data-weave="shared/helper/translation" data-i18n="Mobile"></option>\n        <option value="officeTel" data-weave="shared/helper/translation" data-i18n="Office Tel"></option>\n        <option value="fax" data-weave="shared/helper/translation" data-i18n="Fax"></option>\n    </select>\n    <input type="text" class="input-medium"/>\n    <span class="ext">Ext:&nbsp;<input type="text" class="input-mini"/></span>\n    <a href="#" class="remove" data-action="phone/remove"><i class="icon-remove"></i></a>\n</div>';
		return a
	}
}), define("app/widget/common/phone/main", ["compose", "jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "template!./phone.html", "shared/helper/utils"], function (a, b, c, d, e, f, g) {
	function h() {
		if (m > l) {
			var a = b("#addphone"),
			c = a.closest(".controls"),
			d = b(g());
			d.find("[data-weave]").each(function () {
				b(this).weave()
			}),
			b('select[name="phones"]').each(function () {
				d.find('[value="' + b(this).val() + '"]').remove()
			}),
			c.prev().find('[name="phones"]').prop("disabled", !0),
			c.before(d),
			l++
		}
	}
	function i(a, b) {
		var c = this,
		d = a,
		e = d.split("#");
		h(),
		c.find("select:not(:disabled)").val(b).next("input").attr("name", b).val(e[0]).next().find("input").val(e[1])
	}
	function j(a) {
		var b = this;
		b.html(f, b._json, a)
	}
	function k(a) {
		var b = this,
		c = b.$element;
		b._phone && b._phone.mobile && c.find("input[name=mobile]").val(b._phone.mobile),
		b._phone && b._phone.officeTel && (c.find("select[name=phones]").eq(0).prop("disabled", !0), i.call(c, b._phone.officeTel, "officeTel")),
		b._phone && b._phone.fax && (c.find("select[name=phones]").eq(1).prop("disabled", !0), i.call(c, b._phone.fax, "fax")),
		a.resolve()
	}
	var l = 1,
	m = 3;
	return c.extend(function (a, b, c) {
		var d = this;
		d._phone = c,
		d.getPhoneData = function () {
			var a = this.$element,
			b = a.find('input[name="mobile"]').val(),
			c = a.find('input[name="officeTel"]').val(),
			d = a.find('input[name="officeTel"]').next().find("input").val(),
			e = a.find('input[name="fax"]').val(),
			f = a.find('input[name="fax"]').next().find("input").val();
			return {
				mobile : b || null,
				officeTel : c ? d ? c + "#" + d : c : null,
				fax : e ? f ? e + "#" + f : e : null
			}
		}
	}, {
		"sig/initialize" : function (a, b) {
			j.call(this, b)
		},
		"sig/start" : function (a, b) {
			k.call(this, b)
		},
		"dom/action.click.change" : b.noop,
		"dom/action/phone/add.click" : function (a, c) {
			if (m > l) {
				var d = b(c.target),
				e = d.closest(".controls"),
				f = b(g());
				f.find("[data-weave]").each(function () {
					b(this).weave()
				}),
				b('[name="phones"]').each(function () {
					f.find('[value="' + b(this).val() + '"]').remove()
				}),
				e.prev().find('[name="phones"]').prop("disabled", !0),
				e.before(f),
				e.prev().find('[name="phones"]').trigger("change"),
				l++
			}
			c.preventDefault()
		},
		"dom/action/phone.change" : function (a, c) {
			var d = b(c.target),
			e = d.val(),
			f = d.next(),
			g = d.closest(".controls");
			f.attr("name", e),
			"mobile" === e ? g.addClass("mobile") : g.removeClass("mobile")
		},
		"dom/action/phone/remove.click" : function (a, c) {
			c.preventDefault();
			var d = b(c.target),
			e = d.closest(".controls"),
			f = e.next().find("select[name=phones]");
			window.confirm("Are you really to remove it?") && ((!f.length || f.prop("disabled")) && e.prev().find('[name="phones"]').prop("disabled", !1), e.remove(), l--)
		}
	})
}), define("troopjs-requirejs/template!app/widget/common/share-request/main.html", [], function () {
	return function (a) {
		var b = '<p>\n    <span class="candidate">\n        <span>重复数据:</span>\n        ';
		return b += a.islimited ? "\n        <span>ID - " + a.candidate.id + "</span>\n        " : '\n        <a href="/candidate#detail!id=' + a.candidate.id + '" target="_blank">' + a.candidate.englishName + " " + a.candidate.chineseName + "</a>\n        ",
		b += '\n    </span>\n    \n    <span class="owner">\n        <span>拥有者:</span> <a href="/user/preview#' + a.owner.id + '" data-action="profile/open">' + a.owner.englishName + '</a>\n    </span>\n    \n    <span class="request-share">\n        ',
		b += a.islimited ? '\n        <button class="btn" data-action="auto/share">自动验证共享</button>\n        ' : '\n        <span class="shared">已经共享</span>\n        ',
		b += "\n    </span>\n</p>\n",
		a.candidate.title && a.candidate.company && (b += '\n<p class="title-company">\n    ' + a.candidate.title + ' at <a href="/company#detail!id=' + a.candidate.company.id + '" target="_blank">' + a.candidate.company.name + "</a>\n</p>\n"),
		b += '\n\n<p>\n    <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="Edit" data-action="edit/this(' + a.candidate.id + ')"></button>\n    <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="将附件上传至此候选人" data-action="merge/attachment"></button>\n</p>'
	}
}), define("app/widget/common/share-request/main", ["compose", "jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d, e, f) {
	function g(a, b) {
		var c = this;
		c.html(e, b || c._json, a)
	}
	return c.extend(function (a, b, c) {
		var d = this;
		d._json = c
	}, {
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"dom/action.click" : b.noop,
		"dom/action/auto/share.click" : function (a, c) {
			c.preventDefault();
			var e = this,
			f = b(c.target),
			h = f.closest(".control-group"),
			i = h.find("input"),
			j = i.attr("name"),
			k = i.val();
			e.publish("modal/auto-share/show", {
				type : j,
				val : k,
				onSuccess : function () {
					e.publish("ajax", {
						url : "/rest/candidate/check",
						type : "post",
						data : {
							data : JSON.stringify({
								type : j,
								value : k
							})
						}
					}, d().done(function (a) {
							var b = a.data;
							g.call(e, d(), {
								islimited : !1,
								candidate : {
									englishName : b.englishName,
									chineseName : b.chineseName,
									id : b.id,
									company : b.company,
									title : b.title
								},
								owner : {
									englishName : b.owner.englishName,
									chineseName : b.owner.chineseName,
									id : b.owner.id
								}
							})
						}))
				}
			})
		},
		"dom/action/merge/attachment.click" : function (a, c) {
			c.preventDefault();
			var d = this;
			d.publish("merge/attachment", d._json.candidate.id, b(c.target))
		},
		"dom/action/edit/this.click" : function (a, b, c) {
			b.preventDefault(),
			window.location.hash = "add!id=" + c
		},
		"dom/action/profile/open.click" : function (a, c) {
			c.preventDefault();
			var d = b(c.target),
			e = d.attr("href");
			f.window({
				url : e,
				name : "User Profile",
				width : "1024"
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/common/slide-helper/attachment/main.html", [], function () {
	return function (a) {
		var b = "",
		c = a.hasCheck;
		return b += '\n<aside>\n    <div class="handle ui-resizable-handle ui-resizable-w" data-action="slide/helper/toggle"></div>\n</aside>\n<div class="clearfix btns">\n    <span class="count-info hide">重复数据: <strong class="red"></strong></span>\n    ',
		c && (b += '\n    <button class="btn btn-mini" data-action="attachment/helper/find" data-weave="shared/helper/translation" data-i18n="检查系统内已有人才"></button>\n    '),
		b += '\n    <button class="btn btn-mini" data-action="attachment/helper/popup" data-weave="shared/helper/translation" data-i18n="Fullscreen"></button>\n    <button class="btn btn-mini" data-action="attachment/helper/print" data-weave="shared/helper/translation" data-i18n="Print"></button>\n</div>\n\n<div class="slide-content">\n    <iframe src="" frameborder="0" id="attachment-frame" frameBorder="0"></iframe>\n</div>\n\n<div class="resize-mask"></div>\n\n<div class="slide-close">\n    <a href="#" data-action="slide/helper/close" data-weave="shared/helper/translation(\'title\')" data-i18n="Close"><i class="icon-remove"></i></a>\n</div>'
	}
}), define("app/widget/common/slide-helper/attachment/main", ["jquery", "shared/widget/common/slide-helper/base", "troopjs-utils/deferred", "template!./main.html", "hilitor"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		b.html(d, b._json, a)
	}
	function f(a) {
		var b = this,
		c = b.$element;
		b.$content = c.find(".slide-content"),
		b.$frame = c.find("#attachment-frame"),
		b.$countInfo = b.$element.find(".count-info"),
		b.$count = b.$countInfo.find("strong"),
		b.$frame.on("load", function () {
			c.addClass("open max").removeClass("min"),
			b.$content.removeClass("widget-spin")
		}),
		a.resolve()
	}
	var g = {
		PREVIEW : "/rest/file/preview/<uuidname>",
		IMPORTER_PREVIEW : "/rest/importer/preview?f=<filename>",
		FULL_PREVIEW : "/document/preview#file=<uuidname>",
		FIND : "/rest/document/find_candidate?uuidname=<uuidname>",
		DOWNLOAD : "/rest/file/download/<uuidname>",
		PREVIEW_PDF : "/rest/file/download/<uuidname>?as_attachment=0"
	};
	return b.extend(function (a, b, c) {
		this._json.hasCheck = c
	}, {
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		},
		"sig/start" : function (a, b) {
			f.call(this, b)
		},
		"hub/slide-helper/attachment/reload" : function (a, b, c, d) {
			var e,
			f = this,
			h = f.$element;
			f._uuidname = b,
			f._ext = d,
			f.publish("slide/helper/close"),
			h.removeClass("hide"),
			f.$content.addClass("widget-spin"),
			f.$countInfo.addClass("hide"),
			e = c && "importer" === c ? g.IMPORTER_PREVIEW.replace("<filename>", b) : d && "pdf" === d.toLowerCase() ? g.PREVIEW_PDF.replace("<uuidname>", b) : g.PREVIEW.replace("<uuidname>", b),
			f.$frame.attr("src", e)
		},
		"dom/action/attachment/helper/print.click" : function (a, b) {
			b.preventDefault();
			var c = this;
			c.$frame.get(0).contentWindow.print()
		},
		"dom/action/attachment/helper/popup.click" : function (a, b) {
			b.preventDefault();
			var c,
			d = this;
			c = d._ext && "pdf" === d._ext.toLowerCase() ? g.PREVIEW_PDF.replace("<uuidname>", d._uuidname) : g.FULL_PREVIEW.replace("<uuidname>", d._uuidname),
			this.$element.addClass("hide"),
			window.open(c, "taget=_blank")
		},
		"dom/action/attachment/helper/find.click" : function (b, d) {
			d.preventDefault();
			var e = this,
			f = new Hilitor("attachment-frame", null, !0);
			e.publish("ajax", {
				url : g.FIND.replace("<uuidname>", e._uuidname)
			}, c().done(function (b) {
					var c,
					d = [];
					if (b.email)
						for (c in b.email)
							d.push(c);
					if (b.mobile)
						for (c in b.mobile)
							d.push(c);
					e.$countInfo.removeClass("hide"),
					e.$count.text(b.count),
					f.apply(d.join(" ")),
					a(".hilitor", frames[0].document).on("click", function (c) {
						c.preventDefault(),
						c.stopPropagation();
						var d = a(this).text();
						b.email[d] && window.open("/candidate#detail!id=" + b.email[d], 'target="_blank"'),
						b.mobile[d] && window.open("/candidate#detail!id=" + b.mobile[d], 'target="_blank"')
					})
				}))
		}
	})
}), define("troopjs-requirejs/template!app/widget/common/slide-helper/detail/main.html", [], function () {
	return function () {
		var a = '<div class="slide-content">\n    <div class="inner row-fluid scrollable-content" data-weave="app/widget/candidate/detail/main(true)"></div>\n</div>\n\n<div class="resize-mask"></div>\n\n<div class="slide-close">\n    <a href="#" data-action="slide/helper/close" data-weave="shared/helper/translation(\'title\')" data-i18n="Close"><i class="icon-remove"></i></a>\n</div>';
		return a
	}
}), define("app/widget/common/slide-helper/detail/main", ["compose", "jquery", "shared/widget/common/slide-helper/base", "troopjs-utils/deferred", "template!./main.html"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		b.html(e, a)
	}
	function g(a) {
		var b = this,
		c = b.$element;
		b.$row = c.find(".row-fluid"),
		a.resolve()
	}
	return c.extend({
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"sig/start" : function (a, b) {
			g.call(this, b)
		},
		"dom/action/slide/helper/close.click" : a.around(function (a) {
			return function (b, c) {
				a.call(this, b, c),
				this.id = null
			}
		}),
		"hub/slide-helper/detail/close" : function () {
			var a = this,
			b = a.$element;
			b.removeClass("open max").addClass("hide min"),
			this.id = null
		},
		"hub/candidate/detail/rendered" : function () {
			var a = this;
			a.note ? a.publish("candidate/show/note") : a.publish("candidate/show/resume")
		},
		"hub/slide-helper/detail/reload" : function (a, b, c, d) {
			var e = this,
			f = e.$element;
			e.note = d,
			e.id !== b ? (e.id = b, e.publish("slide/helper/close"), f.addClass("open max").removeClass("hide min"), e.$row.addClass("widget-spin"), e.publish("candidate/slide/detail/id", b)) : e.publish("candidate/detail/rendered")
		}
	})
}), define("troopjs-requirejs/template!app/widget/common/slide-helper/note/main.html", [], function () {
	return function () {
		var a = '<div class="slide-content">\n    <div class="inner row-fluid"></div>\n</div>\n<div class="hide-mask"></div>';
		return a
	}
}), define("app/widget/common/slide-helper/note/main", ["jquery", "shared/widget/common/slide-helper/base", "troopjs-utils/deferred", "template!./main.html"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		b.html(d, a)
	}
	function f(a) {
		var b = this,
		c = b.$element;
		b.$row = c.find(".row-fluid"),
		a.resolve()
	}
	var g = "app/widget/<type>/detail/note-tab/main",
	h = "app/widget/<type>/detail/shortlist-tab/main",
	i = "app/widget/candidate/detail/target-tab/main",
	j = "app/widget/candidate/detail/email-tab/main",
	k = "app/widget/<type>/detail/task-tab/main",
	l = "app/widget/candidate/detail/floating-tab/main",
	m = "app/widget/company/detail/jobs-tab/main",
	n = {
		PEOPLE : "/rest/candidate/<id>"
	};
	return b.extend({
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		},
		"sig/start" : function (a, b) {
			f.call(this, b)
		},
		"hub/slide-helper/note/close" : function () {
			this.$element.addClass("hide")
		},
		"hub/slide-helper/note/reload" : function (a, b, d) {
			var e = this,
			f = e.$element,
			h = c().done(function () {
					e.$element.removeClass("widget-spin")
				});
			e._json = b,
			e.publish("slide/helper/close"),
			e.$element.addClass("widget-spin"),
			f.addClass("open max").removeClass("hide min"),
			e.$row.unweave(c().done(function () {
					"object" == typeof e._json && e.$row.data("content", e._json).attr("data-weave", g.replace("<type>", d) + "(content)").weave(h),
					"number" == typeof e._json && e.publish("ajax", {
						url : n.PEOPLE.replace("<id>", e._json)
					}, c().done(function (a) {
							e.$row.data("content", a).attr("data-weave", g.replace("<type>", d) + "(content)").weave(h)
						}))
				}))
		},
		"hub/slide-helper/shortlist/reload" : function (a, b, d) {
			var e = this,
			f = e.$element,
			g = c().done(function () {
					e.$element.removeClass("widget-spin")
				});
			e.publish("slide/helper/close"),
			e.$element.addClass("widget-spin"),
			f.addClass("open max").removeClass("hide min"),
			e.$row.unweave(c().done(function () {
					e.$row.data("content", e._json).attr("data-weave", h.replace("<type>", d) + "(" + b + ")").weave(g)
				}))
		},
		"hub/slide-helper/target/reload" : function (a, b) {
			var d = this,
			e = d.$element,
			f = c().done(function () {
					d.$element.removeClass("widget-spin")
				});
			d.publish("slide/helper/close"),
			d.$element.addClass("widget-spin"),
			e.addClass("open max").removeClass("hide min"),
			d.$row.unweave(c().done(function () {
					d.$row.attr("data-weave", i + "(" + b + ")").weave(f)
				}))
		},
		"hub/slide-helper/email/reload" : function (a, b) {
			var d = this,
			e = d.$element,
			f = c().done(function () {
					d.$element.removeClass("widget-spin")
				});
			d.publish("slide/helper/close"),
			d.$element.addClass("widget-spin"),
			e.addClass("open max").removeClass("hide min"),
			d.$row.unweave(c().done(function () {
					d.$row.attr("data-weave", j + "(" + b + ")").weave(f)
				}))
		},
		"hub/slide-helper/task/reload" : function (a, b, d) {
			var e = this,
			f = e.$element,
			g = c().done(function () {
					e.$element.removeClass("widget-spin")
				});
			e.publish("slide/helper/close"),
			e.$element.addClass("widget-spin"),
			f.addClass("open max").removeClass("hide min"),
			e.$row.unweave(c().done(function () {
					e.$row.attr("data-weave", k.replace("<type>", d) + "(" + b + ")").weave(g)
				}))
		},
		"hub/slide-helper/floating/reload" : function (a, b) {
			var d = this,
			e = d.$element,
			f = c().done(function () {
					d.$element.removeClass("widget-spin")
				});
			d.publish("slide/helper/close"),
			d.$element.addClass("widget-spin"),
			e.addClass("open max").removeClass("hide min"),
			d.$row.unweave(c().done(function () {
					d.$row.attr("data-weave", l + "(" + b + ")").weave(f)
				}))
		},
		"hub/slide-helper/job/reload" : function (a, b) {
			var d = this,
			e = d.$element,
			f = c().done(function () {
					d.$element.removeClass("widget-spin")
				});
			d.publish("slide/helper/close"),
			d.$element.addClass("widget-spin"),
			e.addClass("open max").removeClass("hide min"),
			d.$row.unweave(c().done(function () {
					d.$row.attr("data-weave", m + "(" + b + ")").weave(f)
				}))
		}
	})
}), define("troopjs-requirejs/template!app/widget/common/source/main.html", [], function () {
	return function (a) {
		for (var b = '<option value="" data-weave="shared/helper/translation" data-i18n="Please select"></option>\n', c = 0, d = a.length; d > c; c++)
			b += '\n<option value="' + a[c].id + '">' + a[c].name + "</option>\n";
		return b
	}
}), define("app/widget/common/source/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		b.publish("ajax", {
			url : f.SOURCE
		}, c().done(function (c) {
				b._json = c,
				b.html(d, b._json, a)
			}))
	}
	var f = {
		SOURCE : "/rest/data/candidatesource/list"
	};
	return b.extend({
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		}
	})
}), define("troopjs-requirejs/template!app/widget/company/add/main.html", [], function () {
	return function (a) {
		var b = "",
		c = this.editMode;
		if (c)
			var d = {
				name1 : a.name1 || "",
				name2 : a.name2 || ""
			},
		e = a.bd ? a.bd.id : "",
		f = a.industry ? a.industry.id : "",
		g = a.industry1 ? a.industry1.id : "",
		h = a.industry2 ? a.industry2.id : "",
		i = a.city ? a.city.id : "",
		j = a.city1 ? a.city1.id : "",
		k = a.city2 ? a.city2.id : "",
		l = {
			ext1 : a.ext1.value ? a.ext1.value : "",
			ext2 : a.ext2.value ? a.ext2.value : "",
			ext3 : a.ext3.value ? a.ext3.value : "",
			ext4 : a.ext4.value ? a.ext4.value : "",
			ext5 : a.ext5.value ? a.ext5.value : "",
			ext6 : a.ext6.value ? a.ext6.value : ""
		};
		b += '\r\n<div class="span12">\r\n    ',
		b += c ? '\r\n    <h3 class="heading" data-weave="shared/helper/translation" data-i18n="Edit Company"></h3>\r\n    ' : '\r\n    <h3 class="heading" data-weave="shared/helper/translation" data-i18n="New Company"></h3>\r\n    ',
		b += '\r\n\r\n    <p class="muted">\r\n        ',
		a.client_need_verify && (b += "\r\n        系统已开启审核功能。新增客户公司后，需要管理员审核通过，才能进行后续操作（如添加公司备注，添加客户联系人以及添加项目）\r\n        "),
		b += '\r\n    </p>\r\n    <form action="#" id="addCandidateForm" class="form-horizontal">\r\n        <fieldset>\r\n\r\n            <div class="control-group">\r\n                <label for="name" class="control-label">\r\n                    ' + this.extraFields.name + '\r\n                    <span class="f_req">*</span>\r\n                </label>\r\n                <div class="controls">\r\n                    <input type="text" id="name" name="name" data-action="check/company" autocomplete="off" value="' + (c ? a.name : "") + '">\r\n                </div>\r\n            </div>\r\n\r\n            ';
		for (var m = 0, n = this.companNames.length; n > m; m++)
			b += "\r\n            ", this.extraFields[this.companNames[m]] && (b += '\r\n            <div class="control-group">\r\n                <label for="' + this.companNames[m] + '" class="control-label">\r\n                    ' + this.extraFields[this.companNames[m]] + '\r\n                </label>\r\n                <div class="controls">\r\n                    <input type="text" id="' + this.companNames[m] + '" name="' + this.companNames[m] + '" data-action="check/company" autocomplete="off" value="' + (c ? d[this.companNames[m]] : "") + '">\r\n                </div>\r\n            </div>\r\n            '), b += "\r\n            ";
		b += '\r\n\r\n            <div class="control-group">\r\n                <div class="controls text_line control-existing hide clearfix" data-weave="app/widget/company/existing/main"></div>\r\n            </div>\r\n\r\n            ';
		for (var m = 0, n = this.extFields.length; n > m; m++)
			b += "\r\n            ", this.extraFields[this.extFields[m]] && (b += '\r\n            <div class="control-group">\r\n                <label for="' + this.extFields[m] + '" class="control-label">\r\n                    ' + this.extraFields[this.extFields[m]] + '\r\n                </label>\r\n                <div class="controls">\r\n                    <input type="text" id="' + this.extFields[m] + '" name="' + this.extFields[m] + '" class="input-large" value="' + (c ? l[this.extFields[m]] : "") + '">\r\n                </div>\r\n            </div>\r\n            '), b += "\r\n            ";
		return b += '\r\n\r\n            <div class="control-group">\r\n                <label for="" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Industry"></span>\r\n                    <span class="f_req">*</span>\r\n                </label>\r\n                <div class="controls clearfix">\r\n                    <div class="comtree span3" data-name="industry" data-url="/rest/data/industry" data-weave="shared/widget/common/comtree/main(' + (c ? f : "") + ')"></div>\r\n                </div>\r\n\r\n                <div class="controls clearfix ',
		(!c || c && "number" != typeof g) && (b += "hide"),
		b += '">\r\n                    <div class="comtree span3" data-name="industry1" data-url="/rest/data/industry" data-weave="shared/widget/common/comtree/main(' + (c ? g : "") + ')"></div>\r\n                    <a href="#" class="remove" data-action="remove/field"><span class="icon-remove"></span></a>\r\n                </div>\r\n\r\n                <div class="controls clearfix ',
		(!c || c && "number" != typeof h) && (b += "hide"),
		b += '">\r\n                    <div class="comtree span3" data-name="industry2" data-url="/rest/data/industry" data-weave="shared/widget/common/comtree/main(' + (c ? h : "") + ')"></div>\r\n                    <a href="#" class="remove" data-action="remove/field"><span class="icon-remove"></span></a>\r\n                </div>\r\n\r\n                <div class="controls text_line">\r\n                    <a href="#" data-action="add/industry" data-weave="shared/helper/translation" data-i18n="Add"></a>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <label class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="City"></span>\r\n                    <span class="f_req">*</span>\r\n                </label>\r\n                <div class="controls clearfix">\r\n                    <div class="comtree span3" data-name="city" data-url="/rest/data/city" data-weave="shared/widget/common/comtree/main(' + (c ? i : "") + ')"></div>\r\n                </div>\r\n                <div class="controls clearfix ',
		(!c || c && !j) && (b += "hide"),
		b += '">\r\n                    <div class="comtree span3" data-name="city1" data-url="/rest/data/city" data-weave="shared/widget/common/comtree/main(' + (c ? j : "") + ')"></div>\r\n                    <a href="#" class="remove" data-action="remove/field"><span class="icon-remove"></span></a>\r\n                </div>\r\n                <div class="controls clearfix ',
		(!c || c && !k) && (b += "hide"),
		b += '">\r\n                    <div class="comtree span3" data-name="city2" data-url="/rest/data/city" data-weave="shared/widget/common/comtree/main(' + (c ? k : "") + ')"></div>\r\n                    <a href="#" class="remove" data-action="remove/field"><span class="icon-remove"></span></a>\r\n                </div>\r\n                <div class="controls controls-add text_line">\r\n                    <a href="#" data-action="add/city" data-weave="shared/helper/translation" data-i18n="Add"></a>\r\n                </div>\r\n            </div>\r\n\r\n            ',
		c || (b += '\r\n            <div class="control-group formSep">\r\n                <label class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Add to Folder"></span>\r\n                </label>\r\n                <div class="controls">\r\n                    <div class="comtree span4" data-name="folder" data-url="/rest/folder/list?type=client" data-weave="shared/widget/common/comtree/main"></div>\r\n                </div>\r\n            </div>\r\n            '),
		b += '\r\n\r\n            <div class="control-group">\r\n                <label class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Company Type"></span>\r\n                    <span class="f_req">*</span>\r\n                </label>\r\n                <div class="controls">\r\n                    <label class="radio inline">\r\n                        <input type="radio" name="type" data-action="type" value="generated"> <span data-weave="shared/helper/translation" data-i18n="generated company"></span>\r\n                    </label>\r\n                    <label class="radio inline">\r\n                        <input type="radio" name="type" data-action="type" value="normal" ',
		c || (b += 'checked="checked"'),
		b += '> <span data-weave="shared/helper/translation" data-i18n="normal company"></span>\r\n                    </label>\r\n                    <label class="radio inline">\r\n                        <input type="radio" name="type" data-action="type" value="bding"> <span data-weave="shared/helper/translation" data-i18n="BDing Client Companies"></span>\r\n                    </label>\r\n                    <label class="radio inline">\r\n                        <input type="radio" name="type" data-action="type" value="client"> <span data-weave="shared/helper/translation" data-i18n="Approved Client Companies"></span>\r\n                    </label>\r\n                </div>\r\n            </div>   \r\n            \r\n            <div class="contract-group hide">\r\n                <div class="control-group control-contract"></div>\r\n            </div>\r\n\r\n            <div class="user-group hide">\r\n                <div class="control-group">\r\n                    <label for="bd" class="control-label" data-weave="shared/helper/translation" data-i18n="BD"></label>\r\n                    <div class="controls">\r\n                        <select data-placeholder="Choose a user..." name="bd" id="bd" class="input-medium" data-weave="shared/widget/common/user-list/main(' + (c ? e : "") + ')">\r\n                        </select>\r\n                    </div>\r\n                </div>\r\n                \r\n                <div class="control-group formSep control-share"></div>\r\n            </div>\r\n                \r\n\r\n            ',
		c && (b += '\r\n            <div class="control-group formSep">\r\n                <label class="control-label" data-weave="shared/helper/translation" data-i18n="Keyin By">\r\n                </label>\r\n                <div class="controls text_line">\r\n                    <a href="/user/preview#' + a.addedBy.id + '" target="_blank">' + a.addedBy.englishName + '</a>\r\n                    <span class="hint">\r\n                        ' + a.dateAdded + "\r\n                    </span>\r\n                </div>\r\n            </div>\r\n            "),
		b += '\r\n\r\n            <div class="control-group">\r\n                <div class="controls">\r\n                    <button class="btn btn-primary" type="submit" data-action="add" data-weave="shared/helper/translation" data-i18n="Save"></button>\r\n                </div>\r\n            </div>\r\n        </fieldset>\r\n    </form>\r\n</div>'
	}
}), define("app/widget/company/add/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "shared/helper/utils", "shared/helper/validate", "shared/helper/blurb"], function (a, b, c, d, e, f, g) {
	function h() {
		var b = this,
		e = [],
		f = c(),
		g = c();
		e.push(f.promise(), g.promise()),
		b.publish("ajax", {
			url : m.VERIFY
		}, f.done(function (a) {
				b._json.client_need_verify = a[0] ? 1 === parseInt(a[0].value, 10) ? !0 : !1 : !1
			})),
		b.publish("ajax", {
			url : m.EXTRA_FIELDS
		}, g.done(function (a) {
				b.extraFields = JSON.parse(a[0].value)
			})),
		d.apply(a, e).done(function () {
			b.editMode ? i.call(b) : j.call(b)
		})
	}
	function i() {
		var b = this,
		e = [],
		f = c(),
		g = c();
		e.push(f.promise(), g.promise()),
		b.publish("ajax", {
			url : m.CLIENT_LIST.replace("<clientId>", b._cid)
		}, f.done(function (a) {
				b._json = a
			})),
		b.publish("ajax", {
			url : m.CONTRACT.replace("<clientId>", b._cid)
		}, g.done(function (a) {
				b._contracts = a
			})),
		d.apply(a, e).done(function () {
			j.call(b)
		})
	}
	function j() {
		var a = this;
		c(function (b) {
			a.html(e, a._json, b)
		}).done(function () {
			k.call(a)
		})
	}
	function k() {
		var b = this,
		d = "";
		a("#bd"),
		c(),
		b.editMode && (d = b._json.share),
		b.$form = b.$element.find("form"),
		b.$userGroup = b.$element.find(".user-group"),
		b.$contractGroup = b.$element.find(".contract-group"),
		b.$name = b.$form.find("#name"),
		b.$name1 = b.$form.find("#name1"),
		b.$name2 = b.$form.find("#name2"),
		b.$existing = b.$form.find(".control-existing"),
		b.$city = b.$form.find('[name="city"]'),
		b.$city1 = b.$form.find('[name="city1"]'),
		b.$city2 = b.$form.find('[name="city2"]'),
		b.$industry = b.$form.find('[name="industry"]'),
		b.$industry1 = b.$form.find('[name="industry1"]'),
		b.$industry2 = b.$form.find('[name="industry2"]'),
		g(b.$form, {
			rules : {
				name : {
					required : !0,
					checkDuplicate : {
						url : m.COMPANY_CHECK,
						type : "get",
						data : {
							name : function () {
								return b.$name.val().trim()
							},
							id : b._json.id || null
						},
						dataFilter : function (a) {
							var b = JSON.parse(a);
							return b.data ? '"该公司已经存在"' : '"true"'
						}
					}
				},
				name1 : {
					checkDuplicate : {
						url : m.COMPANY_CHECK,
						type : "get",
						data : {
							name : function () {
								return b.$name1.val().trim()
							},
							id : b._json.id || null
						},
						dataFilter : function (a) {
							var b = JSON.parse(a);
							return b.data ? '"该公司已经存在"' : '"true"'
						}
					}
				},
				name2 : {
					checkDuplicate : {
						url : m.COMPANY_CHECK,
						type : "get",
						data : {
							name : function () {
								return b.$name2.val().trim()
							},
							id : b._json.id || null
						},
						dataFilter : function (a) {
							var b = JSON.parse(a);
							return b.data ? '"该公司已经存在"' : '"true"'
						}
					}
				},
				type : {
					required : !0
				},
				industry : {
					required : !0
				},
				city : {
					required : !0
				}
			}
		}),
		b.$element.find(".control-contract").data("json", b._contracts).attr("data-weave", n + "(json)").weave(),
		a(".control-share").data("json", d).attr("data-weave", "shared/widget/common/add-share/main(json)").weave(c().done(function () {
				b.editMode && b.$element.find('[name="type"]').filter('[value="' + b._json.type + '"]').trigger("click")
			})),
		f.widgetLoaded.call(b)
	}
	var l,
	m = {
		CLIENT_LIST : "/rest/client/<clientId>",
		ADD : "/rest/client/add",
		VERIFY : "/rest/data/configvalue?keys=client_need_verify",
		COMPANY_SUGGESTION : "/rest/client/list?&paginate_by=1000&company_name=<name>",
		COMPANY_CHECK : "/rest/client/check_exists",
		CONTRACT : "/rest/client/<clientId>/contracts",
		EXTRA_FIELDS : "/rest/data/configvalue?keys=company_field_names"
	},
	n = "app/widget/common/add-contract/main";
	return b.extend({
		extFields : ["ext1", "ext2", "ext3", "ext4", "ext5", "ext6"],
		companNames : ["name1", "name2"],
		"hub:memory/add/id/change" : function (a, b) {
			var c = this;
			c._cid = b,
			c.editMode = c._cid !== l ? !0 : !1,
			h.call(c)
		},
		"dom/action.click.change.input" : a.noop,
		"dom/action/type.change" : function (b, c) {
			var d = this,
			e = a(c.target),
			f = e.val(),
			g = d.$element.find('[name="contract"]');
			"client" === f ? (d.$contractGroup.removeClass("hide"), d.$userGroup.removeClass("hide"), g.length && g.rules("add", {
					required : !0
				})) : "bding" === f ? (d.$contractGroup.addClass("hide"), d.$userGroup.removeClass("hide"), g.length && g.rules("remove")) : (d.$contractGroup.addClass("hide"), d.$userGroup.addClass("hide"), g.length && g.rules("remove"))
		},
		"dom/action/check/company.input" : function (b, d) {
			var e = this,
			f = a(d.target),
			g = f.val().trim();
			g.length >= 1 ? e.publish("ajax", {
				url : m.COMPANY_SUGGESTION.replace("<name>", window.encodeURIComponent(g))
			}, c().done(function (a) {
					var b = a.list;
					e.publish("company/existing/update", b)
				})) : e.publish("company/existing/update")
		},
		"dom/action/add.click" : function (b, d) {
			d.preventDefault();
			var e = this,
			g = a(d.target);
			if (!e.$form.valid())
				return !1;
			var h = a('[name="type"]').filter(":checked").val(),
			i = function () {
				var b = [];
				return e.$element.find('[name="share_with"]').each(function () {
					var c = a(this),
					d = c.val(),
					e = function () {
						var a;
						return c.next().find("select").length ? a = c.next().find("select").val() : c.next().find("input").length && (a = c.next().find("input").val()),
						a
					}
					();
					b.push({
						type : d,
						value : e
					})
				}),
				b
			}
			(),
			j = function () {
				var b = [];
				return a(".contract").each(function () {
					b.push(a(this).data("contract"))
				}),
				b
			}
			(),
			k = {
				name : e.$name.val().trim(),
				type : h,
				industry : e.$industry.val(),
				industry1 : e.$industry1.val(),
				industry2 : e.$industry2.val(),
				city : e.$city.val(),
				city1 : e.$city1.val(),
				city2 : e.$city2.val(),
				shares : i,
				contracts : j,
				ext1 : e.$element.find('[name="ext1"]').val(),
				ext2 : e.$element.find('[name="ext2"]').val(),
				ext3 : e.$element.find('[name="ext3"]').val(),
				ext4 : e.$element.find('[name="ext4"]').val(),
				ext5 : e.$element.find('[name="ext5"]').val(),
				ext6 : e.$element.find('[name="ext6"]').val(),
				folder_id : e.$element.find('[name="folder"]').val()
			};
			e.$name1.length && (k.name1 = e.$name1.val().trim()),
			e.$name2.length && (k.name2 = e.$name2.val().trim()),
			k.bd = "normal" === h || "generated" === h ? null : a("#bd").val(),
			e.editMode && (k.id = e._cid),
			e.publish("ajax", {
				url : m.ADD,
				type : "post",
				data : {
					data : JSON.stringify(k)
				}
			}, c().done(function (a) {
					a.status ? e.editMode ? (f.alert("success", "编辑公司成功!"), window.location.hash = "detail!id=" + e._json.id) : (f.alert("success", "新增公司成功!"), window.location.hash = "list") : f.alert("error", a.message)
				}), g)
		},
		"dom/action/add/industry.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = d.closest(".control-group").find(".controls").filter(".hide").eq(0);
			return e.length ? (e.removeClass("hide"), void 0) : (alert("最多添加3个职能!"), void 0)
		},
		"dom/action/remove/field.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = d.closest(".controls").addClass("hide");
			e.find("input").val(""),
			e.find('[data-woven*="shared/widget/common/comtree/main"]').length && e.find('[data-woven*="shared/widget/common/comtree/main"]').woven()[0].reset()
		},
		"dom/action/add/city.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = d.closest(".control-group").find(".controls").filter(".hide").eq(0);
			return e.length ? (e.removeClass("hide"), void 0) : (alert("最多添加3个城市!"), void 0)
		}
	})
}), define("troopjs-requirejs/template!app/widget/company/detail/changelog/main.html", [], function () {
	return function (a) {
		for (var b = "", c = 0, d = a.length; d > c; c++) {
			var e = a[c],
			f = e.dateAdded.split(" "),
			g = f[0],
			h = f[1],
			i = e.user,
			j = i.id,
			k = i.englishName,
			l = e.log;
			b += '\n<div class="activity-item clearfix">\n    <div class="pull-left span2 activity-time">\n        <p>\n            <span>' + h + "</span>\n            <span>" + g + '</span>\n            <a href="/user/preview#' + j + '" data-action="profile/open">' + k + '</a>\n        </p>\n    </div>\n    <div class="pull-left span10 activity-detail">\n        <div class="well">\n            <div class="content">\n                <ul class="unstyled">\n                    ';
			for (var m in l)
				b += "\n                    ", l.hasOwnProperty(m) && (b += "\n                    <li>" + this.getField(m) + ": <strike>" + this.getValue(m, l[m][0]) + "</strike> " + this.getValue(m, l[m][1]) + "</li>\n                    "), b += "\n                    ";
			b += "\n                </ul>\n            </div>\n        </div>\n    </div>\n</div>\n"
		}
		return b
	}
}), define("app/widget/company/detail/changelog/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "shared/helper/blurb", "shared/helper/utils"], function (a, b, c, d, e, f, g) {
	function h(b) {
		var f = this,
		g = c(),
		h = c(),
		l = [g.promise(), h.promise()];
		f.publish("ajax", {
			url : i.LOG.replace("<id>", f._id)
		}, g.done(function (a) {
				f._json = a,
				f.publish(j, "change", a.length)
			})),
		f.publish("ajax", {
			url : i.EXT
		}, h.done(function (a) {
				var b = JSON.parse(a[0].value);
				for (var c in b)
					k[c] = b[c]
			})),
		d.apply(a, l).done(function () {
			f.html(e, f._json, b)
		})
	}
	var i = {
		LOG : "/rest/updatelog/list?type=client&external_id=<id>",
		EXT : "/rest/data/configvalue?keys=company_field_names"
	},
	j = "company/action/count",
	k = {
		industry : f.t("Industry"),
		industry1 : f.t("Industry"),
		industry2 : f.t("Industry"),
		city : f.t("City"),
		city1 : f.t("City"),
		city2 : f.t("City"),
		type : f.t("Company Type"),
		bd : "BD"
	};
	return b.extend(function (a, b, c) {
		this._id = c
	}, {
		"sig/initialize" : function (a, b) {
			h.call(this, b)
		},
		getField : function (a) {
			var b = "";
			return b = k[a] || a
		},
		getValue : function (a, b) {
			var c = b;
			switch (a) {
			case "type":
				c = f.t(c + " company")
			}
			return c
		},
		"dom/action.click" : a.noop,
		"dom/action/profile/open.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = d.attr("href");
			g.window({
				url : e,
				name : "User Profile",
				width : "1024"
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/company/detail/contract-tab/main.html", [], function () {
	return function (a) {
		var b = "",
		c = this._context.role.toUpperCase(),
		d = "ADMIN" === c,
		e = 0,
		f = a.length;
		for (b += "\n\n", e; f > e; e++) {
			b += "\n";
			var g = a[e];
			b += '\n<div class="span6">\n    <table class="table table-bordered">\n        <colgroup>\n            <col width="35%">\n            <col width="65%">\n        </colgroup>\n        <thead>\n            <tr>\n                <td colspan="2">\n                    ' + g.contractName + "\n                    ",
			this.islimited || d || (b += '\n                    <button class="btn btn-primary btn-mini pull-right" data-action="open/edit/contract(' + g.id + ')">Edit</button>\n                    '),
			b += '\n                </td>\n            </tr>\n        </thead>\n        <tbody>\n            <tr>\n                <td data-weave="shared/helper/translation" data-i18n="Invoice Title"></td>\n                <td>' + g.invoiceTitle + '</td>\n            </tr>\n            <tr>\n                <td data-weave="shared/helper/translation" data-i18n="Fee Structure"></td>\n                <td><pre>' + g.feeStructure + '</pre></td>\n            </tr>\n            <tr>\n                <td data-weave="shared/helper/translation" data-i18n="Probation"></td>\n                <td>' + g.probation + '</td>\n            </tr>\n            <tr>\n                <td data-weave="shared/helper/translation" data-i18n="Start Date"></td>\n                <td>' + g.startDate + '</td>\n            </tr>\n            <tr>\n                <td data-weave="shared/helper/translation" data-i18n="End Date"></td>\n                <td>' + g.expireDate + "</td>\n            </tr>\n        </tbody>\n    </table>\n</div>\n"
		}
		return b += "\n\n",
		this.islimited || d || (b += '\n<div class="span6 add-new" data-action="add/contract">\n    <span data-weave="shared/helper/translation" data-i18n="Add new contract"></span>\n</div>\n'),
		b
	}
}), define("app/widget/company/detail/contract-tab/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "shared/helper/utils", "template!./main.html"], function (a, b, c, d, e, f) {
	function g() {
		var a = this;
		a.publish("ajax", {
			url : h.CONTRACT.replace("<id>", a.id)
		}, c().done(function (b) {
				a._json = b,
				a.html(f, a._json),
				e.widgetLoaded.call(a)
			}))
	}
	var h = {
		CONTRACT : "/rest/client/<id>/contracts",
		ADD_CONTRACT : "/rest/client/contractadd"
	};
	return b.extend(function (a, b, c, d) {
		this.id = c,
		this.islimited = d,
		this._json = []
	}, {
		reload : function () {
			this._json = [],
			g.call(this)
		},
		"hub:memory/context" : function (a, b) {
			var c = this;
			c._context = b.user,
			g.call(c)
		},
		"dom/action.click" : a.noop,
		"dom/action/add/contract.click" : function (b, c) {
			var d = this;
			a(c.target),
			d.publish("modal/add/contract/show", h.ADD_CONTRACT, d.id, function (a) {
				a.status ? (d.publish("company/update/count", "contract"), d.reload()) : e.alert("error", a.message)
			})
		},
		"dom/action/open/edit/contract.click" : function (a, b, c) {
			b.preventDefault();
			var d = this,
			f = function () {
				for (var a, b = 0, e = d._json.length; e > b; b++)
					if (d._json[b].id === c) {
						a = d._json[b];
						break
					}
				return a
			}
			();
			d.publish("modal/add/contract/show", h.ADD_CONTRACT, d.id, function (a) {
				a.status ? d.reload() : e.alert("error")
			}, f)
		}
	})
}), define("troopjs-requirejs/template!app/widget/company/detail/intention-tab/main.html", [], function () {
	return function (a) {
		for (var b = '<table class="table table-striped table-bordered">\n    <colgroup>\n        <col width="">\n        <col width="">\n        <col width="">\n        <col width="">\n        <col width="">\n        <col width="">\n        <col width="70">\n    </colgroup>\n    <thead>\n        <tr>\n            <th data-weave="shared/helper/translation" data-i18n="Name"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Company"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Title"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Note"></th> \n            <th data-weave="shared/helper/translation" data-i18n="Time"></th>\n            <th data-weave="shared/helper/translation" data-i18n="User"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Operation"></th>\n        </tr>\n    </thead>\n    <tbody>\n        ', c = 0, d = a.length; d > c; c++) {
			b += "\n        ";
			var e = a[c];
			b += "\n        <tr>\n            <td>\n                ",
			b += e.candidate.islimited ? "\n                ID: " + e.candidate.id + "\n                " : '\n                <a href="/candidate#detail!id=' + e.candidate.id + '" target="_blank">' + [e.candidate.englishName, e.candidate.chineseName].join(" ").trim() + "</a>\n                ",
			b += '\n            </td>\n            <td><a href="/company#detail!id=' + e.candidate.company.id + '">' + e.candidate.company.name + "</a> ",
			!e.candidate.company.type || "bding" !== e.candidate.company.type && "client" !== e.candidate.company.type || (b += '(<span class="red" data-weave="shared/helper/translation" data-i18n="' + e.candidate.company.type + ' company"></span>)'),
			b += "</td>\n            <td>" + e.candidate.title + "</td>\n            <td>" + e.note + "</td>\n            <td>" + e.date + '</td>\n            <td><a href="/user/preview#' + e.user.id + '" data-action="profile/open">' + e.user.englishName + "</a></td>\n            <td>\n                ",
			this.userId === e.user.id && (b += '\n                <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="Edit" data-action="edit/target(' + c + ')"></button>\n                '),
			b += "\n            </td>\n        </tr>\n        "
		}
		return b += "\n    </tbody>\n</table>"
	}
}), define("app/widget/company/detail/intention-tab/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "shared/helper/utils", "template!./main.html", "jquery.datatables"], function (a, b, c, d, e) {
	function f() {
		var a = this;
		a.publish("ajax", {
			url : g.LIST.replace("<id>", a._id)
		}, c().done(function (b) {
				a._json = b,
				a.html(e, a._json)
			}).always(function () {
				d.widgetLoaded.call(a)
			}))
	}
	var g = {
		LIST : "/rest/candidate/targetcompany/list?client=<id>"
	};
	return b.extend(function (a, b, c) {
		this._id = c
	}, {
		"hub:memory/context" : function (a, b) {
			this.userId = b.user.id,
			f.call(this)
		},
		"dom/action.click" : a.noop,
		"dom/action/profile/open.click" : function (b, c) {
			c.preventDefault();
			var e = a(c.target),
			f = e.attr("href");
			d.window({
				url : f,
				name : "User Profile",
				width : "1024"
			})
		},
		"dom/action/edit/target.click" : function (a, b, d) {
			b.preventDefault();
			var e = this,
			g = e._json[d];
			e.publish("modal/target-company/show", {
				id : g.candidate.id,
				data : g,
				onSuccess : function () {
					f.call(e, c())
				}
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/company/detail/jobs-tab/main.html", [], function () {
	return function () {
		var a = '<div class="search_page">\n    <div class="search_panel clearfix"></div>\n</div>';
		return a
	}
}), define("app/widget/company/detail/jobs-tab/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "shared/helper/utils"], function (a, b, c, d, e, f) {
	function g(b) {
		var f = this;
		f._reference,
		f.publish("ajax", {
			url : i.JOBS.replace("<id>", f._id)
		}, c().done(function (g) {
				var h = g.list,
				i = 0,
				j = h.length,
				k = [];
				f.html(e, c().done(function () {
						var c = f.$element.find(".search_panel");
						for (i; j > i; i++) {
							var e = b.promise();
							c.append('<div class="search_item clearfix"></div>'),
							c.children().last().data("json", h[i]).attr("data-weave", "app/widget/job/item/main(json)").weave(b),
							k.push(e)
						}
						d.apply(a, k).then(function () {
							b.resolve()
						})
					}))
			}))
	}
	function h(a) {
		var b = this;
		f.widgetLoaded.call(b),
		a.resolve()
	}
	var i = {
		JOBS : "rest/joborder/list?ordering=-id&client__id__eq=<id>&paginate_by=1000"
	};
	return b.extend(function (a, b, c) {
		this._id = c
	}, {
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"sig/start" : function (a, b) {
			h.call(this, b)
		},
		"sig/finalize" : function (a, b) {
			var c = this;
			c.$element.empty(),
			b.resolve()
		}
	})
}), define("troopjs-requirejs/template!app/widget/company/detail/main.html", [], function () {
	return function (a) {
		var b = "";
		return a.context.role.toUpperCase(),
		b += '\r\n\r\n<div class="pull-right">\r\n    ',
		a.islimited || (b += '\r\n    <a href="/candidate#add/company=' + a.id + '" target="_blank" class="btn" data-weave="shared/helper/translation" data-i18n="New People"></a>\r\n    <a href="#add!id=' + a.id + '" class="btn" data-weave="shared/helper/translation" data-i18n="Edit"></a>\r\n    '),
		b += '\r\n    <a href="javascript:history.back();" class="btn">\r\n        <i class="icon-arrow-left"></i>\r\n    </a>\r\n</div>\r\n    \r\n<h3 class="heading"><span data-weave="shared/helper/translation" data-i18n="Company Profile"></span> <span id="cid">ID: ' + a.id + '</span></h3>\r\n\r\n<div class="search_page">\r\n    <div class="search_panel clearfix clear">\r\n        <div class="search_item company-item clearfix widget-spin"></div>\r\n    </div>\r\n</div>\r\n\r\n<ul class="nav nav-tabs">\r\n    <li>\r\n        <a href="#note-tab" data-toggle="tab">\r\n            <span class="note-count">' + a.activity_count + '</span>\r\n            <span data-weave="shared/helper/translation" data-i18n="Note"></span>\r\n        </a>\r\n    </li>\r\n    <li class="active">\r\n        <a href="#people-tab" data-toggle="tab">\r\n            <span class="people-count">' + a.people_count + '</span>\r\n            <span data-weave="shared/helper/translation" data-i18n="On Job"></span>\r\n        </a>\r\n    </li>\r\n    <li>\r\n        <a href="#past-people-tab" data-toggle="tab">\r\n            <span class="past-people-count">' + a.past_people_count + '</span>\r\n            <span data-weave="shared/helper/translation" data-i18n="User Leave"></span>\r\n        </a>\r\n    </li>\r\n\r\n    <li>\r\n        <a href="#intention-tab" data-toggle="tab">\r\n            <span class="past-people-count">' + a.candidate_targetcompany_count + '</span>\r\n            <span data-weave="shared/helper/translation" data-i18n="Intention"></span>\r\n        </a>\r\n    </li>\r\n\r\n    ',
		a.job_count && (b += '\r\n    <li>\r\n        <a href="#jobs-tab" data-toggle="tab">\r\n            <span class="jobs-count">' + a.job_count + '</span>\r\n            <span data-weave="shared/helper/translation" data-i18n="Jobs"></span>\r\n        </a>\r\n    </li>\r\n    '),
		b += '\r\n    <li>\r\n        <a data-toggle="tab" href="#task-tab">\r\n            <span>' + a.todo_count + '</span>\r\n            <span data-weave="shared/helper/translation" data-i18n="Task"></span>\r\n        </a>\r\n    </li>\r\n    ',
		!a.islimited && a.contract_count && (b += '\r\n    <li>\r\n        <a href="#contract" data-toggle="tab">\r\n            <span class="contract-count">' + a.contract_count + '</span>\r\n            <span data-weave="shared/helper/translation" data-i18n="Contract"></span>\r\n        </a>\r\n    </li>\r\n    '),
		b += '\r\n\r\n    <li>\r\n        <a href="#change-log" data-toggle="tab">\r\n            <span class="change-count">0</span>\r\n            <span data-weave="shared/helper/translation" data-i18n="Change Log"></span>\r\n        </a>\r\n    </li>\r\n</ul>\r\n\r\n<div class="tab-content">\r\n    <div class="tab-pane" id="note-tab">\r\n        <div id="activity-history" class="widget-spin"></div>\r\n    </div>\r\n    <div class="tab-pane active search_page widget-spin" id="people-tab">\r\n    </div>\r\n    <div class="tab-pane search_page widget-spin" id="past-people-tab"></div>\r\n\r\n    <div class="tab-pane widget-spin" id="intention-tab"></div>\r\n\r\n    ',
		a.job_count && (b += '\r\n    <div class="tab-pane widget-spin" id="jobs-tab"></div>\r\n    '),
		b += '\r\n    <div class="tab-pane widget-spin" id="task-tab"></div>\r\n    ',
		!a.islimited && a.contract_count && (b += '\r\n    <div class="tab-pane widget-spin" id="contract"></div>\r\n    '),
		b += '\r\n    \r\n    <div class="tab-pane" id="change-log">\r\n        <div class="activity-history" data-weave="app/widget/company/detail/changelog/main(' + a.id + ')"></div>\r\n    </div>\r\n</div>'
	}
}), define("app/widget/company/detail/main", ["compose", "jquery", "shared/widget/base/main", "troopjs-utils/deferred", "shared/helper/utils", "template!./main.html"], function (a, b, c, d, e, f) {
	function g() {
		var a = this;
		a.uid && a._context && a.publish("ajax", {
			url : j.CLIENT + a.uid
		}, d().done(function (b) {
				a._json = b,
				a._json.context = a._context,
				h.call(a)
			}))
	}
	function h() {
		var a = this;
		d(function (b) {
			a.html(f, a._json, b)
		}).done(function () {
			i.call(a)
		})
	}
	function i() {
		var a = this,
		c = a.$element;
		a.$contractList = c.find("#contract"),
		a.$noteCount = c.find(".note-count"),
		a.$contactCount = c.find(".contact-count"),
		a.$contractCount = c.find(".contract-count"),
		a.$element.find("#people-tab").attr("data-weave", "app/widget/company/detail/people-tab/main(" + a._json.id + ", true)").weave(),
		a.$element.find(".company-item").data("json", a._json).attr("data-weave", "app/widget/company/item/main(json)").weave(d().done(function () {
				a.$element.find(".company-item").removeClass("widget-spin")
			})),
		b('a[href="#note-tab"]').one("shown", function () {
			a.$element.find("#activity-history").data("reference", a._json).attr("data-weave", "app/widget/company/detail/note-tab/main(reference)").weave()
		}),
		b('a[href="#jobs-tab"]').one("shown", function () {
			a.$element.find("#jobs-tab").attr("data-weave", "app/widget/company/detail/jobs-tab/main(" + a._json.id + ")").weave()
		}),
		b('a[href="#past-people-tab"]').one("shown", function () {
			a.$element.find("#past-people-tab").attr("data-weave", "app/widget/company/detail/past-people-tab/main(" + a._json.id + ", false)").weave()
		}),
		b('a[href="#contract"]').one("shown", function () {
			a.$element.find("#contract").attr("data-weave", "app/widget/company/detail/contract-tab/main(" + a._json.id + "," + a._json.islimited + ")").weave()
		}),
		b('a[href="#task-tab"]').one("shown", function () {
			a.$element.find("#task-tab").attr("data-weave", "app/widget/company/detail/task-tab/main(" + a._json.id + ")").weave()
		}),
		b('a[href="#intention-tab"]').one("shown", function () {
			a.$element.find("#intention-tab").attr("data-weave", "app/widget/company/detail/intention-tab/main(" + a._json.id + ")").weave()
		}),
		e.widgetLoaded.call(a)
	}
	var j = {
		CLIENT : "/rest/client/"
	};
	return c.extend({
		"hub:memory/detail/id/change" : function (a, b) {
			var c = this;
			c.uid = b,
			g.call(c)
		},
		"hub:memory/context" : function (a, b) {
			var c = this;
			d(),
			c._context = b.user,
			g.call(c)
		},
		"hub/company/update/count" : function (a, b) {
			var c = this,
			d = ["$" + b + "Count"];
			c[d].text(parseInt(c[d].text(), 10) + 1)
		},
		"hub:memory/company/action/count" : function (a, b, c) {
			var d = this;
			switch (b) {
			case "change":
				d.$element.find(".change-count").text(c)
			}
		}
	})
}), define("troopjs-requirejs/template!app/widget/company/detail/note-tab/main.html", [], function () {
	return function (a) {
		for (var b = "", c = 0, d = a.length; d > c; c++) {
			b += "\n";
			var e = a[c],
			f = e.dateAdded.split(" "),
			g = f[0],
			h = f[1],
			i = e.user,
			j = i.id;
			b += '\n<div class="activity-item clearfix">\n    <div class="pull-left span2 activity-time">\n        <p>\n            <span>' + h + "</span>\n            <span>" + g + '</span>\n            <a href="/user#' + e.user.id + '" target="_blank">' + e.user.englishName + '</a>\n        </p>\n    </div>\n    <div class="pull-left span10 activity-detail">\n        <div class="well">\n            <div class="title">\n                ',
			e.category && (b += '\n                <span class="label" style="background-color: ' + e.category.color + '">' + e.category.value + "</span>\n                "),
			b += "\n                ",
			j === this._userId && (b += '\n                <button class="btn btn-mini btn-edit" data-weave="shared/helper/translation" data-i18n="Edit" data-action="edit/note(' + c + ')"></button>\n                '),
			b += '\n            </div>\n            <div class="content">\n                ';
			for (var k = 0, l = e.items.length; l > k; k++)
				b += "\n                ", e.items[k].field && (b += "\n                <h4>" + e.items[k].field + "</h4>\n                "), b += "\n                <p>\n                    " + this.convertText(e.items[k].value) + "\n                </p>\n                ";
			b += "\n            </div>\n        </div>\n    </div>\n</div>\n"
		}
		return b
	}
}), define("app/widget/company/detail/note-tab/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "shared/helper/utils", "template!./main.html"], function (a, b, c, d, e) {
	function f() {
		var a = this;
		a.publish("ajax", {
			url : h.REMARK.replace("<id>", a._cid)
		}, c().done(function (b) {
				a._json = b.list,
				a.html(e, a._json, c().done(function () {
						g.call(a)
					}))
			}))
	}
	function g() {
		var a = this;
		d.widgetLoaded.call(a)
	}
	var h = {
		REMARK : "/rest/note/list?paginate_by=200&external_type=client&external_id=<id>"
	};
	return b.extend(function (a, b, c) {
		this._reference = c,
		this._cid = c.id
	}, {
		"hub:memory/context" : function (a, b) {
			var c = this;
			c._userId = b.user.id,
			f.call(c)
		},
		"dom/action.click" : a.noop,
		"dom/action/edit/note.click" : function (a, b, c) {
			b.preventDefault();
			var d = this,
			e = d._json[c];
			d.publish("modal/add-note/show", {
				data : e,
				externalType : "client",
				optionType : "client_note_category",
				id : d._json.id,
				onSuccess : function (a) {
					a.status && f.call(d)
				}
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/company/detail/past-people-tab/main.html", [], function () {
	return function () {
		var a = '<div class="clearfix">\n    <div class="pull-right">\n        <div class="input-prepend">\n            <span class="add-on">\n                <i class="icon-search"></i>\n            </span><input type="text" class="iput-medium" data-weave="shared/helper/translation(\'placeholder\')" data-i18n="Search" data-action="search/people">\n        </div>\n    </div>\n</div>\n\n<div class="search_panel clearfix">\n    <div class="search_item clearfix no-item hide">\n        <p class="text-center">没有符合条件的人才</p>\n    </div>\n</div>';
		return a
	}
}), define("app/widget/company/detail/past-people-tab/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "shared/helper/utils", "template!./main.html"], function (a, b, c, d, e, f) {
	function g(a) {
		var b = this;
		b.publish("ajax", {
			url : i.CONFIG
		}, c().done(function (c) {
				b._hideContact = "1" === c[0].value,
				b.html(f, a)
			}))
	}
	function h(b) {
		var f = this,
		g = f.$element.find(".search_panel"),
		h = f._live ? "&current=latest" : "&current=past";
		f.$noItem = f.$element.find(".no-item"),
		f.publish("ajax", {
			url : i.PEOPLE.replace("<id>", f._id) + h
		}, c().done(function (h) {
				for (var i = h.list, j = [], k = 0, l = i.length; l > k; k++) {
					var m = c();
					m.promise(),
					g.append('<div class="search_item clearfix"></div>'),
					g.children().last().data("json", i[k]).attr("data-weave", "app/widget/candidate/item/main(json, false, " + f._hideContact + ")").weave(m)
				}
				d.apply(a, j).done(function () {
					0 === i.length && g.addClass("hide"),
					b.resolve(),
					e.widgetLoaded.call(f)
				})
			}))
	}
	var i = {
		PEOPLE : "rest/candidate/list?paginate_by=10000&company_id=<id>",
		CONFIG : "/rest/data/configvalue?keys=hide_contactinfo"
	};
	return b.extend(function (a, b, c, d) {
		this._id = c,
		this._live = "undefined" == typeof d ? !0 : d
	}, {
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"sig/start" : function (a, b) {
			h.call(this, b)
		},
		"dom/action.keyup" : a.noop,
		"dom/action/search/people.keyup" : function (b, c) {
			var d = this,
			e = new RegExp(a(c.target).val().trim(), "im");
			d.$list || (d.$list = d.$element.find(".search_item")),
			d.$list.each(function () {
				var b = a(this),
				c = b.text();
				e.test(c) ? b.removeClass("hide") : b.addClass("hide")
			}),
			0 === d.$list.filter(":visible").length ? d.$noItem.removeClass("hide") : d.$noItem.addClass("hide")
		}
	})
}), define("troopjs-requirejs/template!app/widget/company/detail/people-tab/main.html", [], function () {
	return function (a) {
		function b(a) {
			for (var d = 0, e = a.length; e > d; d++)
				c += '\n            <tr data-tt-id="' + a[d].id + '" data-tt-branch="true" ', a[d].parent_id && (c += 'data-tt-parent-id="' + a[d].parent_id + '"'), c += '>\n                <td><span class="label function">' + a[d].name + "</span></td>\n                <td>" + a[d].count + "</td>\n                <td></td>\n                <td></td>\n                <td></td>\n                <td></td>\n                <td></td>\n            </tr>\n", a[d].children.length && b(a[d].children)
		}
		var c = '<p class="text-right">\n    <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="Collapse all" data-action="collapse/all"></button>\n    <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="Expand all" data-action="expand/all"></button>\n</p>\n\n';
		return c += '\n\n<div class="search_panel clearfix">\n    <table class="table">\n        <thead>\n            <tr>\n                <th data-weave="shared/helper/translation" data-i18n="organizationChart"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Count"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Note"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Phone"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Title"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Status"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Last Contact"></th>\n            </tr>\n        </thead>\n        <tbody>\n            ',
		b(a),
		c += "\n        </tbody>\n    </table>\n</div>"
	}
}), define("troopjs-requirejs/template!app/widget/company/detail/people-tab/item.html", [], function () {
	return function (a) {
		for (var b = "", c = 0, d = a.list.length; d > c; c++) {
			var e = a.list[c],
			f = [e.englishName, e.chineseName].join(" ").trim(),
			g = e.mobile || "",
			h = e.mobile1 || "",
			i = e.mobile2 || "",
			j = parseInt(a.context.config.hide_contactinfo);
			b += '\n<tr data-tt-id="' + a.parentId + "-" + e.id + '" data-tt-parent-id="' + a.parentId + '">\n    <td>\n        ',
			e.islimited ? b += "\n        ID: " + e.id + "\n        " : (b += '\n        <a href="/candidate#detail!id=' + e.id + '" target="_blank" class="', "contact" === e.type && (b += "red"), b += '">' + f + "</a>\n        "),
			b += '\n    </td>\n    <td></td>\n    <td>\n        <a href="#" ',
			e.islimited && (b += 'class="disabled"'),
			b += ' data-action="people/note(' + e.id + ')">\n            <span class="icon-comment ',
			b += e.islimited ? "icon-transparent" : "icon-blue",
			b += '"></span>\n            <strong>' + e.note_count + "</strong>\n        </a>\n    </td>\n    <td>\n        ",
			(g || h || i) && (b += "\n            ", j ? (b += "\n            ", g && (b += '\n            <a href="tel:' + g + '">' + g + "</a>\n            "), b += "\n            ", h && (b += '\n            , <a href="tel:' + h + '">' + h + "</a>\n            "), b += "\n            ", i && (b += '\n            , <a href="tel:' + i + '">' + i + "</a>\n            "), b += "\n            ") : (b += '\n            <span class="helper-toggle">\n                <a href="#" data-weave="shared/helper/translation" data-i18n="View" data-action="helper/toggle/show" class="helper-toggle-show"></a>\n                <span class="hide" data-toggle="view">\n                    ', g && (b += '\n                    <a href="tel:' + g + '">' + g + "</a>\n                    "), b += "\n                    ", h && (b += '\n                    , <a href="tel:' + h + '">' + h + "</a>\n                    "), b += "\n                    ", i && (b += '\n                    , <a href="tel:' + i + '">' + i + "</a>\n                    "), b += "\n                </span>\n            </span>\n            "), b += "\n        "),
			b += "\n    </td>\n    <td>" + e.title + "</td>\n    <td>\n        ",
			b += e.status ? '\n        <span class="label status" style="background-color: ' + e.status.color + ';">' + e.status.value + "</span>\n        " : '\n        <span class="label status"></span>\n        ',
			b += '\n    </td>\n    <td class="lastupdate"><span data-toggle="tooltip" title="' + e.lastUpdateDate + '">' + e.lastUpdate + "</span></td>\n</tr>\n"
		}
		return b
	}
}), define("app/widget/company/detail/people-tab/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "shared/helper/utils", "template!./main.html", "template!./item.html", "treetable"], function (a, b, c, d, e, f, g) {
	function h() {
		var a = this;
		a.publish("ajax", {
			url : j.FN_LIST.replace("<cid>", a._cid)
		}, c().done(function (b) {
				a._json = b,
				c(function (b) {
					a.html(f, a._json, b)
				}).done(function () {
					i.call(a)
				})
			}))
	}
	function i() {
		var b = this;
		b.$table = b.$element.find("table"),
		b.$table.treetable({
			expandable : !0,
			onInitialized : function () {
				e.widgetLoaded.call(b)
			},
			onNodeExpand : function () {
				var d = this;
				d.row.data("ttBranch") !== !0 || d.loaded || b.publish("ajax", {
					url : j.PEOPLE_LIST.replace("<cid>", b._cid).replace("<fid>", d.id),
					async : !1
				}, c().done(function (e) {
						var f = a("<div></div>"),
						h = a(g({
									list : e,
									parentId : d.id,
									context : b._context
								}));
						f.append(h),
						h.find("[data-weave]").weave(c().done(function () {
								b.$table.treetable("loadBranch", d, f.html()),
								d.loaded = !0
							}))
					}))
			}
		}),
		b.$element.tooltip({
			selector : '[data-toggle="tooltip"]'
		})
	}
	var j = {
		PEOPLE : "rest/candidate/list?paginate_by=10000&company_id=<id>",
		FN_LIST : "/rest/candidate/function_tree?company_id=<cid>",
		PEOPLE_LIST : "/rest/candidate/function_tree?company_id=<cid>&function_id=<fid>"
	},
	k = '[data-toggle="view"]',
	l = "hide";
	return b.extend(function (a, b, c) {
		this._cid = c
	}, {
		"hub:memory/context" : function (a, b) {
			var c = this;
			c._context = b,
			h.call(c)
		},
		"dom/action.click.mouseover.mouseout" : a.noop,
		"dom/action/add/note.click" : function (b, c, d) {
			c.preventDefault();
			var e = this,
			f = a(c.target);
			e.publish("modal/add-note/show", {
				externalType : "candidate",
				optionType : "candidate_note_category",
				id : d,
				onSuccess : function (a) {
					var b = a.data.status,
					c = f.find(".note-count"),
					d = f.closest("tr");
					c.text(parseInt(c.text(), 10) + 1),
					d.find(".lastupdate").text(e.formatDate(a.data.lastUpdate));
					var g = d.find(".status").eq(0);
					b && g.css("background-color", b.color).text(b.value)
				}
			})
		},
		"dom/action/collapse/all.click" : function () {
			var a = this;
			a.$table.treetable("collapseAll")
		},
		"dom/action/expand/all.click" : function () {
			var a = this;
			a.$table.treetable("expandAll")
		},
		"dom/action/people/note.mouseover.click" : function (b, c, d) {
			c.preventDefault();
			var e = this,
			f = a(c.target);
			return "click" === c.namespace ? (f.hasClass("disabled") || e.publish("modal/add-note/show", {
					externalType : "candidate",
					optionType : "candidate_note_category",
					id : d,
					onSuccess : function () {
						f.find("strong").text(parseInt(f.find("strong").text(), 10) + 1)
					}
				}), void 0) : ("0" != f.find("strong").text() && e.publish("slide-helper/note/reload", d, "candidate"), void 0)
		},
		"dom/action/people/note.mouseout" : function (b, c) {
			c.preventDefault();
			var d = this;
			a(c.target),
			d._json.islimited || d._isAdmin || d.publish("slide-helper/note/close")
		},
		"dom/action/helper/toggle/show.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target);
			d.$element.find(".helper-toggle").find("a").removeClass(l),
			d.$element.find(".helper-toggle").find(k).addClass(l),
			e.addClass(l),
			e.closest(".helper-toggle").find(k).removeClass(l)
		}
	})
}), define("troopjs-requirejs/template!app/widget/company/detail/task-tab/main.html", [], function () {
	return function () {
		var a = '<table class="table table-striped table-bordered">\n    <colgroup>\n        <col width="30">\n        <col width="150">\n        <col width="150">\n        <col>\n        <col width="150">\n        <col width="150">\n        <col width="150">\n        <col width="70">\n    </colgroup>\n    <thead>\n        <tr>\n            <th>\n                <input type="checkbox" data-action="check/all">\n            </th>\n            <th data-weave="shared/helper/translation" data-i18n="Task type"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Task object"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Note"></th> \n            <th data-weave="shared/helper/translation" data-i18n="Date"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Participant"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Creator"></th> \n            <th data-weave="shared/helper/translation" data-i18n="Operation"></th>\n        </tr>\n    </thead>\n    <tbody></tbody>\n</table>';
		return a
	}
}), define("app/widget/company/detail/task-tab/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "shared/helper/utils", "template!./main.html"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		b.html(e, a)
	}
	function g(a) {
		var b = this;
		b.publish("ajax", {
			url : b._url
		}, c().done(function (c) {
				c.list.length && c.list.forEach(function (a) {
					b.appendItem(a)
				}),
				d.widgetLoaded.call(b),
				a.resolve()
			}))
	}
	var h = {
		DONE : "/rest/todo/done"
	};
	return b.extend(function (a, b, c) {
		this._url = "/rest/todo/list?external_type=client&external_id=" + c
	}, {
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"sig/start" : function (a, b) {
			var c = this;
			g.call(c, b)
		},
		"hub/add/task/count" : function () {
			var a = this;
			a.$element.find("tbody").children().remove(),
			g.call(a, c())
		},
		appendItem : function (a) {
			var b = this;
			b.$element.find("tbody").append("<tr></tr>"),
			b.$element.find("tbody").children().last().data("json", a).attr("data-weave", "app/widget/task/item(json)").weave()
		},
		"dom/action.change" : a.noop,
		"dom/action/check/all.change" : function (b, e) {
			var f,
			g = this,
			i = a(e.target),
			j = i.is(":checked"),
			k = [];
			j ? (f = g.$element.find("tbody :checkbox").filter(":not(:disabled)").filter(":not(:checked)"), f.prop("checked", !0)) : (f = g.$element.find("tbody :checkbox").filter(":not(:disabled)").filter(":checked"), f.prop("checked", !1)),
			f.each(function () {
				k.push(a(this).data("id"))
			}),
			k.length && g.publish("ajax", {
				url : h.DONE,
				data : {
					data : JSON.stringify({
						ids : k,
						done : j
					})
				},
				type : "POST"
			}, c().done(function (a) {
					a.status ? d.alert("success", "任务状态更改成功!") : d.alert("error", a.data || a.message)
				}))
		}
	})
}), define("troopjs-requirejs/template!app/widget/company/existing/main.html", [], function () {
	return function (a) {
		var b = '<p class="text-error"><span data-weave="shared/helper/translation" data-i18n="已存在的名称相似公司"></span></p>\n\n<div class="well well-small">\n    ',
		c = 0,
		d = a.length,
		e = 15;
		for (b += "\n    "; e > c && d > c; ) {
			b += "\n    ";
			var f = a[c];
			b += '\n    <div class="clearfix">\n        <p>\n            <span><a href="/company#detail!id=' + f.id + '" target="_blank" class="',
			f.type && "normal" !== f.type && "generated" !== f.type && (b += "red"),
			b += '">' + f.name + "</a></span>&nbsp;&nbsp;&nbsp;&nbsp;\n\n            ",
			f.type && "normal" !== f.type && "generated" !== f.type && (b += '\n            <span class="red" data-i18n="' + f.type + ' company" data-weave="shared/helper/translation"></span>\n            '),
			b += "&nbsp;&nbsp;\n\n            ",
			f.bd && (b += '\n            <span class="muted">BD: <a href="/user/preview#' + f.bd.id + '" data-action="profile/open">' + f.bd.englishName + "</a></span>\n            &nbsp;&nbsp;\n            "),
			b += '\n\n            <span class="muted">' + f.people_count + "人才</span>&nbsp;&nbsp;\n\n            ",
			f.city && f.city.name && (b += '\n            <span class="muted">' + f.city.name + "</span>&nbsp;&nbsp;\n            "),
			b += "\n\n            ",
			f.industry && f.industry.id && (b += '\n            <span class="label industry" title="' + f.industry.name, f.industry1 && (b += ", " + f.industry1.name), f.industry2 && (b += ", " + f.industry2.name), b += '">' + f.industry.name, (f.industry1 || f.industry2) && (b += "..."), b += "</span>\n            &nbsp;&nbsp;\n            "),
			b += '\n            \n            \n            <span class="muted">添加者:</span> <a href="user/preview#' + f.addedBy.id + '" data-action="profile/open">' + f.addedBy.englishName + '</a>&nbsp;&nbsp;\n            <span class="muted">(' + f.dateAdded + ")</span>&nbsp;&nbsp;\n        </p>\n\n        ",
			f.name1 && (b += '\n        <span class="muted">' + f.name1 + "</span>&nbsp;&nbsp;&nbsp;&nbsp;\n        "),
			b += "\n        ",
			f.name2 && (b += '\n        <span class="muted">' + f.name2 + "</span>\n        "),
			b += "\n    </div> \n    ",
			c++,
			b += "\n    "
		}
		return b += "\n</div>"
	}
}), define("app/widget/company/existing/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d, e) {
	return b.extend({
		"hub/company/existing/update" : function (a, b) {
			var e = this;
			b && b.length ? e.html(d, b, c().done(function () {
					e.$element.find(".industry").tooltip(),
					e.$element.removeClass("hide")
				})) : e.$element.addClass("hide")
		},
		"dom/action.click" : a.noop,
		"dom/action/profile/open.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			f = d.attr("href");
			e.window({
				url : f,
				name : "User Profile",
				width : "1024"
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/company/filter/main.html", [], function () {
	return function () {
		var a = '<ul class="nav nav-pills line_sep">\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Company Name"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <input type="text" class="input-medium" autocomplete="off">\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'company_name\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="City"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <div class="comtree span" data-name="city_id" data-url="/rest/data/city" data-weave="shared/widget/common/comtree/main"></div>\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'city_id\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Industry"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <div class="comtree span" data-name="industry_id" data-url="/rest/data/industry" data-weave="shared/widget/common/comtree/main"></div>\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'industry_id\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Company Type"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <select name="type__eq">\r\n                        <option value="generated" data-weave="shared/helper/translation" data-i18n="generated company"></option>\r\n                        <option value="normal" data-weave="shared/helper/translation" data-i18n="normal company"></option>\r\n                        <option value="bding" data-weave="shared/helper/translation" data-i18n="BDing Client Companies"></option>\r\n                        <option value="client" data-weave="shared/helper/translation" data-i18n="Approved Client Companies"></option>\r\n                    </select>\r\n                </div>\r\n\r\n                <button class="btn" type="submit" data-action="form(\'type__eq\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="User"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <select data-placeholder="Choose a user..." name="name" class="input-large" data-weave="shared/widget/common/user-list/main">\r\n                    </select>\r\n                </div>\r\n                <div class="control-group">\r\n                    <select name="type">\r\n                        <option value="bd__eq" data-weave="shared/helper/translation" data-i18n="BD"></option>\r\n                        <option value="user_id" data-weave="shared/helper/translation" data-i18n="BD and Shared"></option>\r\n                        <option value="addedBy__eq" data-weave="shared/helper/translation" data-i18n="Keyin"></option>\r\n                        <option value="share_id" data-weave="shared/helper/translation" data-i18n="Shared"></option>\r\n                    </select>\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'user\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Team"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <div class="comtree span" data-name="team_id" data-url="/rest/data/team" data-weave="shared/widget/common/comtree/main"></div>\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'team_id\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n\r\n    ';
		if (this.needVerify && (a += '\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Verify Status"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <select name="verifystatus">\r\n                        <option value="TobeVerified" data-weave="shared/helper/translation" data-i18n="To be Verified"></option>\r\n                        <option value="Verified" data-weave="shared/helper/translation" data-i18n="Client Verified"></option>\r\n                        <option value="VerifyInvalid" data-weave="shared/helper/translation" data-i18n="Client Verified Invalid"></option>\r\n                    </select>\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'verifystatus\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    '), a += '\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Folder"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <div class="comtree span" data-name="folder_id" data-weave="shared/widget/common/comtree/main" data-hub="update/client/folder"></div>\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'folder_id\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Attachment Type"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <select name="attachment_type" data-type="company" data-weave="app/widget/common/attachment-type/main"></select>\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'attachment_type\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    ', this._hasExtra) {
			a += '\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Other Fields"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <select name="ext-type" class="input-large">\r\n                        <option value="" data-weave="shared/helper/translation" data-i18n="Please select"></option>\r\n                        ';
			for (var b = 0, c = this.extFields.length; c > b; b++)
				a += "\r\n                        ", this.extraFields[this.extFields[b]] && (a += '\r\n                        <option value="' + this.extFields[b] + '__icontains">' + this.extraFields[this.extFields[b]] + "</option>\r\n                        "), a += "\r\n                        ";
			a += '\r\n                    </select>\r\n                </div>\r\n                <div class="control-group">\r\n                    <input type="text" name="ext-value" class="input-large">\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'ext\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    '
		}
		return a += '\r\n</ul>\r\n\r\n<p class="sepH_b">\r\n    <span class="tag label label-info deletable hide" data-query="company_name" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Company Name"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="city_id" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="City"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="industry_id" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Industry"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="type__eq" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Company Type"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="user" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="User"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="team_id" data-action="tag/remove"><b data-i18n="Team" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="verifystatus" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Verify Status"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="folder_id" data-action="tag/remove"><b data-i18n="Folder" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="attachment_type" data-action="tag/remove"><b data-i18n="Attachment Type" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="ext" data-action="tag/remove"><b data-i18n="Other Fields" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <a href="#" class="hide save-filter" data-action="filter/save/toggle" data-weave="shared/helper/translation" data-i18n="Save as"></a>\r\n</p>\r\n\r\n<form action="#" class="form-horizontal save-filter-form hide">\r\n    <input type="text" class="input-medium">\r\n    <button class="btn" data-action="filter/save" data-weave="shared/helper/translation" data-i18n="Save"></button>\r\n    <button class="btn" data-action="filter/save/toggle" data-weave="shared/helper/translation" data-i18n="Close">Close</button>\r\n</form>'
	}
}), define("app/widget/company/filter/main", ["compose", "jquery", "shared/widget/filter/base", "troopjs-utils/deferred", "troopjs-utils/when", "shared/helper/utils", "template!./main.html", "shared/widget/filter/query"], function (a, b, c, d, e, f, g, h) {
	function i() {
		h.addAttr({
			company_name : function (a) {
				var c = b.trim(a.find("input").val());
				c.length && this.addQuery("company_name", "company_name=" + encodeURIComponent(c))
			},
			city_id : function (a) {
				var b = a.find('[name="city_id"]').val();
				b.length && this.addQuery("city_id", "city_id=" + b)
			},
			industry_id : function (a) {
				var b = a.find('[name="industry_id"]').val();
				b.length && this.addQuery("industry_id", "industry_id=" + b)
			},
			type__eq : function (a) {
				var b = a.find('select[name="type__eq"]').val();
				b.length && this.addQuery("type__eq", "type__eq=" + b)
			},
			user : function (a) {
				var b = a.find('select[name="type"]').val(),
				c = a.find('select[name="name"]').val();
				b.length && c.length && this.addQuery("user", b + "=" + c)
			},
			verifystatus : function (a) {
				var b = a.find("select :selected").val();
				b.length && this.addQuery("verifystatus", "verifystatus=" + b)
			},
			folder_id : function (a) {
				var b = a.find('[name="folder_id"]').val();
				b.length && this.addQuery("folder_id", "folder_id=" + b)
			},
			ext : function (a) {
				var b = a.find('select[name="ext-type"] :selected').val(),
				c = a.find("input").val();
				b.length && c.length && this.addQuery("ext", b + "=" + window.encodeURIComponent(c))
			},
			team_id : function (a) {
				var b = a.find('[name="team_id"]').val();
				b.length && this.addQuery("team_id", "team_id=" + b)
			},
			attachment_type : function (a) {
				var b = a.find("select").val();
				b.length && this.addQuery("attachment_type", "attachment_type=" + encodeURIComponent(b))
			}
		})
	}
	function j(a) {
		var b,
		c,
		d,
		e = this,
		f = a[0],
		g = a[1];
		switch (f) {
		case "bd__eq":
		case "user_id":
		case "addedBy__eq":
		case "share_id":
			c = e.$element.find('select[name="type"]').find('[value="' + a[0] + '"]').text(),
			d = e.$element.find('select[name="name"]').find('[value="' + g + '"]').text(),
			e.$element.find('[data-query="user"]').removeClass("hide").find("span").text(d + " - " + c),
			h.addQuery("user", a[0] + "=" + g);
			break;
		case "ext1__icontains":
		case "ext2__icontains":
		case "ext3__icontains":
		case "ext4__icontains":
		case "ext5__icontains":
		case "ext6__icontains":
			c = e.$element.find('select[name="ext-type"] [value="' + a[0] + '"]').text(),
			e.$element.find('[data-query="ext"]').removeClass("hide").find("span").text(c + " - " + window.decodeURIComponent(g)),
			h.addQuery("ext", f + "=" + g);
			break;
		case "type__eq":
		case "verifystatus":
		case "attachment_type":
			b = e.$element.find('[name="' + f + '"] [value="' + decodeURIComponent(g) + '"]').text(),
			e.$element.find('[data-query="' + f + '"]').removeClass("hide").find("span").text(b),
			h.addQuery(f, f + "=" + g);
			break;
		case "city_id":
		case "industry_id":
		case "team_id":
		case "folder_id":
			b = e.$element.find('[data-name="' + f + '"]').woven()[0].getNodeNameById(window.decodeURIComponent(g)),
			e.$element.find('[data-query="' + f + '"]').removeClass("hide").find("span").text(b),
			h.addQuery(f, f + "=" + g);
			break;
		case "byfilter":
			break;
		default:
			e.$element.find('[data-query="' + f + '"]').removeClass("hide").find("span").text(window.decodeURIComponent(g)),
			h.addQuery(f, f + "=" + g)
		}
	}
	function k(a) {
		var c = this,
		f = [],
		h = d(),
		i = d();
		f.push(h.promise(), i.promise()),
		c.publish("ajax", {
			url : n.EXTRA_FIELDS
		}, h.done(function (a) {
				c.extraFields = JSON.parse(a[0].value),
				c._hasExtra = function () {
					var a = !1;
					for (var b in c.extraFields)
						if (c.extraFields[b]) {
							a = !0;
							break
						}
					return a
				}
				()
			})),
		c.publish("ajax", {
			url : n.NEED_VERIFY
		}, i.done(function (a) {
				c.needVerify = "1" === a[0].value
			})),
		e.apply(b, f).done(function () {
			d(function (a) {
				c.html(g, this._json, a)
			}).done(function () {
				l.call(c, a)
			})
		})
	}
	function l(a) {
		var b = this;
		b.folderWidget = b.$element.find('[data-name="folder"]').woven()[0],
		a.resolve()
	}
	function m() {
		var a = this;
		a.city = null
	}
	var n = {
		SAVE_FILTER : "/rest/data/queryfilter/client/add",
		EXTRA_FIELDS : "/rest/data/configvalue?keys=company_field_names",
		NEED_VERIFY : "/rest/data/configvalue?keys=client_need_verify"
	};
	return c.extend(function () {
		var a = this;
		m.call(a),
		h.url = n.SAVE_FILTER,
		a._setFilter = j,
		i.call(a)
	}, {
		extFields : ["ext1", "ext2", "ext3", "ext4", "ext5", "ext6"],
		"sig/initialize" : function (a, b) {
			k.call(this, b)
		},
		"hub:momery/filter/set" : a.around(function (a) {
			return function (b, c) {
				a.call(this, b, c),
				m.call(this)
			}
		})
	})
}), define("troopjs-requirejs/template!app/widget/company/item/detail.html", [], function () {
	return function (a) {
		var b,
		c,
		d = "",
		e = a.verifystatus,
		f = a.islimited,
		g = a.type,
		h = "",
		i = "icon-blue",
		j = this._context.user.role.toUpperCase(),
		k = "ADMIN" === j,
		l = this.isList;
		switch (g) {
		case "bding":
			b = "label-info";
			break;
		case "client":
			b = "label-red"
		}
		switch (e) {
		case "TobeVerified":
			c = "To be Verified";
			break;
		case "Verified":
			c = "Client Verified",
			h = "approved";
			break;
		case "VerifyInvalid":
			c = "Client Verified Invalid",
			h = "label-inverse"
		}
		f && (i = "icon-transparent");
		var m = (new Date).getTime();
		d += '\r\n<div class="search_content full-width">\r\n    <div class="search_item_tags pull-right clearfix">\r\n        ',
		k && (d += "\r\n        ", "normal" !== a.type && "generated" !== a.type && (d += '\r\n        <div class="btn-group">\r\n            ', this.needVerify && (d += '\r\n            <button class="btn btn-small dropdown-toggle" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Valid"></button>\r\n            '), d += '\r\n            <ul class="dropdown-menu">\r\n                <li>\r\n                    <label class="radio">\r\n                        <input type="radio" name="approve-radio_' + m + '" value="TobeVerified">\r\n                        <span data-weave="shared/helper/translation" data-i18n="To be Verified"></span>\r\n                    </label>\r\n                </li>\r\n                <li>\r\n                    <label class="radio">\r\n                        <input type="radio" name="approve-radio_' + m + '" value="Verified">\r\n                        <span data-weave="shared/helper/translation" data-i18n="Client Verified"></span>\r\n                    </label>\r\n                </li>\r\n                <li>\r\n                    <label class="radio">\r\n                        <input type="radio" name="approve-radio_' + m + '" value="VerifyInvalid">\r\n                        <span data-weave="shared/helper/translation" data-i18n="Client Verified Invalid"></span>\r\n                    </label>\r\n                </li>\r\n                <li class="divider"></li>\r\n                <li>\r\n                    <button class="btn" data-i18n="Save" data-action="approve/action" data-weave="shared/helper/translation"></button>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n        '), d += "\r\n        "),
		d += "\r\n\r\n        ",
		this.needVerify && e && (d += '\r\n        <span class="label ' + h + '" data-weave="shared/helper/translation" data-i18n="' + c + '"></span>&nbsp;\r\n        '),
		d += '\r\n        <span class="label ' + b + '" data-weave="shared/helper/translation" data-i18n="' + g + " company" + '"></span>&nbsp;\r\n        ',
		a.industry && a.industry.id && (d += '\r\n        <span class="label industry" title="' + a.industry.name, a.industry1 && (d += ", " + a.industry1.name), a.industry2 && (d += ", " + a.industry2.name), d += '">' + a.industry.name, (a.industry1 || a.industry2) && (d += "..."), d += "</span>\r\n        "),
		d += '\r\n    </div>\r\n\r\n    <div class="pull-left item-title">\r\n\r\n        ',
		"undefined" != typeof this.viewType && (d += '\r\n        <input type="checkbox" data-action="list/check">\r\n        '),
		d += '\r\n\r\n        <a href="/company#detail!id=' + a.id + '" class="title">' + a.name + '</a>\r\n        <a href="/company#detail!id=' + a.id + '" target="_blank" title="Open in new tab"><span class="icon-new-window icon-blue"></span></a>\r\n        ',
		a.city && (d += "\r\n        <span>(" + a.city.name + ")</span>\r\n        "),
		d += '\r\n\r\n        <span class="muted">(<span data-weave="shared/helper/translation" data-i18n="On Job"></span>: ' + a.people_count + ')</span>\r\n        <span class="muted">(<span data-weave="shared/helper/translation" data-i18n="User Leave"></span>: ' + a.past_people_count + ')</span>\r\n        <span class="muted">(<span data-weave="shared/helper/translation" data-i18n="Intention"></span>: ' + a.candidate_targetcompany_count + ")</span>\r\n\r\n        ",
		f || (d += '\r\n        <span class="dropdown" data-weave="app/widget/common/attachment-view/main(' + a.attachment_count + ", 'clientcompany', " + a.id + ')"></span>\r\n        '),
		d += "\r\n\r\n        ",
		f || (d += '\r\n        <a href="/company#add!id=' + a.id + '" target="_blank" class="content-actions" data-weave="shared/helper/translation(\'title\')" data-i18n="Edit">\r\n            <i class="icon-edit icon-blue"></i>\r\n        </a>\r\n        '),
		d += '\r\n    </div>\r\n\r\n    <div class="sepH_b item_description muted">\r\n        ',
		a.name1 && (d += "\r\n        <span>" + a.name1 + "</span>\r\n        "),
		d += "\r\n        ",
		a.name2 && (d += "\r\n        <span>" + a.name2 + "</span>\r\n        "),
		d += '\r\n    </div>\r\n\r\n    <div class="sepH_b item_description">\r\n        ';
		for (var n = 1; 6 >= n; n++) {
			var o = "ext" + n;
			a[o].field && a[o].value && (d += "\r\n        <span>\r\n            " + a[o].field + ': \r\n            <span class="muted">' + this.parseValue(a[o].value) + "</span>\r\n        </span>\r\n        "),
			d += "\r\n        \r\n        "
		}
		return d += '\r\n    </div>\r\n\r\n    <ul class="inline pull-right line_sep muted">\r\n        ',
		a.bd && (d += '\r\n        <li>\r\n            <span>BD: <a href="/user/preview#' + a.bd.id + '" data-action="profile/open">' + a.bd.englishName + "</a></span>\r\n        </li>\r\n        "),
		d += '\r\n    </ul>\r\n\r\n    <ul class="nav nav-pills line_sep actions">\r\n        <li>\r\n            <a href="#" data-action="note" data-preview="' + l + '">\r\n                <i class="icon-comment icon-blue"></i>\r\n                <b class="note-count">' + a.activity_count + '</b>\r\n                <span data-weave="shared/helper/translation" data-i18n="Note"></span>\r\n            </a>\r\n        </li>\r\n        ',
		"normal" !== g && "generated" !== g && (d += "\r\n        <li ", f && (d += 'class="disabled"'), d += '>\r\n            <a href="#" data-action="add/contract">\r\n                <i class="icon-flag ' + i + '"></i>\r\n                <b class="contract-count">' + a.contract_count + '</b>\r\n                <span data-weave="shared/helper/translation" data-i18n="Contract"></span>\r\n            </a>\r\n        </li>\r\n        '),
		d += '\r\n        <li>\r\n            <a href="#" data-action="task" data-preview="' + l + '">\r\n                <i class="icon-time icon-blue"></i>\r\n                <b class="task-count">' + a.todo_count + '</b>\r\n                <span data-weave="shared/helper/translation" data-i18n="Task"></span>\r\n            </a>\r\n        </li>\r\n        <li>\r\n            <a href="#" data-action="job" data-preview="' + l + '">\r\n                <i class="icon-share icon-blue"></i>\r\n                <b class="job-count">' + a.job_count + '</b>\r\n                <span data-weave="shared/helper/translation" data-i18n="Job"></span>\r\n            </a>\r\n        </li>\r\n        <li>\r\n            <a href="#" data-action="add/to/folder">\r\n                <i class="icon-folder-open icon-blue"></i>\r\n                <b class="folder-count">' + a.folders.length + '</b>\r\n                <span data-weave="shared/helper/translation" data-i18n="Folder"></span>\r\n                <span class="muted">' + this.getFolderName(a.folders) + "</span>\r\n            </a>\r\n        </li>\r\n    </ul>\r\n</div>"
	}
}), define("troopjs-requirejs/template!app/widget/company/item/list.html", [], function () {
	return function (a) {
		var b,
		c,
		d = "",
		e = a.verifystatus,
		f = a.islimited,
		g = a.type,
		h = "",
		i = "icon-blue";
		switch (this._context.user.role.toUpperCase(), g) {
		case "bding":
			b = "label-info";
			break;
		case "client":
			b = "label-red"
		}
		switch (e) {
		case "TobeVerified":
			c = "To be Verified";
			break;
		case "Verified":
			c = "Client Verified",
			h = "approved";
			break;
		case "VerifyInvalid":
			c = "Client Verified Invalid",
			h = "label-inverse"
		}
		return f && (i = "icon-transparent"),
		(new Date).getTime(),
		d += "\n<td>\n    ",
		"undefined" != typeof this.viewType && (d += '\n    <input type="checkbox" data-action="list/check">\n    '),
		d += "\n</td>\n<td>\n    ",
		f || (d += '\n    <span class="dropdown" data-weave="app/widget/common/attachment-view/main(' + a.attachment_count + ", 'clientcompany', " + a.id + ')"></span>\n    '),
		d += '\n</td>\n<td>\n    <a href="/company#detail!id=' + a.id + '" class="title">' + a.name + '</a>\n    <a href="/company#detail!id=' + a.id + '" target="_blank" title="Open in new tab"><span class="icon-new-window icon-blue"></span></a>\n</td>\n<td>\n    <a href="#" data-action="add/remark">\n        <i class="icon-comment ' + i + '"></i>\n        <b class="remark-count">' + a.activity_count + "</b> \n    </a>\n</td>\n<td>\n    ",
		a.city && (d += "\n        " + a.city.name + "\n    "),
		d += "\n</td>\n<td>\n    ",
		a.industry && a.industry.id && (d += '\n    <span class="label industry" title="' + a.industry.name, a.industry1 && (d += ", " + a.industry1.name), a.industry2 && (d += ", " + a.industry2.name), d += '">' + a.industry.name, (a.industry1 || a.industry2) && (d += "..."), d += "</span>\n    "),
		d += "\n</td>\n<td>" + a.people_count + "</td>\n<td>" + a.past_people_count + "</td>\n<td>" + a.candidate_targetcompany_count + '</td>\n<td><span class="label ' + b + '" data-weave="shared/helper/translation" data-i18n="' + g + " company" + '"></span></td>\n<td>\n    <div class="dropdown">\n        <a href="javascript: void(0);" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-list-alt"></i> <i class="caret"></i></a>\n        <ul class="dropdown-menu">\n            ',
		f || (d += '\n            <li>\n                <a href="/company#add!id=' + a.id + '" target="_blank" data-weave="shared/helper/translation" data-i18n="Edit Company"></a>\n            </li>\n            '),
		d += "\n            ",
		"normal" !== g && "generated" !== g && (d += "\n            <li ", f && (d += 'class="disabled"'), d += '>\n                <a href="#" data-action="add/contract">\n                    <b class="contract-count">' + a.contract_count + '</b>\n                    <span data-weave="shared/helper/translation" data-i18n="Contract"></span>\n                </a>\n            </li>\n            '),
		d += '\n            <li>\n                <a href="#" data-action="task">\n                    <b class="task-count">' + a.todo_count + '</b>\n                    <span data-weave="shared/helper/translation" data-i18n="Task"></span>\n                </a>\n            </li>\n            <li>\n                <a href="#" data-action="job">\n                    <b class="job-count">' + a.job_count + '</b>\n                    <span data-weave="shared/helper/translation" data-i18n="Job"></span>\n                </a>\n            </li>\n            <li>\n                <a href="#" data-action="add/to/folder">\n                    <b class="folder-count">' + a.folders.length + '</b>\n                    <span data-weave="shared/helper/translation" data-i18n="Folder"></span>\n                </a>\n            </li>\n        </ul>\n    </div>\n</td>'
	}
}), define("app/widget/company/item/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "shared/helper/utils", "template!./detail.html", "template!./list.html"], function (a, b, c, d, e, f, g) {
	function h() {
		var a = this;
		a.publish("ajax", {
			url : n.CLIENT.replace("<id>", a.uid)
		}, c().done(function (b) {
				a._json = b,
				i.call(a)
			}))
	}
	function i() {
		var a = this;
		a.publish("ajax", {
			url : n.NEED_VERIFY
		}, c().done(function (b) {
				a.needVerify = "1" === b[0].value,
				c(function (b) {
					a.viewType ? a.html(g, a._json, b) : a.html(f, a._json, b)
				}).done(function () {
					j.call(a)
				})
			}))
	}
	function j() {
		var b = this,
		c = b.$element;
		b.$noteCount = c.find(".note-count"),
		b.$contractCount = c.find(".contract-count"),
		b.$folderCount = c.find(".folder-count"),
		b.$shortlistCount = c.find(".job-count"),
		b.$listCheck = c.find('[data-action="list/check"]').data("json", b._json),
		c.find(".industry").tooltip();
		var d,
		e,
		f,
		g,
		h;
		b.$element.on("mouseenter", '[data-action="note"], [data-action="job"], [data-action="task"]', function (c) {
			var i = a(c.target);
			g = function (b) {
				clearTimeout(e),
				a(this).off(b)
			},
			h = function (c) {
				f = setTimeout(function () {
						b.publish("slide-helper/note/close"),
						a(this).off(c)
					}, 600)
			},
			a(".slide-helper").off("mouseenter.helper", g).off("mouseleave.helper", h),
			i.data("preview") && (b._json.islimited || b._isAdmin || "0" === i.text() || "0" === i.find('[class*="count"]').text() || (clearTimeout(d), clearTimeout(e), clearTimeout(f), d = setTimeout(function () {
							var a = i.data("action");
							b.publish("slide-helper/" + a + "/reload", b._json.id, "company")
						}, 500), i.on("mouseleave", function (c) {
						e = setTimeout(function () {
								b.publish("slide-helper/note/close"),
								a(".slide-helper").off("mouseenter.helper", g).off("mouseleave.helper", h)
							}, 600),
						a(".slide-helper").on("mouseenter.helper", g).on("mouseleave.helper", h),
						clearTimeout(d),
						i.off(c)
					})))
		})
	}
	var k,
	l = /^(http:\/\/)/i,
	m = /^(www)/i,
	n = {
		ADD_CONTRACT : "/rest/client/contractadd",
		APPROVE : "/rest/client/verify",
		CLIENT : "/rest/client/<id>",
		NEED_VERIFY : "/rest/data/configvalue?keys=client_need_verify"
	};
	return b.extend(function (a, b, c, d) {
		var e = this;
		e._json = c,
		e.viewType = d,
		e.isList = arguments[3] !== k
	}, {
		"hub:memory/context" : function (a, b) {
			var c = this;
			c._context = b,
			i.call(c)
		},
		"hub/list/check/all" : function () {
			var a = this;
			a.$listCheck.filter(":not(:disabled)").prop("checked", !0)
		},
		"hub/list/uncheck/all" : function () {
			var a = this;
			a.$listCheck.filter(":not(:disabled)").prop("checked", !1)
		},
		"dom/action.click" : a.noop,
		"dom/action/list/check.click" : function () {
			var a = this;
			a.publish("toggle/mass/action")
		},
		"dom/action/profile/open.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			f = d.attr("href");
			e.window({
				url : f,
				name : "User Profile",
				width : "1024"
			})
		},
		"dom/action/dropdown.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target),
			f = e.siblings(".dropdown-menu"),
			g = a(document),
			h = e.closest(".btn-group");
			d.$element.find(".btn-group").removeClass("open"),
			h.addClass("open"),
			g.on("click.btn.dropdown", function (b) {
				var c = a(b.target);
				!c.closest(f).length && h.hasClass("open") && (h.removeClass("open"), g.off("click.btn.dropdown"))
			})
		},
		"dom/action/approve/action.click" : function (b, d) {
			var f,
			g = this,
			i = a(d.target),
			j = i.closest(".btn-group"),
			k = j.find(":radio:checked");
			f = {
				id : g._json.id,
				verifystatus : k.val()
			},
			g.publish("ajax", {
				url : n.APPROVE,
				data : {
					data : JSON.stringify(f)
				},
				type : "post"
			}, c().done(function (a) {
					a.status ? (e.alert("success", "验证操作成功"), g.uid = g._json.id, h.call(g)) : e.alert("error", a.data)
				}))
		},
		"dom/action/note.click" : function (b, c) {
			c.preventDefault();
			var d = this;
			a(c.target),
			d.publish("modal/add-note/show", {
				externalType : "client",
				optionType : "client_note_category",
				id : d._json.id,
				onSuccess : function () {
					d.$noteCount.text(parseInt(d.$noteCount.text(), 10) + 1)
				}
			})
		},
		"dom/action/add/contract.click" : function (b, c) {
			c.preventDefault();
			var d = this;
			a(c.target),
			d._json.islimited || d.publish("modal/add/contract/show", n.ADD_CONTRACT, d._json.id, function (a) {
				a.status ? d.$contractCount.text(parseInt(d.$contractCount.text(), 10) + 1) : e.alert("error")
			})
		},
		"dom/action/add/to/folder.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target),
			f = [];
			!function () {
				d._json.folders.forEach(function (a) {
					f.push(a.id)
				})
			}
			(),
			d.publish("modal/add-to-folder/show", {
				ids : [d._json.id],
				type : "client",
				folders : f,
				multiSelect : !0,
				onSuccess : function (a) {
					d._json.folders = a,
					d.$folderCount.text(a.length),
					e.find(".muted").text(d.getFolderName(a))
				}
			})
		},
		"dom/action/job.click" : function (a, b) {
			b.preventDefault()
		},
		"dom/action/task.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target),
			f = e.find("b");
			d.publish("modal/add/task/show", {
				name : d._json.name,
				id : d._json.id,
				onSuccess : function () {
					f.text(parseInt(f.text(), 10) + 1)
				},
				type : "client"
			})
		},
		parseValue : function (a) {
			return l.test(a) ? '<a href="' + a + '" target="_blank">' + a + "</a>" : m.test(a) ? '<a href="http://' + a + '" target="_blank">' + a + "</a>" : a
		},
		getFolderName : function (a) {
			var b = "",
			c = [];
			return a.length && (a.forEach(function (a) {
					c.push(a.name)
				}), b = c.join(", ")),
			b
		}
	})
}), define("troopjs-requirejs/template!app/widget/company/list/main.html", [], function () {
	return function () {
		var a = '<div class="well well-small action-bar clearfix">\n    <div class="pull-left mass-action">\n        <label class="checkbox inline">\n            <input type="checkbox" data-action="list/toggle/all"> <span data-weave="shared/helper/translation" data-i18n="Select All"></span>\n        </label>\n        <button class="btn btn-small disabled" data-weave="shared/helper/translation" data-i18n="Add to Folder" data-action="mass/to/folder"></button>\n        ';
		return this._isAdmin && (a += '\n        <button class="btn btn-small disabled" data-weave="shared/helper/translation" data-i18n="Merge duplicate company" data-action="merge/company"></button>\n        '),
		a += '\n    </div>\n    <div class="pull-right">\n        <span data-weave="shared/helper/translation" data-i18n="Display rows"></span>: \n        <select class="sort input-small" data-weave="shared/widget/list-paginate/main(' + this._listType + ')" data-action="paginate">\n            <option value="10">10</option>\n            <option value="25">25</option>\n            <option value="50">50</option>\n        </select>\n        <select class="sort input-medium" data-weave="shared/widget/list-ordering/main(' + this._listType + ')" data-action="ordering">\n            <option value="-dateAdded" data-weave="shared/helper/translation" data-i18n="Sort by Keyin Date (Descend)"></option>\n            <option value="dateAdded" data-weave="shared/helper/translation" data-i18n="Sort by Keyin Date (Ascend)"></option>\n            <option value="name" data-weave="shared/helper/translation" data-i18n="Sort by Company Name"></option>\n            <option value="city_id" data-weave="shared/helper/translation" data-i18n="Sort by City"></option>\n            <option value="industry_id" data-weave="shared/helper/translation" data-i18n="Sort by Industry"></option>\n            <option value="type" data-weave="shared/helper/translation" data-i18n="Sort by Company Type"></option>\n        </select>\n        \n        <button class="btn btn-small" data-action="listview" data-toggle="tooltip" data-weave="shared/helper/translation(\'title\')" data-i18n="Switch View"><span class="icon-test"></span></button>\n    </div>\n</div>\n\n<!-- pagination -->\n<div class="pagination clearfix hide" data-weave="shared/widget/pagination/main(\'' + this._listType + '\')"></div>\n\n<div class="loading-area widget-spin">\n    ',
		a += this.viewType ? '\n    <table class="table table_vam table-bl">\n        <colgroup>\n            <col width="30">\n            <col width="60">\n            <col>\n            <col>\n            <col>\n            <col>\n            <col>\n            <col>\n            <col>\n            <col>\n            <col width="60">\n        </colgroup>\n        <thead>\n            <tr>\n                <th></th>\n                <th></th>\n                <th data-weave="shared/helper/translation" data-i18n="Company Name"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Note"></th>\n                <th data-weave="shared/helper/translation" data-i18n="City"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Industry"></th>\n                <th data-weave="shared/helper/translation" data-i18n="On Job"></th>\n                <th data-weave="shared/helper/translation" data-i18n="User Leave"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Intention"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Company Type"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Operation"></th>\n            </tr>\n        </thead>\n        <tbody class="list-container">\n        </tbody>\n    </table>\n    ' : '\n    <div class="search_panel list-container clearfix"></div>\n    ',
		a += '\n</div>\n\n<!-- pagination -->\n<div class="pagination clearfix hide" data-weave="shared/widget/pagination/main(\'' + this._listType + "')\"></div>"
	}
}), define("app/widget/company/list/main", ["jquery", "shared/widget/list/base", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		c(function (a) {
			b.html(d, a)
		}).done(function () {
			b.$container = b.$element.find(".list-container"),
			b.$massActions = b.$element.find(".mass-action .btn"),
			b.$toggleAll = b.$element.find('[data-action="list/toggle/all"]'),
			b.$listview = b.$element.find('[data-action="listview"]'),
			b.viewType ? b.$listview.addClass("table-view").find("span").attr("class", "icon-sqaures") : b.$listview.addClass("detail-view").find("span").attr("class", "icon-list"),
			b.$element.tooltip({
				selector : '[data-toggle="tooltip"]',
				trigger : "hover"
			}),
			a.resolve()
		})
	}
	var f = "/rest/client/list?",
	g = "app/widget/company/item/main";
	return b.extend(function () {
		this._url = f,
		this._listType = "client"
	}, {
		render : function (a) {
			var b = this;
			b.subscribe("context", !0, function (c, d) {
				b._isAdmin = "Admin" === d.user.role ? !0 : !1,
				e.call(b, a)
			})
		},
		appendItems : function (a) {
			var b = this;
			b.$toggleAll.prop("checked", !1),
			b.$toggleAll.prop("indeterminate", !1),
			b.viewType ? a.forEach(function (a) {
				b.$container.append("<tr></tr>"),
				b.$container.children().last().data("json", a).attr("data-weave", g + "(json, " + b.viewType + ")").weave()
			}) : a.forEach(function (a) {
				b.$container.append('<div class="search_item clearfix"></div>'),
				b.$container.children().last().data("json", a).attr("data-weave", g + "(json, " + b.viewType + ")").weave()
			})
		},
		"dom/action/mass/to/folder.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target);
			if (!e.hasClass("disabled")) {
				var f = d.$element.find('[data-action="list/check"]').filter(":checked"),
				h = [];
				f.each(function () {
					h.push(a(this).data("json").id)
				}),
				d.publish("modal/add-to-folder/show", {
					ids : h,
					type : "client",
					multiSelect : !0,
					onSuccess : function (b) {
						f.each(function () {
							a(this).data("json").folders = b
						}),
						f.closest('[data-woven*="' + g + '"]').find(".folder-count").text(b.length).closest("a").find(".muted").text(d.getFolderName(b))
					}
				})
			}
		},
		"dom/action/merge/company.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target);
			if (!e.hasClass("disabled")) {
				var f = d.$element.find('[data-action="list/check"]').filter(":checked"),
				h = [],
				i = [];
				f.each(function () {
					var b = a(this).data("json");
					h.push(b.id),
					i.push(b.name)
				}),
				d.publish("modal/merge-company/show", {
					ids : h,
					onSuccess : function (b) {
						f.each(function () {
							var c = a(this);
							b !== c.data("json").id && c.closest('[data-woven*="' + g + '"]').remove()
						})
					}
				})
			}
		},
		getFolderName : function (a) {
			var b = "",
			c = [];
			return a.length && (a.forEach(function (a) {
					c.push(a.name)
				}), b = c.join(", ")),
			b
		}
	})
}), define("troopjs-requirejs/template!app/widget/company/merge/main.html", [], function () {
	return function (a) {
		var b = "";
		return a.context.role.toUpperCase(),
		b += '\n\n<div class="pull-right">\n    <a href="javascript:history.back();" class="btn">\n        <i class="icon-arrow-left"></i>\n    </a>\n</div>\n\n<h3 class="heading"><span data-weave="shared/helper/translation" data-i18n="Merge duplicate company"></span></h3>\n\n<div class="search_page">\n    <div class="search_panel clearfix">\n        <div class="search_item company-item clearfix widget-spin"></div>\n    </div>\n</div>\n\n<div class="alert alert-error">\n    <p class="text-center">该公司将被合并，所有的数据，包括“Note”，“People”等信息将被转移到以下公司</p>\n</div>\n\n\n<form>\n    <label>请搜索并选择一家公司，接收被合并公司的数据</label>\n    <div class="input-prepend input-append">\n        <span class="add-on"><i class="icon-search"></i></span>\n        <input type="text" class="input-large search-input">\n        <button class="btn" data-weave="shared/helper/translation" data-i18n="Search" data-action="search/company"></button>\n    </div>\n</form>\n\n<div class="search_page company-list widget-spin hide">\n    <div class="search_panel clearfix"></div>\n    <button class="btn" data-weave="shared/helper/translation" data-i18n="Merge Company" data-action="merge/company"></button>\n</div>'
	}
}), define("troopjs-requirejs/template!app/widget/company/merge/company.html", [], function () {
	return function (a) {
		for (var b = "", c = 0, d = a.length; d > c; c++) {
			b += "\n";
			var e = a[c];
			b += '\n<div class="search_item">\n    <div>\n        <input type="radio" name="company" value="' + e.id + '">\n        <a href="/company#detail!id=' + e.id + '" target="_blank">' + e.name + '</a> <span class="muted"><span data-weave="shared/helper/translation" data-i18n="People"></span>: ' + e.people_count + "</span>\n    </div>\n    ",
			e.name1 && (b += "\n    <div>" + e.name1 + "</div>\n    "),
			b += "\n\n    ",
			e.name2 && (b += "\n    <div>" + e.name2 + "</div>\n    "),
			b += "\n</div>\n"
		}
		return b
	}
}), define("app/widget/company/merge/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "shared/helper/utils", "template!./main.html", "template!./company.html"], function (a, b, c, d, e, f) {
	function g() {
		var a = this;
		a.uid && a._context && a.publish("ajax", {
			url : j.CLIENT + a.uid
		}, c().done(function (b) {
				a._json = b,
				a._json.context = a._context,
				h.call(a)
			}))
	}
	function h() {
		var a = this;
		c(function (b) {
			a.html(e, a._json, b)
		}).done(function () {
			i.call(a)
		})
	}
	function i() {
		var a = this,
		b = a.$element;
		a.$list = b.find(".company-list"),
		b.find(".search_page:eq(0) .company-item").data("json", a._json).attr("data-weave", "app/widget/company/item/main(json)").weave(c().done(function () {
				a.$element.find(".company-item").removeClass("widget-spin")
			})),
		d.widgetLoaded.call(a)
	}
	var j = {
		CLIENT : "/rest/client/",
		LIST : "/rest/client/list?company_name=",
		MERGE : "/rest/client/merge"
	};
	return b.extend({
		"hub:memory/merge/id/change" : function (a, b) {
			var c = this;
			c.uid = b,
			g.call(c)
		},
		"hub:memory/context" : function (a, b) {
			var d = this;
			c(),
			d._context = b.user,
			g.call(d)
		},
		"dom/action.click" : a.noop,
		"dom/action/search/company.click" : function (b, d) {
			d.preventDefault();
			var e = this,
			g = e.$element.find(".search-input").val().trim(),
			h = a(d.target);
			g.length && (e.$list.removeClass("hide").addClass("widget-spin"), e.publish("ajax", {
					url : j.LIST + window.encodeURIComponent(g)
				}, c().done(function (b) {
						if (b.count) {
							var d = c(),
							g = a(f(b.list, d));
							g.find("[data-weave]").weave(),
							e.$list.find(".search_panel").html(g),
							e.$list.removeClass("widget-spin")
						} else
							e.$list.addClass("hide")
					}), h))
		},
		"dom/action/merge/company.click" : function (b, e) {
			e.preventDefault();
			var f,
			g = this,
			h = a(e.target),
			i = g.$list.find(":radio:checked");
			if (i.length) {
				var k = parseInt(i.val(), 10),
				l = g._json.id;
				if (k === l)
					return d.alert("error", "请选择不同的两家公司进行合并"), void 0;
				f = window.confirm("确定要合并所选择的公司吗？"),
				f && g.publish("ajax", {
					url : j.MERGE,
					data : {
						data : JSON.stringify({
							merge_to : k,
							merge_from : l
						})
					},
					type : "post"
				}, c().done(function (a) {
						a.status ? (d.alert("success", "合并成功！"), window.location.hash = "list") : d.alert("error", a.message)
					}), h)
			}
		}
	})
}), define("troopjs-requirejs/template!app/widget/dashboard/main.html", [], function () {
	return function () {
		var a = '<div class="widgets-pad">\n    <div class="handle text-center" data-action="toggle/pad">\n        <a><i class="fa fa-caret-up fa-lg"></i></a>\n    </div>\n    <ul class="unstyled inline list-widget-icon">\n        <li>\n            <div class="widget-icon" data-type="note" data-toggle="tooltip" title="添加备注组件">\n                <span class="fa-2x">\n                    <i class="fa fa-comment"></i>\n                </span>\n            </div>\n        </li>\n        <li>\n            <div class="widget-icon"  data-type="revenue" data-toggle="tooltip" title="添加业绩组件">\n                <span class="fa-2x">\n                    <i class="fa fa-bar-chart-o"></i>\n                </span>\n            </div>\n        </li>\n        <li>\n            <div class="widget-icon" data-type="task" data-toggle="tooltip" title="添加任务组件">\n                <span class="fa-2x">\n                    <i class="fa fa-check-square-o"></i>\n                </span>\n            </div>\n        </li>\n        <li>\n            <div class="widget-icon" data-type="tutorial" data-toggle="tooltip" title="添加Gllue教程">\n                <span class="fa-2x">\n                    <i class="fa fa-video-camera"></i>\n                </span>\n            </div>\n        </li>\n    </ul>\n</div>\n\n<h3 data-weave="shared/helper/translation" data-i18n="Dashboard"></h3>\n\n<div class="row-fluid w-container">\n    <div class="span6" data-column="1"></div>\n\n    <div class="span6" data-column="2"></div>\n    \n</div>';
		return a
	}
}), define("app/widget/dashboard/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "jquery.ui"], function (a, b, c, d, e) {
	function f() {
		var a = this;
		c(function (b) {
			a.html(d, b)
		}).done(function () {
			g.call(a)
		})
	}
	function g() {
		var b = this,
		c = b.$element,
		d = c.find(".w-container").children();
		b.$widgetsPad = b.$element.find(".widgets-pad"),
		b.dashboard_config.forEach(function (a) {
			var b = c.find('[data-column="' + a.column + '"]');
			a.widgets.forEach(function (a) {
				b.append('<div class="w-box" data-widget="' + a + '" data-weave="app/widget/dashboard/' + a + '/main"></div>')
			}),
			b.find("[data-weave]").weave()
		}),
		d.sortable({
			connectWith : d,
			handle : ".w-box-header",
			helper : function () {
				return a("<div></div>")
			},
			update : function (a, c) {
				var d = c.item,
				e = d.data("type");
				e && d.removeAttr("data-type data-toggle").removeClass("widget-icon ui-draggable").addClass("w-box").attr("data-widget", e).attr("data-weave", "app/widget/dashboard/" + e + "/main").weave(),
				b.publish("dashboard/widget/update")
			}
		}),
		b.$element.find(".list-widget-icon div").draggable({
			connectToSortable : d,
			helper : "clone",
			revert : "invalid",
			start : function () {
				b.$element.toggleClass("widgets-editing")
			},
			stop : function () {
				b.$element.toggleClass("widgets-editing")
			}
		}),
		b.$element.find('[data-toggle="tooltip"]').tooltip({
			placement : "top"
		})
	}
	var h = {
		LISTVIEW : "/rest/user/listview"
	},
	i = [{
			column : 1,
			widgets : ["revenue", "note"]
		}, {
			column : 2,
			widgets : ["task", "tutorial"]
		}
	];
	return b.extend({
		"hub:memory/context" : function (a, b) {
			var c = this;
			c.dashboard_config = b.user.listview.dashboard && b.user.listview.dashboard.config ? b.user.listview.dashboard.config : i,
			f.call(c)
		},
		"hub:memory/dashboard/disable/widget/icon" : function (a, b) {
			var c = this;
			b && c.$element.find('[data-type="' + b + '"]').draggable("disable")
		},
		"hub:memory/dashboard/enable/widget/icon" : function (a, b) {
			var c = this;
			b && c.$element.find('[data-type="' + b + '"]').draggable("enable")
		},
		"hub/dashboard/widget/update" : function () {
			var b = this,
			d = b.$element,
			f = [];
			d.find("[data-column]").each(function () {
				var b = a(this),
				c = [];
				b.find("[data-widget]").each(function () {
					c.push(a(this).data("widget"))
				}),
				f.push({
					column : b.data("column"),
					widgets : c
				})
			}),
			b.publish("ajax", {
				url : h.LISTVIEW,
				data : {
					data : JSON.stringify({
						list : "dashboard",
						key : "config",
						value : f
					})
				},
				type : "post"
			}, c().done(function (a) {
					a.status || e.alert("error", a.message)
				}))
		},
		"dom/action.click.mouseover.mouseout" : a.noop,
		"dom/action/toggle/pad.click" : function (b, c) {
			var d = this,
			e = a(c.target);
			d.$element.toggleClass("widgets-editing"),
			e.find(".fa").toggleClass("fa-caret-up fa-caret-down")
		}
	})
}), define("app/widget/dashboard/widget/main", ["jquery", "shared/widget/base/main", "shared/helper/utils"], function (a, b) {
	return b.extend(function (b) {
		var c = this;
		c._type = a(b).data("widget"),
		c.publish("dashboard/disable/widget/icon", c._type)
	}, {
		"sig/stop" : function () {
			var a = this;
			a.publish("dashboard/enable/widget/icon", a._type)
		},
		"dom/action.click" : a.noop,
		"dom/action/remove/me.click" : function (a, b) {
			b.preventDefault();
			var c = this;
			c.$element.remove(),
			c.publish("dashboard/widget/update")
		}
	})
}), define("troopjs-requirejs/template!app/widget/dashboard/note/main.html", [], function () {
	return function () {
		var a = '<div class="w-box-header">\n    <span data-weave="shared/helper/translation" data-i18n="Note"></span>\n\n    <div class="pull-right">\n        <div class="btn-group">\n            <a class="btn dropdown-toggle btn-mini" data-toggle="dropdown" href="#">\n                <i class="icon-cog"></i> <span class="caret"></span>\n            </a>\n            <ul class="dropdown-menu">\n                <li><a href="#" data-action="remove/me" data-weave="shared/helper/translation" data-i18n="Remove from dashboard"></a></li>\n            </ul>\n        </div>\n    </div>\n</div>\n<div class="w-box-content cnt_a widget-spin"></div>\n<div class="w-box-footer text-center">\n    <a href="#" data-action="load/more" data-weave="shared/helper/translation" data-i18n="Load more"></a>\n</div>';
		return a
	}
}), define("troopjs-requirejs/template!app/widget/dashboard/note/item.html", [], function () {
	return function (a) {
		function b(a) {
			return a ? a.replace(/(\r\n)|(\n)/g, "<br>") : ""
		}
		var c = "";
		c += "\n";
		for (var d = 0, e = a.length; e > d; d++) {
			c += "\n";
			var f = a[d],
			g = f.dateAdded.split(" "),
			h = g[0],
			i = g[1],
			j = f.user,
			k = j.id,
			l = j.englishName;
			c += '\n<div class="activity-item clearfix">\n    <div class="pull-left span2 activity-time">\n        <p>\n            <span>' + i + "</span>\n            <span>" + h + '</span>\n            <a href="/user/preview#' + k + '" data-action="profile/open">' + l + '</a>\n        </p>\n    </div>\n\n    <div class="pull-left span10 activity-detail">\n        <div class="well">\n            <div class="title clearfix">\n                <div>\n                    ',
			f.jobsubmission && (c += '\n                    <span class="label label-orange" data-weave="shared/helper/translation" data-i18n="Job Note"></span>\n                    '),
			c += '\n                    <span class="label" style="background-color: ' + f.category.color + '">' + f.category.value + "</span>\n\n                    ",
			f.status && (c += '\n                    <span class="label" style="background-color: ' + f.status.color + ';">' + f.status.value + "</span>\n                    "),
			c += "\n                    \n                    ",
			"candidate" === f.external_type ? (c += "\n                    ", "coldcall" === f.target.type && (c += '<span class="label">Cold call</span>'), c += '\n                    <a href="/candidate#detail!id=' + f.target.id + '" target="_blank">' + [f.target.englishName, f.target.chineseName].join(" ").trim() + "</a>\n\n                    ") : "client" === f.external_type ? c += '\n                    <a href="/company#detail!id=' + f.target.id + '" target="_blank">' + f.target.name + "</a>\n                    " : "joborder" === f.external_type && (c += '\n                    <a href="/job#detail!id=' + f.target.id + '" target="_blank">' + f.target.jobTitle + "</a>\n                    "),
			c += '\n                </div>\n\n                <div class="activity-item-hide">\n                    ',
			"candidate" === f.external_type && f.target.company && (c += "\n                    " + f.target.title + ' <span class="muted">at</span> <a href="/company#detail!id=' + f.target.company.id + '" target="_blank">' + f.target.company.name + "</a>\n                    "),
			c += "\n\n                    ",
			f.jobsubmission && (c += '\n                    <span class="muted" data-weave="shared/helper/translation" data-i18n="来自项目"></span>: <a href="/job#detail!id=' + f.jobsubmission.joborder.id + '" target="_blank">' + f.jobsubmission.joborder.jobTitle + "</a>\n                    "),
			c += '\n                </div>\n            </div>\n            <div class="content" data-name="notes">\n            ';
			for (var m = 0, n = f.items.length; n > m; m++)
				c += "\n                ", f.items[m].field && (c += "\n                <h4>" + f.items[m].field + "</h4>\n                "), c += "\n                <p>\n                    " + b(f.items[m].value) + "\n                </p>\n            ";
			c += "\n            </div>\n        </div>\n    </div>\n</div>\n"
		}
		return c
	}
}), define("app/widget/dashboard/note/main", ["jquery", "app/widget/dashboard/widget/main", "troopjs-utils/deferred", "template!./main.html", "template!./item.html", "shared/helper/utils"], function (a, b, c, d, e, f) {
	function g() {
		var a = this;
		a.html(d, a._json, c().done(function () {
				h.call(a)
			}))
	}
	function h() {
		var b = this,
		d = b.$element;
		b.$content = d.find(".w-box-content"),
		b.$more = d.find('[data-action="load/more"]'),
		b.publish("ajax", {
			url : k.LIST.replace("<page>", i).replace("<paginate>", j).replace("<userId>", b._userId)
		}, c().done(function (d) {
				if (d.list.length) {
					var f = a(e(d.list));
					f.find("[data-weave]").weave(c().done(function () {
							b.$content.append(f)
						})),
					d.current >= d.pages && b.$more.addClass("disabled")
				} else
					b.$more.addClass("disabled")
			})),
		b.$content.removeClass("widget-spin")
	}
	var i = 1,
	j = 5,
	k = {
		LIST : "/rest/note/list?page=<page>&paginate_by=<paginate>&user=<userId>"
	};
	return b.extend({
		"hub:memory/context" : function (a, b) {
			var c = this;
			c._userId = b.user.id,
			g.call(c)
		},
		"dom/action/profile/open.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = d.attr("href");
			f.window({
				url : e,
				name : "User Profile",
				width : "1024"
			})
		},
		"dom/action/load/more.click" : function (b, d) {
			d.preventDefault();
			var f = this,
			g = a(d.target);
			g.hasClass("disabled") || (i += 1, f.publish("ajax", {
					url : k.LIST.replace("<page>", i).replace("<paginate>", j).replace("<userId>", f._userId)
				}, c().done(function (b) {
						if (b.list.length) {
							b.current >= b.pages && f.$more.addClass("disabled");
							var d = a(e(b.list));
							d.find("[data-weave]").weave(c().done(function () {
									f.$content.append(d)
								}))
						}
					})))
		}
	})
}), define("troopjs-requirejs/template!app/widget/dashboard/revenue/main.html", [], function () {
	return function (a) {
		var b = "",
		c = a.total;
		return b += '\n<div class="w-box-header">\n    <span data-weave="shared/helper/translation" data-i18n="Revenue"></span>\n\n    <div class="pull-right">\n        <div class="btn-group">\n            <a class="btn dropdown-toggle btn-mini" data-toggle="dropdown" href="#">\n                <i class="icon-cog"></i> <span class="caret"></span>\n            </a>\n            <ul class="dropdown-menu">\n                <li><a href="#" data-action="remove/me" data-weave="shared/helper/translation" data-i18n="Remove from dashboard"></a></li>\n            </ul>\n        </div>\n    </div>\n</div>\n<div class="w-box-content cnt_a widget-spin">\n    <div class="text-right">\n        <h4>\n            <span class="name" data-weave="shared/helper/translation" data-i18n="Total Revenue"></span> <span class="value"><span data-weave="shared/helper/translation" data-i18n="Currency symbol"></span> ' + this.formatCurrency(c ? c.revenue : 0) + '</span>\n        </h4>\n    </div>\n    <div class="chart"></div>\n\n    <div class="text-center">\n        <ul class="unstyled inline stats-overview">\n            <li>\n                <span class="name" data-weave="shared/helper/translation" data-i18n="Invoice Not Sent"></span>\n                <span class="value"><span data-weave="shared/helper/translation" data-i18n="Currency symbol"></span> ' + this.formatCurrency(c ? c.invoiceNotSent : 0) + '</span>\n            </li>\n            <li>\n                <span class="name" data-weave="shared/helper/translation" data-i18n="Invoice Sent Not Received"></span>\n                <span class="value"><span data-weave="shared/helper/translation" data-i18n="Currency symbol"></span> ' + this.formatCurrency(c ? c.invoiceSent : 0) + '</span>\n            </li>\n            <li>\n                <span class="name" data-weave="shared/helper/translation" data-i18n="Invoice Received"></span>\n                <span class="value"><span data-weave="shared/helper/translation" data-i18n="Currency symbol"></span> ' + this.formatCurrency(c ? c.paymentReceived : 0) + "</span>\n            </li>\n        </ul>\n    </div>\n</div>"
	}
}), define("app/widget/dashboard/revenue/main", ["jquery", "app/widget/dashboard/widget/main", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "shared/helper/utils", "shared/helper/blurb", "flot.resize", "flot.time"], function (a, b, c, d, e, f, g) {
	function h(b, c, d) {
		a('<div id="flot-tooltip" class="flot-tooltip"><div class="tooltip-arrow"></div>' + d + "</div>").css({
			top : c - 43,
			left : b - 15
		}).appendTo("body").fadeIn(200)
	}
	function i() {
		var b = this,
		f = [],
		g = c(),
		h = c();
		f.push(g.promise(), h.promise()),
		b.publish("ajax", {
			url : o.CHART.replace("<userId>", b._userId).replace("<start>", m).replace("<end>", n)
		}, g.done(function (a) {
				b._json.ticks = function () {
					var b = [];
					return a.data.length && a.data[0].values.forEach(function (a) {
						b.push([a.x, a.y])
					}),
					b
				}
				()
			})),
		b.publish("ajax", {
			url : o.TOTAL.replace("<userId>", b._userId).replace("<start>", m).replace("<end>", n)
		}, h.done(function (a) {
				b._json.total = a.aaData[0]
			})),
		d.apply(a, f).done(function () {
			b.html(e, b._json, c().done(function () {
					j.call(b)
				}))
		})
	}
	function j() {
		var b = this,
		c = b.$element;
		b.$content = c.find(".w-box-content"),
		b.$chart = c.find(".chart"),
		b.$content.removeClass("widget-spin"),
		a.plot(b.$chart, [{
					data : b._json.ticks,
					color : "#3a8ce5"
				}
			], {
			xaxis : {
				min : new Date(l.getFullYear() - 1 + "-12-29").getTime(),
				max : new Date(l.getFullYear() + "-12-3").getTime(),
				mode : "time",
				tickSize : [1, "month"],
				monthNames : ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"]
			},
			yaxis : {
				tickFormatter : function (a, c) {
					return p.CURRENCY_SYM + " " + b.formatCurrency(a.toFixed(c.tickDecimals))
				}
			},
			series : {
				lines : {
					show : !0,
					fill : !0
				},
				points : {
					show : !0
				}
			},
			grid : {
				hoverable : !0,
				clickable : !0
			},
			legend : {
				show : !1
			}
		}),
		b.$chart.bind("plothover", function (c, d, e) {
			if (e) {
				if (k != e.dataIndex) {
					k = e.dataIndex,
					a("#flot-tooltip").remove();
					var f = e.datapoint[1].toFixed();
					h(e.pageX, e.pageY, "¥ " + b.formatCurrency(f))
				}
			} else
				a("#flot-tooltip").remove(), k = null
		})
	}
	var k,
	l = new Date,
	m = l.getFullYear() + "-01-01",
	n = l.getFullYear() + "-12-31",
	o = {
		CHART : "/rest/report/revenue_chart?type=user&filter=user&user_id=<userId>&start=<start>&end=<end>&dateType=dateAdded&time_slice=month",
		TOTAL : "/rest/report/revenue?type=user&filter=user&user_id=<userId>&start=<start>&end=<end>&dateType=dateAdded"
	},
	p = {
		CURRENCY_SYM : g.t("Currency symbol")
	};
	return b.extend({
		"hub:memory/context" : function (a, b) {
			var c = this;
			c._userId = b.user.id,
			i.call(c)
		}
	})
}), define("troopjs-requirejs/template!app/widget/dashboard/task/main.html", [], function () {
	return function () {
		var a = '<div class="w-box-header">\n    <span data-weave="shared/helper/translation" data-i18n="截至今天的任务"></span>: <span class="count"></span>\n\n    <div class="pull-right">\n        <div class="btn-group">\n            <a class="btn dropdown-toggle btn-mini" data-toggle="dropdown" href="#">\n                <i class="icon-cog"></i> <span class="caret"></span>\n            </a>\n            <ul class="dropdown-menu">\n                <li><a href="#" data-action="remove/me" data-weave="shared/helper/translation" data-i18n="Remove from dashboard"></a></li>\n            </ul>\n        </div>\n    </div>\n</div>\n<div class="w-box-content cnt_a widget-spin">\n    <p class="text-center all-done hide">今天没有未完成的任务!</p>\n</div>\n<div class="w-box-footer text-center">\n    <a href="#" data-action="load/more" data-weave="shared/helper/translation" data-i18n="Load more"></a>\n</div>';
		return a
	}
}), define("troopjs-requirejs/template!app/widget/dashboard/task/item.html", [], function () {
	return function (a) {
		function b(a) {
			var b = new Date(a.split(" ")[0]);
			return b.getFullYear() + "-" + (parseInt(b.getMonth(), 10) + 1) + "-" + b.getDate()
		}
		var c = "";
		c += "\n";
		for (var d = 0, e = a.length; e > d; d++) {
			c += "\n";
			var f = a[d];
			c += "\n";
			var g;
			c += '\n<div class="w-box-container w-box-note-item">\n    <input data-id="' + f.id + '" type="checkbox" ',
			f.done && (c += 'checked="checked"'),
			c += ' data-action="check/one">\n    <p>\n        <span class="label" style="background-color: ' + f.category.color + ';">' + f.category.value + "</span>\n        ",
			"joborder" === f.external_type ? c += '\n        <a href="/job#detail!id=' + f.target.id + '" target="_blank">' + f.target.name + "</a>\n        " : "client" === f.external_type ? c += '\n        <a href="/company#detail!id=' + f.target.id + '" target="_blank">' + f.target.name + "</a>\n        " : f.target && f.target.candidate ? (c += "\n        ", g = f.target.candidate, c += '\n        <a href="/candidate#detail!id=' + g.id + '" target="_blank">' + [g.englishName, g.chineseName].join(" ").trim() + "</a>\n        ") : f.target && (c += '\n        <a href="/candidate#detail!id=' + f.target.id + '" target="_blank">' + f.target.name + "</a>\n        "),
			c += '\n        <span class="muted pull-right">\n            ',
			c += f.allday ? "\n            " + b(f.date) + "\n            " : "\n            " + f.date + "\n            ",
			c += "\n        </span>\n    </p>\n    ",
			f.content && (c += "\n    <p>\n        " + f.content + "\n    </p>\n    "),
			c += "\n</div>\n"
		}
		return c
	}
}), define("app/widget/dashboard/task/main", ["jquery", "app/widget/dashboard/widget/main", "troopjs-utils/deferred", "template!./main.html", "template!./item.html", "shared/helper/utils"], function (a, b, c, d, e, f) {
	function g() {
		var a = this;
		a.html(d, a._json, c().done(function () {
				h.call(a)
			}))
	}
	function h() {
		var b = this,
		d = b.$element;
		b.$count = d.find(".count"),
		b.$content = d.find(".w-box-content"),
		b.$more = d.find('[data-action="load/more"]'),
		b.$allDone = d.find(".all-done"),
		b.publish("ajax", {
			url : k.LIST.replace("<user_id>", b._userId).replace("<page>", i).replace("<paginate>", j)
		}, c().done(function (c) {
				if (b.$count.text(c.count), c.list.length) {
					var d = a(e(c.list));
					b.$content.append(d),
					c.current >= c.pages && b.$more.addClass("disabled")
				} else
					b.$allDone.removeClass("hide"), b.$more.addClass("disabled");
				b.$content.removeClass("widget-spin")
			}))
	}
	var i = 1,
	j = 5,
	k = {
		DONE : "/rest/todo/done",
		LIST : "/rest/todo/list?&page=<page>&paginate_by=<paginate>&done__eq=&user_id=<user_id>&date__until_today="
	};
	return b.extend({
		"hub:memory/context" : function (a, b) {
			var c = this;
			c._userId = b.user.id,
			g.call(c)
		},
		"dom/action.change" : a.noop,
		"dom/action/load/more.click" : function (b, d) {
			d.preventDefault();
			var f = this,
			g = a(d.target);
			g.hasClass("disabled") || (i += 1, f.publish("ajax", {
					url : k.LIST.replace("<user_id>", f._userId).replace("<page>", i).replace("<paginate>", j)
				}, c().done(function (b) {
						if (b.list.length) {
							b.current >= b.pages && f.$more.addClass("disabled");
							var c = a(e(b.list));
							f.$content.append(c)
						}
					})))
		},
		"dom/action/check/one.change" : function (b, d) {
			var e = this,
			g = a(d.target),
			h = g.data("id"),
			i = g.is(":checked");
			e.publish("ajax", {
				url : k.DONE,
				data : {
					data : JSON.stringify({
						ids : [h],
						done : i
					})
				},
				type : "POST"
			}, c().done(function (b) {
					b.status ? (g.closest(".w-box-container").fadeOut(function () {
							a(this).remove(),
							e.$element.find(".w-box-container").length || e.$allDone.fadeIn()
						}), e.$count.text(parseInt(e.$count.text(), 10) - 1), f.alert("success", "任务状态更改成功!")) : f.alert("error", b.message)
				}))
		}
	})
}), define("troopjs-requirejs/template!app/widget/dashboard/tutorial/main.html", [], function () {
	return function () {
		var a = '<div class="w-box-header">\n    <span data-weave="shared/helper/translation" data-i18n="Gllue system video tutorial"></span> <span class="count"></span>\n\n    <div class="pull-right">\n        <div class="btn-group">\n            <a class="btn dropdown-toggle btn-mini" data-toggle="dropdown" href="#">\n                <i class="icon-cog"></i> <span class="caret"></span>\n            </a>\n            <ul class="dropdown-menu">\n                <li><a href="#" data-action="remove/me" data-weave="shared/helper/translation" data-i18n="Remove from dashboard"></a></li>\n            </ul>\n        </div>\n    </div>\n</div>\n<div class="w-box-content cnt_a">\n    <ol class="">\n        <li>\n            <a href="#" data-source="http://support.gllue.com/training/Gllue_Intro.mp4" data-action="play/video">第一讲：系统基本介绍</a>\n        </li>\n        <li>\n            <a href="#" data-source="http://support.gllue.com/training/People_Basic.mp4" data-action="play/video">第二讲：人才模块 - 基本操作</a>\n        </li>\n        <li>\n            <a href="#" data-source="http://support.gllue.com/training/People_Search.mp4" data-action="play/video">第三讲：人才模块 - 搜索及分类</a>\n        </li>\n        <li>\n            <a href="#" data-source="http://support.gllue.com/training/People_Keyin.mp4" data-action="play/video">第四讲：人才模块 - 录入及编辑</a>\n        </li>\n        <li>\n            <a href="#" data-source="http://support.gllue.com/training/People_ImportPlugin.mp4" data-action="play/video">第五讲：人才模块 - 如何安装简历导入插件</a>\n        </li>\n        <li>\n            <a href="#" data-source="http://support.gllue.com/training/Company_Basic.mp4" data-action="play/video">第六讲：公司模块 - 基本操作</a>\n        </li>\n        <li>\n            <a href="#" data-source="http://support.gllue.com/training/Job_Basic.mp4" data-action="play/video">第七讲：项目模块 - 基本操作</a>\n        </li>\n        <li>\n            <a href="#" data-source="http://support.gllue.com/training/Job_Process.mp4" data-action="play/video">第八讲：项目模块 - 项目流程</a>\n        </li>\n        <li>\n            <a href="#" data-source="http://support.gllue.com/training/Reporting_Basic.mp4" data-action="play/video">第九讲：报表模块 - 基本操作</a>\n        </li>\n        <li>\n            <a href="#" data-source="http://support.gllue.com/training/Doc_Basic.mp4" data-action="play/video">第十讲：文档中心 - 基本操作</a>\n        </li>\n        <li>\n            <a href="#" data-source="http://support.gllue.com/training/CalendarTodo_Basic.mp4" data-action="play/video">第十一讲：日历与任务模块 - 基本操作</a>\n        </li>\n        <li>\n            <a href="#" data-source="http://support.gllue.com/training/Finance_Basic.mp4" data-action="play/video">第十二讲：财务模块 - 基本操作</a>\n        </li>\n        <li>\n            <a href="#" data-source="http://support.gllue.com/training/Admin_Basic.mp4" data-action="play/video">第十三讲：管理员后台设置 - 基本操作</a>\n        </li>\n    </ol>\n</div>';
		return a
	}
}), define("app/widget/dashboard/tutorial/main", ["jquery", "app/widget/dashboard/widget/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d) {
	function e() {
		var a = this;
		a.html(d, a._json, c().done(function () {
				f.call(a)
			}))
	}
	function f() {
		var a = this;
		a.$element
	}
	return b.extend({
		"hub:memory/context" : function (a, b) {
			var c = this;
			c._userId = b.user.id,
			e.call(c)
		},
		"dom/action/play/video.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target).data("source");
			d.publish("modal/video/show", e)
		}
	})
}), define("troopjs-requirejs/template!app/widget/document/detail/detail.html", [], function () {
	return function (a) {
		var b = '<div class="search_content full-width">\n    <div class="pull-right clearfix muted">\n        <span>' + (a.filesize / 1024).toFixed(2) + 'KB</span>&nbsp;&nbsp;\n        <span><span data-weave="shared/helper/translation" data-i18n="Upload Date"></span>: ' + a.dateAdded + '</span>&nbsp;&nbsp;\n        <span><span data-weave="shared/helper/translation" data-i18n="Upload User"></span>: <a href="/user/preview#id=' + a.addedBy.id + '" data-action="profile/open">' + a.addedBy.englishName + '</a></span>\n    </div>\n    <div class="pull-left sepH_b">\n        <input type="checkbox" data-action="list/check">\n        <a href="#" data-action="show/document" class="' + this._getType(a.ext) + " file-type-icon " + a.ext.toLowerCase() + '">' + a.originname + "</a>\n    </div>\n    ";
		return a.content.trim().length && (b += '\n    <hr class="clearfix">\n    <div class="item_description clearfix">\n        ' + a.content + '\n    </div>\n    <hr class="clearfix">\n    '),
		b += '\n\n    <ul class="nav pull-left nav-pills line_sep actions clear">\n        <li>\n            <a href="#" data-action="add/to/folder">\n                <i class="icon-folder-open icon-blue"></i>\n                <b class="folder-count">' + a.folders.length + '</b>\n                <span data-i18n="Folder" data-weave="shared/helper/translation"></span>\n                <span class="muted">' + this.getFolderName(a.folders) + '</span>\n            </a>\n        </li>\n    </ul>\n\n    <div class="pull-right content-actions">\n        <button class="btn btn-mini" data-weave="shared/helper/translation" data-i18n="Import to system" data-action="import/to/system"></button>\n        <button class="btn btn-mini" data-weave="shared/helper/translation" data-i18n="Preview" data-action="show/document"></button>\n        ',
		(this._context.user.id === a.addedBy.id || this._allowDownload) && (b += '\n        <button class="btn btn-mini" data-weave="shared/helper/translation" data-i18n="Download" data-action="attachment/download"></button>\n        '),
		b += '\n        <button class="btn btn-mini btn-danger" data-weave="shared/helper/translation" data-i18n="Delete" data-action="attachment/delete"></button>\n    </div>\n</div>'
	}
}), define("troopjs-requirejs/template!app/widget/document/detail/list.html", [], function () {
	return function (a) {
		var b = '<td>\n    <input type="checkbox" data-action="list/check">\n</td>\n<td>\n    <a href="#" data-action="show/document" class="' + this._getType(a.ext) + " file-type-icon " + a.ext.toLowerCase() + '">' + a.originname + "</a>\n</td>\n<td>\n    " + (a.filesize / 1024).toFixed(2) + "KB\n</td>\n<td>\n    " + a.dateAdded + '\n</td>\n<td>\n    <a href="/user/preview#id=' + a.addedBy.id + '" data-action="profile/open">' + a.addedBy.englishName + '</a>\n</td>\n<td>\n<div class="dropdown">\n    <a href="javascript: void(0);" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-list-alt"></i> <i class="caret"></i></a>\n        <ul class="dropdown-menu">\n            <li>\n                <a href="#" data-action="add/to/folder">\n                    <b class="folder-count">' + a.folders.length + '</b>\n                    <span data-i18n="Add to Folder" data-weave="shared/helper/translation"></span>\n                </a>\n            </li>\n            <li>\n                <a href="#" data-weave="shared/helper/translation" data-i18n="Preview" data-action="show/document"></a>\n            </li>\n            ';
		return (this._context.user.id === a.addedBy.id || this._allowDownload) && (b += '\n            <li>\n                <a href="#" data-weave="shared/helper/translation" data-i18n="Download" data-action="attachment/download"></a>\n            </li>\n            '),
		b += '\n            <li>\n                <a href="#" data-weave="shared/helper/translation" data-i18n="Delete" data-action="attachment/delete"></a>\n            </li>\n        </ul>\n    </div>\n</td>'
	}
}), define("app/widget/document/detail/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "shared/helper/utils", "template!./detail.html", "template!./list.html"], function (a, b, c, d, e, f) {
	function g() {
		var a = this;
		c(function (b) {
			a.viewType ? a.html(f, a._json, b) : a.html(e, a._json, b)
		}).then(function () {
			h.call(a)
		})
	}
	function h() {
		var a = this,
		b = a.$element;
		a.$folderCount = b.find(".folder-count"),
		a.$listCheck = b.find('[data-action="list/check"]').data("json", a._json),
		b.find("a.image").popover({
			placement : "bottom",
			trigger : "hover",
			html : !0,
			content : '<img width="260" src="' + i.PREVIEW + a._json.uuidname + '">'
		})
	}
	var i = {
		DOWNLOAD : "/rest/file/download/<uuidname>",
		DELETE : "/rest/file/del",
		ADD_CANDIDATE : "/candidate#add!file=<file>",
		PREVIEW : "/rest/file/preview/"
	},
	j = /(jpg)|(gif)|(png)|(jpeg)|(bmp)/i;
	return b.extend(function (a, b, c, d) {
		var e = this;
		e._json = c,
		e.viewType = d
	}, {
		"hub:memory/context" : function (a, b) {
			var c = this;
			c._context = b,
			c._allowDownload = "1" === b.config.attachment_allow_download,
			g.call(c)
		},
		"hub/list/check/all" : function () {
			var a = this;
			a.$listCheck.filter(":not(:disabled)").prop("checked", !0)
		},
		"hub/list/uncheck/all" : function () {
			var a = this;
			a.$listCheck.filter(":not(:disabled)").prop("checked", !1)
		},
		"dom/action.click" : a.noop,
		"dom/action/list/check.click" : function () {
			var a = this;
			a.publish("toggle/mass/action")
		},
		"dom/action/profile/open.click" : function (b, c) {
			c.preventDefault();
			var e = a(c.target),
			f = e.attr("href");
			d.window({
				url : f,
				name : "User Profile",
				width : "1024"
			})
		},
		"dom/action/show/document.click" : function (b, c) {
			c.preventDefault();
			var d = this;
			a(c.target),
			d.publish("slide-helper/attachment/reload", d._json.uuidname, null, d._json.ext)
		},
		"dom/action/add/to/folder.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target),
			f = [];
			d._json.islimited || d._isAdmin || (function () {
				d._json.folders.forEach(function (a) {
					f.push(a.id)
				})
			}
				(), d.publish("modal/add-to-folder/show", {
					ids : [d._json.id],
					type : "document",
					folders : f,
					multiSelect : !0,
					onSuccess : function (a) {
						d._json.folders = a,
						d.$folderCount.text(a.length),
						e.find(".muted").text(d.getFolderName(a))
					}
				}))
		},
		"dom/action/attachment/download.click" : function (a, b) {
			b.preventDefault();
			var c = this;
			window.open(i.DOWNLOAD.replace("<uuidname>", c._json.uuidname), "target=_blank")
		},
		"dom/action/attachment/delete.click" : function (b, e) {
			e.preventDefault();
			var f = this,
			g = a(e.target),
			h = window.confirm("你确认要删除文件吗？");
			h && f.publish("ajax", {
				url : i.DELETE,
				type : "post",
				data : {
					data : JSON.stringify({
						uuidnames : [f._json.uuidname]
					})
				}
			}, c().done(function () {
					d.alert("success", "Delete attachment successfully!"),
					g.closest("li").remove(),
					f.$count.text(parseInt(f.$count.text(), 10) - 1)
				}))
		},
		"dom/action/import/to/system.click" : function (b, c) {
			c.preventDefault();
			var d = this;
			a(c.target),
			window.open(i.ADD_CANDIDATE.replace("<file>", d._json.uuidname), "_blank")
		},
		_getType : function (a) {
			var b = "";
			return j.test(a) && (b = "image"),
			b
		},
		getFolderName : function (a) {
			var b = "",
			c = [];
			return a.length && (a.forEach(function (a) {
					c.push(a.name)
				}), b = c.join(", ")),
			b
		}
	})
}), define("troopjs-requirejs/template!app/widget/document/filter/main.html", [], function () {
	return function () {
		var a = '<ul class="nav nav-pills line_sep">\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Attachment Text"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <input type="text" name="content" data-weave="shared/widget/common/tagit/main">\n                    <div class="help-block" data-i18n="Separate keywords" data-weave="shared/helper/translation"></div>\n                </div>\n                \n                <button class="btn" type="submit" data-action="form(\'content\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Document name"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <input type="text" name="name">\n                </div>\n                \n                <button class="btn" type="submit" data-action="form(\'originname\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Upload Date"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <input type="text" name="from" class="date input-small" data-weave="shared/widget/common/date-picker/main">\n                    -\n                    <input type="text" name="to" class="date input-small" data-weave="shared/widget/common/date-picker/main">\n                </div>\n                \n                <button class="btn" type="submit" data-action="form(\'dateAdded\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Folder"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <div class="comtree span" data-name="folder" data-weave="shared/widget/common/comtree/main" data-hub="update/document/folder"></div>\n                </div>\n                \n                <button class="btn" type="submit" data-action="form(\'folder_id\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="User"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <select data-placeholder="Choose a user..." name="name" class="input-large" data-weave="shared/widget/common/user-list/main"></select>\n                </div>\n                \n                <button class="btn" type="submit" data-action="form(\'user_id\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n</ul>\n\n<p>\n    <span class="tag label label-info deletable hide" data-query="content" data-action="tag/remove"><b data-i18n="Attachment Text" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="originname" data-action="tag/remove"><b data-i18n="Document name" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="dateAdded" data-action="tag/remove"><b data-i18n="Upload Date" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="folder_id" data-action="tag/remove"><b data-i18n="Folder" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="user_id" data-action="tag/remove"><b data-i18n="User" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n\n    <a href="#" class="hide save-filter" data-action="filter/save/toggle" data-weave="shared/helper/translation" data-i18n="Save as"></a>\n</p>\n\n<form action="#" class="form-horizontal save-filter-form hide">\n    <input type="text" class="input-large">\n    <button class="btn" data-action="filter/save" data-weave="shared/helper/translation" data-i18n="Save"></button>\n    <button class="btn" data-action="filter/save/toggle" data-weave="shared/helper/translation" data-i18n="Close"></button>\n</form>';
		return a
	}
}), define("app/widget/document/filter/main", ["compose", "jquery", "shared/widget/filter/base", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "shared/widget/filter/query"], function (a, b, c, d, e, f, g) {
	function h() {
		g.addAttr({
			content : function (a) {
				var c = b.trim(a.find("input").val());
				c.length && this.addQuery("content", "content=" + encodeURIComponent(c))
			},
			originname : function (a) {
				var c = b.trim(a.find("input").val());
				c.length && this.addQuery("originname", "originname=" + encodeURIComponent(c))
			},
			dateAdded : function (a) {
				var b = a.find('input[name="from"]').val(),
				c = a.find('input[name="to"]').val();
				b && c && this.addQuery("dateAdded", "dateAdded__gt=" + b + "&dateAdded__lt=" + c)
			},
			folder_id : function (a) {
				var b = a.find('[name="folder"]').val();
				b.length && this.addQuery("folder_id", "folder_id=" + b)
			},
			user_id : function (a) {
				var b = a.find('select[name="name"]').val();
				b.length && this.addQuery("user_id", "user_id=" + b)
			}
		})
	}
	function i(a) {
		var b = this;
		d(function (a) {
			b.html(e, this._json, a)
		}).done(function () {
			j.call(b, a)
		})
	}
	function j(a) {
		var b = this;
		b.folderWidget = b.$element.find('[data-name="folder"]').woven()[0],
		a.resolve()
	}
	function k(a) {
		var b,
		c = this,
		d = a[0],
		e = a[1];
		switch (d) {
		case "dateAdded__gt":
		case "dateAdded__lt":
			if ("dateAdded__gt" === d ? c.updateFrom = e : "dateAdded__lt" === d && (c.updateTo = e), c.updateFrom && c.updateTo)
				return c.$element.find('[data-query="dateAdded"]').removeClass("hide").find("span").text(c.updateFrom + " - " + c.updateTo), g.addQuery("dateAdded", "dateAdded__gt=" + c.updateFrom + "&dateAdded__lt=" + c.updateTo), void 0;
			break;
		case "user_id":
			b = c.$element.find('select[name="name"]').find('[value="' + e + '"]').text(),
			c.$element.find('[data-query="' + d + '"]').removeClass("hide").find("span").text(b),
			g.addQuery(d, d + "=" + e);
			break;
		case "folder_id":
			b = c.folderWidget.getNodeNameById(e),
			c.$element.find('[data-query="' + d + '"]').removeClass("hide").find("span").text(b),
			g.addQuery(d, d + "=" + e);
			break;
		case "byfilter":
			break;
		default:
			c.$element.find('[data-query="' + d + '"]').removeClass("hide").find("span").text(window.decodeURIComponent(e)),
			g.addQuery(d, d + "=" + e)
		}
	}
	function l() {
		var a = this;
		g.url = m.SAVE_FILTER,
		a._setFilter = k
	}
	var m = {
		SAVE_FILTER : "/rest/data/queryfilter/document/add"
	};
	return c.extend(function () {
		var a = this;
		l.call(a),
		h.call(a)
	}, {
		"sig/initialize" : function (a, b) {
			i.call(this, b)
		},
		"hub:memory/filter/set" : a.around(function (a) {
			return function (b, c) {
				a.call(this, b, c),
				l.call(this)
			}
		})
	})
}), define("troopjs-requirejs/template!app/widget/document/list/main.html", [], function () {
	return function () {
		var a = "";
		return "Admin" === this.context.user.role,
		a += '\n<div class="well well-small action-bar clearfix">\n    \n    <div class="pull-left">\n        <label class="checkbox inline">\n            <input type="checkbox" data-action="list/toggle/all"> <span data-weave="shared/helper/translation" data-i18n="Select All"></span>\n        </label>\n\n        <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="Upload" data-action="upload"></button>\n        <span class="mass-action">\n            <button class="btn btn-small disabled hide" data-weave="shared/helper/translation" data-i18n="Download" data-action="mass/download"></button>\n            <button class="btn btn-small disabled" data-weave="shared/helper/translation" data-i18n="Add to Folder" data-action="mass/to/folder"></button>\n            <button class="btn btn-small disabled hide" data-weave="shared/helper/translation" data-i18n="Import to system" data-action=""></button>\n            <button class="btn btn-small disabled hide" data-weave="shared/helper/translation" data-i18n="Change permission" data-action=""></button>\n            <button class="btn btn-small btn-danger disabled" data-weave="shared/helper/translation" data-i18n="Delete" data-action="mass/delete"></button>\n        </span>\n    </div>\n\n    <div class="pull-right">\n        <span>显示: </span>\n        <select class="sort input-small" data-weave="shared/widget/list-paginate/main(' + this._listType + ')" data-action="paginate">\n            <option value="10">10</option>\n            <option value="25">25</option>\n            <option value="50">50</option>\n        </select>\n        <button class="btn btn-small" data-action="listview" data-toggle="tooltip"><span class="icon-test"></span></button>\n    </div>\n</div>\n\n<!-- pagination -->\n<div class="pagination clearfix hide" data-weave="shared/widget/pagination/main(\'' + this._listType + '\')"></div>\n\n<div class="loading-area widget-spin">\n    ',
		a += this.viewType ? '\n    <table class="table table_vam table-candidate table-bl">\n        <colgroup>\n            <col width="30">\n            <col>\n            <col>\n            <col>\n            <col>\n            <col width="60">\n        </colgroup>\n        <thead>\n            <tr>\n                <th></th>\n                <th data-weave="shared/helper/translation" data-i18n="Document name"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Size"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Upload Date"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Upload User"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Operation"></th>\n            </tr>\n        </thead>\n        <tbody class="list-container">\n        </tbody>\n    </table>\n    ' : '\n    <div class="search_panel list-container clearfix"></div>\n    ',
		a += '\n</div>\n<!-- pagination -->\n<div class="pagination clearfix hide" data-weave="shared/widget/pagination/main(\'' + this._listType + "')\"></div>"
	}
}), define("app/widget/document/list/main", ["jquery", "shared/widget/list/base", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		c(function (a) {
			b.html(d, a)
		}).done(function () {
			b.$container = b.$element.find(".list-container"),
			b.$massActions = b.$element.find(".mass-action .btn"),
			b.$toggleAll = b.$element.find('[data-action="list/toggle/all"]'),
			b.$listview = b.$element.find('[data-action="listview"]'),
			b.viewType ? b.$listview.addClass("table-view").attr("title", "切换为详细视图").find("span").attr("class", "icon-sqaures") : b.$listview.addClass("detail-view").attr("title", "切换为列表视图").find("span").attr("class", "icon-list"),
			b.$element.tooltip({
				selector : '[data-toggle="tooltip"]',
				trigger : "hover"
			}),
			a.resolve()
		})
	}
	var g = {
		LIST : "/rest/document/list?",
		DELETE : "/rest/file/del"
	};
	return b.extend(function () {
		this._url = g.LIST,
		this._listType = "document"
	}, {
		render : function (a) {
			f.call(this, a || c())
		},
		appendItems : function (a) {
			var b = this;
			b.$toggleAll.prop("checked", !1),
			b.$toggleAll.prop("indeterminate", !1),
			b.viewType ? a.forEach(function (a) {
				b.$container.append("<tr></tr>"),
				b.$container.children().last().data("json", a).attr("data-weave", "app/widget/document/detail/main(json, " + b.viewType + ")").weave()
			}) : a.forEach(function (a) {
				b.$container.append('<div class="search_item clearfix"></div>'),
				b.$container.children().last().data("json", a).attr("data-weave", "app/widget/document/detail/main(json, " + b.viewType + ")").weave()
			})
		},
		"dom/action/upload.click" : function () {
			var a = this;
			a.publish("modal/upload-document/show", {
				onSuccess : function () {
					a.publish("list/reload")
				}
			})
		},
		"dom/action/mass/to/folder.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target);
			if (!e.hasClass("disabled")) {
				var f = d.$element.find('[data-action="list/check"]').filter(":checked"),
				g = [];
				f.each(function () {
					g.push(a(this).data("json").id)
				}),
				d.publish("modal/add-to-folder/show", {
					multiSelect : !0,
					ids : g,
					type : "document",
					onSuccess : function () {
						d.publish("list/reload")
					}
				})
			}
		},
		"dom/action/mass/delete.click" : function (b, d) {
			var f = this,
			h = a(d.target);
			if (!h.hasClass("disabled")) {
				var i = window.confirm("确定要删除所选文件吗?");
				if (i) {
					var j = f.$element.find('[data-action="list/check"]').filter(":checked"),
					k = [];
					j.each(function () {
						k.push(a(this).data("json").uuidname)
					}),
					f.publish("ajax", {
						url : g.DELETE,
						type : "post",
						data : {
							data : JSON.stringify({
								uuidnames : k
							})
						}
					}, c().done(function (a) {
							a.status ? (f.publish("list/reload"), e.alert("success", "文档删除成功!")) : e.alert("error", a.message)
						}))
				}
			}
		}
	})
}), define("troopjs-requirejs/template!app/widget/document/preview/main.html", [], function () {
	return function () {
		var a = '<div class="well well-small">\n    <p>\n        <button class="btn" data-action="find/duplicate">检查系统内已有人才</button>\n        <span class="count-info hide">重复数据: <strong class="red"></strong></span>\n    </p>\n    \n    <p class="muted">\n        点击后，系统将遍历文档内的所有手机与邮件地址，并将系统中已录入的人才高亮显示出来，点击高亮内容可以直接打开人才详情。\n    </p>\n</div>\n\n<iframe frameborder="0" id="attachment-frame" width="100%" height="100%"></iframe>';
		return a
	}
}), define("app/widget/document/preview/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "shared/helper/utils", "hilitor"], function (a, b, c, d, e) {
	function f() {
		var a = this,
		b = i.PREVIEW.replace("<uuidname>", a._uuidname);
		a.$element.addClass("widget-spin"),
		a.$frame.attr("src", b)
	}
	function g(a) {
		var b = this;
		c(function (a) {
			b.html(e, a)
		}).done(function () {
			h.call(b, a)
		})
	}
	function h(a) {
		var b = this;
		b.$frame = b.$element.find("iframe"),
		b.$countInfo = b.$element.find(".count-info"),
		b.$count = b.$countInfo.find("strong"),
		b.$frame.on("load", function () {
			b.$element.removeClass("widget-spin"),
			b.$frame.height(b.$frame.contents().height())
		}),
		a.resolve()
	}
	var i = {
		PREVIEW : "/rest/file/preview/<uuidname>",
		FIND : "/rest/document/find_candidate?uuidname=<uuidname>"
	};
	return b.extend(function (a, b, c) {
		this._uuidname = c
	}, {
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"hub:memory/route" : function (a, b) {
			var c = this,
			d = b.path,
			e = d ? d[0] : null;
			e && (c.$countInfo.addClass("hide"), c._uuidname = e ? e.split("=")[1] : "", f.call(c))
		},
		"dom/action.click" : a.noop,
		"dom/action/find/duplicate.click" : function (b, d) {
			d.preventDefault();
			var e = this,
			f = new Hilitor("attachment-frame", null, !0);
			e.publish("ajax", {
				url : i.FIND.replace("<uuidname>", e._uuidname)
			}, c().done(function (b) {
					var c,
					d = [];
					if (b.email)
						for (c in b.email)
							d.push(c);
					if (b.mobile)
						for (c in b.mobile)
							d.push(c);
					e.$countInfo.removeClass("hide"),
					e.$count.text(b.count),
					f.apply(d.join(" ")),
					a(".hilitor", frames[0].document).on("click", function (c) {
						c.preventDefault(),
						c.stopPropagation();
						var d = a(this).text();
						b.email[d] && window.open("/candidate#detail!id=" + b.email[d], 'target="_blank"'),
						b.mobile[d] && window.open("/candidate#detail!id=" + b.mobile[d], 'target="_blank"')
					})
				}))
		}
	})
}), define("troopjs-requirejs/template!app/widget/extension/main.html", [], function () {
	return function () {
		var a = '<h3 class="heading" data-weave="shared/helper/translation" data-i18n="System Plugins"></h2>\n<p class="gray">谷露招聘管理系统提供了一个强大的插件系统，能够帮您增加一些有用的功能。<br/>\n如需要启用某项插件，请联系谷露软件。</p>\n\n<hr>\n\n<div class="list">\n    <div class="item clearfix">\n        <div class="thumbnail span1">\n            \n            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2hpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowMjgwMTE3NDA3MjA2ODExODA4M0E5NTgxRDhCNUQ0QyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDowRUZBODhGMDU3NEIxMUUyQjE5M0NENDAwNTVDOUY2NyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowRUZBODhFRjU3NEIxMUUyQjE5M0NENDAwNTVDOUY2NyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MDI4MDExNzQwNzIwNjgxMTgwODNBOTU4MUQ4QjVENEMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MDI4MDExNzQwNzIwNjgxMTgwODNBOTU4MUQ4QjVENEMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7z3uWIAAAKq0lEQVR42uydCXBV1R3G/3kxGAIhILFsJsoeMMRUSJFBxoFSKVqdYUlVqgVb2srWxipo7VBmOkyr0k5baB2obV0QRGtsJ4pF2igIhB0xgYhZgIRm3/eEhKTfP+8wDTEh7753t/fu/5v55mQg977kfr+ce+7ZblBHRweJnCuXXAIBQCQAiAQAkQAgEgBEAoBIABAJACIBQCQAiAJdN/jDDzlny8FoFDHwaHgkPAq+BR4Gh8MD4QGq7K42uFq5SpVlcB6cD19UZfZHa+5udRoAQXYaDELQXCPFwjPhBHiycrgJH8+gfAFnKJ+GDwOKKgHA2NDvQHE/fA98FzzIRteHL85Z+BB8AE4FEMUCgG+Bh6D4BvwA/C1VlfuL+GKdgt+Hd8MnAUS7AOBZ8FNRfBdeAkcGyB9QEbyTDRBOCQBfDp0bZsvgFfDtAd6e4vbDdvhvgKHI0QAgeG6pr4KfgG9yWMOaG5PJ8J8AwgFHAYDgR6BYDy+HQ+Qpm9Lh5+G/A4a2gAUAwQ9GsRZOgsMk9y8pF94Iv2E3EHwCAMEHq2r+lw6s6r0FYYNqNHb4NQCqVf8y/FXJVbOOwU8CgjS/AwDB34jiF/AzcLBk6ZN2wU8DhAK/AADhT1LPvfGSnW6qg5+C/2LFbcFjABD+Yyi2SiPPMH0Mfx8QXLAVAKrr9vfwSsnIcDXAqwHBq7YAAOFzy/4deLZkY6regFcAhHrLAED4USg+hCdJHpaIu5YTAUGGkR/i6iX8cSgOS/iWaiJ8BFksMLUGwAdOQZEK3ywZ9K3vxY2keXHDqaSmhfIrGiintJ4y4Zy6ZmrXr03/HGqCXxsOgPrLT5PwtenJGbfSA9Oirvm3suomOpJTTodyK+hEWb0eMGxVDcQrhgCg7vlc7Y+SSLWpH26kf3gwliZGDe7x/4sqGmn36QLaAyAqL/uU39vwY4Dgsq4AIPwIfH2Q3PPxRF5o0uD+tOXRqeQK6v17GptbKeXEfyn5bDFVeA/Ce/BivSAI/mToXO7OTSH3fDyRlypvbqOR/YJp7IjepzSG3BBMsdFDaP7k4RTU0kbZqBmuaL81cOMw/rVj+clLp0f7fDvgp4BN8FyJ0He981mhR98XHhZCP/j6eNqWGEdTbx7ozUfxfModajTWZwB4ZIonOLZJhL4pp66FTqPR56mivxJOmx6Op9UJURQaHKT14xbDW/RsBHLL/yH4h/AUidM7PTg2kpLui9F8XHZBDT2/N4su1LdoPfRZtAde0K0fQMEwi9x9/4tIpnZp0vD+IbRz+XSvjq2pv0yb/nWO0oprtRzGAS4EBP/UDYAuIPCSrJ+qWqG/xOuZtj8ST6Mivbq3U3t7B23e8wWl5JZrOYzHDL4GCD7XFYAuIPA8/nXwGjhUIr6+1s4cTfPv9K075eXUbHozs0TLIefgaYCgQWsjsE/hpOUwAzABfk1VO6Lekiiu8/kc/JSwZPIwLYfEeNMo1LQ8HBBcgpepPoPPJOqedam6SZfzLAcEC8dr6pV/HLV1omEAdAGBHx2ncQsUviyRX6uLtU26nWvlvRNo1sgILYe8BAiGGwqAgqBNPX5MV/cfkVJ1a3vnYJAecrmCaN39MTQu/EZPD+H22mbDAegCAq+j5yniOyX6/6uoqlG3cw0IDaFn502kMM87ixJRC9xnCgAKAv5tH4V/Jg1Et8pqW3Q935gRg2hZvKaV9H9UU/iNB0BB0AHzOjiePdzqdABK61p0P+fCGbdS3E0eT8rm7XR+bBoAXUDYQe5+akdDUF6vf9uYh5qXzxytJbSfq4m95gGgIODh5UfgdqcCUNlozMNR7G1D6G7Pnwr4G9eZDoCCgNfIr3AqAFVNxlWAi6dqagusVj255gKgIPgzN0Yc2QYwEACuBWIiPB6aGXC9toAZG0XyYFKa0wCoaG7tHNgxSveMHaq1FgizBAC1+SI/ItY7CYBWZF9S1WTY+RPGaNqOYQj8HatqAFILHp923G2gxjgAuF9gUIim+FZZBoASbyZx1EkAFNc0G3r+6IGaRubvwG3gTssAUBsqrnISAHkVjYaePyJU81bPS62sARiCk+RebewI5RvYBugML0jzRNJFqAWCLANAiTdJcsR4wYVqY2uASu2PmjxNKcFSAFALZKL4wAkAFDW3UWF5gyHnbrvSQXl1XrUxvml1DcD6rVNuA8fPVxpy3vQLFVTf5lVP+1w7ALAPznYCAIcvGgPA7gyvd61PUNv+WAeA2g3rr04A4ERpHeWX1ul6Tl59tL+g2tvD+dkxzuoagPWmEwDg3uBdRy/pdr6yqkb63b5cX/cbmGw5AKgF+D09jugY2ovbwPGscp/Pw/sMrE/JpEu+DzVPsEMNwHrfEbUA/OK+HMotrPX6HIcySyjp3XTKqtWld3GSXQBwxOMgq6KljdamnKGP0gs1HXcuv4o2JGfQ+tRsKmvWbQH3bVe/sPq1cZ/CvP5pmBMg4OniG/efp3+kF9PscZE0JSqCbhkaRv1D3Y3yqroWKqluorzyBsoqqaczJXWUXWvIeMKQq1/Y4a1hr1IPfdQiQ1WJNthQO9wCOtuDkofpGmyXNgDroORhuly2AQBV0XkUxZKJxSRYrAMShamqtxsAaZKJqbpiNwAOSyamqsxuAPAKY9lnwDzl2QoANAR5JeUpycU0XbRbDcA6KrmYpnw7AnBEcjFNnwoAztYx2wGAdgDfl0okG+MbgLjWJXasAaQWMEfX9LnYDYBPJB/D9Z6dAZCRQWPFM0o+sDMAvPtoueRkmPbh/l9jWwDUdPGPJSfDtKP7P7hs+EN+KDkZoir4LX8AgBspstmk/nodNWyT7QHAD1mK4pDkpat4ZvpLPf2Hy6Y/sOw7rK+24w8ry58A4E0kWiU3XcSTPzb29p+2BAC08oSFZMlOF72C65njVwAobZXsfBavTX/uet9gWwBA7X4UJyRDn7RW1abkjzUA61eSodficZVX+vomuwPAL0M8KVlqFu9I8bjqWfVfANQv8IzkqVk/UgtuyN9rAIYgFcXbkqnH2oxr5vHuKy4/+aWS4BrJtk/thZ/ScoBfAACii1A8IfleV7y24tv8Or+AA0BBsAvF65Jzj+KOnnu7j/UHFABKXAvIApJrdQae1dfzfkAAoIYzF8AFknunjsNzcF28Xl7vbzXA1e3l5kujkPjNbLO9/cv3WwAUBBko5sHVDg2fe0gX4Dr4vBO15ZtE+aI5Ww5OQfFvcsguY+SeMLsUweu2vZ7Ln6+Gqgnugj93QPg8VS5Wz/D9vgboUhOEk3vgY1EABs/LuH6C4N8y4uQBAUAXEFai2ASHBcCvc3VH9XUIv8qoDwkoABQE41Fs4xayH/8aPCk2CcEbPh8i4ADoAsLDKF6Eo/zox+Zl2xsQ/B6zPjBgAVAQ9CN37yG/QXuUjat6XgzzGzXyaaoCGoBuIDwEr6Fub82yUNybyUu1tnk6di8A6AMDvy5lCZwIjzH54/nVIdyD9y65F2q2W309HAdADzBwj+IceAYcofNH8DA2b8jAO6H+B4Gftds1cDQA3WDgTjF+gmAobodHk/vFCtzLGAkPgkO6HcavAOFtVwvV8zq/JJurcw46Q81jsLUEAIfLJZdAABAJACIBQCQAiAQAkQAgEgBEAoBIABAJAKJA1/8EGAAESZu1emK9TQAAAABJRU5ErkJggg==" height="60" width="60">\n\n\n        </div>\n\n        <div class="content pull-left">\n            <h4 class="pull-left">No.1 简历自动导入</h4>\n            <span class="label label-warning pull-left">已启用</span>\n\n            <p class="sepH_b item-description clearfix">\n                此插件需要安装Google Chrome扩展程序。安装后，可以一键导入来自招聘网站的简历。目前支持的招聘网站有：“智联招聘”；“51Job”。<br/>\n                支持导入的简历类型正在持续增加中。\n            </p>\n            <p class="item-info clearfix">\n                <span>\n                    版本：1.0\n                </span>\n                <span>\n                    <span data-weave="shared/helper/translation" data-i18n="Update Date"></span>: 2013-3-3\n                </span>\n                <span>\n                    <a href="http://support.gllue.com/?p=450" target="_blank">插件下载及教程</a>\n                </span>\n                <span>\n                    价格：待定\n                </span>   \n            </p>\n        </div>\n    </div>\n</div>';
		return a
	}
}), define("app/widget/extension/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "shared/helper/utils", "template!./main.html"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		b.html(e, b._json, a)
	}
	return b.extend({
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		}
	})
}), define("troopjs-requirejs/template!app/widget/floating/filter/main.html", [], function () {
	return function () {
		var a = '<ul class="nav nav-pills line_sep">\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Candidate"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <input type="text" class="input-medium" autocomplete="off">\n                </div>\n                <button class="btn" type="submit" data-action="form(\'candidate_name\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Contact"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <input type="text" class="input-medium" autocomplete="off">\n                </div>\n                <button class="btn" type="submit" data-action="form(\'contact_name\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Company"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <input type="text" class="input-medium" autocomplete="off">\n                </div>\n                <button class="btn" type="submit" data-action="form(\'contact_company_name\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Note"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <input type="text" name="note__icontains">\n                </div>\n                <button class="btn" type="submit" data-action="form(\'note__icontains\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Time"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <input type="text" name="from" class="input-small" data-weave="shared/widget/common/date-picker/main"> - <input type="text" name="to" class="input-small" data-weave="shared/widget/common/date-picker/main">\n                </div>\n                <button class="btn" type="submit" data-action="form(\'time\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Feedback"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <select name="feedback"></select>\n                </div>\n                <button class="btn" type="submit" data-action="form(\'feedback\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Status"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <select name="done__eq">\n                        <option value="1" data-i18n="Done" data-weave="shared/helper/translation"></option>\n                        <option value="" data-i18n="Not done" data-weave="shared/helper/translation"></option>\n                    </select>\n                </div>                \n                <button class="btn" type="submit" data-action="form(\'done__eq\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="User"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <select data-placeholder="Choose a user..." name="user__eq" class="input-large" data-weave="shared/widget/common/user-list/main">\n                    </select>\n                </div>                \n                <button class="btn" type="submit" data-action="form(\'user__eq\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Team"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <div class="comtree span2" data-name="team_id" data-url="/rest/data/team" data-weave="shared/widget/common/comtree/main"></div>\n                </div>\n                <div class="control-group help-block">\n                    搜索团队拥有的项目\n                </div>\n                <button class="btn" type="submit" data-action="form(\'team_id\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n</ul>\n\n<p class="sepH_b">\n    <span class="tag label label-info deletable hide" data-query="candidate_name" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Candidate"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="contact_name" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Contact"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="contact_company_name" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Company"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="note__icontains" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Note"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="time" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Time"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="feedback" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Feedback"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="done__eq" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Status"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="user__eq" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="User"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="team_id" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Team"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    \n    <a href="#" class="hide save-filter" data-action="filter/save/toggle" data-weave="shared/helper/translation" data-i18n="Save as"></a>\n</p>\n\n<form action="#" class="form-horizontal save-filter-form hide">\n    <input type="text" class="input-medium">\n    <button class="btn" data-action="filter/save" data-weave="shared/helper/translation" data-i18n="Save"></button>\n    <button class="btn" data-action="filter/save/toggle" data-weave="shared/helper/translation" data-i18n="Close"></button>\n</form>';
		return a
	}
}), define("app/widget/floating/filter/main", ["compose", "jquery", "shared/widget/filter/base", "troopjs-utils/deferred", "template!./main.html", "shared/widget/filter/query", "shared/helper/utils"], function (a, b, c, d, e, f) {
	function g() {
		f.addAttr({
			candidate_name : function (a) {
				var c = b.trim(a.find("input").val());
				c.length && this.addQuery("candidate_name", "candidate_name=" + encodeURIComponent(c))
			},
			contact_name : function (a) {
				var c = b.trim(a.find("input").val());
				c.length && this.addQuery("contact_name", "contact_name=" + encodeURIComponent(c))
			},
			contact_company_name : function (a) {
				var c = b.trim(a.find("input").val());
				c.length && this.addQuery("contact_company_name", "contact_company_name=" + encodeURIComponent(c))
			},
			note__icontains : function (a) {
				var c = b.trim(a.find("input").val());
				c.length && this.addQuery("note__icontains", "note__icontains=" + encodeURIComponent(c))
			},
			time : function (a) {
				var b = a.find('input[name="from"]').val(),
				c = a.find('input[name="to"]').val();
				b && c && this.addQuery("time", "dateAdded__gt=" + b + "&dateAdded__lt=" + c)
			},
			done__eq : function (a) {
				var b = a.find(":selected"),
				c = b.val();
				this.addQuery("done__eq", "done__eq=" + c)
			},
			user__eq : function (a) {
				var b = a.find("select").val();
				b.length && this.addQuery("user__eq", "user__eq=" + b)
			},
			team_id : function (a) {
				var b = a.find('[name="team_id"]').val();
				b.length && this.addQuery("team_id", "team_id=" + b)
			},
			feedback : function (a) {
				var b = a.find("select").val();
				b.length && this.addQuery("feedback", "feedback=" + encodeURIComponent(b))
			}
		})
	}
	function h(a) {
		var b = this;
		b.publish("ajax", {
			url : l.FEEDBACK
		}, d().done(function (c) {
				b._feedback = c,
				d(function (a) {
					b.html(e, b._json, a)
				}).done(function () {
					i.call(b, a)
				})
			}))
	}
	function i(a) {
		var b = this,
		c = b.$element.find('[name="feedback"]');
		b._feedback.forEach(function (a) {
			c.append('<option value="' + a.code + '">' + a.value + "</option>")
		}),
		a.resolve()
	}
	function j(a) {
		var b,
		c = this,
		d = a[0],
		e = a[1];
		switch (d.indexOf("dateAdded") > -1 && (d = "dateAdded"), d) {
		case "note":
			c.$element.find('[data-query="note"]').removeClass("hide").find("span").text(decodeURIComponent(e)),
			f.addQuery("note", a[0] + "=" + e);
			break;
		case "dateAdded":
			if (a[0].indexOf("gt") > -1 ? c.dateFrom = e : a[0].indexOf("lt") > -1 && (c.dateTo = e), c.dateFrom && c.dateTo)
				return c.$element.find('[data-query="time"]').removeClass("hide").find("span").text(c.dateFrom + " - " + c.dateTo), f.addQuery("time", "dateAdded__gt=" + c.dateFrom + "&dateAdded__lt=" + c.dateTo), void 0;
			break;
		case "done__eq":
		case "user__eq":
		case "feedback":
		case "done__eq":
			b = c.$element.find('[name="' + d + '"]').find('[value="' + window.decodeURIComponent(e) + '"]').text(),
			c.$element.find('[data-query="' + d + '"]').removeClass("hide").find("span").text(b),
			f.addQuery(d, d + "=" + e);
			break;
		case "team_id":
			b = c.$element.find('[data-name="' + d + '"]').woven()[0].getNodeNameById(window.decodeURIComponent(e)),
			c.$element.find('[data-query="' + d + '"]').removeClass("hide").find("span").text(b),
			f.addQuery(d, d + "=" + e);
			break;
		case "byfilter":
			break;
		default:
			c.$element.find('[data-query="' + d + '"]').removeClass("hide").find("span").text(window.decodeURIComponent(e)),
			f.addQuery(d, d + "=" + e)
		}
	}
	function k() {
		var a = this;
		a.dateFrom = null,
		a.dateTo = null
	}
	var l = {
		SAVE_FILTER : "/rest/data/queryfilter/floating/add",
		FEEDBACK : "/rest/data/options?type=floating_feedback"
	};
	return c.extend(function () {
		var a = this;
		f.url = l.SAVE_FILTER,
		a._setFilter = j,
		k.call(a),
		g.call(a)
	}, {
		"sig/initialize" : function (a, b) {
			h.call(this, b)
		},
		"hub:momery/filter/set" : a.around(function (a) {
			return function (b, c) {
				a.call(this, b, c),
				k.call(this)
			}
		})
	})
}), define("troopjs-requirejs/template!app/widget/floating/item.html", [], function () {
	return function (a) {
		var b = '<td>\n    <input type="checkbox" data-action="check/one" data-id="' + a.id + '" ';
		return a.done && (b += 'checked="checked"'),
		b += '>\n</td>\n<td>\n    <a href="/mail/center#outbox/' + a.email + '" target="_blank"><span class="icon-envelope icon-blue"></span></a>\n</td>\n<td>\n    <a href="/candidate#detail!id=' + a.candidate.id + '" target="_blank">' + [a.candidate.englishName, a.candidate.chineseName].join(" ").trim() + '</a>\n</td>\n<td>\n    <a href="/candidate#detail!id=' + a.clientContact.id + '" target="_blank">' + [a.clientContact.englishName, a.clientContact.chineseName].join(" ").trim() + '</a>\n</td>\n<td>\n    <a href="/company#detail!id=' + a.clientContact.company.id + '" target="_blank">' + a.clientContact.company.name + '</a>\n</td>\n<td>\n    <a href="#" data-type="textarea" data-pk="' + a.id + '" data-value="' + a.note + '" class="note"></a>\n</td>\n<td>\n    ' + a.dateAdded + '\n</td>\n<td>\n    <a href="/user/preview#' + a.user.id + '" data-action="open/profile">' + a.user.englishName + '</a>\n</td>\n<td>\n    <a href="#" data-type="select" data-pk="' + a.id + '" class="feedback" style="color: ' + a.feedback.color + ';" data-placement="left">' + a.feedback.code + "</a>\n</td>"
	}
}), define("app/widget/floating/item", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./item.html", "shared/helper/utils", "shared/helper/blurb", "bootstrap.editable"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		c(function (a) {
			b.html(d, b._json, a)
		}).done(function () {
			g.call(b, a)
		})
	}
	function g(b) {
		var c = this;
		c.$element.find("a.note").editable({
			emptytext : "未填写",
			url : h.EDIT,
			params : function (a) {
				return a.note = a.value,
				a.id = a.pk,
				delete a.value,
				delete a.pk,
				delete a.name, {
					data : JSON.stringify(a)
				}
			},
			success : function (a) {
				a.status ? e.alert("success", "备注修改成功!") : e.alert("error", a.message)
			},
			error : function (a) {
				var b = JSON.parse(a.responseText);
				e.alert("error", b.message)
			}
		}),
		c.$element.find("a.feedback").editable({
			emptytext : "未知",
			source : h.FEEDBACK,
			sourceCache : !0,
			url : h.EDIT,
			params : function (a) {
				return a.feedback = a.value,
				a.id = a.pk,
				delete a.value,
				delete a.pk,
				delete a.name, {
					data : JSON.stringify(a)
				}
			},
			success : function (b) {
				b.status ? a(this).css("color", b.data.feedback.color).text(b.data.feedback.value) : e.alert("error", b.message)
			},
			error : function (a) {
				var b = JSON.parse(a.responseText);
				e.alert("error", b.message)
			}
		}),
		b.resolve()
	}
	var h = {
		EDIT : "/rest/floating/edit",
		FEEDBACK : "/rest/data/options?type=floating_feedback"
	};
	return b.extend(function (a, b, c) {
		var d = this;
		d._json = c,
		d._feedback = []
	}, {
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"dom/action.click.change" : a.noop,
		"dom/action/open/profile.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			f = d.attr("href");
			e.window({
				url : f,
				name : "User Profile",
				width : "1024"
			})
		},
		"dom/action/check/one.click" : function (b, d) {
			var f = this,
			g = a(d.target),
			i = {
				id : f._json.id,
				done : null
			};
			i.done = g.is(":checked") ? !0 : !1,
			f.publish("ajax", {
				url : h.EDIT,
				data : {
					data : JSON.stringify(i)
				},
				type : "post"
			}, c().done(function (a) {
					a.status ? e.alert("success", "状态更新成功!") : e.alert("error", a.message)
				}))
		}
	})
}), define("troopjs-requirejs/template!app/widget/floating/list/main.html", [], function () {
	return function () {
		var a = '<div class="well well-small action-bar clearfix">\n    <div class="pull-right">\n        <span>显示: </span>\n        <select class="sort input-small" data-weave="shared/widget/list-paginate/main(' + this._listType + ')" data-action="paginate">\n            <option value="10">10</option>\n            <option value="25">25</option>\n            <option value="50">50</option>\n        </select>\n        <select class="sort input-medium" data-weave="shared/widget/list-ordering/main(' + this._listType + ')" data-action="ordering">\n            <option value="-dateAdded">按Floating时间顺序</option>\n            <option value="dateAdded">按Floating时间倒序</option>\n            <option value="candidate_id">按候选人排序</option>\n            <option value="contact_id">按联系人排序</option>\n            <option value="clientContact">按客户公司排序</option>\n            <option value="user_id">按用户排序</option>\n            <option value="feedback">按反馈排序</option>\n        </select>\n    </div>\n</div>\n\n<!-- pagination -->\n<div class="pagination clearfix hide" data-weave="shared/widget/pagination/main(\'' + this._listType + '\')"></div>\n\n<div class="loading-area widget-spin">\n    <table class="table table-striped table-bordered table_vam">\n        <colgroup>\n            <col width="30">\n            <col width="50">\n            <col width="">\n            <col>\n            <col width="">\n            <col width="">\n            <col width="">\n            <col width="">\n            <col width="70">\n        </colgroup>\n        <thead>\n            <tr>\n                <th>\n                    <input type="checkbox" data-action="check/all">\n                </th>\n                <th>邮件</th>\n                <th data-weave="shared/helper/translation" data-i18n="Candidate"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Contact"></th> \n                <th data-weave="shared/helper/translation" data-i18n="Company"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Note"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Time"></th>\n                <th data-weave="shared/helper/translation" data-i18n="User"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Feedback"></th>\n            </tr>\n        </thead>\n        <tbody></tbody>\n    </table>\n</div>\n\n<!-- pagination -->\n<div class="pagination clearfix hide" data-weave="shared/widget/pagination/main(\'' + this._listType + "')\"></div>";
		return a
	}
}), define("app/widget/floating/list/main", ["jquery", "shared/widget/list/base", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d, e) {
	function f(a) {
		var b = this,
		c = b._json.list;
		c.length ? (b.$element.show(), b.$element.find("tbody").children().remove(), b.appendItems(c)) : b.$element.hide(),
		a.resolve()
	}
	var g = {
		DONE : "/rest/floating/done"
	};
	return b.extend(function () {
		this._url = "/rest/floating/list?",
		this._listType = "floating"
	}, {
		"sig/initialize" : function (a, b) {
			var e = this;
			c(function (a) {
				e.html(d, a)
			}).done(function () {
				e.$container = e.$element.find("table"),
				b.resolve()
			})
		},
		appendItems : function (a) {
			var b = this;
			a.forEach(function (a) {
				b.$element.find("tbody").append("<tr></tr>"),
				b.$element.find("tbody").children().last().data("json", a).attr("data-weave", "app/widget/floating/item(json)").weave()
			})
		},
		renderList : function (a) {
			f.call(this, a)
		},
		"dom/action.change" : a.noop,
		"dom/action/check/all.change" : function (b, d) {
			var f,
			h = this,
			i = a(d.target),
			j = i.is(":checked"),
			k = [];
			j ? (f = h.$element.find("tbody :checkbox").filter(":not(:disabled)").filter(":not(:checked)"), f.prop("checked", !0)) : (f = h.$element.find("tbody :checkbox").filter(":not(:disabled)").filter(":checked"), f.prop("checked", !1)),
			f.each(function () {
				k.push(a(this).data("id"))
			}),
			k.length && h.publish("ajax", {
				url : g.DONE,
				data : {
					data : JSON.stringify({
						ids : k,
						done : j
					})
				},
				type : "POST"
			}, c().done(function (a) {
					a.status ? e.alert("success", "任务状态更改成功!") : e.alert("error", a.data || a.message)
				}))
		}
	})
}), define("troopjs-requirejs/template!app/widget/invoice/filter/main.html", [], function () {
	return function () {
		var a = '<ul class="nav nav-pills line_sep">\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Added Date"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <ul class="nav nav-pills">\r\n                    <li>\r\n                        <a href="#lastUpdateDate__today=" data-type="dateAdded" data-action="date/select" data-weave="shared/helper/translation" data-i18n="Today"></a>\r\n                    </li>\r\n                    <li>\r\n                        <a href="#lastUpdateDate__this_week=" data-type="dateAdded" data-action="date/select" data-weave="shared/helper/translation" data-i18n="This week"></a>\r\n                    </li>\r\n                    <li>\r\n                        <a href="#lastUpdateDate__this_month=" data-type="dateAdded" data-action="date/select" data-weave="shared/helper/translation" data-i18n="This month"></a>\r\n                    </li>\r\n                    <li>\r\n                        <a href="#lastUpdateDate__3_months_ago=" data-type="dateAdded" data-action="date/select" data-weave="shared/helper/translation" data-i18n="> 3 months"></a>\r\n                    </li>\r\n                    <li>\r\n                        <a href="#lastUpdateDate__six_months_ago=" data-type="dateAdded" data-action="date/select" data-weave="shared/helper/translation" data-i18n="> 6 months"></a>\r\n                    </li>\r\n                    <li>\r\n                        <a href="#lastUpdateDate__one_year_ago=" data-type="dateAdded" data-action="date/select" data-weave="shared/helper/translation" data-i18n="> 1 year"></a>\r\n                    </li>\r\n                </ul>\r\n                <p>\r\n                    <input type="text" name="from" class="input-small" data-weave="shared/widget/common/date-picker/main" data-action="date"> - <input type="text" name="to" class="input-small" data-weave="shared/widget/common/date-picker/main" data-action="date">\r\n                </p>\r\n                \r\n                <button class="btn" type="submit" data-action="form(\'dateAdded\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Sent Date"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <ul class="nav nav-pills">\r\n                    <li>\r\n                        <a href="#sentDate__today=" data-type="sentDate" data-action="date/select" data-weave="shared/helper/translation" data-i18n="Today"></a>\r\n                    </li>\r\n                    <li>\r\n                        <a href="#sentDate__this_week=" data-type="sentDate" data-action="date/select" data-weave="shared/helper/translation" data-i18n="This week"></a>\r\n                    </li>\r\n                    <li>\r\n                        <a href="#sentDate__this_month=" data-type="sentDate" data-action="date/select" data-weave="shared/helper/translation" data-i18n="This month"></a>\r\n                    </li>\r\n                    <li>\r\n                        <a href="#sentDate__this_year=" data-type="sentDate" data-action="date/select" data-weave="shared/helper/translation" data-i18n="This year"></a>\r\n                    </li>\r\n                </ul>\r\n                <p>\r\n                    <input type="text" name="from" class="input-small" data-weave="shared/widget/common/date-picker/main" data-action="date"> - <input type="text" name="to" class="input-small" data-weave="shared/widget/common/date-picker/main" data-action="date">\r\n                </p>\r\n                \r\n                <button class="btn" type="submit" data-action="form(\'sentDate\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Received Date"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <ul class="nav nav-pills">\r\n                    <li>\r\n                        <a href="#paymentReceivedDate__today=" data-type="paymentReceivedDate" data-action="date/select" data-weave="shared/helper/translation" data-i18n="Today"></a>\r\n                    </li>\r\n                    <li>\r\n                        <a href="#paymentReceivedDate__this_week=" data-type="paymentReceivedDate" data-action="date/select" data-weave="shared/helper/translation" data-i18n="This week"></a>\r\n                    </li>\r\n                    <li>\r\n                        <a href="#paymentReceivedDate__this_month=" data-type="paymentReceivedDate" data-action="date/select" data-weave="shared/helper/translation" data-i18n="This month"></a>\r\n                    </li>\r\n                    <li>\r\n                        <a href="#paymentReceivedDate__this_year=" data-type="paymentReceivedDate" data-action="date/select" data-weave="shared/helper/translation" data-i18n="This year"></a>\r\n                    </li>\r\n                </ul>\r\n                <p>\r\n                    <input type="text" name="from" class="input-small" data-weave="shared/widget/common/date-picker/main" data-action="date"> - <input type="text" name="to" class="input-small" data-weave="shared/widget/common/date-picker/main" data-action="date">\r\n                </p>\r\n                \r\n                <button class="btn" type="submit" data-action="form(\'paymentReceivedDate\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Added by"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <select data-placeholder="Choose a user..." name="addedBy__eq" class="input-large" data-weave="shared/widget/common/user-list/main">\r\n                    </select>\r\n                </div>\r\n\r\n                <button class="btn" type="submit" data-action="form(\'addedBy__eq\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Consultant related to revenue"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <select data-placeholder="Choose a user..." name="user_id" class="input-large" data-weave="shared/widget/common/user-list/main">\r\n                    </select>\r\n                </div>\r\n                \r\n                <button class="btn" type="submit" data-action="form(\'user_id\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Team"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <div class="comtree span" data-name="team_id" data-url="/rest/data/team" data-weave="shared/widget/common/comtree/main"></div>\r\n                </div>\r\n                \r\n                <button class="btn" type="submit" data-action="form(\'team_id\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Job\'s Name"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <p>\r\n                    <input type="text" class="input-medium" autocomplete="off">\r\n                </p>\r\n                \r\n                <button class="btn" type="submit" data-action="form(\'joborder__jobTitle__icontains\')" data-weave="shared/helper/translation" data-i18n="Search"><tton>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Client\'s Name"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <p>\r\n                    <input type="text" class="input-medium" autocomplete="off">\r\n                </p>\r\n                \r\n                <button class="btn" type="submit" data-action="form(\'client__name__icontains\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Candidate\'s Name"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <p>\r\n                    <input type="text" class="input-medium" autocomplete="off">\r\n                </p>\r\n                \r\n                <button class="btn" type="submit" data-action="form(\'candidate_name\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Invoice Status"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <p>\r\n                    <select name="status__eq">\r\n                        <option value="Invoice Added" data-weave="shared/helper/translation" data-i18n="Invoice Added"></option>\r\n                        <option value="To be sent" data-weave="shared/helper/translation" data-i18n="To be sent"></option>\r\n                        <option value="Sent" data-weave="shared/helper/translation" data-i18n="Sent"></option>\r\n                        <option value="Received" data-weave="shared/helper/translation" data-i18n="Received"></option>\r\n                        <option value="Void" data-weave="shared/helper/translation" data-i18n="Backout"></option>\r\n                    </select>\r\n                </p>\r\n                \r\n                <button class="btn" type="submit" data-action="form(\'status__eq\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Finance"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <p>\r\n                    <select data-placeholder="Choose a user..." name="finance__eq" class="input-large" data-role="finance" data-weave="shared/widget/common/user-list/main"></select>\r\n                </p>\r\n                \r\n                <button class="btn" type="submit" data-action="form(\'finance__eq\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Invoice Notes"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <p>\r\n                    <input type="text" class="input-medium">\r\n                </p>\r\n                <button class="btn" type="submit" data-action="form(\'note\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n</ul>\r\n\r\n<p class="sepH_b">\r\n    <span class="tag label label-info deletable hide" data-query="dateAdded" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Added Date"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="sentDate" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Sent Date"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="paymentReceivedDate" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Received Date"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="addedBy__eq" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Added by"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="user_id" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Consultant related to revenue"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="team_id" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Team"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="joborder__jobTitle__icontains" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Jobs"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="client__name__icontains" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Clients"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="candidate_name" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Candidates"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="status__eq" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Invoice Status"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="finance__eq" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Finance"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="note" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Invoice Notes"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <a href="#" class="hide save-filter" data-action="filter/save/toggle" data-weave="shared/helper/translation" data-i18n="Save as"></a>\r\n</p>\r\n\r\n<form action="#" class="form-horizontal save-filter-form hide">\r\n    <input type="text" class="input-medium">\r\n    <button class="btn" data-action="filter/save" data-weave="shared/helper/translation" data-i18n="Save"></button>\r\n    <button class="btn" data-action="filter/save/toggle" data-weave="shared/helper/translation" data-i18n="Close"></button>\r\n</form>';
		return a
	}
}), define("app/widget/invoice/filter/main", ["compose", "jquery", "shared/widget/filter/base", "troopjs-utils/deferred", "shared/helper/utils", "template!./main.html", "shared/widget/filter/query"], function (a, b, c, d, e, f, g) {
	function h() {
		g.addAttr({
			ordering : function (a) {
				m ? l[m] <= l[a] && (m = a) : m = a,
				this.addQuery("ordering", "ordering=" + m)
			},
			dateAdded : function (a) {
				var b = a.find('input[name="from"]').val(),
				c = a.find('input[name="to"]').val();
				b && c && this.addQuery("dateAdded", "dateAdded__gt=" + b + "&dateAdded__lt=" + c)
			},
			sentDate : function (a) {
				var b = a.find('input[name="from"]').val(),
				c = a.find('input[name="to"]').val();
				b && c && this.addQuery("sentDate", "sentDate__gt=" + b + "&sentDate__lt=" + c)
			},
			paymentReceivedDate : function (a) {
				var b = a.find('input[name="from"]').val(),
				c = a.find('input[name="to"]').val();
				b && c && this.addQuery("paymentReceivedDate", "paymentReceivedDate__gt=" + b + "&paymentReceivedDate__lt=" + c)
			},
			candidate_name : function (a) {
				var b = a.find("input").val().trim();
				b.length && this.addQuery("candidate", "candidate_name=" + b)
			},
			user_id : function (a) {
				var b = a.find("select").val();
				b.length && this.addQuery("user_id", "user_id=" + b)
			},
			client__name__icontains : function (a) {
				var b = a.find("input").val().trim();
				b.length && this.addQuery("client__name__icontains", "client__name__icontains=" + window.encodeURIComponent(b))
			},
			team_id : function (a) {
				var b = a.find('[name="team_id"]').val();
				b.length && this.addQuery("team_id", "team_id=" + b)
			},
			joborder__jobTitle__icontains : function (a) {
				var b = a.find("input").val().trim();
				b.length && this.addQuery("joborder__jobTitle__icontains", "joborder__jobTitle__icontains=" + window.encodeURIComponent(b))
			},
			status__eq : function (a) {
				var b = a.find("select option:selected").val();
				b.length && ("Void" == b ? this.addQuery("active__eq", "active__eq=") : (this.addQuery("status__eq", "status__eq=" + b), this.addQuery("active__eq", "active__eq=1")))
			},
			addedBy__eq : function (a) {
				var b = a.find("select").val();
				b.length && this.addQuery("addedBy__eq", "addedBy__eq=" + b)
			},
			finance__eq : function (a) {
				var b = a.find("select").val();
				b.length && this.addQuery("finance__eq", "finance__eq=" + b)
			},
			note : function (a) {
				var b = a.find("input").val().trim();
				b.length && this.addQuery("note", "note__icontains=" + encodeURIComponent(b))
			}
		})
	}
	function i(a) {
		var c,
		d,
		e = this,
		f = a[0],
		h = a[1];
		switch (f.indexOf("dateAdded") > -1 && (f = "dateAdded"), f.indexOf("sentDate") > -1 && (f = "sentDate"), f.indexOf("paymentReceivedDate") > -1 && (f = "paymentReceivedDate"), f) {
		case "dateAdded":
			if (a[0].indexOf("gt") > -1 || a[0].indexOf("lt") > -1) {
				if (a[0].indexOf("gt") > -1 ? e.dateAddedFrom = h : a[0].indexOf("lt") > -1 && (e.dateAddedTo = h), e.updateFrom && e.updateTo)
					return e.$element.find('[data-query="addedDate"]').removeClass("hide").find("span").text(e.dateAddedFrom + " - " + e.dateAddedTo), g.addQuery("addedDate", "dateAdded__gt=" + e.dateAddedFrom + "&dateAdded__lt=" + e.dateAddedTo), void 0
			} else
				e.$element.find('a[data-type="addedDate"]').each(function () {
					return b(this).attr("href").substring(1) == a[0] + "=" ? (c = b(this).text(), !1) : void 0
				}), e.$element.find('[data-query="addedDate"]').removeClass("hide").find("span").text(c), g.addQuery("addedDate", a[0] + "=");
			break;
		case "sentDate":
			if (a[0].indexOf("gt") > -1 || a[0].indexOf("lt") > -1) {
				if (a[0].indexOf("gt") > -1 ? e.sentDateFrom = h : a[0].indexOf("lt") > -1 && (e.sentDateTo = h), e.updateFrom && e.updateTo)
					return e.$element.find('[data-query="sentDate"]').removeClass("hide").find("span").text(e.sentDateFrom + " - " + e.sentDateTo), g.addQuery("sentDate", "sentDate__gt=" + e.sentDateFrom + "&sentDate__lt=" + e.sentDateTo), void 0
			} else
				e.$element.find('a[data-type="sentDate"]').each(function () {
					return b(this).attr("href").substring(1) == a[0] + "=" ? (c = b(this).text(), !1) : void 0
				}), e.$element.find('[data-query="sentDate"]').removeClass("hide").find("span").text(c), g.addQuery("sentDate", a[0] + "=");
			break;
		case "paymentReceivedDate":
			if (a[0].indexOf("gt") > -1 || a[0].indexOf("lt") > -1) {
				if (a[0].indexOf("gt") > -1 ? e.sentDateFrom = h : a[0].indexOf("lt") > -1 && (e.sentDateTo = h), e.updateFrom && e.updateTo)
					return e.$element.find('[data-query="paymentReceivedDate"]').removeClass("hide").find("span").text(e.sentDateFrom + " - " + e.sentDateTo), g.addQuery("receivedDate", "paymentReceivedDate__gt=" + e.sentDateFrom + "&paymentReceivedDate__lt=" + e.sentDateTo), void 0
			} else
				e.$element.find('a[data-type="paymentReceivedDate"]').each(function () {
					return b(this).attr("href").substring(1) == a[0] + "=" ? (c = b(this).text(), !1) : void 0
				}), e.$element.find('[data-query="paymentReceivedDate"]').removeClass("hide").find("span").text(c), g.addQuery("paymentReceivedDate", a[0] + "=");
			break;
		case "active__eq":
			h || e.$element.find('[data-query="status__eq"]').removeClass("hide").find("span").text("作废"),
			g.addQuery(f, f + "=" + h);
			break;
		case "user_id":
		case "addedBy__eq":
		case "finance__eq":
		case "status__eq":
			d = e.$element.find('[name="' + f + '"]').find('[value="' + window.decodeURIComponent(h) + '"]').text(),
			e.$element.find('[data-query="' + f + '"]').removeClass("hide").find("span").text(d),
			g.addQuery(f, f + "=" + h);
			break;
		case "team_id":
			d = e.$element.find('[data-name="' + f + '"]').woven()[0].getNodeNameById(window.decodeURIComponent(h)),
			e.$element.find('[data-query="' + f + '"]').removeClass("hide").find("span").text(d),
			g.addQuery(f, f + "=" + h);
			break;
		case "byfilter":
			break;
		default:
			e.$element.find('[data-query="' + f + '"]').removeClass("hide").find("span").text(window.decodeURIComponent(h)),
			g.addQuery(f, f + "=" + h)
		}
	}
	function j(a) {
		this.html(f, this._json, a)
	}
	var k = {
		SAVE_FILTER : "/rest/data/queryfilter/invoice/add"
	},
	l = {
		dateAdded : 1,
		sentDate : 2,
		paymentReceivedDate : 3
	},
	m = "";
	return c.extend(function () {
		var a = this;
		g.url = k.SAVE_FILTER,
		a._setFilter = i,
		h.call(a)
	}, {
		"sig/initialize" : function (a, b) {
			j.call(this, b)
		},
		"dom/action.click" : b.noop,
		"dom/action/date/select.click" : function (a, c) {
			c.preventDefault();
			var d = b(c.target),
			e = d.attr("data-type");
			b('[data-query="' + e + '"]').removeClass("hide").find("span").text(d.text()),
			g.addQuery(e, d.attr("href").substring(1)),
			d.closest("form").find("button").trigger("click")
		}
	})
}), define("troopjs-requirejs/template!app/widget/invoice/list/main.html", [], function () {
	return function () {
		var a = '<!-- pagination -->\n<div class="pagination clearfix hide" data-weave="shared/widget/pagination/main(\'' + this._listType + '\')"></div>\n\n<div class="loading-area widget-spin">\n    <table id="invoiceTable" class="table table-bordered table-candidate invoice-list table_vam">\n        <colgroup>\n            <col>\n            <col>\n            <col>\n            <col>\n            <col>\n            <col>\n            <col>\n            <col>\n            <col>\n            <col>\n            <col width="60">\n        </colgroup>\n        <thead>\n            <tr>\n                <th data-weave="shared/helper/translation" data-i18n="Added Date"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Consultant related to revenue"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Candidates"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Clients"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Jobs"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Sent Date"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Received Date"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Invoice Amount"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Payment Received"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Invoice Status"></th>\n                <th></th>\n            </tr>\n        </thead>\n\n        <tbody>\n        </tbody>\n\n        <tfoot>\n            <tr>\n                <th data-weave="shared/helper/translation" data-i18n="Summary"></th>\n                <th></th>\n                <th></th>\n                <th></th>\n                <th></th>\n                <th></th>\n                <th></th>\n                <th class="invoiceAmount"></th>\n                <th class="paymentReceived"></th>\n                <th></th>\n                <th></th>\n            </tr>\n        </tfoot>\n    </table>\n</div>\n\n<!-- pagination -->\n<div class="pagination clearfix hide" data-weave="shared/widget/pagination/main(\'' + this._listType + "')\"></div>";
		return a
	}
}), define("app/widget/invoice/list/main", ["jquery", "shared/widget/list/base", "template!./main.html", "troopjs-utils/deferred", "shared/helper/utils", "shared/helper/blurb", "jquery.datatables.fixedheader"], function (a, b, c, d, e, f) {
	function g() {
		var a = this;
		a.$table.fnSort([[0, "desc"]])
	}
	function h(a) {
		var b = "";
		switch (a) {
		case "Invoice Added":
			b = -1;
			break;
		case "To be sent":
			b = 0;
			break;
		case "Sent":
			b = 1;
			break;
		case "Received":
			b = 2
		}
		return b
	}
	function i(a) {
		var b = "";
		switch (a) {
		case "Invoice Added":
			b = "label-purple";
			break;
		case "To be sent":
			b = "label-lightblue";
			break;
		case "Sent":
			b = "label-blue";
			break;
		case "Received":
			b = "label-red"
		}
		return b
	}
	function j(a) {
		a.closest(".btn-group").removeClass("open")
	}
	function k(a) {
		var b = this;
		b.html(c, a),
		a.resolve()
	}
	function l(a) {
		var b = this;
		b.$totalReceived = b.$element.find(".totoal-received"),
		b.$container = b.$table = b.$element.find("table").dataTable({
				bPaginate : !1,
				bAutoWidth : !1,
				sAjaxDataProp : "list",
				aoColumns : q,
				sDom : "t",
				oLanguage : {
					sProcessing : "<div class='widget-spin'></div>",
					sLoadingRecords : "<div class='widget-spin'></div>"
				}
			}),
		g.call(b),
		a.resolve()
	}
	var m,
	n,
	o = {
		LIST : "/rest/invoice/list?paginate_by=50",
		INVOICE : "/rest/invoice/<id>",
		SAVE_URL : "/rest/joborder/shortlist/<id>/addinvoice",
		SHORTLIST : "/rest/joborder/<id>/shortlist/<sid>"
	},
	p = {
		"Invoice Added" : f.t("Invoice Added"),
		"To be sent" : f.t("To be sent"),
		Sent : f.t("Sent"),
		Received : f.t("Received"),
		Backout : f.t("Backout"),
		"Edit Invoice" : f.t("Edit Invoice"),
		"Invoice sent" : f.t("Invoice sent"),
		"Invoice received payment" : f.t("Invoice received payment"),
		"Reset invoice" : f.t("Reset invoice"),
		"View Revenue Allocation" : f.t("View Revenue Allocation"),
		CURRENCY_SYM : f.t("Currency symbol")
	};
	a.extend(jQuery.fn.dataTableExt.oSort, {
		"formatted-date-pre" : function (a) {
			a = "-" === a ? 0 : a.replace(/<span[^>]*>(\d+)<\/span>/g, "$1");
			var b = a.replace(/(\d*-\d*-\d*).*/g, "$1");
			return new Date(b)
		},
		"formatted-date-asc" : function (a, b) {
			return a - b
		},
		"formatted-date-desc" : function (a, b) {
			return b - a
		}
	});
	var q = [{
			mData : null,
			sType : "formatted-date",
			mRender : function (a, b, c) {
				var d = "";
				return d = m(c.dateAdded) + '<br><a href="user/preview#' + c.user.id + '" data-action="profile/open">' + c.user.englishName + "</a>"
			}
		}, {
			mData : null,
			mRender : function (a, b, c) {
				for (var d = c.assignments, e = "", f = 0, g = d.length; g > f; f++)
					e += '<a href="user/preview#' + d[f].user.id + '" data-action="profile/open">' + d[f].user.englishName + "</a><br>";
				return e
			}
		}, {
			mData : null,
			mRender : function (a, b, c) {
				var d,
				e = c.candidate;
				return d = e.englishName + "<br>" + e.chineseName
			}
		}, {
			mData : null,
			mRender : function (a, b, c) {
				var d = c.client,
				e = "";
				return e = '<p class="fixed-width">' + d.name + "<br>(ID: " + d.id + ")" + "</p>"
			}
		}, {
			mData : null,
			mRender : function (a, b, c) {
				var d = c.joborder;
				return d.jobTitle + "<br>(ID: " + d.id + ")"
			}
		}, {
			mData : "sentDate",
			sType : "date",
			mRender : function (a) {
				return a ? m(a) : "N/A"
			}
		}, {
			mData : "paymentReceivedDate",
			sType : "date",
			mRender : function (a) {
				return a ? m(a) : "N/A"
			}
		}, {
			mData : "invoiceAmount",
			mRender : function (a) {
				return p.CURRENCY_SYM + " " + n(a)
			}
		}, {
			mData : "paymentReceived",
			mRender : function (a) {
				var b;
				return b = a ? p.CURRENCY_SYM + " " + n(a) : "N/A"
			}
		}, {
			mData : null,
			mRender : function (a, b, c) {
				var d,
				e = c.status;
				return d = c.active ? '<span class="label ' + i(e) + '">' + p[e] + "</span>" : '<span class="label label-inverse">' + p.Backout + "</span>" + '<p class="hint">' + m(c.lastUpdateDate) + "<br>" + c.invalidReason + "</p>"
			}
		}, {
			mData : null,
			mRender : function (a, b, c) {
				var d,
				e = c.status,
				f = c.active,
				g = c.id,
				i = [c.candidate.englishName, c.candidate.chineseName].join(" ").trim(),
				j = c.joborder.id,
				k = c.jobsubmission;
				return d = '<div class="btn-group"><button class="btn btn-small dropdown-toggle" data-toggle="dropdown"><i class="icon-list-alt"></i></button><ul class="dropdown-menu"><li class="' + (-1 === h(e) ? "disabled" : "") + '">' + '<a href="#" data-action="invoice/edit(' + i + ", " + g + ", " + j + ", " + k + ')">' + p["Edit Invoice"] + "</a>" + "</li>" + "<li>" + '<a href="#" data-action="view/revenue(' + g + ')">' + p["View Revenue Allocation"] + "</a>" + "</li>" + '<li class="' + (-1 === h(e) || e >= 1 || !f ? "disabled" : "") + '">' + '<a href="#" data-action="send/to/client(' + g + ')">' + p["Invoice sent"] + "</a>" + "</li>" + '<li class="' + (-1 !== h(e) && f ? "" : "disabled") + '">' + '<a href="#" data-action="payment/received(' + g + "," + c.invoiceAmount + ')">' + p["Invoice received payment"] + "</a>" + "</li>",
				f && (d += '<li class="divider"></li><li><a href="#" data-action="reset/invoice(' + g + ')">' + p["Reset invoice"] + "</a>" + "</li>"),
				d += "</ul></div>"
			},
			bSortable : !1
		}
	];
	return b.extend(function () {
		this._url = o.LIST,
		this._listType = "invoice",
		m = this.formatDate,
		n = this.formatCurrency
	}, {
		"sig/initialize" : function (a, b) {
			k.call(this, b)
		},
		"sig/start" : function (a, b) {
			l.call(this, b)
		},
		renderList : function (a) {
			var b,
			c = this,
			d = c._json,
			e = d.total;
			c.$table.fnClearTable(),
			c.$table.fnAddData(d.list),
			c.$table.fnDraw(),
			c._json = {},
			d.list.forEach(function (a) {
				c._json[a.id] = a
			});
			for (b in e)
				c.$element.find("." + b).text(p.CURRENCY_SYM + " " + c.formatCurrency(e[b]));
			g.call(c),
			a.resolve()
		},
		"dom/action.click" : a.noop,
		"dom/action/invoice/edit.click" : function (b, c, f, g, h, i) {
			c.preventDefault();
			var k = this,
			l = a(c.target),
			m = l.closest("li"),
			n = l.closest("tr")[0];
			m.hasClass("disabled") || (k.publish("ajax", {
					url : o.SHORTLIST.replace("<id>", h).replace("<sid>", i)
				}, d().done(function (a) {
						var b = a.detail.filter(function (a) {
								return "OfferSign" === a.type
							});
						b = b[b.length - 1],
						k.publish("modal/invoice-finance/show", {
							name : f,
							invoiceId : g,
							data : k._json[g],
							operator : "finance",
							offerInfo : b,
							onSuccess : function () {
								k.updateRow(g, n),
								e.alert("success", "Save invoice successfully!")
							}
						})
					})), j(l))
		},
		"dom/action/send/to/client.click" : function (b, c, d) {
			c.preventDefault();
			var e = this,
			f = a(c.target),
			g = f.closest("li"),
			h = f.closest("tr")[0];
			g.hasClass("disabled") || (e.publish("modal/invoice-client/show", d, function () {
					e.updateRow(d, h),
					g.addClass("disabled")
				}), j(f))
		},
		"dom/action/payment/received.click" : function (b, c, d, e) {
			c.preventDefault();
			var f = this,
			g = a(c.target),
			h = g.closest("li"),
			i = g.closest("tr")[0];
			h.hasClass("disabled") || (f.publish("modal/payment-received/show", e, d, function () {
					f.updateRow(d, i),
					h.addClass("disabled")
				}), j(g))
		},
		"dom/action/reset/invoice.click" : function (b, c, d) {
			c.preventDefault();
			var e = this,
			f = a(c.target),
			g = f.closest("tr")[0];
			e.publish("modal/reset-invoice/show", d, function () {
				e.updateRow(d, g)
			}),
			j(f)
		},
		"dom/action/view/revenue.click" : function (a, b, c) {
			b.preventDefault();
			var d = this;
			d.publish("modal/allocation-revenue/show", {
				invoiceId : c
			})
		},
		"dom/action/profile/open.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			f = d.attr("href");
			e.window({
				url : f,
				name : "User Profile",
				width : "1024"
			})
		},
		updateRow : function (a, b) {
			var c = this;
			c.publish("ajax", {
				url : o.INVOICE.replace("<id>", a)
			}, d().done(function (a) {
					c._json[a.id] = a,
					c.$table.fnUpdate(a, b)
				}))
		}
	})
}), define("troopjs-requirejs/template!app/widget/job/add/contacts.html", [], function () {
	return function () {
		var a = '<label for="contact" class="control-label">\n    <span data-weave="shared/helper/translation" data-i18n="Client Contact"></span> <span class="f_req">*</span>\n</label>\n<div class="controls text_line">\n    <a href="#" data-action="add/contact" data-weave="shared/helper/translation" data-i18n="Add contact"></a>\n</div>';
		return a
	}
}), define("troopjs-requirejs/template!app/widget/job/add/client-contact.html", [], function () {
	return function (a) {
		for (var b = "", c = 0, d = a.length; d > c; c++)
			b += '\n<div class="controls controls-contact">\n    <p>\n        <input type="text" name="contact" class="input-xlarge" data-weave="app/widget/common/people-list/main" data-url="/rest/candidate/list?type=contact&user_id=' + a[c].userId + '&ordering=englishName" value="' + (a[c].id || "") + '">\n        <span class="hint" data-weave="shared/helper/translation" data-i18n="Only show shared contacts"></span>\n        <a href="#" class="remove" data-action="remove/contact"><span class="icon-remove"></span></a>\n    </p>\n    \n    <p class="contact-info hide"></p>\n</div>\n';
		return b
	}
}), define("app/widget/job/add/contacts", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./contacts.html", "template!./client-contact.html", "shared/helper/utils"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		b.html(d, a)
	}
	function g(b) {
		var d,
		f = this;
		f.$label = f.$element.find("label"),
		d = f._json ? function () {
			var a = [];
			return f._json.forEach(function (b) {
				a.push({
					id : b.clientContact.id,
					userId : f.userId
				})
			}),
			a
		}
		() : [{
				userId : f.userId
			}
		];
		var g = a(e(d));
		g.find("[data-weave]").weave(c().done(function () {
				f.$label.after(g)
			})),
		b.resolve()
	}
	return b.extend(function (a, b, c, d) {
		this._json = d,
		this.userId = c
	}, {
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"sig/start" : function (a, b) {
			g.call(this, b)
		},
		"dom/action.click" : a.noop,
		"dom/action/add/contact.click" : function (b, d) {
			d.preventDefault();
			var f = this,
			g = a(d.target),
			h = a(e([{
								userId : f.userId
							}
						]));
			h.find("[data-weave]").weave(c().done(function () {
					g.closest("div").before(h)
				}))
		},
		"dom/action/remove/contact.click" : function (b, c) {
			c.preventDefault(),
			a(c.target).closest(".controls-contact").remove()
		}
	})
}), define("troopjs-requirejs/template!app/widget/job/add/main.html", [], function () {
	return function (a) {
		var b = "",
		c = this.editMode,
		d = a.users;
		if (c) {
			d.filter(function (a) {
				return "BD" === a.type
			})[0],
			d.filter(function (a) {
				return "Main Consultant" === a.type
			})[0];
			for (var e = a.function  ? a.function .id : "", f = a.city ? a.city.id : "", g = {}, h = 1;
				6 >= h;
				h++)g["ext" + h] = a["ext" + h].value ? a["ext" + h].value : ""
}
b += '\r\n<div class="span12">\r\n    ',
b += c ? '\r\n    <h3 class="heading" data-weave="shared/helper/translation" data-i18n="Edit Job"></h3>\r\n    ' : '\r\n    <h3 class="heading" data-weave="shared/helper/translation" data-i18n="New Job"></h3>\r\n    ',
b += '\r\n    <form action="#" class="form-horizontal">\r\n        <fieldset>\r\n\r\n            <div class="control-group formSep">\r\n                <label for="fileinput" class="control-label" data-weave="shared/helper/translation" data-i18n="JD Upload"></label>\r\n                <div class="controls">\r\n                    <select name="tag" class="input-medium" data-type="job" data-weave="app/widget/common/attachment-type/main"></select>\r\n                    <span class="upload-file"></span>\r\n                </div>\r\n                <div class="controls text_line hide">\r\n                    <ul class="unstyled attachment-list"></ul>\r\n                </div>\r\n            </div>\r\n        </fieldset>\r\n    </form>\r\n    <form action="#" class="form-horizontal">\r\n        <fieldset>\r\n            <div class="control-group">\r\n                <label for="company" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Client Company"></span>\r\n                    <span class="f_req">*</span>\r\n                </label>\r\n                <div class="controls">\r\n                    <input type="text" name="company" id="company" data-action="company" style="width: 400px;" value="' + (c ? a.client.id : "") + '">\r\n                    <span class="hint" data-weave="shared/helper/translation" data-i18n="Only show shared clients"></span>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group control-group-contacts"></div>\r\n\r\n            <div class="control-group">\r\n                <label for="jobName" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Job Name"></span> <span class="f_req">*</span>\r\n                </label>\r\n                <div class="controls">\r\n                    <input type="text" class="input-large" id="jobName" name="jobName" value="' + (c ? a.jobTitle : "") + '" />\r\n                    <span data-weave="shared/helper/translation" data-i18n="Number of hiring"></span>\r\n                    <input type="text" class="span1" id="totalCount" name="totalCount" value="' + (c ? a.totalCount : "1") + '" />\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <label for="jobName" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Priority">\r\n                    </span> <span class="f_req">*</span>\r\n                </label>\r\n                <div class="controls">\r\n                    <select name="priority" class="input-medium">\r\n                        <option value="" data-weave="shared/helper/translation" data-i18n="Please select"></option>\r\n                        <option value="High" data-weave="shared/helper/translation" data-i18n="High"></option>\r\n                        <option value="Medium" data-weave="shared/helper/translation" data-i18n="Medium"></option>\r\n                        <option value="Low" data-weave="shared/helper/translation" data-i18n="Low"></option>\r\n                    </select>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <label for="" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Function"></span>\r\n                    <span class="f_req">*</span>\r\n                </label>\r\n                <div class="controls">\r\n                    <div class="comtree span3" data-name="function" data-url="/rest/data/function" data-weave="shared/widget/common/comtree/main(' + (c ? e : "") + ')"></div>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <label class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="City"></span> <span class="f_req">*</span>\r\n                </label>\r\n                <div class="controls">\r\n                    <div class="comtree span3" data-name="city" data-url="/rest/data/city" data-weave="shared/widget/common/comtree/main(' + (c ? f : "") + ')"></div>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <label for="jobStatus" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Job Status"></span> <span class="f_req">*</span>\r\n                </label>\r\n                <div class="controls">\r\n                    <select name="jobStatus" id="jobStatus" ',
c || (b += "disabled='disabled'"),
b += '>\r\n                        <option value="Live" data-weave="shared/helper/translation" data-i18n="Live Jobs" selected="selected"></option>\r\n                        <option value="Successful" data-weave="shared/helper/translation" data-i18n="Successful Jobs"></option>\r\n                        <option value="Failed" data-weave="shared/helper/translation" data-i18n="Failed Jobs"></option>\r\n                        <option value="Pending" data-weave="shared/helper/translation" data-i18n="Pending Jobs"></option>\r\n                    </select>\r\n                    ',
c || (b += '\r\n                    <span class="hint" data-weave="shared/helper/translation" data-i18n="Job status is not permitted to modify when add a new job."></span>\r\n                    '),
b += '\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <label for="" class="control-label" data-weave="shared/helper/translation" data-i18n="Tags"></label>\r\n                <div class="controls">\r\n                    <div class="span5">\r\n                        <input type="text" id="tags" name="tags" data-type="tag" autocomplete="off" data-weave="shared/widget/common/tagit/main" value="' + (c ? a.tags : "") + '">\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            ';
for (var h = 0, i = this.extFields.length; i > h; h++)
	b += "\r\n            ", this.extraFields[this.extFields[h]] && (b += '\r\n            <div class="control-group">\r\n                <label for="' + this.extFields[h] + '" class="control-label">\r\n                    ' + this.extraFields[this.extFields[h]] + '\r\n                </label>\r\n                <div class="controls">\r\n                    <input type="text" id="' + this.extFields[h] + '" name="' + this.extFields[h] + '" class="input-large" value="' + (c ? g[this.extFields[h]] : "") + '">\r\n                </div>\r\n            </div>\r\n            ') , b += "\r\n            ";
	return b += '\r\n\r\n            <div class="control-group">\r\n                <label for="bd" class="control-label">BD <span class="f_req">*</span></label>\r\n                <div class="controls">\r\n                    <select data-placeholder="Choose a user..." name="BD" id="bd" class="input-medium user">\r\n                    </select>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <label for="consultant" class="control-label" >Main Consultant <span class="f_req">*</span>\r\n                </label>\r\n                <div class="controls">\r\n                    <select data-placeholder="Choose a user..." name="Main Consultant" id="consultant" class="input-medium user"></select>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group formSep control-consultant"></div>\r\n\r\n            <div class="control-group">\r\n                <div class="controls">\r\n                    <button class="btn btn-primary" data-action="add" data-weave="shared/helper/translation" data-i18n="Save"></button>\r\n                </div>\r\n            </div>\r\n        </fieldset>\r\n    </form>\r\n</div>'
}
}), define("troopjs-requirejs/template!app/widget/job/add/attachment.html", [], function () {
	return function (a) {
		for (var b = "", c = 0, d = a.length; d > c; c++) {
			b += "\n";
			var e = a[c];
			b += "\n<li>\n    ",
			b += e.tag ? '\n    <span class="label editable editable-click" data-type="select" data-pk="' + e.id + '" style="background-color:' + e.tag.color + ';">' + e.tag.value + "</span>\n    " : '\n    <span class="label editable editable-click" data-type="select" data-pk="' + e.id + '" data-weave="shared/helper/translation" data-i18n="Unknown"></span>\n    ',
			b += '\n    <a href="#" data-id="' + e.id + '" class="attachment-item file-type-icon ' + e.ext.toLowerCase() + '" data-action="attachment/preview(\'' + e.uuidname + "')\">" + e.originname + '</a>\n    <a href="#" data-action="remove/attachment"><span class="icon-remove"></span></a>\n</li>\n'
		}
		return b
	}
}), define("app/widget/job/add/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "template!app/widget/common/company-suggestion/main.html", "template!./attachment.html", "shared/helper/utils", "shared/helper/validate", "shared/helper/blurb", "jquery.ui", "app/widget/common/select2/main", "bootstrap.editable"], function (a, b, c, d, e, f, g, h, i) {
	function j(a) {
		for (var b = this, c = a.split(","), d = c.length; d--; )
			b.$tags.tagit("createTag", c[d])
	}
	function k() {
		for (var b, c = this, d = [], e = !1, f = 0; f < c._json.users.length; f += 1)
			b = c._json.users[f], "BD" === b.type && a("#bd").attr("data-weave", "shared/widget/common/user-list/main(" + b.user.id + ")").weave(), "Main Consultant" === b.type && (e = !0, a("#consultant").attr("data-weave", "shared/widget/common/user-list/main(" + b.user.id + ")").weave()), ("Researcher" === b.type || "Consultant" === b.type) && d.push(b);
		e || a("#consultant").attr("data-weave", "shared/widget/common/user-list/main").weave(),
		c.$element.find(".control-consultant").data("json", d).attr("data-weave", "app/widget/common/add-consultant/main(json)").weave()
	}
	function l() {
		var b = this;
		b.$btnFile.data("json", {
			multiple : !0,
			data : {
				type : "joborder"
			},
			beforeSubmit : function (a, c, d) {
				this.$controls = b.$btnFile.closest(".controls"),
				this.$controls.addClass("text_line");
				var e = JSON.parse(d.data.data);
				e.tag = c.find('[name="tag"]').val(),
				d.data.data = JSON.stringify(e)
			},
			success : function (c) {
				this.$controls.removeClass("text_line"),
				c.status ? c.data.forEach(function (d, e) {
					var g = a(f(c.data));
					b.$attachmentList.append(g),
					b.$attachmentList.closest(".controls").removeClass("hide"),
					g.find("[data-weave]").weave(),
					0 === e && d.tags && j.call(b, d.tags),
					b._attachments.push(d.id)
				}) : g.alert("error", "Upload file error!")
			},
			error : function () {
				this.$controls.removeClass("text_line")
			}
		}).attr("data-weave", "shared/widget/common/upload/main(json)").weave()
	}
	function m() {
		var a = this;
		a.editMode !== q && a.userId !== q && a.publish("ajax", {
			url : r.EXTRA_FIELDS
		}, c().done(function (b) {
				a.extraFields = JSON.parse(b[0].value),
				a._jobId ? (a.editMode = !0, n.call(a)) : o.call(a)
			}))
	}
	function n() {
		var a = this;
		a.publish("ajax", {
			url : r.JOBORDER + a._jobId
		}, c().done(function (b) {
				a._json = b,
				o.call(a)
			}))
	}
	function o() {
		var a = this;
		c(function (b) {
			a.html(d, a._json, b)
		}).done(function () {
			p.call(a)
		})
	}
	function p() {
		var b,
		d = this;
		d.$form = d.$element.find("form").eq(1),
		d.$invoiceTitle = d.$form.find("#invoice-title"),
		d.$feeStructure = d.$form.find("#fee-structure"),
		d.$probation = d.$form.find("#probation"),
		d.$contact = d.$form.find("#contact"),
		d.$company = d.$form.find("#company"),
		d.$tags = d.$element.find("#tags"),
		d.$btnFile = d.$element.find(".upload-file"),
		d.$priority = d.$element.find('[name="priority"]'),
		d.$jobStatus = d.$element.find('[name="jobStatus"]'),
		d.cityWidget = d.$element.find('[data-name="city"]').woven()[0],
		d.$attachmentList = d.$element.find(".attachment-list"),
		l.call(d),
		d.$company.select2({
			placeholder : i.t("Please select"),
			minimumInputLength : 1,
			ajax : {
				url : r.CLIENT.replace("<id>", d.userId),
				dataType : "json",
				quietMillis : 100,
				data : function (a, b) {
					return {
						company_name : a,
						page : b
					}
				},
				results : function (a) {
					var b = a.current < a.pages;
					return {
						results : a.list,
						more : b
					}
				}
			},
			initSelection : function (b, c) {
				var e = a(b).val();
				"" !== e && a.ajax(r.CLIENT.replace("<id>", d.userId), {
					data : {
						id : e
					},
					dataType : "json"
				}).done(function (a) {
					a.list.length && c(a.list[0])
				})
			},
			formatResult : function (a) {
				return a.ctype = t[a.type],
				e(a)
			},
			formatSelection : function (a, b) {
				b.text(a.name)
			},
			escapeMarkup : function (a) {
				return a
			}
		}),
		h(d.$form, {
			rules : {
				jobName : {
					required : !0
				},
				company : {
					required : !0
				},
				contact : {
					required : !0
				},
				"function" : {
					required : !0
				},
				city : {
					required : !0
				},
				BD : {
					required : !0
				},
				"Main Consultant" : {
					required : !0
				},
				totalCount : {
					required : !0,
					number : !0
				},
				priority : {
					required : !0
				}
			}
		}),
		d.editMode ? (k.call(d), b = d._json.tags, d.$jobStatus.val(d._json.jobStatus), d.$priority.val(d._json.priority), d.$element.find(".control-group-contacts").data("json", d._json.contacts).attr("data-weave", s + "(" + d.userId + ", json )").weave(), d.publish("ajax", {
				url : r.GET_ATTACHMENTS.replace("<id>", d._jobId)
			}, c().done(function (b) {
					var c = a(f(b));
					d.$attachmentList.append(c),
					c.find("[data-weave]").weave(),
					d.$attachmentList.closest(".controls").removeClass("hide")
				}))) : (d.$element.find(".control-group-contacts").attr("data-weave", s + "(" + d.userId + ")").weave(), d.$element.find(".control-consultant").attr("data-weave", "app/widget/common/add-consultant/main").weave(), a("#bd").attr("data-weave", "shared/widget/common/user-list/main").weave(), a("#consultant").attr("data-weave", "shared/widget/common/user-list/main").weave()),
		d.$element.editable({
			selector : "span.label",
			mode : "inline",
			emptytext : "未知",
			source : r.CATEGORY,
			sourceCache : !0,
			url : r.EDIT_CATE,
			params : function (a) {
				return a.id = a.pk,
				a.tag = a.value,
				delete a.value,
				delete a.pk,
				delete a.name, {
					data : JSON.stringify(a)
				}
			},
			success : function (b) {
				a(this).css("background-color", b.data.tag.color).text(b.data.tag.value)
			},
			error : function (a) {
				var b = JSON.parse(a.responseText);
				g.alert("error", b.message)
			}
		}),
		g.widgetLoaded.call(d)
	}
	var q,
	r = {
		FN : "/rest/data/function/list",
		CLIENT : "/rest/client/list?paginate_by=10&user_id=<id>&allow_new_job=1",
		CLIENT_DETAIL : "/rest/client/<id>",
		ADD : "/rest/joborder/add",
		UPLOAD : "/rest/file/upload",
		JOBORDER : "/rest/joborder/",
		EXTRA_FIELDS : "/rest/data/configvalue?keys=joborder_field_names",
		CATEGORY : "/rest/data/options?type=joborder_attachment_category",
		EDIT_CATE : "/rest/file/edit",
		GET_ATTACHMENTS : "/rest/file/list/joborder/<id>"
	},
	s = "app/widget/job/add/contacts",
	t = {
		ADD_CONTACT : i.t("Please add a contact for this company"),
		client : i.t("client company"),
		bding : i.t("bding company"),
		normal : "",
		generated : ""
	};
	return b.extend(function () {
		this._attachments = []
	}, {
		extFields : ["ext1", "ext2", "ext3", "ext4", "ext5", "ext6"],
		"sig/stop" : function (a, b) {
			this.$company.select2("destroy"),
			b.resolve()
		},
		"hub:memory/add/id/change" : function (a, b) {
			var c = this;
			c._jobId = b,
			c.editMode = c._jobId !== q ? !0 : !1,
			m.call(c)
		},
		"hub:memory/context" : function (a, b) {
			this.userId = b.user.id,
			m.call(this)
		},
		"dom/action.click.change" : a.noop,
		"dom/action/attachment/preview.click" : function (a, b, c) {
			b.preventDefault();
			var d = this;
			d.publish("slide-helper/attachment/reload", c)
		},
		"dom/action/reset.click" : function () {
			var b = this;
			b.$element.find(".tagItem").remove(),
			a("#contact").html("")
		},
		"dom/action/company.change" : function (b, d) {
			var e = this,
			f = a(d.target);
			e.publish("ajax", {
				url : r.CLIENT_DETAIL.replace("<id>", f.val())
			}, c().done(function (a) {
					a.city && e.cityWidget.selectById(a.city.id)
				}))
		},
		"dom/action/add.click" : function (b, d) {
			d.preventDefault();
			var e = this,
			f = a(d.target);
			if (!e.$form.valid())
				return !1;
			var h = function () {
				var b = [];
				return e.$element.find('[name="contact"]').each(function () {
					var c = a(this).val();
					c && b.push(c)
				}),
				b
			}
			(),
			i = a('[name="city"]').val(),
			j = a("#jobName").val().trim(),
			k = a('[name="function"]').val(),
			l = a("#company").val();
			a("#contact").val();
			var m = function () {
				var b = [];
				return e.$element.find("select.user").each(function () {
					var c = a(this);
					b.push({
						type : c.attr("name"),
						user_id : c.val()
					})
				}),
				b
			}
			(),
			n = a("#totalCount").val().trim(),
			o = a("#jobStatus").val(),
			p = function () {
				var b = [];
				return e.$element.find(".attachment-item").each(function () {
					b.push(a(this).data("id"))
				}),
				b.join(",")
			}
			(),
			q = {
				city : i,
				jobTitle : j,
				"function" : k,
				client : {
					id : l
				},
				contacts : h,
				users : m,
				tags : e.$tags.val(),
				totalCount : n,
				jobStatus : o,
				attachments : p,
				priority : e.$priority.val(),
				ext1 : e.$element.find('[name="ext1"]').val(),
				ext2 : e.$element.find('[name="ext2"]').val(),
				ext3 : e.$element.find('[name="ext3"]').val(),
				ext4 : e.$element.find('[name="ext4"]').val(),
				ext5 : e.$element.find('[name="ext5"]').val(),
				ext6 : e.$element.find('[name="ext6"]').val()
			};
			e.editMode && (q.id = this._jobId),
			e.publish("ajax", {
				url : r.ADD,
				data : {
					data : JSON.stringify(q)
				},
				type : "post"
			}, c().done(function (a) {
					a.status ? e.editMode ? (g.alert("success", "编辑项目成功!"), window.location.hash = "detail!id=" + e._json.id) : (g.alert("success", "新增项目成功!"), window.location.hash = "list") : g.alert("error", a.message)
				}), f)
		},
		"dom/action/remove/attachment.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = window.confirm("确定要删除此附件吗?");
			e && (1 === d.closest(".controls").find("li").length && d.closest(".controls").addClass("hide"), d.closest("li").remove())
		}
	})
}), define("troopjs-requirejs/template!app/widget/job/detail/email-tab/main.html", [], function () {
	return function (a) {
		var b = '<table class="table table_vam mbox_table" >\n    <colgroup>\n        <col width="">\n        <col width="">\n        <col width="">\n        <col width="125">\n        <col width="50">\n    </colgroup>\n    <thead>\n        <tr>\n            <th><span data-weave="shared/helper/translation" data-i18n="Sender"></span></th>\n            <th><span data-weave="shared/helper/translation" data-i18n="To"></span></th>\n            <th><span data-weave="shared/helper/translation" data-i18n="Subject"></span></th>\n            <th><span data-weave="shared/helper/translation" data-i18n="Date"></span></th>\n            <th><span data-weave="shared/helper/translation" data-i18n="Attachment"></span></th>\n        </tr>\n    </thead>\n    <tbody data-weave="app/widget/job/detail/email-tab/row(\'' + a + "')\"></tbody>\n</table>\n\n<!-- pagination -->\n<div class=\"pagination clearfix hide\" data-weave=\"shared/widget/pagination/main('joborder-email', 'load')\"></div>";
		return b
	}
}), define("app/widget/job/detail/email-tab/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "shared/helper/blurb"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		b.html(d, this._id, a)
	}
	function g(a) {
		var b = this;
		e.widgetLoaded.call(b),
		a.resolve()
	}
	return b.extend(function (a, b, c) {
		this._id = c
	}, {
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"sig/start" : function (a, b) {
			g.call(this, b)
		}
	})
}), define("troopjs-requirejs/template!app/widget/job/detail/email-tab/row.html", [], function () {
	return function (a) {
		var b = "",
		c = a.list,
		d = 0,
		e = c.length;
		if (b += "\n", e) {
			for (b += "\n", d; e > d; d++) {
				b += "\n";
				var f = c[d];
				b += '\n<tr class="',
				f.status || (b += "unread"),
				b += '" data-action="view/detail" data-id="' + f.id + '">\n    <td>' + this.formatEmail(f._from) + "</td>\n    ";
				var g = f.to.split(","),
				h = g.length,
				i = this.formatEmail(g[0]);
				h > 1 && (i += " ..."),
				b += "\n    <td>" + i + "</td>\n    <td>" + f.subject + "</td>\n    <td>" + (f.dateAdded ? f.dateAdded : "") + "</td>\n    <td> \n        ",
				f.attachment && (b += '\n        <span class="icon-paper-clip"></span>\n        '),
				b += "\n    </td>\n</tr>\n"
			}
			b += "\n"
		} else
			b += '\n<tr>\n    <td colspan="5">\n        <p class="text-center">\n            未发现邮件!\n        </p>\n    </td>\n</tr>\n';
		return b
	}
}), define("app/widget/job/detail/email-tab/row", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./row.html", "shared/helper/utils", "shared/helper/blurb"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		b._id ? b.publish("ajax", {
			url : g.LIST.replace("<id>", b._id).replace("<page>", h)
		}, c().done(function (c) {
				b._json = c,
				b.publish(i, c),
				b.html(d, c, a)
			})) : a.resolve()
	}
	function f(a) {
		a.resolve()
	}
	var g = {
		LIST : "/rest/mail/list?paginate_by=20&joborder_id=<id>&page=<page>",
		DETAIL : "/mail/center#inbox/<id>"
	},
	h = 1,
	i = "joborder-email/paging/set";
	return b.extend(function (a, b, c) {
		this._id = c
	}, {
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		},
		"sig/start" : function (a, b) {
			f.call(this, b)
		},
		"hub/make/load" : function (a, b) {
			var d = this;
			h = b.page,
			e.call(d, c())
		},
		"hub/add/email/count" : function () {
			var a = this;
			h = 1,
			e.call(a, c())
		},
		"dom/action.click" : a.noop,
		"dom/action/view/detail.click" : function (b, c) {
			var d = a(c.target),
			e = d.closest("tr");
			e.hasClass("unread") && e.removeClass("unread"),
			window.open(g.DETAIL.replace("<id>", e.data("id")), "_blank")
		},
		formatEmail : function (a) {
			return a ? a.replace(/</g, "&lt;").replace(/>/g, "&gt;") : ""
		}
	})
}), define("troopjs-requirejs/template!app/widget/job/detail/live-job/main.html", [], function () {
	return function (a) {
		var b = '<div class="well well-small action-bar clearfix">\n    <div class="pull-left">\n        ';
		this._islimited || (b += '\n        <label class="checkbox inline">\n            <input type="checkbox" data-action="shortlist/toggle/all"> <span data-i18n="Select All" data-weave="shared/helper/translation"></span>\n        </label>\n        \n        ', this.checkUserPermission() && (b += '\n        <!-- <a class="btn btn-small" href="/rest/joborder/' + this._jobJson.id + '/shortlist?output=csv" data-i18n="Export candidates in job" data-weave="shared/helper/translation"></a> -->\n        '), b += "\n\n        ", "Live" === this._jobJson.jobStatus && (b += '\n        <a href="/candidate#add/job=' + this._jobJson.id + '" target="_blank" class="btn btn-small" data-i18n="New People" data-weave="shared/helper/translation"></a>\n        '), b += '\n\n        <span class="mass-action">\n            <button class="btn btn-small btn-batch disabled" data-action="batch" data-i18n="Batch Send CV" data-weave="shared/helper/translation"></button>\n            <div class="btn-group">\n                <button class="btn btn-small dropdown-toggle disabled" data-toggle="dropdown"><span data-i18n="More" data-weave="shared/helper/translation"></span> <span class="caret"></span></button>\n                <ul class="dropdown-menu">\n                    <li>\n                        <a class="#" data-action="mass/send/email" data-i18n="Email" data-weave="shared/helper/translation"></a>\n                    </li>\n                    <li>\n                        <a class="#" data-action="add/shortlist" data-i18n="Shortlist" data-weave="shared/helper/translation"></a>\n                    </li>\n                    <li>\n                        <a class="#" data-action="floating/cv" data-i18n="Floating CV" data-weave="shared/helper/translation"></a>\n                    </li>\n                    <li>\n                        <a class="#" data-action="add/to/folder" data-i18n="Add to Folder" data-weave="shared/helper/translation"></a>\n                    </li>\n                </ul>\n            </div>\n        </span>\n        '),
		b += '\n    </div>\n\n    <div class="pull-right">\n\n        <select class="sort input-small" data-action="people/type">\n            <option value="" data-weave="shared/helper/translation" data-i18n="All people"></option>\n            <option value="candidate" data-weave="shared/helper/translation" data-i18n="Candidates"></option>\n            <option value="coldcall" data-weave="shared/helper/translation" data-i18n="Cold Call"></option>\n        </select>\n\n        <select class="sort input-medium note-status" data-action="note/status">\n            <option value="" data-weave="shared/helper/translation" data-i18n="Please select"></option>\n            ';
		for (var c = 0, d = a.length; d > c; c++) {
			b += "\n            ";
			var e = a[c];
			b += '\n            <option value="' + e.code + '">' + e.value + "</option>\n            "
		}
		return b += '\n        </select>\n\n        <select class="sort input-medium" data-action="sort">\n            <option value="lastUpdateDate" data-weave="shared/helper/translation" data-i18n="Sort by update (Descend)"></option>\n            <option value="lastUpdateDate&desc" data-weave="shared/helper/translation" data-i18n="Sort by update (Ascend)"></option>\n            <option value="dateAdded" data-weave="shared/helper/translation" data-i18n="Sort by shortlist (Descend)"></option>\n            <option value="dateAdded&desc" data-weave="shared/helper/translation" data-i18n="Sort by shortlist (Ascend)"></option>\n            <option value="candidate.englishName" data-weave="shared/helper/translation" data-i18n="Sort by English Name"></option>\n            <option value="candidate.company.name" data-weave="shared/helper/translation" data-i18n="Sort by Company"></option>\n            <option value="candidate.title" data-weave="shared/helper/translation" data-i18n="Sort by Title"></option>\n            <option value="currentStatus" data-weave="shared/helper/translation" data-i18n="Sort by Status"></option>\n            <option value="detail.0.user.englishName" data-weave="shared/helper/translation" data-i18n="Sort by User"></option>\n        </select>\n\n        <button class="btn btn-small" data-action="listview" data-toggle="tooltip" data-weave="shared/helper/translation(\'title\')" data-i18n="Switch View"><span></span></button>\n    </div>\n</div>\n\n<div class="clearfix">\n    <div class="btn-group btn-group-filter pull-left clearfix">\n        <button class="btn btn-small active" data-action="buttons-toggle"><span class="live-count">0</span> <span data-i18n="All people" data-weave="shared/helper/translation"></span></button>\n        <button class="btn btn-small" data-action="buttons-toggle(\'Shortlist\')"><span class="shortlist-count">0</span> <span data-i18n="New Shortlist" data-weave="shared/helper/translation"></span></button>\n        <button class="btn btn-small" data-action="buttons-toggle(\'CVSent\')"><span class="cvsent-count">0</span> <span data-i18n="CV sent without CCM" data-weave="shared/helper/translation"></span></button>\n        <button class="btn btn-small" data-action="buttons-toggle(\'ClientInterview\')"><span class="clientinterview-count">0</span> <span data-i18n="CCM" data-weave="shared/helper/translation"></span></button>\n        <button class="btn btn-small" data-action="buttons-toggle(\'OfferSign Invoice Onboard\')"><span class="offersign-count">0</span> <span data-i18n="Offer Signed" data-weave="shared/helper/translation"></span></button>\n    </div>\n    <div class="pull-right">\n        <div class="input-prepend">\n            <span class="add-on">\n                <i class="icon-search"></i>\n            </span><input type="text" class="iput-medium" data-weave="shared/helper/translation(\'placeholder\')" data-i18n="Search" data-action="search(\'live\')">\n        </div>\n    </div>\n</div>\n\n',
		this.viewType && (b += '\n<table class="table table_vam table-candidate table-bl">\n    <colgroup>\n        <col width="30">\n        <col>\n        <col width="60">\n        <col>\n        <col>\n        <col>\n        <col>\n        <col>\n        <col width="70">\n    </colgroup>\n    <thead>\n        <tr>\n            <th></th>\n            <th data-weave="shared/helper/translation" data-i18n="Name"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Attachment"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Phone"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Company"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Title"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Job Status"></th>\n            <th data-weave="shared/helper/translation" data-i18n="User"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Operation"></th>\n        </tr>\n    </thead>\n    <tbody>\n    </tbody>\n</table>\n'),
		b
	}
}), define("app/widget/job/detail/live-job/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "shared/helper/utils", "template!./main.html"], function (a, b, c, d, e, f) {
	function g() {
		var a = this,
		b = JSON.parse(JSON.stringify(a._originjson));
		a._status && (b = b.filter(function (b) {
					return a._status.indexOf(b.currentStatus) <= -1 ? !1 : !0
				})),
		a._type && (b = b.filter(function (b) {
					return b.candidate.type !== a._type ? !1 : !0
				})),
		a._noteStatus && (b = b.filter(function (b) {
					for (var c = !1, d = b.detail.length; d--; )
						if ("Note" === b.detail[d].type) {
							if (b.detail[d].status.code !== a._noteStatus)
								break;
							c = !0
						}
					return c
				})),
		a._json = b,
		k.call(a)
	}
	function h(a, b) {
		for (var c = 0, d = b.split("."), e = d.length; e > c; c++)
			try {
				a = a[d[c]]
			} catch (f) {
				a = ""
			}
		return a
	}
	function i(a) {
		var b = this,
		c = 0;
		b.$element.find('[class*="-count"]').text(0);
		for (var d in a)
			"Invoice" === d || "OfferSign" === d || "Onboard" === d ? (c += a[d], b.$element.find(".offersign-count").text(c)) : b.$element.find("." + d.toLowerCase().replace(" ", "-") + "-count").text(a[d]);
		b.$element.find(".live-count").text(b._json.length)
	}
	function j() {
		var a = this;
		a.publish("ajax", {
			url : n.STATUS
		}, c().done(function (b) {
				var d = b || [];
				c(function (b) {
					a.html(f, d, b)
				}).done(function () {
					k.call(a)
				}).done(function () {
					i.call(a, a._counts)
				})
			}))
	}
	function k() {
		var b,
		c = this,
		d = {};
		c._counts = d,
		c.$massActions = c.$element.find(".mass-action .btn"),
		c.$toggleAll = c.$element.find('[data-action="shortlist/toggle/all"]'),
		c.$noteStatus = c.$element.find(".note-status"),
		c.$listview = c.$element.find('[data-action="listview"]'),
		c.$element.find(".shortlist-steps").remove(),
		a.each(c._json, function (e, f) {
			d[f.currentStatus] = d[f.currentStatus] ? d[f.currentStatus] + 1 : 1,
			f.joborder = c._jobJson,
			c.viewType ? (b = a('<tr class="shortlist-steps"></tr>').data("json", f).data("islimited", c._islimited).attr("data-weave", "app/widget/shortlist/main(json, islimited, true)"), c.$listview.addClass("table-view").find("span").attr("class", "icon-sqaures"), c.$element.find("tbody").append(b)) : (b = a('<div class="shortlist-steps clearfix"></div>').data("json", f).data("islimited", c._islimited).attr("data-weave", "app/widget/shortlist/main(json, islimited, false)"), c.$listview.addClass("detail-view").find("span").attr("class", "icon-list"), c.$element.append(b)),
			c.$element.tooltip({
				selector : '[data-toggle="tooltip"]',
				trigger : "hover"
			})
		}),
		c.$element.find(".shortlist-steps").weave()
	}
	var l,
	m = "shortlist",
	n = {
		LISTVIEW : "/rest/user/listview",
		STATUS : "/rest/data/options?type=jobsubmission_status"
	};
	return b.extend(function (a, b, c, d, e) {
		this._jobJson = c,
		this._originjson = d,
		this._json = JSON.parse(JSON.stringify(d)),
		this._islimited = e
	}, {
		"hub:memory/context" : function (a, b) {
			var c = this;
			c.userId = b.user.id,
			c.viewType = b.user.listview[m] && b.user.listview[m].list ? b.user.listview[m].list !== l ? b.user.listview[m].list : !1 : !1,
			j.call(c)
		},
		"hub/job/shortlist/count/update" : function (a, b, c) {
			var d = this,
			e = d.$element.find("." + b.toLowerCase().replace(" ", "-") + "-count"),
			f = d.$element.find("." + c.toLowerCase().replace(" ", "-") + "-count");
			e.text(parseInt(e.text(), 10) - 1),
			f.text(parseInt(f.text(), 10) + 1)
		},
		"hub/live-job/show/living" : function (a, b) {
			var c = this;
			c.$element.find(".btn-group-filter .btn").eq(0).trigger("click"),
			c.publish("show/living", b)
		},
		"hub/job/live-job/update/count" : function (a, b, c) {
			var d,
			e,
			f = this;
			b !== c && (d = f.$element.find("." + b.toLowerCase().replace(" ", "-") + "-count"), d.text(parseInt(d.text(), 10) - 1), e = "OfferSign" === c || "Invoice" === c || "Onboard" === c ? f.$element.find(".offersign-count") : f.$element.find("." + c.toLowerCase().replace(" ", "-") + "-count"), e.text(parseInt(e.text(), 10) + 1))
		},
		"hub/shortlist/toggle/mass/action" : function () {
			var a = this;
			if (!a.$element.is(":hidden")) {
				var b = a.$element.find('[data-action="shortlist/check"]').length,
				c = a.$element.find('[data-action="shortlist/check"]').filter(":checked").length;
				c ? a.$massActions.removeClass("disabled") : a.$massActions.addClass("disabled"),
				b === c ? (a.$toggleAll.prop("indeterminate", !1), a.$toggleAll.prop("checked", !0)) : 0 === c ? (a.$toggleAll.prop("indeterminate", !1), a.$toggleAll.prop("checked", !1)) : c > 0 && b !== c && (a.$toggleAll.prop("checked", !1), a.$toggleAll.prop("indeterminate", !0))
			}
		},
		"dom/action.click.change" : a.noop,
		"dom/action/listview.click" : function (b, d) {
			d.preventDefault();
			var e = this,
			f = a(d.target),
			g = f.hasClass("detail-view");
			g ? f.removeClass("detail-view").addClass("table-view") : f.removeClass("table-view").addClass("detail-view"),
			e.publish("ajax", {
				url : n.LISTVIEW,
				data : {
					data : JSON.stringify({
						list : m,
						key : "list",
						value : g
					})
				},
				type : "post"
			}, c().done(function (a) {
					a.status && window.location.reload()
				}))
		},
		"dom/action/shortlist/toggle/all.click" : function (b, c) {
			var d = this,
			e = a(c.target);
			e.is(":checked") ? (d.publish("list/check/all"), d.publish("shortlist/toggle/mass/action")) : (d.publish("list/uncheck/all"), d.publish("shortlist/toggle/mass/action"))
		},
		"dom/action/sort.change" : function (b, c) {
			var d,
			e,
			f = this,
			g = a(c.target),
			i = g.val().split("&"),
			j = i[0],
			l = i[1];
			f.$element.find(".btn-group-filter .btn").eq(0).trigger("click"),
			f._json.sort(function (a, b) {
				return d = h(a, j),
				e = h(b, j),
				isNaN(Date.parse(d)) ? l ? e > d ? 1 : -1 : d > e ? 1 : -1 : (d = Date.parse(d), e = Date.parse(e), l ? d > e ? 1 : -1 : e > d ? 1 : -1)
			}),
			k.call(f)
		},
		"dom/action/buttons-toggle.click" : function (b, c, d) {
			c.preventDefault();
			var e = this,
			f = a(c.target);
			e._status = d,
			f.siblings().removeClass("active"),
			f.addClass("active"),
			g.call(e)
		},
		"dom/action/people/type.change" : function (b, c) {
			var d = this,
			e = a(c.target);
			d._type = e.val(),
			g.call(d)
		},
		"dom/action/note/status.change" : function (b, c) {
			var d = this,
			e = a(c.target);
			d._noteStatus = e.val(),
			g.call(d)
		},
		checkUserPermission : function () {
			for (var a = !1, b = this, c = b._jobJson.users, d = 0, e = c.length; e > d; d++)
				if (c[d].user.id === b.userId) {
					a = !0;
					break
				}
			return a
		}
	})
}), define("troopjs-requirejs/template!app/widget/job/detail/main.html", [], function () {
	return function (a) {
		var b = '<div class="pull-right">\r\n    ';
		return this._islimited || (b += '\r\n    <a href="#add!id=' + a.id + '" class="btn" data-weave="shared/helper/translation" data-i18n="Edit"></a>\r\n    '),
		b += '\r\n    <a href="javascript:history.back();" class="btn">\r\n        <i class="icon-arrow-left"></i>\r\n    </a>\r\n</div>\r\n    \r\n<h3 class="heading"><span data-weave="shared/helper/translation" data-i18n="Job Profile"></span> <span id="cid">ID: ' + a.id + '</span></h3>\r\n\r\n<div class="search_page">\r\n    <div class="search_panel clearfix clear">\r\n        <div class="search_item clearfix"></div>\r\n    </div>\r\n</div>\r\n\r\n<ul class="nav nav-tabs">\r\n    <li class="active">\r\n        <a data-toggle="tab" href="#live-candidates">\r\n            <span class="live-count"></span>\r\n            <span data-weave="shared/helper/translation" data-i18n="Shortlist"></span>\r\n        </a>\r\n    </li>\r\n    <li>\r\n        <a data-toggle="tab" href="#targets">\r\n            <span>' + a.targetcompany_count + '</span>\r\n            <span data-weave="shared/helper/translation" data-i18n="Target Company"></span>\r\n        </a>\r\n    </li>\r\n    <li>\r\n        <a data-toggle="tab" href="#task-tab">\r\n            <span>' + a.todo_count + '</span>\r\n            <span data-weave="shared/helper/translation" data-i18n="Task"></span>\r\n        </a>\r\n    </li>\r\n\r\n    <li>\r\n        <a data-toggle="tab" href="#email-tab">\r\n            <span>' + a.email_count + '</span>\r\n            <span data-weave="shared/helper/translation" data-i18n="Email"></span>\r\n        </a>\r\n    </li>\r\n\r\n    <li>\r\n        <a data-toggle="tab" href="#job-note-tab">\r\n            <span>' + a.note_count + '</span>\r\n            <span data-weave="shared/helper/translation" data-i18n="Note"></span>\r\n        </a>\r\n    </li>\r\n</ul>\r\n\r\n<div class="tab-content">\r\n    <!-- live-candidates -->\r\n    <div class="tab-pane active" id="live-candidates"></div>\r\n\r\n    <div class="tab-pane widget-spin" id="targets"></div>\r\n\r\n    <div class="tab-pane widget-spin" id="task-tab"></div>\r\n\r\n    <div class="tab-pane" id="email-tab"></div>\r\n\r\n    <div class="tab-pane" id="job-note-tab"></div>\r\n</div>'
	}
}), define("app/widget/job/detail/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "shared/helper/utils", "template!./main.html", "shared/helper/blurb", "redactor"], function (a, b, c, d, e, f, g) {
	function h() {
		var a = this;
		a._json.users.forEach(function (b) {
			return b.user.id == a._currentUserId ? (a._islimited = !1, !1) : void 0
		})
	}
	function i() {
		var b = this,
		e = [],
		f = c(),
		g = c();
		e.push(f.promise(), g.promise()),
		b.publish("ajax", {
			url : l.JOBORDER + b.uid
		}, f.done(function (a) {
				b._json = a,
				b.consultants = function () {
					for (var a = [], c = b._json.users, d = c.length; d--; ) {
						var e = c[d].user;
						a.filter(function (a) {
							return a.id === e.id
						}).length || a.push({
							id : e.id,
							name : e.englishName
						})
					}
					return a
				}
				(),
				h.call(b)
			})),
		b.publish("ajax", {
			url : "/rest/joborder/" + b.uid + "/shortlist"
		}, g.done(function (a) {
				b._shortlistJson = a
			})),
		d.apply(a, e).then(function () {
			j.call(b)
		})
	}
	function j() {
		var a = this;
		c(function (b) {
			a.html(f, a._json, b)
		}).done(function () {
			k.call(a)
		})
	}
	function k() {
		var b = this,
		d = b.$element;
		a('a[href="#job-note-tab"]').one("shown", function () {
			d.find("#job-note-tab").data("reference", b._json).attr("data-weave", "app/widget/job/detail/note-tab/main(reference)").weave()
		}),
		a('a[href="#targets"]').one("shown", function () {
			d.find("#targets").attr("data-weave", "app/widget/job/detail/targets-tab/main(" + b._json.id + ")").weave()
		}),
		a('a[href="#task-tab"]').one("shown", function () {
			d.find("#task-tab").attr("data-weave", "app/widget/job/detail/task-tab/main(" + b._json.id + ")").weave()
		}),
		a('a[href="#email-tab"]').one("shown", function () {
			d.find("#email-tab").attr("data-weave", m + '("' + b._json.id + '")').weave()
		}),
		c(function (a) {
			d.find(".search_item").data("json", b._json).attr("data-weave", "app/widget/job/item/main(json)").weave(a)
		}).done(function () {
			b.$live = a("#live-candidates"),
			b._shortlistJson.filter(function (a) {
				return "Rejected" !== a.currentStatus
			}),
			b.$live.data("json", b._json).data("items", b._shortlistJson).data("islimited", b._islimited).attr("data-weave", "app/widget/job/detail/live-job/main(json, items, islimited)").weave();
			var c = b._shortlistJson.length;
			d.find(".live-count").text(c)
		}).done(function () {
			e.widgetLoaded.call(b)
		})
	}
	var l = {
		SEND_CV : "/rest/joborder/<id>/sendcvstoclient",
		JOBORDER : "/rest/joborder/"
	},
	m = "app/widget/job/detail/email-tab/main",
	n = {
		email : g.t("Private email"),
		email1 : g.t("Work email"),
		email2 : g.t("Other")
	};
	return b.extend(function () {
		this._islimited = !0
	}, {
		"hub:memory/detail/id/change" : function (a, b) {
			var c = this;
			c.uid = b,
			i.call(c)
		},
		"hub:memory/context" : function (a, b) {
			var c = this;
			c._currentUserId = b.user.id
		},
		"hub/show/living" : function (a, b) {
			var c = this;
			c.$element.find('[href="#live-candidates"]').trigger("click"),
			c.$live.find("input:text").val(b).trigger("change")
		},
		"hub/show/rejected" : function (a, b) {
			var c = this;
			c.$element.find('[href="#rejected"]').trigger("click"),
			c.$rejected.find("input:text").val(b).trigger("change")
		},
		"dom/action.click.input.change.keydown.keyup" : a.noop,
		"dom/action/search.input.change.keydown.keyup" : function (b, c, d) {
			var e,
			f = this,
			g = a(c.target),
			h = a.trim(g.val()).toLowerCase();
			"live" === d ? e = f.$live.find(".shortlist-steps") : "rejected" === d && (e = f.$rejected.find(".shortlist-steps")),
			e.each(function () {
				var b = a(this),
				c = b.find(".searchable");
				c.each(function () {
					var c = a(this),
					d = c.text().toLowerCase();
					return d.indexOf(h) > -1 ? (b.closest(".shortlist-steps").removeClass("hide"), !1) : (b.closest(".shortlist-steps").addClass("hide"), void 0)
				})
			})
		},
		"dom/action/note/edit.click" : function () {
			var b = this;
			b.$jobnote.redactor({
				focus : !0,
				buttons : ["bold", "italic", "deleted", "|", "unorderedlist", "orderedlist", "outdent", "indent", "|", "alignment", "|", "horizontalrule"],
				plugins : ["fontfamily", "fontsize", "fontcolor"],
				linebreaks : !0,
				autoresize : !0,
				minHeight : 300
			}),
			a(".jobnote .btn").toggleClass("hide")
		},
		"dom/action/note/save.click" : function (b, d) {
			var f = this,
			g = a(d.target),
			h = f.$jobnote.redactor("get"),
			i = {
				id : f.uid,
				client : {
					id : f._json.client.id
				},
				note : h
			};
			f.$jobnote.redactor("destroy"),
			a(".jobnote .btn").toggleClass("hide"),
			f.publish("ajax", {
				url : "/rest/joborder/add",
				data : {
					data : JSON.stringify(i)
				},
				type : "post"
			}, c().done(function (a) {
					a.status ? e.alert("success", "Saving job note success.") : e.alert("error", a.message)
				}), g)
		},
		"dom/action/batch.click" : function (b, c) {
			c.preventDefault();
			var d,
			f = this,
			g = a(c.target),
			h = l.SEND_CV.replace("<id>", f._json.id),
			i = a("#live-candidates").find(":checkbox[name=candidates]:checked"),
			j = {},
			k = [];
			if (!g.hasClass("disabled")) {
				i.each(function () {
					j[this.value] = a(this).closest(".shortlist-steps").find(".candidate-name").text(),
					k.push(a(this).data("sid"))
				});
				var m,
				o,
				p = f._json,
				q = p.contacts,
				r = [],
				s = [],
				t = [];
				q.forEach(function (a) {
					var b,
					c,
					d = a.clientContact;
					o = [d.englishName, d.chineseName].join(" ").trim(),
					d.email ? (b = "email", c = d.email) : d.email1 ? (b = "email1", c = d.email1) : d.email2 && (b = "email2", c = d.email2),
					c ? (m || (m = d.id), r.push('"' + o + '" [' + n.email1 + "]"), s.push(c)) : t.push('<a href="/candidate#detail!id=' + d.id + '" target="_blank">' + o + "</a>")
				}),
				t.length && e.alert("info", "以下人才没有邮箱:<br>" + t.join(", "));
				var u = [];
				f.consultants.forEach(function (a) {
					u.push({
						id : a.id,
						text : a.name
					})
				}),
				d = {
					parseEmail : !0,
					individually : !1,
					sender : u,
					myId : f._currentUserId,
					id : p.id,
					names : r,
					emails : s,
					cvSendUrl : h,
					type : "cv_sent",
					emailTemplate : "cv_sent",
					category : "CV Sent",
					refreshPage : !0,
					sids : k,
					attachment : {
						candidate : j
					},
					checkAttachment : !0,
					skipSend : !0,
					templateVariable : {
						clientcontact_id : m,
						job_id : p.id
					}
				},
				f.publish("modal/sendemail/show", d)
			}
		},
		"dom/action/mass/send/email.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target),
			f = d.$live.is(":visible") ? d.$live.find(":checkbox[name=candidates]:checked") : d.$rejected.find(":checkbox[name=candidates]:checked"),
			g = [],
			h = [],
			i = null;
			if (!e.hasClass("disabled")) {
				f.each(function () {
					var b = a(this).data("json").candidate;
					g.push(b.email),
					h.push([b.englishName, b.chineseName].join(" ").trim())
				});
				var j = {
					names : h,
					emails : g,
					emailTemplate : "candidate_email",
					attachment : {
						joborder : 0,
						clientcompany : 0
					}
				};
				f.length && (i = f.data("json").id, j.candidate_id = i),
				d.publish("modal/sendemail/show", j)
			}
		},
		"dom/action/add/shortlist.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target),
			f = d.$live.is(":visible") ? d.$live.find(":checkbox[name=candidates]:checked") : d.$rejected.find(":checkbox[name=candidates]:checked"),
			g = [],
			h = [];
			e.hasClass("disabled") || (f.each(function () {
					var b = a(this).data("json").candidate;
					g.push(b.id),
					h.push([b.englishName, b.chineseName].join(" ").trim())
				}), d.publish("modal/addshortlist/show", {
					ids : g,
					names : h,
					type : "people"
				}))
		},
		"dom/action/floating/cv.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target),
			f = d.$live.is(":visible") ? d.$live.find(":checkbox[name=candidates]:checked") : d.$rejected.find(":checkbox[name=candidates]:checked"),
			g = [],
			h = [];
			e.hasClass("disabled") || (f.each(function () {
					var b = a(this).data("json").candidate,
					c = [b.englishName, b.chineseName].join(" ").trim();
					h.push(c),
					g.push({
						name : c,
						id : b.id
					})
				}), d.publish("modal/add-floating/show", {
					names : h,
					attachment : g,
					checkAttachment : !0
				}))
		},
		"dom/action/add/to/folder.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target),
			f = d.$live.is(":visible") ? d.$live.find(":checkbox[name=candidates]:checked") : d.$rejected.find(":checkbox[name=candidates]:checked"),
			g = [];
			e.hasClass("disabled") || (f.each(function () {
					g.push(a(this).data("json").candidate.id)
				}), d.publish("modal/add-to-folder/show", {
					ids : g,
					type : "candidate",
					multiSelect : !0
				}))
		}
	})
}), define("troopjs-requirejs/template!app/widget/job/detail/note-tab/main.html", [], function () {
	return function (a) {
		for (var b = "", c = 0, d = a.length; d > c; c++) {
			b += "\n";
			var e = a[c],
			f = e.dateAdded.split(" "),
			g = f[0],
			h = f[1],
			i = e.user,
			j = i.id;
			b += '\n<div class="activity-item clearfix">\n    <div class="pull-left span2 activity-time">\n        <p>\n            <span>' + h + "</span>\n            <span>" + g + '</span>\n            <a href="/user#' + e.user.id + '" target="_blank">' + e.user.englishName + '</a>\n        </p>\n    </div>\n    <div class="pull-left span10 activity-detail">\n        <div class="well">\n            <div class="title">\n                ',
			e.category && (b += '\n                <span class="label" style="background-color: ' + e.category.color + '">' + e.category.value + "</span>\n                "),
			b += "\n                ",
			j === this._userId && (b += '\n                <button class="btn btn-mini btn-edit" data-weave="shared/helper/translation" data-i18n="Edit" data-action="edit/note(' + c + ')"></button>\n                '),
			b += '\n            </div>\n            <div class="content">\n                ';
			for (var k = 0, l = e.items.length; l > k; k++)
				b += "\n                ", e.items[k].field && (b += "\n                <h4>" + e.items[k].field + "</h4>\n                "), b += "\n                <p>\n                    " + this.convertText(e.items[k].value) + "\n                </p>\n                ";
			b += "\n            </div>\n        </div>\n    </div>\n</div>\n"
		}
		return b
	}
}), define("app/widget/job/detail/note-tab/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "shared/helper/utils", "template!./main.html"], function (a, b, c, d, e) {
	function f() {
		var a = this;
		a.publish("ajax", {
			url : g.REMARK.replace("<id>", a.jobId)
		}, c().done(function (b) {
				a._json = b.list,
				a.html(e, a._json)
			}))
	}
	var g = {
		REMARK : "/rest/note/list?paginate_by=200&external_type=joborder&external_id=<id>"
	};
	return b.extend(function (a, b, c) {
		this._reference = c,
		this.jobId = c.id
	}, {
		"hub:memory/context" : function (a, b) {
			var c = this;
			c._userId = b.user.id,
			f.call(c)
		},
		"dom/action.click" : a.noop,
		"dom/action/edit/note.click" : function (a, b, c) {
			b.preventDefault();
			var d = this,
			e = d._json[c];
			d.publish("modal/add-note/show", {
				data : e,
				externalType : "joborder",
				optionType : "joborder_note_category",
				id : d._json.id,
				onSuccess : function (a) {
					a.status && f.call(d)
				}
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/job/detail/targets-tab/main.html", [], function () {
	return function () {
		var a = '<div class="well well-small">\n    <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="Add Target Company" data-action="add/target"></button>\n    <span class="mass-aciton">\n        <button class="btn btn-small disabled" data-weave="shared/helper/translation" data-i18n="Shortlist" data-action="mass/add/shortlist"></button>\n        <button class="btn btn-small disabled" data-weave="shared/helper/translation" data-i18n="Add to Folder" data-action="mass/to/folder"></button>\n        <button class="btn btn-small disabled" data-weave="shared/helper/translation" data-i18n="Remove" data-action="delete/targets"></button>\n    </span>\n</div>\n\n<table class="table table-bordered table_vam">\n    <colgroup>\n        <col width="30">\n        <col>\n        <col>\n        <col>\n        <col width="100">\n        <col width="100">\n        <col width="120">\n        <col width="120">\n        <col width="70">\n    </colgroup>\n    <thead>\n        <tr>\n            <th><input type="checkbox" data-action="toggle/all"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Company Name"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Importance"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Note"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Live Jobs"></th>\n            <th data-weave="shared/helper/translation" data-i18n="已拒绝"></th>\n            <th data-weave="shared/helper/translation" data-i18n="User"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Added Date"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Operation"></th>\n        </tr>\n    </thead>\n    <tbody>\n        \n    </tbody>\n</table>';
		return a
	}
}), define("troopjs-requirejs/template!app/widget/job/detail/targets-tab/item.html", [], function () {
	return function (a) {
		var b = "",
		c = a;
		return b += "\n",
		c.is_deleted || (b += '\n<tr data-id="' + c.client.id + '">\n    <td><input type="checkbox" data-action="toggle/one"></td>\n    <td>\n        <a href="/company#detail!id=' + c.client.id + '" target="_blank" class="client-name">' + c.client.name + '</a>\n    </td>\n    <td>\n        <a href="#" data-type="select" data-pk="' + c.id + '" data-value="' + c.importance + '" class="importance editable-click ', c.importance || (b += "editable-empty"), b += '">\n            ', b += c.importance ? '\n            <span data-weave="shared/helper/translation" data-i18n="' + c.importance + '">' + c.importance + "</span>\n            " : '\n            <span data-weave="shared/helper/translation" data-i18n="Not selected"></span>\n            ', b += '\n        </a>\n    </td>\n    <td>\n        <a href="#" data-type="textarea" data-pk="' + c.id + '" data-value="' + c.note + '" class="target-note editable-click ', c.note || (b += "editable-empty"), b += '">\n            ', b += c.note ? "\n            " : '\n            <span data-weave="shared/helper/translation" data-i18n="Not filled"></span>\n            ', b += '\n        </a>\n    </td>\n    <td>\n        <a href="#" data-action="show/active(' + c.client.name + ')">' + c.active_count + '</a>\n    </td>\n    <td>\n        <a href="#" data-action="show/inactive(' + c.client.name + ')">' + c.inactive_count + '</a>\n    </td>\n    <td>\n        <a href="/user/preview#' + c.user.id + '" data-action="profile/open">' + c.user.englishName + "</a>\n    </td>\n    <td>\n        " + c.dateAdded + '\n    </td>\n    <td>\n        <button class="btn btn-small" data-weave="shared/helper/translation" data-action="edit/target(' + c.id + ')" data-i18n="Edit"></button>\n    </td>\n</tr>\n'),
		b
	}
}), define("app/widget/job/detail/targets-tab/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "shared/helper/utils", "template!./main.html", "template!./item.html", "shared/helper/blurb", "jquery.datatables", "bootstrap.editable"], function (a, b, c, d, e, f, g, h) {
	function i() {
		var a = this,
		b = a.$element.find('[data-action="toggle/one"]').length,
		c = a.$element.find('[data-action="toggle/one"]').filter(":checked").length;
		c ? a.$massAction.removeClass("disabled") : a.$massAction.addClass("disabled"),
		b === c ? (a.$toggleAll.prop("indeterminate", !1), a.$toggleAll.prop("checked", !0)) : 0 === c ? (a.$toggleAll.prop("indeterminate", !1), a.$toggleAll.prop("checked", !1)) : c > 0 && b !== c && (a.$toggleAll.prop("checked", !1), a.$toggleAll.prop("indeterminate", !0))
	}
	function j(a) {
		var b = this;
		a.find("a.target-note").editable({
			emptytext : "未填写",
			url : o.EDIT.replace("<jobid>", b._id),
			params : function (a) {
				return a.note = a.value,
				a.id = a.pk,
				delete a.value,
				delete a.pk,
				delete a.name, {
					data : JSON.stringify(a)
				}
			},
			success : function (a) {
				a.status || e.alert("error", a.message)
			},
			error : function (a) {
				var b = JSON.parse(a.responseText);
				e.alert("error", b.message)
			}
		})
	}
	function k(b) {
		var c = this;
		b.find("a.importance").editable({
			emptytext : "未选择",
			source : [{
					code : "High",
					value : h.t("High")
				}, {
					code : "Medium",
					value : h.t("Medium")
				}, {
					code : "Low",
					value : h.t("Low")
				}
			],
			url : o.EDIT.replace("<jobid>", c._id),
			params : function (a) {
				return a.importance = a.value,
				a.id = a.pk,
				delete a.value,
				delete a.pk,
				delete a.name, {
					data : JSON.stringify(a)
				}
			},
			success : function (b, c) {
				b.status ? a(this).text(h.t(c)) : e.alert("error", b.message)
			},
			error : function (a) {
				var b = JSON.parse(a.responseText);
				e.alert("error", b.message)
			}
		})
	}
	function l() {
		var b = this,
		f = [];
		b.publish("ajax", {
			url : o.TARGETS.replace("<jobid>", b._id)
		}, c().done(function (h) {
				b._json = h,
				b.$table.fnDestroy && b.$table.fnDestroy(),
				b.$tbody.empty(),
				b._json.forEach(function (d) {
					var e = c(),
					h = a(g(d));
					f.push(e.promise()),
					b.$tbody.append(h),
					j.call(b, h),
					k.call(b, h),
					h.find("[data-weave]").weave(e)
				}),
				d.apply(a, f).done(function () {
					b.$toggleOne = b.$element.find('[data-action="toggle/one"]'),
					b.$table.dataTable({
						sDom : "ft",
						bDestroy : !0,
						bPaginate : !1,
						bLengthChange : !1,
						aaSorting : [],
						oLanguage : {
							sSearch : ""
						},
						aoColumnDefs : [{
								bSortable : !1,
								aTargets : [0]
							}, {
								bSortable : !1,
								aTargets : [8]
							}
						],
						aoColumns : [null, null, {
								sType : "enum"
							}, null, null, null, null, null, null],
						fnInitComplete : function () {
							b.$table.width("100%");
							var a = b.$element.find(".dataTables_filter"),
							c = a.find("label");
							a.prepend('<div class="input-prepend pull-right"><span class="add-on"><i class="icon-search"></i></span></div>'),
							a.find(".input-prepend").append(c),
							c.find("input").attr("placeholder", "搜索")
						}
					}),
					e.widgetLoaded.call(b)
				})
			}))
	}
	function m(a) {
		var b = this;
		b.html(f, b._json, a)
	}
	function n(a) {
		var b = this;
		b.$massAction = b.$element.find(".mass-aciton .btn"),
		b.$toggleAll = b.$element.find('[data-action="toggle/all"]'),
		b.$table = b.$element.find("table"),
		b.$tbody = b.$element.find("tbody"),
		b.$element.find("table").dataTable({
			sDom : "ft",
			bPaginate : !1,
			bLengthChange : !1,
			aaSorting : [],
			oLanguage : {
				sSearch : ""
			},
			aoColumnDefs : [{
					bSortable : !1,
					aTargets : [0]
				}
			],
			fnInitComplete : function () {
				var a = b.$element.find(".dataTables_filter"),
				c = a.find("label");
				a.prepend('<div class="input-prepend pull-right"><span class="add-on"><i class="icon-search"></i></span></div>'),
				a.find(".input-prepend").append(c),
				c.find("input").attr("placeholder", "搜索")
			}
		}),
		l.call(b),
		a.resolve()
	}
	var o = {
		TARGETS : "/rest/joborder/<jobid>/targetcompany",
		DELETE : "/rest/joborder/<jobid>/targetcompany/del",
		EDIT : "/rest/joborder/<jobid>/targetcompany/edit"
	};
	return a.extend(a.fn.dataTableExt.oSort, {
		"enum-pre" : function (b) {
			var c = a(b).data("value");
			switch (c) {
			case "High":
				return 1;
			case "Medium":
				return 2;
			case "Low":
				return 3;
			default:
				return 4
			}
		},
		"enum-asc" : function (a, b) {
			return b > a ? -1 : a > b ? 1 : 0
		},
		"enum-desc" : function (a, b) {
			return b > a ? 1 : a > b ? -1 : 0
		}
	}),
	b.extend(function (a, b, c) {
		this._id = c
	}, {
		"sig/initialize" : function (a, b) {
			m.call(this, b)
		},
		"sig/start" : function (a, b) {
			n.call(this, b)
		},
		"dom/action.click" : a.noop,
		"dom/action/toggle/all.click" : function (b, c) {
			var d = this,
			e = a(c.target);
			e.is(":checked") ? d.$toggleOne.prop("checked", !0) : d.$toggleOne.prop("checked", !1),
			i.call(d)
		},
		"dom/action/toggle/one.click" : function () {
			var a = this;
			i.call(a)
		},
		"dom/action/add/target.click" : function (a, b) {
			b.preventDefault();
			var c = this;
			c.publish("modal/add-target-company/show", {
				jobid : c._id,
				onSuccess : function () {
					l.call(c)
				}
			})
		},
		"dom/action/edit/target.click" : function (a, b, c) {
			b.preventDefault();
			var d = this,
			e = d._json.filter(function (a) {
					return a.id === c
				})[0];
			d.publish("modal/add-target-company/show", {
				jobid : d._id,
				data : e,
				onSuccess : function () {
					l.call(d)
				}
			})
		},
		"dom/action/delete/targets.click" : function (b, d) {
			d.preventDefault();
			var f = this,
			g = a(d.target);
			if (!g.hasClass("disabled")) {
				var h = window.confirm("确定要删除所选的目标公司吗?");
				if (!h)
					return !1;
				var j = f.$element.find('[data-action="toggle/one"]').filter(":checked"),
				k = j.closest("tr"),
				m = function () {
					var b = [];
					return k.each(function () {
						b.push(a(this).data("id"))
					}),
					b
				}
				();
				g.addClass("disabled"),
				f.publish("ajax", {
					url : o.DELETE.replace("<jobid>", f._id),
					data : {
						data : JSON.stringify({
							client_ids : m
						})
					},
					type : "post"
				}, c().done(function (a) {
						a.status ? l.call(f) : e.alert("error", a.data)
					}).always(function () {
						i.call(f)
					}))
			}
		},
		"dom/action/profile/open.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			f = d.attr("href");
			e.window({
				url : f,
				name : "User Profile",
				width : "1024"
			})
		},
		"dom/action/show/active.click" : function (a, b, c) {
			b.preventDefault();
			var d = this;
			d.publish("live-job/show/living", c)
		},
		"dom/action/show/inactive.click" : function (a, b, c) {
			b.preventDefault();
			var d = this;
			d.publish("show/rejected", c)
		},
		"dom/action/mass/to/folder.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target);
			if (!e.hasClass("disabled")) {
				var f = d.$element.find('[data-action="toggle/one"]').filter(":checked"),
				g = [];
				f.each(function () {
					g.push(a(this).data("id"))
				}),
				d.publish("modal/add-to-folder/show", {
					multiSelect : !0,
					ids : g,
					type : "client"
				})
			}
		},
		"dom/action/mass/add/shortlist" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target);
			if (!e.hasClass("disabled")) {
				var f = d.$element.find('[data-action="toggle/one"]').filter(":checked"),
				g = [],
				h = [];
				f.each(function () {
					g.push(a(this).data("id")),
					h.push(a(this).closest("tr").find(".client-name").text())
				}),
				d.publish("modal/addshortlist/show", {
					ids : g,
					names : h,
					type : "company"
				})
			}
		}
	})
}), define("troopjs-requirejs/template!app/widget/job/detail/task-tab/main.html", [], function () {
	return function () {
		var a = '<table class="table table-striped table-bordered table_vam">\n    <colgroup>\n        <col width="30">\n        <col width="150">\n        <col width="150">\n        <col>\n        <col width="150">\n        <col width="150">\n        <col width="150">\n        <col width="70">\n    </colgroup>\n    <thead>\n        <tr>\n            <th>\n                <input type="checkbox" data-action="check/all">\n            </th>\n            <th data-weave="shared/helper/translation" data-i18n="Task type"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Task object"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Note"></th> \n            <th data-weave="shared/helper/translation" data-i18n="Date"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Participant"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Creator"></th> \n            <th data-weave="shared/helper/translation" data-i18n="Operaion"></th>\n        </tr>\n    </thead>\n    <tbody></tbody>\n</table>';
		return a
	}
}), define("app/widget/job/detail/task-tab/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "shared/helper/utils", "template!./main.html"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		b.html(e, a)
	}
	function g(a) {
		var b = this;
		b.publish("ajax", {
			url : b._url
		}, c().done(function (c) {
				c.list.length && c.list.forEach(function (a) {
					b.appendItem(a)
				}),
				d.widgetLoaded.call(b),
				a.resolve()
			}))
	}
	var h = {
		DONE : "/rest/todo/done"
	};
	return b.extend(function (a, b, c) {
		this._url = "/rest/todo/list?external_type=joborder&external_id=" + c
	}, {
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"sig/start" : function (a, b) {
			var c = this;
			g.call(c, b)
		},
		"hub/add/task/count" : function () {
			var a = this;
			a.$element.find("tbody").children().remove(),
			g.call(a, c())
		},
		appendItem : function (a) {
			var b = this;
			b.$element.find("tbody").append("<tr></tr>"),
			b.$element.find("tbody").children().last().data("json", a).attr("data-weave", "app/widget/task/item(json)").weave()
		},
		"dom/action.change" : a.noop,
		"dom/action/check/all.change" : function (b, e) {
			var f,
			g = this,
			i = a(e.target),
			j = i.is(":checked"),
			k = [];
			j ? (f = g.$element.find("tbody :checkbox").filter(":not(:disabled)").filter(":not(:checked)"), f.prop("checked", !0)) : (f = g.$element.find("tbody :checkbox").filter(":not(:disabled)").filter(":checked"), f.prop("checked", !1)),
			f.each(function () {
				k.push(a(this).data("id"))
			}),
			k.length && g.publish("ajax", {
				url : h.DONE,
				data : {
					data : JSON.stringify({
						ids : k,
						done : j
					})
				},
				type : "POST"
			}, c().done(function (a) {
					a.status ? d.alert("success", "任务状态更改成功!") : d.alert("error", a.data || a.message)
				}))
		}
	})
}), define("troopjs-requirejs/template!app/widget/job/filter/main.html", [], function () {
	return function () {
		var a = '<ul class="nav nav-pills line_sep">\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Job Name"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <input type="text" class="input-medium" autocomplete="off">\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'jobTitle__icontains\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Company"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <input type="text" name="company-name" class="input-large" data-weave="app/widget/common/company-suggestion/main" autocomplete="off">\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'client__name__icontains\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Client Type"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <select name="client_type">\r\n                        <option value="" data-weave="shared/helper/translation" data-i18n="Please select"></option>\r\n                        <option value="bding" data-weave="shared/helper/translation" data-i18n="bding company"></option>\r\n                        <option value="client" data-weave="shared/helper/translation" data-i18n="client company"></option>\r\n                    </select>\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'client_type\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Tags"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <input type="text" data-type="tag" name="tags" data-weave="shared/widget/common/tagit/main">\r\n                    <div class="help-block" data-i18n="Separate keywords" data-weave="shared/helper/translation"></div>\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'tags\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Industry"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <div class="comtree span" data-name="industry_id" data-url="/rest/data/industry" data-weave="shared/widget/common/comtree/main"></div>\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'industry_id\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Function"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <div class="comtree span" data-name="function_id" data-url="/rest/data/function" data-weave="shared/widget/common/comtree/main"></div>\r\n                </div>\r\n                    \r\n                <button class="btn" type="submit" data-action="form(\'function_id\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="City"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <div class="comtree span" data-name="city_id" data-url="/rest/data/city" data-weave="shared/widget/common/comtree/main"></div>\r\n                </div>\r\n                    \r\n                <button class="btn" type="submit" data-action="form(\'city_id\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Status"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <select name="jobStatus__eq">\r\n                        <option value="Live" data-weave="shared/helper/translation" data-i18n="Live Jobs"></option>\r\n                        <option value="Successful" data-weave="shared/helper/translation" data-i18n="Successful Jobs"></option>\r\n                        <option value="Failed" data-weave="shared/helper/translation" data-i18n="Failed Jobs"></option>\r\n                        <option value="Pending" data-weave="shared/helper/translation" data-i18n="Pending Jobs"></option>\r\n                    </select>\r\n                </div>\r\n\r\n                <button class="btn" type="submit" data-action="form(\'jobStatus__eq\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Priority"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <select name="priority__eq" class="input-medium">\r\n                    <option value="" data-weave="shared/helper/translation" data-i18n="Please select"></option>\r\n                    <option value="High" data-weave="shared/helper/translation" data-i18n="High"></option>\r\n                    <option value="Medium" data-weave="shared/helper/translation" data-i18n="Medium"></option>\r\n                    <option value="Low" data-weave="shared/helper/translation" data-i18n="Low"></option>\r\n                </select>\r\n                <button class="btn" type="submit" data-action="form(\'priority__eq\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>    \r\n\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="User"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <select data-placeholder="Choose a user..." name="name" class="input-large" data-weave="shared/widget/common/user-list/main">\r\n                    </select>\r\n                </div>\r\n\r\n                <div class="control-group">\r\n                    <select name="type">\r\n                        <option value="user_id" data-weave="shared/helper/translation" data-i18n="Any role"></option>\r\n                        <option value="bd_id" data-weave="shared/helper/translation" data-i18n="BD"></option>\r\n                        <option value="main_consultant_id">Main Consultant</option>\r\n                        <option value="consultant_id">Consultant</option>\r\n                        <option value="researcher_id">Researcher</option>\r\n                    </select>\r\n                </div>\r\n                \r\n                <button class="btn" type="submit" data-action="form(\'user\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Team"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <div class="comtree span" data-name="team_id" data-url="/rest/data/team" data-weave="shared/widget/common/comtree/main"></div>\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'team_id\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Last update"></a>\r\n\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#">\r\n                <ul class="nav nav-pills">\r\n                    <li>\r\n                        <a href="#lastUpdateDate__today=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="Today"></a>\r\n                    </li>\r\n                    <li>\r\n                        <a href="#lastUpdateDate__this_week=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="This week"></a>\r\n                    </li>\r\n                    <li>\r\n                        <a href="#lastUpdateDate__this_month=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="This month"></a>\r\n                    </li>\r\n                    <li>\r\n                        <a href="#lastUpdateDate__one_month_ago=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="> 1 month"></a>\r\n                    </li>\r\n                    <li>\r\n                        <a href="#lastUpdateDate__three_months_ago=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="> 3 months"></a>\r\n                    </li>\r\n                    <li>\r\n                        <a href="#lastUpdateDate__six_months_ago=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="> 6 months"></a>\r\n                    </li>\r\n                    <li>\r\n                        <a href="#lastUpdateDate__one_year_ago=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="> 1 year"></a>\r\n                    </li>\r\n                </ul>\r\n                <input type="text" name="from" class="date input-small" data-weave="shared/widget/common/date-picker/main">\r\n                -\r\n                <input type="text" name="to" class="date input-small" data-weave="shared/widget/common/date-picker/main">\r\n                <button class="btn" type="submit" data-action="form(\'update\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Attachment Type"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <select name="attachment_type" data-type="job" data-weave="app/widget/common/attachment-type/main"></select>\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'attachment_type\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    ';
		if (this._hasExtra) {
			a += '\r\n    <li class="divider"></li>\r\n    <li class="dropdown">\r\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Other Fields"></a>\r\n        <div class="dropdown-menu filter-content">\r\n            <form action="#" class="form-horizontal">\r\n                <div class="control-group">\r\n                    <select name="ext-type" class="input-large">\r\n                        <option value="" data-weave="shared/helper/translation" data-i18n="Please select"></option>\r\n                        ';
			for (var b = 0, c = this.extFields.length; c > b; b++)
				a += "\r\n                        ", this.extraFields[this.extFields[b]] && (a += '\r\n                        <option value="' + this.extFields[b] + '__icontains">' + this.extraFields[this.extFields[b]] + "</option>\r\n                        "), a += "\r\n                        ";
			a += '\r\n                    </select>\r\n                </div>\r\n                <div class="control-group">\r\n                    <input type="text" name="ext-value" class="input-large">\r\n                </div>\r\n                <button class="btn" type="submit" data-action="form(\'ext\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\r\n            </form>\r\n        </div>\r\n    </li>\r\n    '
		}
		return a += '\r\n</ul>\r\n\r\n<p class="sepH_b">\r\n    <span class="tag label label-info deletable hide" data-query="jobTitle__icontains" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Job Name"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="client__name__icontains" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Company"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="client_type" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Client Type"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="tags" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Tags"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="industry_id" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Industry"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="function_id" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Function"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="city_id" data-action="tag/remove"><b data-i18n="City" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="jobStatus__eq" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Status"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="priority__eq" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Priority"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="user" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="User"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="team_id" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Team"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="update" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Last update"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="attachment_type" data-action="tag/remove"><b data-i18n="Attachment Type" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <span class="tag label label-info deletable hide" data-query="ext" data-action="tag/remove"><b data-i18n="Other Fields" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\r\n    <a href="#" class="hide save-filter" data-action="filter/save/toggle" data-weave="shared/helper/translation" data-i18n="Save as"></a>\r\n</p>\r\n\r\n<form action="#" class="form-horizontal save-filter-form hide">\r\n    <input type="text" class="input-medium">\r\n    <button class="btn" data-action="filter/save" data-weave="shared/helper/translation" data-i18n="Save"></button>\r\n    <button class="btn" data-action="filter/save/toggle" data-weave="shared/helper/translation" data-i18n="Close"></button>\r\n</form>'
	}
}), define("app/widget/job/filter/main", ["compose", "jquery", "shared/widget/filter/base", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "shared/widget/filter/query", "jquery.tagit"], function (a, b, c, d, e, f, g) {
	function h() {
		g.addAttr({
			jobTitle__icontains : function (a) {
				var c = b.trim(a.find("input").val());
				c.length && this.addQuery("jobTitle__icontains", "jobTitle__icontains=" + window.encodeURIComponent(c))
			},
			client__name__icontains : function (a) {
				var c = b.trim(a.find('input[name="company-name"]').val());
				c.length && this.addQuery("client__name__icontains", "client__name__icontains=" + window.encodeURIComponent(c))
			},
			client_type : function (a) {
				var b = a.find('[name="client_type"]').val();
				b.length && this.addQuery("client_type", "client_type=" + window.encodeURIComponent(b))
			},
			tags : function (a) {
				var b = a.find("input").val();
				b && this.addQuery("tags", "tags=" + encodeURIComponent(b))
			},
			industry_id : function (a) {
				var b = a.find('[name="industry_id"]').val();
				b.length && this.addQuery("industry_id", "industry_id=" + b)
			},
			function_id : function (a) {
				var b = a.find('[name="function_id"]').val();
				b.length && this.addQuery("function_id", "function_id=" + b)
			},
			city_id : function (a) {
				var b = a.find('[name="city_id"]').val();
				b.length && this.addQuery("city_id", "city_id=" + b)
			},
			jobStatus__eq : function (a) {
				var b = a.find("select").val();
				b.length && this.addQuery("jobStatus__eq", "jobStatus__eq=" + b)
			},
			priority__eq : function (a) {
				var b = a.find("select").val();
				b.length && this.addQuery("priority__eq", "priority__eq=" + b)
			},
			user : function (a) {
				var b = a.find('select[name="type"]').val(),
				c = a.find('select[name="name"]').val();
				b.length && c.length && this.addQuery("user", b + "=" + c)
			},
			team_id : function (a) {
				var b = a.find('[name="team_id"]').val();
				b.length && this.addQuery("team_id", "team_id=" + b)
			},
			update : function (a) {
				var b = a.find('input[name="from"]').val(),
				c = a.find('input[name="to"]').val();
				b && c && this.addQuery("update", "lastUpdateDate__gt=" + b + "&lastUpdateDate__lt=" + c)
			},
			ext : function (a) {
				var b = a.find('select[name="ext-type"] :selected').val(),
				c = a.find("input").val();
				b.length && c.length && this.addQuery(b, b + "=" + window.encodeURIComponent(c))
			},
			attachment_type : function (a) {
				var b = a.find("select").val();
				b.length && this.addQuery("attachment_type", "attachment_type=" + encodeURIComponent(b))
			}
		})
	}
	function i(a, c, d) {
		var e,
		f = 0,
		g = c.length,
		h = a.clone();
		if (d)
			for (b("<option>").val("").text("------").appendTo(h); g > f; f += 1)
				e = c[f], e.parent_id == d && b("<option>").val(e.id).text(e.name).appendTo(h);
		else
			for (; g > f; f += 1)
				e = c[f], e.parent_id || b("<option>").val(e.id).text(e.name).appendTo(h);
		a.replaceWith(h)
	}
	function j(a) {
		var b = this;
		b.publish("ajax", {
			url : o.EXTRA_FIELDS
		}, d().done(function (c) {
				b.extraFields = JSON.parse(c[0].value),
				b._hasExtra = function () {
					var a = !1;
					for (var c in b.extraFields)
						if (b.extraFields[c]) {
							a = !0;
							break
						}
					return a
				}
				(),
				b.html(e, b._json, a)
			}))
	}
	function k(a) {
		a.resolve()
	}
	function l(a) {
		var c,
		d,
		e,
		f = this,
		h = a[0],
		i = a[1];
		switch (h) {
		case "user_id":
		case "bd_id":
		case "main_consultant_id":
		case "consultant_id":
		case "researcher_id":
			d = f.$element.find('select[name="type"]').find('[value="' + a[0] + '"]').text(),
			e = f.$element.find('select[name="name"]').find('[value="' + i + '"]').text(),
			f.$element.find('[data-query="user"]').removeClass("hide").find("span").text(d + " - " + e),
			g.addQuery("user", h + "=" + i);
			break;
		case "lastUpdateDate":
			if (a[0].indexOf("gt") > -1 || a[0].indexOf("lt") > -1) {
				if (a[0].indexOf("gt") > -1 ? f.updateFrom = i : a[0].indexOf("lt") > -1 && (f.updateTo = i), f.updateFrom && f.updateTo)
					return f.$element.find('[data-query="update"]').removeClass("hide").find("span").text(f.updateFrom + " - " + f.updateTo), g.addQuery("update", "lastUpdateDate__gt=" + f.updateFrom + "&lastUpdateDate__lt=" + f.updateTo), void 0
			} else
				f.$element.find('a[data-action="lastupdate"]').each(function () {
					return b(this).attr("href").substring(1) == a[0] + "=" ? (c = b(this).text(), !1) : void 0
				}), f.$element.find('[data-query="update"]').removeClass("hide").find("span").text(c), g.addQuery("update", a[0] + "=");
			break;
		case "ext1__icontains":
		case "ext2__icontains":
		case "ext3__icontains":
		case "ext4__icontains":
		case "ext5__icontains":
		case "ext6__icontains":
			d = f.$element.find('select[name="ext-type"] [value="' + a[0] + '"]').text(),
			f.$element.find('[data-query="ext"]').removeClass("hide").find("span").text(d + " - " + window.decodeURIComponent(i)),
			g.addQuery("ext", h + "=" + i);
			break;
		case "function_id":
		case "industry_id":
		case "team_id":
		case "city_id":
			c = f.$element.find('[data-name="' + h + '"]').woven()[0].getNodeNameById(window.decodeURIComponent(i)),
			f.$element.find('[data-query="' + h + '"]').removeClass("hide").find("span").text(c),
			g.addQuery(h, h + "=" + i);
			break;
		case "jobStatus__eq":
		case "priority__eq":
		case "client_type":
		case "attachment_type":
			c = f.$element.find('[name="' + h + '"]').find('[value="' + i + '"]').text(),
			f.$element.find('[data-query="' + h + '"]').removeClass("hide").find("span").text(c),
			g.addQuery(h, h + "=" + i);
			break;
		case "byfilter":
			break;
		default:
			f.$element.find('[data-query="' + h + '"]').removeClass("hide").find("span").text(window.decodeURIComponent(i)),
			g.addQuery(h, h + "=" + i)
		}
	}
	function m() {
		var a = this;
		this.ageFrom = null,
		this.maxYear = null,
		this.salaryFrom = null,
		this.salaryTo = null,
		this.updateFrom = null,
		this.updateTo = null,
		g.url = o.SAVE_FILTER,
		a._setFilter = l
	}
	var n = new Date;
	({
		YEAR : n.getFullYear(),
		MONTH : n.getMonth(),
		DATE : n.getDate(),
		DAY : n.getDay()
	});
	var o = {
		SAVE_FILTER : "/rest/data/queryfilter/joborder/add",
		EXTRA_FIELDS : "/rest/data/configvalue?keys=joborder_field_names"
	};
	return c.extend(function () {
		var a = this;
		m.call(a),
		h.call(a)
	}, {
		extFields : ["ext1", "ext2", "ext3", "ext4", "ext5", "ext6"],
		"sig/initialize" : function (a, b) {
			j.call(this, b)
		},
		"sig/start" : function (a, b) {
			k.call(this, b)
		},
		"hub:memory/filter/set" : a.around(function (a) {
			return function (b, c) {
				a.call(this, b, c),
				m.call(this)
			}
		}),
		"dom/action.click" : b.noop,
		"dom/action/lastupdate.click" : function (a, c) {
			c.preventDefault();
			var d = b(c.target);
			b('[data-query="update"]').removeClass("hide").find("span").text(d.text()),
			g.addQuery("update", d.attr("href").substring(1)),
			d.closest("form").find("button").trigger("click")
		},
		"dom/action.change" : b.noop,
		"dom/action/function.change" : function (a, c) {
			c.preventDefault();
			var d = b(c.target),
			e = d.val(),
			f = d.next().empty();
			i(f, this._function, e);
			var g = d.next();
			g.children().length > 1 ? g.removeClass("hide") : g.addClass("hide")
		},
		"dom/action/industry.change" : function (a, c) {
			c.preventDefault();
			var d = b(c.target),
			e = d.val(),
			f = d.next().empty();
			i(f, this._industry, e);
			var g = d.next();
			g.children().length > 1 ? g.removeClass("hide") : g.addClass("hide")
		}
	})
}), define("troopjs-requirejs/template!app/widget/job/item/detail.html", [], function () {
	return function (a) {
		var b = "",
		c = a.users,
		d = a.contacts,
		e = "",
		f = "",
		g = a.jobStatus,
		h = this.isList;
		switch (g) {
		case "Live":
			f = "label-warning";
			break;
		case "Failed":
			f = "label-inverse";
			break;
		case "Successful":
			f = "label-red"
		}
		switch (a.priority) {
		case "High":
			e = "label-red";
			break;
		case "Medium":
			e = 'label-info"'
		}
		b += '\n<div class="search_content full-width">\n    <div class="search_item_tags pull-right clearfix">\n        <span class="label ' + f + '" data-weave="shared/helper/translation" data-i18n="' + g + ' Jobs"></span>&nbsp;\n        \n        ',
		a.client && a.client.industry.id && (b += '\n        <span class="label industry">' + a.client.industry.name + "</span>&nbsp;\n        "),
		b += "\n        ",
		a.function  && a.function .id && (b += '\n        <span class="label function">' + a.function .name + "</span>\n        "), b += "\n        ", a.priority && (b += '\n        <span class="label ' + e + '" data-weave="shared/helper/translation" data-i18n="' + a.priority + '"></span>\n        '), b += '\n    </div>\n\n    <div class="pull-left item-title">\n        <span class="badge badge-info">' + a.currentCount + "/" + a.totalCount + '</span>\n\n        <a href="/job#detail!id=' + a.id + '" class="title">' + a.jobTitle + '</a>\n        <a href="/job#detail!id=' + a.id + '" target="_blank" title="Open in new tab"><span class="icon-new-window icon-blue"></span></a>\n        ', a.client && (b += '\n        of\n        <a href="company#detail!id=' + a.client.id + '" target="_blank"> ' + a.client.name + "</a>\n        ", !a.client.type || "client" !== a.client.type && "bding" !== a.client.type || (b += '\n        (<abbr class="red" data-weave="shared/helper/translation" data-i18n="' + a.client.type + ' company"></abbr>)\n        '), b += "\n        ", a.city && (b += "\n        <span>(" + a.city.name + ")</span>\n        "), b += "\n\n        ", this.showMoreInfo && (b += '\n        <span>(<a href="##" data-toggle="popover">更多信息</a>)</span>\n        '), b += "\n\n        "), b += "\n        ", this._islimited || (b += '\n        <span class="dropdown" data-weave="app/widget/common/attachment-view/main(' + a.attachment_count + ", 'joborder', " + a.id + ')">\n        </span>\n\n        '), b += "\n        ", this._islimited || (b += '\n        <a href="/job#add!id=' + a.id + '" target="_blank" class="content-actions" data-weave="shared/helper/translation(\'title\')" data-i18n="Edit">\n            <i class="icon-edit icon-blue"></i>\n        </a>\n        '), b += '\n    </div>\n\n    <div class="sepH_b item_description clearfix">\n        ';
			for (var i = 0, j = c.length; j > i; i++)
				b += '\n        <span class="muted">' + c[i].type + ': <a href="/user/preview#' + c[i].user.id + '" data-action="profile/open">' + c[i].user.englishName + "</a></span>\n        ";
			b += '\n        \n        <span class="pull-right contacts muted">\n            <span data-weave="shared/helper/translation" data-i18n="Contacts"></span>:\n\n            ';
			for (var i = 0, j = d.length; j > i; i++)
				b += "\n                ", b += d[i].clientContact.islimited ? "\n                <span>ID " + d[i].clientContact.id + "</span>\n                " : '\n                <a href="/candidate#detail!id=' + d[i].clientContact.id + '" target="_blank">' + [d[i].clientContact.englishName, d[i].clientContact.chineseName].join(" ").trim() + "</a>\n                ", b += "\n            ";
			return b += '\n        </span>\n    </div>\n    \n    <div class="sepH_a tags-area hide">\n        <input type="text" class="tags" value="' + a.tags + '" data-type="tag">\n    </div>\n\n    <ul class="unstyled inline pull-right last-update">\n        <li>\n            <span data-weave="shared/helper/translation" data-i18n="CVs Sent"></span>: ' + a.cvsent_count + '\n        </li>\n        <li>\n            <span data-weave="shared/helper/translation" data-i18n="CCM"></span>: ' + a.clientinterview_count + '\n        </li>\n        <li>\n            <span data-weave="shared/helper/translation" data-i18n="Offer Signed"></span>: ' + a.offersign_count + '\n        </li>\n        <li>\n            <span data-toggle="tooltip" title="' + a.dateAdded + '"><span data-weave="shared/helper/translation" data-i18n="Live days"></span>: ' + a.livedays + '</span>\n        </li>\n        <li>\n            <span data-toggle="tooltip" title="' + a.lastUpdateDate + '"><span data-weave="shared/helper/translation" data-i18n="Last update"></span>: ' + a.lastUpdate + '</span>\n        </li>\n    </ul>\n\n    <ul class="nav nav-pills line_sep actions">\n        <li>\n            <a href="#" data-action="note" data-preview="' + h + '">\n                <i class="icon-comment ', b += a.islimited ? "icon-transparent" : "icon-blue", b += '"></i>\n                <b class="note-count">' + a.note_count + '</b>\n                <span data-weave="shared/helper/translation" data-i18n="Note"></span>\n            </a>\n        </li>\n        <li>\n            <a href="javascript: void(0);">\n                <i class="icon-envelope icon-blue"></i>\n                <b class="task-count">' + a.email_count + '</b>\n                <span data-weave="shared/helper/translation" data-i18n="Email"></span>\n            </a>\n        </li>\n        <li>\n            <a href="#" data-action="task" data-preview="' + h + '">\n                <i class="icon-time ', b += a.islimited ? "icon-transparent" : "icon-blue", b += '"></i>\n                <b class="task-count">' + a.todo_count + '</b>\n                <span data-weave="shared/helper/translation" data-i18n="Task"></span>\n            </a>\n        </li>\n        <li>\n            <a href="#" data-action="toggle/tag">\n                <i class="icon-tag ', b += a.islimited ? "icon-transparent" : "icon-blue", b += '"></i>\n                <b class="tags-count">' + a.tags.length + '</b>\n                <span data-weave="shared/helper/translation" data-i18n="Tags"></span>\n            </a>\n        </li>\n    </ul>\n</div>'
}
}), define("troopjs-requirejs/template!app/widget/job/item/list.html", [], function () {
	return function (a) {
		var b = "",
		c = a.users,
		d = "",
		e = a.jobStatus,
		f = "icon-blue",
		g = "";
		switch (e) {
		case "Live":
			d = "label-warning";
			break;
		case "Failed":
			d = "label-inverse";
			break;
		case "Successful":
			d = "label-red"
		}
		switch (this.islimited && (f = "icon-transparent"), a.priority) {
		case "High":
			g = "label-red";
			break;
		case "Medium":
			g = 'label-info"'
		}
		b += "\n<td>\n    ",
		this._islimited || (b += '\n    <span class="dropdown" data-weave="app/widget/common/attachment-view/main(' + a.attachment_count + ", 'joborder', " + a.id + ')">\n    </span>\n    '),
		b += '\n</td>\n<td>\n    <a href="/job#detail!id=' + a.id + '" class="title">' + a.jobTitle + '</a>\n    <a href="/job#detail!id=' + a.id + '" target="_blank" title="Open in new tab"><span class="icon-new-window icon-blue"></span></a>\n</td>\n<td>\n    <a href="#" data-action="note" ',
		this.islimited && (b += 'class="disabled"'),
		b += '>\n        <i class="icon-comment ' + f + '"></i>\n        <b class="note-count">' + a.note_count + '</b>\n    </a>\n</td>\n<td>\n    <a href="company#detail!id=' + a.client.id + '" target="_blank"> ' + a.client.name + "</a>\n    ",
		!a.client.type || "client" !== a.client.type && "bding" !== a.client.type || (b += '\n    (<span class="red" data-weave="shared/helper/translation" data-i18n="' + a.client.type + ' company"></span>)\n    '),
		b += "\n</td>\n<td>\n    ";
		for (var h = 0, i = c.length; i > h; h++)
			b += "\n    ", "Main Consultant" === c[h].type && (b += '\n    <a href="/user/preview#' + c[h].user.id + '" data-action="profile/open">' + c[h].user.englishName + "</a>\n    "), b += "\n    ";
		return b += "\n</td>\n<td>\n    " + a.cvsent_count + "\n</td>\n<td>\n    " + a.clientinterview_count + "\n</td>\n<td>\n    " + a.offersign_count + '\n</td>\n<td>\n    <span data-toggle="tooltip" title="' + a.dateAdded + '">' + a.livedays + '</span>\n</td>\n<td>\n    <span data-toggle="tooltip" title="' + a.lastUpdateDate + '">' + a.lastUpdate + '</span>\n</td>\n<td>\n    <span class="label ' + d + '" data-weave="shared/helper/translation" data-i18n="' + e + ' Jobs"></span>\n</td>\n<td>\n    ',
		a.priority && (b += '\n    <span class="label ' + g + '" data-weave="shared/helper/translation" data-i18n="' + a.priority + '"></span>\n    '),
		b += '\n</td>\n<td>\n    <div class="dropdown">\n        <a href="javascript: void(0);" class="',
		b += this.islimited ? "disabled" : "dropdown-toggle",
		b += '" data-toggle="dropdown"><i class="icon-list-alt"></i> <i class="caret"></i></a>\n        <ul class="dropdown-menu">\n            <li>\n                <a href="#" data-action="task">\n                    <b class="task-count">' + a.todo_count + '</b>\n                    <span data-weave="shared/helper/translation" data-i18n="Task"></span>\n                </a>\n            </li>\n        </ul>\n    </div>\n</td>'
	}
}), define("troopjs-requirejs/template!app/widget/job/item/more-info.html", [], function () {
	return function (a) {
		var b = "";
		b += "\n";
		for (var c = 1; 6 >= c; c++) {
			b += "\n";
			var d = a["ext" + c];
			if (b += "\n", !d)
				break;
			b += "\n",
			d.field && d.value && (b += "\n<div>" + d.field + ": " + d.value + "</div>\n"),
			b += "\n"
		}
		return b
	}
}), define("app/widget/job/item/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./detail.html", "template!./list.html", "template!./more-info.html", "shared/helper/utils", "shared/helper/blurb", "shared/widget/filter/query"], function (a, b, c, d, e, f, g, h, i) {
	function j(a) {
		var b = this;
		c(function (a) {
			b.viewType ? b.html(e, b._json, a) : b.html(d, b._json, a)
		}).then(function () {
			a.resolve(),
			k.call(b)
		})
	}
	function k() {
		var b = this;
		b.$noteCount = b.$element.find(".note-count"),
		b.$tagCount = b.$element.find(".tags-count"),
		b.$tagsArea = b.$element.find(".tags-area"),
		b.$tag = b.$element.find(".tags").data("onSaveTags", function (c, d) {
				c.preventDefault(),
				a.ajax({
					url : m.ADD_TAG.replace("<id>", b._json.id),
					data : {
						data : d.join(",")
					},
					type : "post",
					dataType : "json"
				}).done(function (a) {
					a.status ? (b.$tagCount.text(d.length), g.alert("success", n.ADD_TAG_SUCCESS)) : g.alert("error", a.message)
				}).fail(function () {
					g.alert("error")
				})
			}).attr("data-weave", o + "(true, true, onSaveTags)").weave(),
		b.$element.on("click", ".tagit-choice-read-only", function (c) {
			var d,
			e,
			f = a(c.target);
			d = "LI" === f[0].tagName ? f.find(".tagit-label").text() : f.text(),
			i.items.tags = "tags=" + window.encodeURIComponent(d),
			e = i.toString(),
			b.publish(p, {
				filter : e,
				page : 1
			})
		}),
		b.$element.find('[data-toggle="popover"]').popover({
			html : !0,
			placement : "top",
			content : f(b._moreInfo),
			trigger : "hover"
		}).click(function (a) {
			a.preventDefault()
		}),
		b.$element.find('[data-toggle="tooltip"]').tooltip();
		var c,
		d,
		e,
		h,
		j;
		b.$element.on("mouseenter", '[data-action="note"], [data-action="task"]', function (f) {
			var g = a(f.target);
			h = function (b) {
				clearTimeout(d),
				a(this).off(b)
			},
			j = function (c) {
				e = setTimeout(function () {
						b.publish("slide-helper/note/close"),
						a(this).off(c)
					}, 600)
			},
			a(".slide-helper").off("mouseenter.helper", h).off("mouseleave.helper", j),
			g.data("preview") && (b._json.islimited || b._isAdmin || "0" === g.text() || "0" === g.find('[class*="count"]').text() || (clearTimeout(c), clearTimeout(d), clearTimeout(e), c = setTimeout(function () {
							var a = g.data("action");
							b.publish("slide-helper/" + a + "/reload", b._json.id, "job")
						}, 500), g.on("mouseleave", function (e) {
						d = setTimeout(function () {
								b.publish("slide-helper/note/close"),
								a(".slide-helper").off("mouseenter.helper", h).off("mouseleave.helper", j)
							}, 600),
						a(".slide-helper").on("mouseenter.helper", h).on("mouseleave.helper", j),
						clearTimeout(c),
						g.off(e)
					})))
		})
	}
	var l,
	m = {
		SAVE_INVOICE : "/rest/joborder/shortlist/<id>/addinvoice",
		ADD_TAG : "/rest/joborder/<id>/addtag"
	},
	n = {
		LOAD_X_ERROR : h.t("Load x error"),
		DELETE_X_TAG_SUCCESS : h.t("Delete tag x successfully"),
		FILL_IN_X : h.t("Please fill in x"),
		NEED_NEW_TAG : h.t("Need tag"),
		ADD_TAG_SUCCESS : h.t("Add tags successfully")
	},
	o = "shared/widget/common/tagit/main",
	p = "make/route";
	return b.extend(function (b, c, d, e) {
		var f = this;
		f._json = d,
		f.viewType = e,
		f._moreInfo = function () {
			for (var a = {}, b = 1; 6 >= b; b++)
				d["ext" + b].value && (a["ext" + b] = d["ext" + b]);
			return a
		}
		(),
		f.showMoreInfo = !a.isEmptyObject(f._moreInfo),
		f.isList = arguments !== l
	}, {
		"sig/initialize" : function (a, b) {
			var c = this;
			j.call(c, b)
		},
		"hub:memory/context" : function (a, b) {
			var d = this,
			e = b.user.id;
			d._json.users.forEach(function (a) {
				return a.user.id == e ? (d._islimited = !1, !1) : void 0
			}),
			j.call(d, c())
		},
		"dom/action.click.change" : a.noop,
		"dom/action/profile/open.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = d.attr("href");
			g.window({
				url : e,
				name : "User Profile",
				width : "1024"
			})
		},
		"dom/action/task.click" : function (b, c) {
			c.preventDefault();
			var d = this;
			if (!d._json.islimited) {
				var e = a(c.target),
				f = e.find("b");
				d.publish("modal/add/task/show", {
					name : d._json.jobTitle,
					id : d._json.id,
					onSuccess : function () {
						"started" === d.phase && f.text(parseInt(f.text(), 10) + 1)
					},
					type : "joborder"
				})
			}
		},
		"dom/action/note.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target);
			d._json.islimited || d._isAdmin || (e.closest(".dropdown").removeClass("open"), d.publish("modal/add-note/show", {
					externalType : "joborder",
					optionType : "joborder_note_category",
					id : d._json.id,
					onSuccess : function () {
						"started" === d.phase && d.$noteCount.text(parseInt(d.$noteCount.text(), 10) + 1)
					}
				}))
		},
		"dom/action/send/email" : function (b, c) {
			c.preventDefault();
			var d = this;
			if (!d._json.islimited) {
				var e,
				f = a(c.target),
				g = f.find("b"),
				h = d._json,
				i = h.contacts,
				j = [],
				k = [];
				i.forEach(function (a, b) {
					var c = a.clientContact;
					0 === b && (e = c.id),
					j.push([c.englishName, c.chineseName].join(" ").trim()),
					k.push(c.email)
				}),
				d.publish("modal/sendemail/show", {
					names : j,
					emails : k,
					emailTemplate : null,
					onSuccess : function () {
						"started" === d.phase && g.text(parseInt(g.text(), 10) + 1)
					},
					templateVariable : {
						joborder_id : d._json.id
					}
				})
			}
		},
		"hub:memory/job/set/jobAttr" : function (a, b) {
			var c = this;
			b.jobAttr = c._json
		},
		"hub/job/item/open/invoice/modal" : function (a, b) {
			var c = this,
			d = m.SAVE_INVOICE.replace("<id>", b.id);
			c.publish("modal/allocation-revenue/show", {
				saveUrl : d,
				jobAttr : c._json,
				candidate_id : c.candidateId,
				owner : b.owner,
				onSuccess : function (a) {
					"started" === c.phase && b.onSuccess && b.onSuccess(a)
				}
			})
		},
		"dom/action/toggle/tag.click" : function (a, b) {
			b.preventDefault();
			var c = this;
			c.$tagsArea.toggleClass("hide")
		}
	})
}), define("troopjs-requirejs/template!app/widget/job/list/main.html", [], function () {
	return function () {
		var a = '<div class="well well-small action-bar clearfix">\n    <div class="pull-right">\n        <span data-weave="shared/helper/translation" data-i18n="Display rows"></span>:\n        <select class="sort input-small" data-weave="shared/widget/list-paginate/main(' + this._listType + ')" data-action="paginate">\n            <option value="10">10</option>\n            <option value="25">25</option>\n            <option value="50">50</option>\n        </select>\n        <select class="sort input-medium" data-weave="shared/widget/list-ordering/main(' + this._listType + ')" data-action="ordering">\n            <option value="-lastUpdateDate" data-weave="shared/helper/translation" data-i18n="Sort by update (Descend)"></option>\n            <option value="lastUpdateDate" data-weave="shared/helper/translation" data-i18n="Sort by update (Ascend)"></option>\n            <option value="-dateAdded" data-weave="shared/helper/translation" data-i18n="Sort by days (Descend)"></option>\n            <option value="dateAdded" data-weave="shared/helper/translation" data-i18n="Sort by days (Ascend)"></option>\n            <option value="client_id" data-weave="shared/helper/translation" data-i18n="Sort by Company"></option>\n            <option value="jobStatus" data-weave="shared/helper/translation" data-i18n="Sort by status"></option>\n            <option value="-_priority" data-weave="shared/helper/translation" data-i18n="Sort by priority"></option>\n            <option value="function" data-weave="shared/helper/translation" data-i18n="Sort by function"></option>\n        </select>\n        <button class="btn btn-small" data-action="listview" data-toggle="tooltip" data-weave="shared/helper/translation(\'title\')" data-i18n="Switch View"><span></span></button>\n    </div>\n        \n</div>\n\n<!-- pagination -->\n<div class="pagination clearfix hide" data-weave="shared/widget/pagination/main(\'' + this._listType + '\')"></div>\n\n<div class="loading-area widget-spin">\n    ';
		return a += this.viewType ? '\n    <table class="table table_vam table-bl">\n        <colgroup>\n            <col width="60">\n            <col>\n            <col>\n            <col>\n            <col>\n            <col>\n            <col>\n            <col>\n            <col>\n            <col>\n            <col>\n            <col width="60">\n        </colgroup>\n        <thead>\n            <tr>\n                <th></th>\n                <th data-weave="shared/helper/translation" data-i18n="Job Name"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Note"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Company Name"></th>\n                <th data-weave="shared/helper/translation" data-i18n="MC"></th>\n                <th data-weave="shared/helper/translation" data-i18n="CVs Sent"></th>\n                <th data-weave="shared/helper/translation" data-i18n="CCM"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Offer Signed"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Live days"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Last update"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Status"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Priority"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Operation"></th>\n            </tr>\n        </thead>\n        <tbody class="list-container">\n        </tbody>\n    </table>\n    ' : '\n    <div class="search_panel list-container clearfix"></div>\n    ',
		a += '\n</div>\n\n<!-- pagination -->\n<div class="pagination clearfix hide" data-weave="shared/widget/pagination/main(\'' + this._listType + "')\"></div>"
	}
}), define("app/widget/job/list/main", ["jquery", "shared/widget/list/base", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		c(function (a) {
			b.html(d, a)
		}).done(function () {
			b.$container = b.$element.find(".list-container"),
			b.$massActions = b.$element.find(".mass-action .btn"),
			b.$toggleAll = b.$element.find('[data-action="list/toggle/all"]'),
			b.$listview = b.$element.find('[data-action="listview"]'),
			b.viewType ? b.$listview.addClass("table-view").find("span").attr("class", "icon-sqaures") : b.$listview.addClass("detail-view").find("span").attr("class", "icon-list"),
			b.$element.tooltip({
				selector : '[data-toggle="tooltip"]',
				trigger : "hover"
			}),
			a.resolve()
		})
	}
	var f = "/rest/joborder/list?",
	g = "app/widget/job/item/main";
	return b.extend(function () {
		this._url = f,
		this._listType = "joborder"
	}, {
		render : function (a) {
			e.call(this, a)
		},
		appendItems : function (a) {
			var b = this;
			b.$toggleAll.prop("checked", !1),
			b.$toggleAll.prop("indeterminate", !1),
			b.viewType ? a.forEach(function (a) {
				b.$container.append("<tr></tr>"),
				b.$container.children().last().data("json", a).attr("data-weave", g + "(json, " + b.viewType + ")").weave()
			}) : a.forEach(function (a) {
				b.$container.append('<div class="search_item clearfix"></div>'),
				b.$container.children().last().data("json", a).attr("data-weave", g + "(json, " + b.viewType + ")").weave()
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/mail-center/compose/main.html", [], function () {
	return function (a) {
		var b = "",
		c = a.attachment;
		if (b += '\n<h3 data-weave="shared/helper/translation" data-i18n="Compose Mail"></h3>\n<div class="doc_view">\n    <div class="doc_view_content">\n        <form action="#" class="form-horizontal form-horizontal-small">\n            <div class="control-group">\n                <label for="sender" class="control-label">\n                    <span data-i18n="Sender" data-weave="shared/helper/translation"></span>\n                </label>\n                <div class="controls text_line">\n                    <ul class="inline pull-right mail-actions">\n                        <li>\n                            <span data-i18n="Autocomplate Email Type" data-weave="shared/helper/translation"></span>:\n                            <select name="email-type" class="input-small" data-action="email/type">\n                                <option value="email,email1,email2" data-i18n="Any email" data-weave="shared/helper/translation"></option>\n                                <option value="email" data-i18n="Private email" data-weave="shared/helper/translation"></option>\n                                <option value="email1" data-i18n="Work email" data-weave="shared/helper/translation"></option>\n                                <option value="email2" data-i18n="Other" data-weave="shared/helper/translation"></option>\n                            </select>\n                        </li>\n                        <li><a href="#" data-weave="shared/helper/translation" data-i18n="Cc" data-action="toggle/control(\'cc\')"></a></li>\n                        <li><a href="#" data-weave="shared/helper/translation" data-i18n="Bcc" data-action="toggle/control(\'bcc\')"></a></li>\n                        <li>\n                            <span class="dropdown mass-mail">\n                                <a href="#" class="dropdown-toggle" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Mass Mail"></a>\n                                <div class="dropdown-menu">\n                                    <div class="clearfix sepH_b">\n                                        <select name="mass-type" data-action="mass/type">\n                                            <option value="" data-weave="shared/helper/translation" data-i18n="Please select"></option>\n                                            <option value="/rest/data/queryfilter/candidate" data-weave="shared/helper/translation" data-i18n="订阅搜索"></option>\n                                            <option value="/rest/folder/list?type=candidate" data-weave="shared/helper/translation" data-i18n="Folder"></option>\n                                        </select>\n                                        <br><br>\n                                        <div class="comtree" data-name="mass-group" data-weave="shared/widget/common/comtree/main"></div>\n                                    </div>\n\n                                    <button class="btn" data-weave="shared/helper/translation" data-i18n="Add" data-action="mass/add"></button>\n                                </div>\n                            </span>\n                        </li>\n                        <li>\n                            <a href="#" data-action="add/attachment" data-weave="shared/helper/translation" data-i18n="Attachment"></a>\n                        </li>\n                    </ul>\n                    ' + a.username + '\n                </div>\n            </div>\n\n            <div class="control-group">\n                <label for="to" class="control-label">\n                    <span data-i18n="To" data-weave="shared/helper/translation"></span>\n                </label>\n                <div class="controls">\n                    <div class="span12">\n                        <input name="to" type="text" id="to" data-action="to" data-max="100" data-weave="app/widget/common/email-suggestion/main">\n                    </div>\n                    <p class="hint">请使用"回车键"或者"逗号"确认邮件地址</p>\n                </div>\n            </div>\n\n            <div class="control-group control-cc hide">\n                <label class="control-label" for="cc">\n                    <span data-i18n="Cc" data-weave="shared/helper/translation"></span>\n                </label>\n                <div class="controls">\n                    <div class="span12">\n                        <input id="cc" name="cc" type="text" data-max="100" data-weave="app/widget/common/email-suggestion/main">\n                    </div>\n                    <p class="hint">请使用"回车键"或者"逗号"确认邮件地址</p>\n                </div>\n            </div>\n\n            <div class="control-group control-bcc hide">\n                <label class="control-label" for="bcc">\n                    <span data-i18n="Bcc" data-weave="shared/helper/translation"></span>\n                </label>\n                <div class="controls">\n                    <div class="span12">\n                        <input id="bcc" name="bcc" type="text" data-max="100" data-weave="app/widget/common/email-suggestion/main">\n                    </div>\n                    <p class="hint">请使用"回车键"或者"逗号"确认邮件地址</p>\n                </div>\n            </div>\n\n            <div class="control-group">\n                <label for="subject" class="control-label">\n                    <span data-i18n="Subject" data-weave="shared/helper/translation"></span>\n                </label>\n                <div class="controls">\n                    <input type="text" id="subject" name="subject" class="span12" value="' + (a.subject ? a.subject : "") + '">\n                </div>\n            </div>\n\n            <div class="control-group subjuct-view hide">\n                <label for="subject" class="control-label">\n                    <span data-i18n="Subject" data-weave="shared/helper/translation"></span>\n                </label>\n                <div class="controls">\n                    <input type="text" class="span12" disabled="disabled">\n                </div>\n            </div>\n\n            <div class="control-group attachment-group ', c && c.length || (b += "hide"), b += '">\n                <label class="control-label">\n                    <span data-i18n="Attachment" data-weave="shared/helper/translation"></span>\n                </label>\n                <div class="controls text_line">\n                    <ul class="unstyled">\n                        ', c) {
			b += "\n                        ";
			for (var d = 0, e = c.length; e > d; d++)
				b += "\n                        <li data-id=" + c[d].id + '><span class="file-type-icon ' + c[d].ext.toLowerCase() + '">' + c[d].name + '</span><a href="#" data-action="attachment/remove"><span class="icon-remove-small"></span></a></li>\n                        ';
			b += "\n                        "
		}
		return b += '\n                    </ul>\n                </div>\n            </div>\n\n            <div class="control-group">\n                <label class="control-label">\n                    <span data-i18n="Email Template" data-weave="shared/helper/translation"></span>\n                </label>\n                <div class="controls">\n                    <select name="template" data-action="template" data-weave="shared/widget/common/select-template/main(\'candidate_email\')"></select>\n                </div>\n            </div>\n\n            <div class="control-group">\n                <textarea name="email-content" data-signature="true" ',
		this.draftId && (b += 'data-draft="true"'),
		b += ' data-weave="shared/widget/common/ckeditor/main">' + (a.body ? a.body : "") + '</textarea>\n            </div>\n\n            <div class="control-group content-view hide"></div>\n        </form>\n    </div>\n    <div class="doc_view_footer clearfix">\n        <div class="pull-left">\n            <label class="checkbox">\n                <input type="checkbox" name="individually" value="true" checked="checked">\n                <span>分别发送，每个收件人将收到单独发给他/她的邮件</span>\n            </label>\n        </div>\n        <div class="pull-right">\n            <label class="checkbox inline">\n                <input type="checkbox" name="preview" data-action="preview">\n                <span data-weave="shared/helper/translation" data-i18n="Preview"></span>\n            </label>\n            <button class="btn" data-weave="shared/helper/translation" data-action="save/draft" data-i18n="Save draft"></button>\n            <button class="btn btn-primary" data-weave="shared/helper/translation" data-action="send/mail" data-i18n="Send"></button>\n        </div>\n    </div>\n</div>\n\n<p>邮件群发上限: <span class="text-error">100</span> 收件人, 已添加: <span class="text-error text-count">0</span> 收件人</p>'
	}
}), define("app/widget/mail-center/compose/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "shared/helper/utils", "shared/helper/validate", "shared/helper/blurb"], function (a, b, c, d, e, f, g, h) {
	function i(b, d, e) {
		var g = this,
		h = {},
		i = a(e.target);
		if (g.$form.valid() && !i.hasClass("disabled")) {
			var j = function () {
				var b = [];
				return g.$attachmentGroup.find("li").each(function () {
					b.push(a(this).data("id"))
				}),
				b.join()
			}
			();
			h = {
				cc : g.$cc.val().replace(/\[.*\]/, ""),
				bcc : g.$bcc.val().replace(/\[.*\]/, ""),
				subject : g.$subject.val(),
				content : CKEDITOR.instances["email-content"].getData(),
				to : g.$to.val().replace(/\[.*\]/, ""),
				individually : g.$individually.is(":checked"),
				attachment : j,
				category : "",
				template_id : g._templateId
			},
			g.draftId && (h.draft_id = g.draftId),
			i.addClass("disabled"),
			g.publish("ajax", {
				url : b,
				data : {
					data : JSON.stringify(h)
				},
				type : "post",
				dataType : "json"
			}, c().done(function (a) {
					a.status ? (d && d(a), g.publish(p)) : f.alert("error", a.message)
				}).always(function () {
					i.removeClass("disabled")
				}))
		}
	}
	function j() {
		var b = this;
		b._json.username && b.draftId !== l && (b.draftId ? b.publish("ajax", {
				url : m.VIEW.replace("<id>", b.draftId)
			}, c().done(function (d) {
					b._json = a.extend(!0, b._json, d),
					c(function (a) {
						b.html(e, b._json, a)
					}).done(function () {
						k.call(b)
					})
				})) : c(function (a) {
				b._json = {
					username : b._json.username
				},
				b.html(e, b._json, a)
			}).done(function () {
				k.call(b)
			}))
	}
	function k() {
		var a = this,
		b = a.$element;
		if (a.$content = b.find("textarea"), a.$to = b.find("#to"), a.$cc = b.find("#cc"), a.$bcc = b.find("#bcc"), a.$subject = b.find("#subject"), a.$controlCc = b.find(".control-cc"), a.$controlBcc = b.find(".control-bcc"), a.$individually = b.find('[name="individually"]'), a.$massGroup = b.find('[name="mass-group"]'), a.$count = b.find(".text-count"), a.$form = b.find("form"), a.$attachmentGroup = b.find(".attachment-group"), a.massGroupWidget = b.find('[data-name="mass-group"]').woven()[0], a.$preview = b.find('[name="preview"]'), a.$subjuctView = b.find(".subjuct-view"), a.$contentView = b.find(".content-view"), g(a.$form, {
				rules : {
					to : {
						required : !0,
						emails : !0
					},
					cc : {
						emails : !0
					},
					bcc : {
						emails : !0
					}
				}
			}), a.$to.trigger("change"), a._json.to) {
			var c = a._json.to.split(",");
			c.forEach(function (b) {
				a.$to.tagit("createTag", b)
			})
		}
		if (a._json.cc) {
			a.$controlCc.removeClass("hide");
			var d = a._json.cc.split(",");
			d.forEach(function (b) {
				a.$cc.tagit("createTag", b)
			})
		}
		if (a._json.bcc) {
			a.$controlBcc.removeClass("hide");
			var e = a._json.bcc.split(",");
			e.forEach(function (b) {
				a.$bcc.tagit("createTag", b)
			})
		}
		if (a._json.attachment)
			for (var f = a._json.attachment, h = 0, i = f.length; i > h; h++)
				a.attachmentArr.push({
					id : f[h].attachment_id,
					name : f[h].name
				})
	}
	var l,
	m = {
		VIEW : "/rest/mail/view/<id>",
		SEND : "/rest/mail/send",
		SAVE_DRAFT : "/rest/mail/save_draft",
		PREVIEW : "/rest/data/choosetemplate/0"
	},
	n = {
		email : h.t("Private email"),
		email1 : h.t("Work email"),
		email2 : h.t("Other")
	},
	o = "modal/attachments/show",
	p = "mail-center/update/sidebar/count";
	return b.extend(function () {
		this.attachmentArr = [],
		this.attachmentRefresh = !0,
		this._templateId = "",
		this._emailType = ["email", "email1", "email2"]
	}, {
		"sig/finalize" : function (a, b) {
			var c = this;
			window.clearTimeout(c.timeid),
			c.$element.html(""),
			b.resolve()
		},
		"hub:memory/context" : function (a, b) {
			var c = this,
			d = b.user;
			c._json.username = [d.englishName, d.chineseName].join(" "),
			j.call(c)
		},
		"hub:memory/route" : function (a, b) {
			var c = this;
			c.draftId = b.path[0].split("!")[1] || 0,
			j.call(c)
		},
		"hub/receive/attachments" : function (a, b) {
			var c = this,
			d = "";
			b.forEach(function (a) {
				c.$attachmentGroup.find('[data-id="' + a.id + '"]').length || (d += '<li data-id="' + a.id + '">' + a.type + '<span class="file-type-icon ' + a.ext.toLowerCase() + '">' + a.name + '</span> <a href="#" data-action="attachment/remove"><span class="icon-remove-small"></span></a></li>')
			}),
			d.length && c.$attachmentGroup.removeClass("hide").find("ul").append(d)
		},
		"hub/email/template/switch" : function (a, b) {
			this.$subject.val(b.title),
			this._templateId = b.id
		},
		"dom/action.click.change" : a.noop,
		"dom/action/dropdown.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = d.closest(".dropdown"),
			f = e.find(".dropdown-menu"),
			g = a(document);
			e.toggleClass("open"),
			g.on("click.filter.dropdown", function (b) {
				var c = a(b.target);
				c.closest(f).length || (e.removeClass("open"), g.off("click.filter.dropdown"))
			})
		},
		"dom/action/attachment/remove.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = window.confirm("确定要删除此附件吗？");
			e && a(c.target).closest("li").remove(),
			d.$attachmentGroup.find("ul li").length || d.$attachmentGroup.addClass("hide")
		},
		"dom/action/to.change" : function (b, c) {
			var d = this,
			e = a(c.target),
			f = e.val().trim(),
			g = f ? e.val().split(",").length : 0;
			d.$count && d.$count.text(g),
			g ? d.$preview.prop("disabled", !1) : (d.$preview.is(":checked") && d.$preview.prop("checked", !1).trigger("click").prop("checked", !1), d.$preview.prop("disabled", !0))
		},
		"dom/action/mass/type.change" : function (b, d) {
			var e = this,
			f = a(d.target),
			g = f.val();
			e.$massGroup.children().filter(":not([data-default])").remove(),
			g && e.publish("ajax", {
				url : g
			}, c().done(function (a) {
					e._queryObj = a,
					e.massGroupWidget.loadData(a)
				}))
		},
		"dom/action/mass/add.click" : function (b, d) {
			d.preventDefault();
			var e = this,
			g = a(d.target),
			h = "/rest/candidate/list?<query>&paginate_by=200",
			i = e.$massGroup.val(),
			j = g.closest(".dropdown");
			if (i) {
				var k = e._queryObj.filter(function (a) {
						return a.id == i
					})[0];
				k = k && k.query ? k.query : "folder_id=" + i,
				j.removeClass("open"),
				e.publish("ajax", {
					url : h.replace("<query>", k)
				}, c().done(function (a) {
						var b,
						c,
						d = 0,
						g = a.list.length,
						h = [],
						i = e._emailType ? e._emailType[0] : "";
						for (d; g > d; d++)
							b = a.list[d], c = [b.englishName, b.chineseName].join(" ").trim(), (!e._emailType || e._emailType.length > 1) && (b.email ? i = "email" : b.email1 ? i = "email1" : b.email2 && (i = "email2")), b[i] ? e.$to.tagit("createTag", '"' + c + '" [' + n[i] + "] <" + b[i] + ">") : h.push('<a href="/candidate#detail!id=' + b.id + '" target="_blank">' + c + "</a>");
						h.length && (e._emailType.length > 1 ? f.alert("info", "以下人才没有任何邮箱:<br>" + h.join(", ")) : f.alert("info", "以下人才没有" + n[i] + "邮箱:<br>" + h.join(", ")))
					}))
			}
		},
		"dom/action/toggle/control.click" : function (a, b, c) {
			b.preventDefault();
			var d = this;
			switch (c) {
			case "cc":
				d.$controlCc.toggleClass("hide"),
				d.$cc.tagit("removeAll");
				break;
			case "bcc":
				d.$controlBcc.toggleClass("hide"),
				d.$bcc.tagit("removeAll")
			}
		},
		"dom/action/send/mail.click" : function (a, b) {
			b.preventDefault();
			var c = this;
			i.call(c, m.SEND, function () {
				f.alert("success", "邮件已发送！"),
				c.timeid = window.setTimeout(function () {
						window.location.reload()
					}, 1500)
			}, b)
		},
		"dom/action/save/draft.click" : function (a, b) {
			b.preventDefault();
			var c = this;
			i.call(c, m.SAVE_DRAFT, function (a) {
				f.alert("success", "邮件保存成功！"),
				c.draftId = a.data
			}, b)
		},
		"dom/action/add/attachment.click" : function (a, b) {
			b.preventDefault();
			var c = this;
			c.publish(o, {
				joborder : 0,
				clientcompany : 0
			}, c.attachmentRefresh, c.attachmentArr),
			c.attachmentRefresh = !1
		},
		"dom/action/preview.click" : function (b, d) {
			var e = this,
			f = a(d.target);
			f.is(":checked") ? e.$to.val().length ? e.publish("ajax", {
				url : m.PREVIEW,
				data : {
					data : JSON.stringify({
						email : e.$to.val(),
						title : e.$subject.val(),
						content : CKEDITOR.instances["email-content"].getData()
					})
				},
				type : "post"
			}, c().done(function (a) {
					a.status && (e.$subject.closest(".control-group").addClass("hide"), e.$subjuctView.removeClass("hide").find("input").val(a.data.title), e.$content.closest(".control-group").addClass("hide"), e.$contentView.removeClass("hide").html(a.data.content))
				})) : (e.$subject.closest(".control-group").addClass("hide"), e.$subjuctView.removeClass("hide").find("input").val(""), e.$content.closest(".control-group").addClass("hide"), e.$contentView.removeClass("hide").html("")) : (e.$subject.closest(".control-group").removeClass("hide"), e.$subjuctView.addClass("hide"), e.$content.closest(".control-group").removeClass("hide"), e.$contentView.addClass("hide"))
		},
		"dom/action/email/type.change" : function (b, c) {
			var d = this,
			e = a(c.target),
			f = e.val(),
			g = f.split(",");
			this._emailType = g,
			d.$to.data("emailType", g),
			d.$cc.data("emailType", g),
			d.$bcc.data("emailType", g)
		}
	})
}), define("troopjs-requirejs/template!app/widget/mail-center/filter/main.html", [], function () {
	return function () {
		var a = '<ul class="nav nav-pills line_sep">\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Subject"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <input type="text" name="subject__icontains">\n                </div>\n                \n                <button class="btn" type="submit" data-action="form(\'subject__icontains\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Category"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <select name="category">\n                        <option value="" data-weave="shared/helper/translation" data-i18n="Please select"></option>\n                        <option value="CV Sent" data-weave="shared/helper/translation" data-i18n="CVs Sent"></option>\n                        <option value="emailconfirmwithcandidate" data-weave="shared/helper/translation" data-i18n="与候选人确认邮件"></option>\n                        <option value="emailconfirmwithclient" data-weave="shared/helper/translation" data-i18n="与客户取人邮件"></option>\n                        <option value="emailtocandidate" data-weave="shared/helper/translation" data-i18n="给候选人的邮件"></option>\n                        <option value="Floating" data-weave="shared/helper/translation" data-i18n="Floating"></option>\n                    </select>\n                </div>\n                \n                <button class="btn" type="submit" data-action="form(\'category\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Status"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <select name="status">\n                        <option value="0" data-weave="shared/helper/translation" data-i18n="Please select"></option>\n                        <option value="1" data-weave="shared/helper/translation" data-i18n="发送成功"></option>\n                        <option value="" data-weave="shared/helper/translation" data-i18n="发送失败"></option>\n                    </select>\n                </div>\n                \n                <button class="btn" type="submit" data-action="form(\'status\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Read/Unread"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <label class="radio inline">\n                        <input type="radio" value="1" name="status__eq">\n                        <span data-weave="shared/helper/translation" data-i18n="Read"></span>\n                    </label>\n                    <label class="radio inline">\n                        <input type="radio" value="" name="status__eq">\n                        <span data-weave="shared/helper/translation" data-i18n="Unread"></span>\n                    </label>\n                </div>\n                \n                <button class="btn" type="submit" data-action="form(\'status__eq\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Sender"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <input type="text" name="_from__icontains">\n                </div>\n                \n                <button class="btn" type="submit" data-action="form(\'_from__icontains\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Receiver"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <input type="text" name="to__icontains">\n                </div>\n                \n                <button class="btn" type="submit" data-action="form(\'to__icontains\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Folder"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <div class="comtree span" data-name="folder_id" data-weave="shared/widget/common/comtree/main" data-hub="update/email/folder"></div>\n                </div>\n                \n                <button class="btn" type="submit" data-action="form(\'folder_id\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="包含附件"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <label class="radio inline">\n                        <input type="radio" value="1" name="has_attachment">\n                        <span data-weave="shared/helper/translation" data-i18n="Yes"></span>\n                    </label>\n                    <label class="radio inline">\n                        <input type="radio" value="0" name="has_attachment">\n                        <span data-weave="shared/helper/translation" data-i18n="No"></span>\n                    </label>\n                </div>\n                \n                <button class="btn" type="submit" data-action="form(\'has_attachment\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n</ul>\n\n<p>\n    <span class="tag label label-info deletable hide" data-query="subject__icontains" data-action="tag/remove"><b data-i18n="Subject" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="category" data-action="tag/remove"><b data-i18n="Category" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="status" data-action="tag/remove"><b data-i18n="Status" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="status__eq" data-action="tag/remove"><b data-i18n="Read/Unread" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="_from__icontains" data-action="tag/remove"><b data-i18n="Sender" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="to__icontains" data-action="tag/remove"><b data-i18n="Receiver" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="folder_id" data-action="tag/remove"><b data-i18n="Folder" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="has_attachment" data-action="tag/remove"><b data-i18n="包含附件" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n</p>\n\n<p class="sepH_b">\n    <button class="btn" data-action="filter/search" data-weave="shared/helper/translation" data-i18n="Search"></button>\n</p>';
		return a
	}
}), define("app/widget/mail-center/filter/main", ["jquery", "shared/widget/filter/base", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "shared/widget/filter/query", "shared/helper/blurb"], function (a, b, c, d, e, f, g) {
	function h() {
		f.addAttr({
			subject__icontains : function (a) {
				var b = a.find("input").val().trim();
				b.length && this.addQuery("subject__icontains", "subject__icontains=" + encodeURIComponent(b))
			},
			category : function (a) {
				var b = a.find("select").val().trim();
				b.length && this.addQuery("category", "category=" + encodeURIComponent(b))
			},
			status : function (a) {
				var b = a.find("select").val().trim();
				"0" !== b && this.addQuery("status", "status=" + encodeURIComponent(b))
			},
			status__eq : function (a) {
				var b = a.find('[name="status__eq"]:checked').val();
				"undefinde" != typeof b && this.addQuery("status__eq", "status__eq=" + encodeURIComponent(b))
			},
			_from__icontains : function (a) {
				var b = a.find("input").val().trim();
				b.length && this.addQuery("_from__icontains", "_from__icontains=" + encodeURIComponent(b))
			},
			to__icontains : function (a) {
				var b = a.find("input").val().trim();
				b.length && this.addQuery("to__icontains", "to__icontains=" + encodeURIComponent(b))
			},
			folder_id : function (a) {
				var b = a.find('[name="folder_id"]').val();
				b.length && this.addQuery("folder_id", "folder_id=" + b)
			},
			has_attachment : function (a) {
				var b = a.find('[name="has_attachment"]:checked').val();
				"undefinde" != typeof b && this.addQuery("has_attachment", "has_attachment=" + b)
			}
		})
	}
	function i(a) {
		var b = this;
		c(function (a) {
			b.html(d, this._json, a)
		}).done(function () {
			j.call(b, a)
		})
	}
	function j(a) {
		var b = this;
		b.folderWidget = b.$element.find('[data-name="folder_id"]').woven()[0],
		a.resolve()
	}
	function k(a) {
		var b,
		c = this,
		d = a[0],
		e = a[1];
		switch (d) {
		case "mbox":
			c.$element.find('[data-query="' + d + '"]').removeClass("hide").find("span").text(m[e]),
			f.addQuery(d, d + "=" + e);
			break;
		case "status__eq":
		case "has_attachment":
			b = c.$element.find('[name="' + d + '"]').filter('[value="' + e + '"]').next().text(),
			c.$element.find('[data-query="' + d + '"]').removeClass("hide").find("span").text(b),
			f.addQuery(d, d + "=" + e);
			break;
		case "status":
		case "category":
			b = c.$element.find('select[name="' + d + '"]').find('[value="' + decodeURIComponent(e) + '"]').text(),
			c.$element.find('[data-query="' + d + '"]').removeClass("hide").find("span").text(b),
			f.addQuery(d, d + "=" + e);
			break;
		case "folder_id":
			b = c.folderWidget.getNodeNameById(e),
			c.$element.find('[data-query="' + d + '"]').removeClass("hide").find("span").text(b),
			f.addQuery(d, d + "=" + e);
			break;
		case "byfilter":
			break;
		default:
			c.$element.find('[data-query="' + d + '"]').removeClass("hide").find("span").text(window.decodeURIComponent(e)),
			f.addQuery(d, d + "=" + e)
		}
	}
	function l() {
		var a = this;
		a._setFilter = k
	}
	var m = {
		inbox : g.t("Inbox"),
		sending : g.t("Sending Box"),
		outbox : g.t("Sent Box"),
		draft : g.t("Drafts"),
		trash : g.t("Trash")
	};
	return b.extend(function () {
		var a = this;
		l.call(a),
		h.call(a)
	}, {
		"sig/initialize" : function (a, b) {
			i.call(this, b)
		},
		"dom/action.click" : a.noop
	})
}), define("troopjs-requirejs/template!app/widget/mail-center/list/main.html", [], function () {
	return function (a) {
		var b = '<div id="filter-container" class="well well-small" data-weave="app/widget/mail-center/filter/main"></div>\n\n<div class="well well-small action-bar clearfix">\n    \n    <div class="span6 btn-actions">\n        ';
		b += "outbox" !== this._type && "sending" !== this._type ? '\n        <button class="btn btn-small btn-read disabled" data-action="mark/mail(1)" data-weave="shared/helper/translation" data-i18n="Mark read"></button>\n        <button class="btn btn-small btn-unread disabled" data-action="mark/mail(0)" data-weave="shared/helper/translation" data-i18n="Mark unread"></button>\n        <button class="btn btn-small disabled" data-action="add/to/folder" data-weave="shared/helper/translation" data-i18n="Add to Folder"></button>\n        <button class="btn btn-small btn-danger btn-detele disabled" data-action="delete/mail" data-weave="shared/helper/translation" data-i18n="Delete"></button>\n        ' : '\n        <button class="btn btn-small disabled" data-weave="shared/helper/translation" data-i18n="Resend" data-action="resend"></button>\n        ',
		b += '\n    </div>\n\n    <div class="pull-right">\n        <span data-weave="shared/helper/translation" data-i18n="Display rows"></span>:\n        <select class="sort input-mini" data-action="paginate" data-weave="shared/widget/list-paginate/main(' + this._listType + ')">\n            <option value="10">10</option>\n            <option value="25">25</option>\n            <option value="50">50</option>\n        </select>\n    </div>\n    \n</div>\n\n<!-- pagination -->\n<div class="pagination clearfix hide" data-weave="shared/widget/pagination/main(\'' + this._listType + '\')"></div>\n\n<table class="table table_vam mbox_table" >\n    <colgroup>\n        ',
		"sending" !== this._type && (b += '\n        <col width="">\n        ', "draft" !== this._type && (b += '\n        <col width="">\n        '), b += "        \n        "),
		b += '\n        <col width="">\n        <col width="">\n        <col>\n        <col width="125">\n    </colgroup>\n';
		var c = a.list,
		d = 0,
		e = c.length;
		if (b += "\n    <thead>\n        <tr>\n            ", "sending" !== this._type && (b += '\n            <th>\n                <input type="checkbox" data-action="check/all">\n            </th>\n            ', "draft" !== this._type && (b += '\n            <th><span data-weave="shared/helper/translation" data-i18n="Sender"></span></th>\n            '), b += "\n            "), b += '\n            <th><span data-weave="shared/helper/translation" data-i18n="To"></span></th>\n            <th><span data-weave="shared/helper/translation" data-i18n="Subject"></span></th>\n            <th></th>\n            <th><span data-weave="shared/helper/translation" data-i18n="Date"></span></th>\n        </tr>\n    </thead>\n\n    <tbody>\n        ', e) {
			for (b += "\n        ", d; e > d; d++) {
				b += "\n        ";
				var f = c[d];
				b += '\n        <tr class="',
				"inbox" !== this._type || f.status || (b += "unread"),
				b += '" data-action="view/detail" data-id="' + f.id + '" data-folders="' + this.getFolderId(f.folders) + '">\n            ',
				"sending" !== this._type && (b += "\n            <td>\n                ", ("outbox" !== this._type || "outbox" === this._type && !f.status) && (b += '\n                <input type="checkbox" data-action="check/one">\n                '), b += "\n            </td>\n             ", "draft" !== this._type && (b += "\n            <td>\n                " + this.formatEmail(f._from) + "\n            </td>\n            "), b += "\n            "),
				b += "\n            ";
				var g = f.to.split(","),
				h = g.length,
				i = this.formatEmail(g[0]);
				h > 1 && (i += " ..."),
				b += "\n            <td>\n                ",
				"outbox" !== this._type || f.status || (b += '<span class="label label-inverse send-fail" data-weave="shared/helper/translation" data-i18n="Send fail"></span>'),
				b += "\n                " + i + '\n            </td>\n            <td class="subject-cell">\n                <div class="pull-left folder-name">\n                ',
				f.folders && (b += "\n                    " + this.getFolderName(f.folders)),
				b += '\n                </div>\n                <div class="pull-left subject-name">\n                    <div class="pull-left">&nbsp;</div>\n                    ' + f.subject + "    \n                </div>\n            </td>\n            <td>\n                ",
				f.attachment && (b += '\n                <span class="icon-paper-clip"></span>\n                '),
				b += "\n            </td>\n            <td>\n                " + (f.dateAdded ? f.dateAdded : "") + "\n            </td>\n        </tr>\n        "
			}
			b += "\n        "
		} else
			b += '\n        <tr>\n            <td colspan="6">\n                <p class="text-center">\n                    未发现邮件!\n                </p>\n            </td>\n        </tr>\n        ';
		return b += '\n    </tbody>\n</table>\n\n<!-- pagination -->\n<div class="pagination clearfix hide" data-weave="shared/widget/pagination/main(\'' + this._listType + "')\"></div>"
	}
}), define("app/widget/mail-center/list/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d, e) {
	function f(a) {
		return a.replace(/#/g, "%23")
	}
	function g(a, b) {
		b ? a.removeClass("disabled") : a.addClass("disabled")
	}
	function h() {
		var a,
		b,
		d,
		g,
		h = this,
		j = "",
		p = 0,
		q = h.route.path,
		r = q.length;
		if ("[object Array]" === Object.prototype.toString.call(q))
			for (p; r > p; p++) {
				var s = q[p];
				l.test(s) ? a = RegExp.$1 : m.test(s) ? b = RegExp.$1 : n.test(s) && (d = RegExp.$1, h.publish("paginate/set", d))
			}
		h.publish("filter/set", b),
		j = h._url + (a ? "&page=" + a : "") + (b ? "&" + b : "") + (d ? "&paginate_by=" + d : ""),
		o.test(j) && (g = RegExp.$1, h._type = g),
		h.publish("ajax", {
			url : f(j)
		}, c().done(function (a) {
				if ("finalize" !== h.phase) {
					if (a.status !== k && !a.status)
						return e.alert("error", "Filter list error: " + a.message), void 0;
					h._json = a,
					i.call(h)
				}
			}))
	}
	function i() {
		var a = this;
		c(function (b) {
			a.publish(a._listType + r, a._json),
			a.html(d, a._json, b)
		}).done(function () {
			j.call(a)
		})
	}
	function j() {
		var a = this,
		b = a.$element;
		a.$mailList = b.find(".mail-list"),
		a.$actionBtns = b.find(".btn-actions button"),
		a.$btnDel = b.find(".btn-detele"),
		a.$btnRead = b.find(".btn-read"),
		a.$btnUnread = b.find(".btn-unread"),
		a.$tbody = b.find("tbody")
	}
	var k,
	l = /^page!(\d*)/,
	m = /^filter!(.*)/,
	n = /^paginate!(\d*)/,
	o = /(inbox|sending|outbox|draft|trash)/,
	p = {
		LIST : "/rest/mail/list?",
		DELETE : "/rest/mail/delete",
		RESEND : "/rest/mail/resend",
		MARK : "/rest/mail/mark"
	},
	q = "make/route",
	r = "/paging/set",
	s = "mail-center/update/sidebar/count",
	t = "mail-center/sidebar/update/unread";
	return b.extend(function () {
		this._url = p.LIST,
		this._listType = "email"
	}, {
		"sig/finalize" : function (a, b) {
			var c = this;
			c.$element.html(""),
			b.resolve()
		},
		"hub:memory/context" : function (a, b) {
			var c = this;
			c.paginate = 10,
			c.context = b,
			c._listType && b.user.listview[c._listType] && (c.paginate = b.user.listview[c._listType].paginate)
		},
		"hub:memory/route" : function (a, b) {
			var c = this;
			if (c.paginate && !c._init) {
				var d,
				e = b.path;
				if ("[object Array]" === Object.prototype.toString.call(e))
					for (var f = 0, g = e.length; g > f; f++) {
						var i = e[f];
						if (n.test(i)) {
							d = RegExp.$1,
							d === c.paginate && (c.route = b, h.call(c), c.loaded = !0);
							break
						}
					}
				if (c.loaded)
					return;
				return c.publish(q, {
					paginate : c.paginate
				}),
				c._init = !0,
				void 0
			}
			c.route = b,
			h.call(c)
		},
		"hub/mail-center/reload/mail" : function () {
			var a = this;
			a.publish(q, {
				page : 1,
				filter : "mbox=inbox"
			})
		},
		"dom/action.click" : a.noop,
		"dom/action/view/detail.click" : function (b, c) {
			var d = this,
			e = a(c.target),
			f = e.closest("tr");
			f.hasClass("unread") && (f.removeClass("unread"), d.publish("mail-center/sidebar/update/unread", -1)),
			window.location.hash = "draft" === d._type ? "compose!" + f.data("id") : "detail!" + f.data("id")
		},
		"dom/action/check/all.click" : function (b, c) {
			var d = this,
			e = a(c.target),
			f = d.$tbody.find("tr");
			e.prop("checked") ? f.filter(":not(.rowChecked)").addClass("rowChecked").find(":checkbox").prop("checked", !0) : f.filter(".rowChecked").removeClass("rowChecked").find(":checkbox").prop("checked", !1),
			g.call(d, d.$actionBtns, d.$tbody.find("tr :checkbox:checked").length)
		},
		"dom/action/check/one.click" : function (b, c) {
			c.stopPropagation();
			var d = this,
			e = a(c.target),
			f = e.closest("tr");
			e.prop("checked") ? f.addClass("rowChecked") : f.removeClass("rowChecked"),
			g.call(d, d.$actionBtns, d.$tbody.find("tr :checkbox:checked").length)
		},
		"dom/action/add/to/folder.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target),
			f = [],
			g = d.$tbody.find("tr"),
			h = {
				ids : f,
				type : "email",
				onSuccess : function (b) {
					var c = d.getFolderName(b),
					e = d.getFolderId(b);
					g.each(function () {
						a(this).data("folders", e),
						a(this).find(".folder-name").html(c)
					})
				}
			};
			e.hasClass("disabled") || (g = d.$tbody.find("tr").filter(".rowChecked"), g.each(function () {
					f.push(a(this).data("id"))
				}), 1 === f.length && (h.folders = g.data("folders").toString().split(",")), d.publish("modal/add-to-folder/show", h))
		},
		"dom/action/delete/mail.click" : function (b, d) {
			d.preventDefault();
			var f,
			h,
			i = this,
			j = a(d.target),
			k = [];
			j.hasClass("disabled") || (f = window.confirm("确定要删除所选邮件吗？"), f && (h = i.$tbody.find("tr").filter(".rowChecked"), h.each(function () {
						k.push(a(this).data("id"))
					}), i.publish("ajax", {
						url : p.DELETE,
						data : {
							data : JSON.stringify({
								ids : k
							})
						},
						type : "post"
					}, c().done(function (a) {
							a.status ? (h.remove(), g.call(i, i.$btnDel, !1), e.alert("success", "邮件已删除"), i.publish(s)) : e.alert("error", a.message)
						}))))
		},
		"dom/action/resend.click" : function (b, d) {
			d.preventDefault();
			var f = this,
			g = a(d.target),
			h = g.closest("tr"),
			i = [];
			h = f.$tbody.find("tr").filter(".rowChecked"),
			h.each(function () {
				i.push(a(this).data("id"))
			}),
			f.publish("ajax", {
				url : p.RESEND,
				data : {
					data : JSON.stringify({
						ids : i
					})
				},
				type : "post"
			}, c().done(function (a) {
					a.status ? (h.find(".send-fail").remove(), f.publish(s)) : e.alert("error", a.message)
				}), g)
		},
		"dom/action/mark/mail.click" : function (b, d, f) {
			d.preventDefault();
			var g,
			h = this,
			i = a(d.target),
			j = [];
			i.hasClass("disabled") || (g = f ? h.$tbody.find("tr").filter(".rowChecked").filter(".unread") : h.$tbody.find("tr").filter(".rowChecked").filter(":not(.unread)"), g.each(function () {
					j.push(a(this).data("id"))
				}), h.publish("ajax", {
					url : p.MARK,
					data : {
						data : JSON.stringify({
							ids : j,
							status : f
						})
					},
					type : "post"
				}, c().done(function (a) {
						a.status ? f ? (g.removeClass("unread"), h.publish(t, -g.length)) : (g.addClass("unread"), h.publish(t, g.length)) : e.alert("error", a.message)
					})))
		},
		formatEmail : function (a) {
			return a ? a.replace(/</g, "&lt;").replace(/>/g, "&gt;") : ""
		},
		getFolderName : function (a) {
			var b = "";
			return a.forEach(function (a) {
				b += '<span class="label">' + a.name + "</span> "
			}),
			b
		},
		getFolderId : function (a) {
			var b = [];
			return a.forEach(function (a) {
				b.push(a.id)
			}),
			b.join(",")
		}
	})
}), define("troopjs-requirejs/template!app/widget/mail-center/mail-detail/main.html", [], function () {
	return function (a) {
		var b = "",
		c = a.attachment,
		d = c.length;
		b += '\n\n<div class="sepH_b clearfix">\n    <div class="btn-group pull-right">\n        <button class="btn" data-action="detail/back" data-weave="shared/helper/translation" data-i18n="Back"></button>\n        <button class="btn" data-action="mail/reply" data-weave="shared/helper/translation" data-i18n="Reply"></button>\n        <button class="btn" data-action="mail/replyall" data-weave="shared/helper/translation" data-i18n="Reply All"></button>\n        <button class="btn" data-action="mail/forward" data-weave="shared/helper/translation" data-i18n="Forward"></button>\n    </div>\n</div>\n\n\n<div class="doc_view">\n    <div class="doc_view_header">\n        <dl class="dl-horizontal">\n            <dt data-weave="shared/helper/translation" data-i18n="Subject">Subject</dt>\n            <dd>' + a.subject + '</dd>\n            <dt data-weave="shared/helper/translation" data-i18n="Sender">Sender</dt>\n            ',
		b += a.candidate ? '\n            <dd><a href="/candidate#detail!id=' + a.candidate.id + '" target="_blank">' + [a.candidate.englishName, a.candidate.chineseName].join(" ") + "</a></dd>\n            " : "\n            <dd><span>" + this.formatEmail(a._from) + "</span></dd>\n            ",
		b += "\n            ",
		a.to && (b += '\n            <dt data-weave="shared/helper/translation" data-i18n="To"></dt>\n            <dd><span>' + this.formatEmail(a.to) + "</span></dd>\n            "),
		b += "\n            ",
		a.cc && (b += '\n            <dt data-weave="shared/helper/translation" data-i18n="Cc"></dt>\n            <dd><span>' + this.formatEmail(a.cc) + "</span></dd>\n            "),
		b += '\n            <dt data-weave="shared/helper/translation" data-i18n="Date">Date</dt>\n            <dd>' + a.date + '</dd>\n            <dt><i class="icon-paper-clip"></i></dt>\n            <dd>\n                <label class="sepH_a ',
		"outbox" !== a.mbox && (b += "checkbox"),
		b += '">\n                    ',
		"outbox" !== a.mbox && (b += '\n                    <input type="checkbox" value="content" data-action="resume/type">\n                    '),
		b += '\n                    <span data-weave="shared/helper/translation" data-i18n="Email content"></span>\n                </label>\n                ';
		for (var e = 0; d > e; e++)
			b += '\n                <label class="sepH_a ', "outbox" !== a.mbox && (b += "checkbox"), b += '">\n                    ', "outbox" !== a.mbox && (b += '\n                    <input type="checkbox" value="' + encodeURIComponent(c[e].id) + '" data-action="resume/type">\n                    '), b += '\n                    <a href="/rest/mail/download/' + this._id + "?id=" + encodeURIComponent(c[e].id) + '" target="_blank" class="file-type-icon ' + c[e].ext.toLowerCase() + '">' + c[e].name + "</a>\n                </label>\n                ";
		return b += '\n                <button class="btn btn-small btn-import hide" data-weave="shared/helper/translation" data-i18n="Import to system" data-action="import/candidate"></button>\n            </dd>\n        </dl>\n    </div>\n    <div class="doc_view_content">\n        <iframe src="" frameborder="0" width="100%"></iframe>\n    </div>\n\n    <div class="doc_view_footer clearfix">\n        <div class="btn-group pull-right">\n            <button class="btn" data-action="detail/back" data-weave="shared/helper/translation" data-i18n="Back"></button>\n            <button class="btn" data-action="mail/reply" data-weave="shared/helper/translation" data-i18n="Reply"></button>\n            <button class="btn" data-action="mail/replyall" data-weave="shared/helper/translation" data-i18n="Reply All"></button>\n            <button class="btn" data-action="mail/forward" data-weave="shared/helper/translation" data-i18n="Forward"></button>\n        </div>\n    </div>\n</div>\n\n<div class="mail-reply-content hide">\n    \n</div>'
	}
}), define("app/widget/mail-center/mail-detail/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d, e) {
	function f() {
		var a = this;
		a.userEmail && a._type && a._id && a.publish("ajax", {
			url : i.DETAIL.replace("<id>", a._id)
		}, c().done(function (b) {
				b.status === h ? (a._json = b, c(function (b) {
						a.html(d, a._json, b)
					}).done(function () {
						g.call(a)
					})) : e.alert("error", b.message)
			}))
	}
	function g() {
		var a = this,
		b = a.$element.find("iframe"),
		c = b.contents();
		a.$resume = a.$element.find('[data-action="resume/type"]'),
		a.$mailReply = a.$element.find(".mail-reply-content"),
		a.$importBtn = a.$element.find(".btn-import"),
		c.find("body").html(a._json.body.replace(/(<html>)|(<\/html>)/gim, "")),
		b.height(c.height());
		for (var d = c[0].getElementsByTagName("a"), e = 0; e < d.length; e++)
			d[e].target = "_blank"
	}
	var h,
	i = {
		DETAIL : "/rest/mail/view/<id>",
		GET_UUIDNAME : "/rest/mail/to_file/<mail>?",
		ADD_CANDIDATE : "/candidate#add!file=<file>"
	};
	return b.extend({
		"sig/finalize" : function (a, b) {
			var c = this;
			c.$element.html(""),
			b.resolve()
		},
		"hub:memory/context" : function (a, b) {
			var c = this;
			c.userEmail = b.user.email,
			f.call(c)
		},
		"hub:memory/route" : function (a, b) {
			var c = this;
			c._type = b.path[0],
			c._id = c._type.split("!")[1],
			f.call(c)
		},
		"dom/action.click.change" : a.noop,
		"dom/action/detail/back.click" : function () {
			window.history.back()
		},
		"dom/action/mail/reply.click" : function (a, b) {
			b.preventDefault();
			var c = this;
			c.$mailReply.attr("data-woven") || c.$mailReply.data("json", c._json).attr("data-weave", "app/widget/mail-center/reply/main(json, " + c._id + ")").weave()
		},
		"dom/action/mail/replyall.click" : function (a, b) {
			b.preventDefault();
			var c = this,
			d = [];
			c.$mailReply.attr("data-woven") || (d = c._json.to.split(", ").filter(function (a) {
						return a.indexOf(c.userEmail) > -1 != !0
					}), (d.length || c._json.cc.length) && (d = [d.join(","), c._json.cc].join(",")), c.$mailReply.data("json", c._json).data("cc", d).attr("data-weave", "app/widget/mail-center/reply/main(json, " + c._id + ")").weave())
		},
		"dom/action/mail/forward.click" : function (a, b) {
			b.preventDefault();
			var c = this;
			c.$mailReply.attr("data-woven") || c.$mailReply.data("json", c._json).data("forward", !0).attr("data-weave", "app/widget/mail-center/reply/main(json, " + c._id + ")").weave()
		},
		"dom/action/import/candidate.click" : function (b, d) {
			d.preventDefault();
			var f = this,
			g = a(d.target),
			h = function () {
				var b = [];
				return f.$resume.filter(":checked").each(function () {
					b.push("id=" + a(this).val())
				}),
				b
			}
			();
			f.publish("ajax", {
				url : i.GET_UUIDNAME.replace("<mail>", f._id) + h.join("&"),
				type : "get",
				async : !1
			}, c().done(function (a) {
					a.status ? window.open(i.ADD_CANDIDATE.replace("<file>", a.data), "_blank") : e.alert("error", a.message)
				}), g)
		},
		"dom/action/resume/type.change" : function (b, c) {
			var d = this;
			a(c.target),
			d.$resume.filter(":checked").length ? d.$importBtn.removeClass("hide") : d.$importBtn.addClass("hide")
		},
		formatEmail : function (a) {
			return a ? a.replace(/</g, "&lt;").replace(/>/g, "&gt;") : ""
		}
	})
}), define("troopjs-requirejs/template!app/widget/mail-center/main.html", [], function () {
	return function () {
		var a = '<div class="mail-list" data-weave="troopjs-core/route/placeholder(app/widget/mail-center/list/main)" data-route="^list">\n</div>\n\n<div data-weave="troopjs-core/route/placeholder(app/widget/mail-center/mail-detail/main)" data-route="^(detail)!\\d+$"></div>\n\n<div data-weave="troopjs-core/route/placeholder(app/widget/mail-center/compose/main)"  data-route="^compose"></div>';
		return a
	}
}), define("app/widget/mail-center/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		b.html(d, a)
	}
	return b.extend({
		"sig/start" : function (a, b) {
			e.call(this, b)
		},
		"hub:memory/route" : function (a, b) {
			var c = b.path;
			c || (window.location.hash = "list")
		}
	})
}), define("troopjs-requirejs/template!app/widget/mail-center/reply/main.html", [], function () {
	return function (a) {
		var b = "",
		c = a.attachment;
		if (b += '\n<div class="doc_view">\n    <div class="doc_view_content ">\n        <form action="#" class="form-horizontal form-horizontal-small">\n            <div class="control-group">\n                <label class="control-label" data-weave="shared/helper/translation" data-i18n="Sender"></label>\n                <div class="controls text_line">\n                    <ul class="inline pull-right mail-actions">\n                        <li>\n                            <span data-i18n="Autocomplate Email Type" data-weave="shared/helper/translation"></span>:\n                            <select name="email-type" class="input-small" data-action="email/type">\n                                <option value="email,email1,email2" data-i18n="Any email" data-weave="shared/helper/translation"></option>\n                                <option value="email" data-i18n="Private email" data-weave="shared/helper/translation"></option>\n                                <option value="email1" data-i18n="Work email" data-weave="shared/helper/translation"></option>\n                                <option value="email2" data-i18n="Other" data-weave="shared/helper/translation"></option>\n                            </select>\n                        </li>\n                        <li><a href="#" data-weave="shared/helper/translation" data-i18n="Cc" data-action="toggle/control(\'cc\')"></a></li>\n                        <li><a href="#" data-weave="shared/helper/translation" data-i18n="Bcc" data-action="toggle/control(\'bcc\')"></a></li>\n                        <li>\n                            <a href="#" data-action="add/attachment" data-weave="shared/helper/translation" data-i18n="Attachment"></a>\n                        </li>\n                    </ul>\n                    ' + this.username + '\n                </div>\n            </div>\n            <div class="control-group">\n                <label for="to" class="control-label">\n                    <span data-i18n="To" data-weave="shared/helper/translation"></span>\n                </label>\n                <div class="controls">\n                    <div class="span12">\n                        <input name="to" type="text" id="to" data-action="to" data-max="100" data-weave="app/widget/common/email-suggestion/main">\n                    </div>\n                    <p class="hint">请使用"回车键"或者"逗号"确认邮件地址</p>\n                </div>\n            </div>\n\n            <div class="control-group control-cc hide">\n                <label class="control-label" for="cc">\n                    <span data-i18n="Cc" data-weave="shared/helper/translation"></span>\n                </label>\n                <div class="controls">\n                    <div class="span12">\n                        <input id="cc" name="cc" type="text" data-max="100" data-weave="app/widget/common/email-suggestion/main">\n                    </div>\n                    <p class="hint">请使用"回车键"或者"逗号"确认邮件地址</p>\n                </div>\n            </div>\n\n            <div class="control-group control-bcc hide">\n                <label class="control-label" for="bcc">\n                    <span data-i18n="Bcc" data-weave="shared/helper/translation"></span>\n                </label>\n                <div class="controls">\n                    <div class="span12">\n                        <input id="bcc" name="bcc" type="text" data-max="100" data-weave="app/widget/common/email-suggestion/main">\n                    </div>\n                    <p class="hint">请使用"回车键"或者"逗号"确认邮件地址</p>\n                </div>\n            </div>\n\n            <div class="control-group">\n                <label for="subject" class="control-label">\n                    <span data-i18n="Subject" data-weave="shared/helper/translation"></span>\n                </label>\n                <div class="controls">\n                    <input type="text" id="subject" name="subject" class="span12" value="', b += this._forward ? "Fwd" : "RE", b += ": " + a.subject + '">\n                </div>\n            </div>\n\n            <div class="control-group subjuct-view hide">\n                <label for="subject" class="control-label">\n                    <span data-i18n="Subject" data-weave="shared/helper/translation"></span>\n                </label>\n                <div class="controls">\n                    <input type="text" class="span12" disabled="disabled">\n                </div>\n            </div> \n\n            <div class="control-group attachment-group ', this._forward || (b += "hide"), b += '">\n                <label class="control-label">\n                    <span data-i18n="Attachment" data-weave="shared/helper/translation"></span>\n                </label>\n                <div class="controls text_line">\n                    <ul class="unstyled">\n                        ', c && this._forward) {
			b += "\n                        ";
			for (var d = 0, e = c.length; e > d; d++)
				b += "\n                        <li data-id=" + c[d].id + ">" + (c[d].name || c[d].originname) + '<a href="#" data-action="attachment/remove"><span class="icon-remove-small"></span></a></li>\n                        ';
			b += "\n                        "
		}
		return b += '\n                    </ul>\n                </div>\n            </div>\n\n            <div class="control-group">\n                <textarea name="email-content" data-signature="true"></textarea>\n            </div>\n\n            <div class="control-group content-view hide">\n            </div>\n        </form>\n    </div>\n\n    <div class="doc_view_footer clearfix">\n        <div class="pull-left">\n            <label class="checkbox">\n                <input type="checkbox" name="individually" value="true" checked="checked">\n                <span>分别发送，每个收件人将收到单独发给他/她的邮件</span>\n            </label>\n        </div>\n        <div class="pull-right">\n            <label class="checkbox inline">\n                <input type="checkbox" name="preview" data-action="preview">\n                <span data-weave="shared/helper/translation" data-i18n="Preview"></span>\n            </label>\n            <button class="btn" data-weave="shared/helper/translation" data-action="save/draft" data-i18n="Save draft"></button>\n            <button class="btn btn-primary" data-weave="shared/helper/translation" data-action="send/mail" data-i18n="Send"></button>\n        </div>\n    </div>\n</div>\n    \n\n<p>邮件群发上限: <span class="text-error">100</span> 收件人, 已添加: <span class="text-error text-count">0</span> 收件人</p>'
	}
}), define("app/widget/mail-center/reply/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "shared/helper/utils", "shared/helper/validate"], function (a, b, c, d, e, f, g) {
	function h(b, d, e) {
		var g = this,
		h = {},
		i = a(e.target);
		if (g.$form.valid() && !i.hasClass("disabled")) {
			var j = function () {
				var b = [];
				return g.$attachmentGroup.find("li").each(function () {
					b.push(a(this).data("id"))
				}),
				b.join()
			}
			();
			h = {
				cc : g.$cc.val(),
				bcc : g.$bcc.val(),
				subject : g.$subject.val(),
				content : CKEDITOR.instances["email-content"].getData(),
				to : g.$to.val(),
				individually : g.$individually.is(":checked"),
				attachment : j,
				category : ""
			},
			g.draftId && (h.draft_id = g.draftId),
			i.addClass("disabled"),
			g.publish("ajax", {
				url : b,
				data : {
					data : JSON.stringify(h)
				},
				type : "post",
				dataType : "json"
			}, c().done(function (a) {
					a.status ? (d && d(a), g.publish(n)) : f.alert("error", a.message)
				}).always(function () {
					i.removeClass("disabled")
				}))
		}
	}
	function i() {
		var a = this;
		a._forward ? a.publish("ajax", {
			url : l.GET_ATTACHMENTS.replace("<id>", a._id)
		}, c().done(function (b) {
				a._json.attachment = b,
				c(function (b) {
					a.html(e, a._json, b)
				}).done(function () {
					j.call(a)
				})
			})) : c(function (b) {
			a.html(e, a._json, b)
		}).done(function () {
			j.call(a)
		})
	}
	function j() {
		var b,
		c = this,
		d = c.$element;
		c.$content = d.find("textarea"),
		c.$to = d.find("#to"),
		c.$cc = d.find("#cc"),
		c.$bcc = d.find("#bcc"),
		c.$subject = d.find("#subject"),
		c.$controlCc = d.find(".control-cc"),
		c.$controlBcc = d.find(".control-bcc"),
		c.$individually = d.find('[name="individually"]'),
		c.$massGroup = d.find('[name="mass-group"]'),
		c.$count = d.find(".text-count"),
		c.$form = d.find("form"),
		c.$attachmentGroup = d.find(".attachment-group"),
		c.$attachment = d.find('[name="attachment"]'),
		c.$preview = d.find('[name="preview"]'),
		c.$subjuctView = d.find(".subjuct-view"),
		c.$contentView = d.find(".content-view");
		var e = function () {
			var a,
			b = k.exec(c._json.body);
			return a = b ? RegExp.$1 : c._json.body,
			'<blockquote style="padding-left:1ex; margin: 0px 0px 0px 0.8ex; BORDER-LEFT: #ccc 1px solid">-----原始邮件-----' + a + "</blockquote>"
		}
		();
		if (c.$content.data("origin", e).attr("data-weave", "shared/widget/common/ckeditor/main").weave(), c._json._from && !c._forward) {
			var f = c._json._from.split(",");
			f.forEach(function (a) {
				c.$to.tagit("createTag", a)
			})
		}
		if (c._json.cc && c._json.cc.length) {
			var h = c._json.cc.split(",");
			c.$controlCc.removeClass("hide"),
			h.forEach(function (a) {
				c.$cc.tagit("createTag", a)
			})
		}
		g(c.$form, {
			rules : {
				to : {
					required : !0,
					emails : !0
				},
				cc : {
					emails : !0
				},
				bcc : {
					emails : !0
				}
			}
		}),
		b = d.removeClass("hide").offset().top,
		a("body").scrollTop(b),
		c.$to.trigger("change")
	}
	var k = /(<body[^]+>[^]+<\/body>)/gi,
	l = {
		SEND : "/rest/mail/send",
		SAVE_DRAFT : "/rest/mail/save_draft",
		PREVIEW : "/rest/data/choosetemplate/0",
		GET_ATTACHMENTS : "/rest/mail/get_attachments/<id>"
	},
	m = "modal/attachments/show",
	n = "mail-center/update/sidebar/count";
	return b.extend(function (a, b, c, d) {
		this._json = c,
		this._id = d,
		a.data("cc") && (this._json.cc = a.data("cc")),
		a.data("forward") && (this._forward = !0),
		this.attachmentArr = [],
		this.attachmentRefresh = !0
	}, {
		"hub:memory/context" : function (a, b) {
			var c = this,
			d = b.user;
			c.username = [d.englishName, d.chineseName].join(" "),
			i.call(c)
		},
		"sig/finalize" : function (a, b) {
			var c = this;
			window.clearTimeout(c.timeid),
			c.$element.html(""),
			b.resolve()
		},
		"hub/receive/attachments" : function (a, b) {
			var c = this,
			d = "";
			b.forEach(function (a) {
				c.$attachmentGroup.find('[data-id="' + a.id + '"]').length || (d += '<li data-id="' + a.id + '">' + a.type + '<span class="file-type-icon ' + a.ext.toLowerCase() + '">' + a.name + '</span> <a href="#" data-action="attachment/remove"><span class="icon-remove-small"></span></a></li>')
			}),
			d.length && c.$attachmentGroup.removeClass("hide").find("ul").append(d)
		},
		"dom/action.click.change" : a.noop,
		"dom/action/attachment/remove.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = window.confirm("确定要删除此附件吗？");
			e && a(c.target).closest("li").remove(),
			d.$attachmentGroup.find("ul li").length || d.$attachmentGroup.addClass("hide")
		},
		"dom/action/to.change" : function (b, c) {
			var d = this,
			e = a(c.target),
			f = e.val().trim(),
			g = f ? e.val().split(",").length : 0;
			d.$count.text(g)
		},
		"dom/action/send/mail.click" : function (a, b) {
			b.preventDefault();
			var c = this;
			h.call(c, l.SEND, function () {
				f.alert("success", "邮件回复成功！"),
				c.timeid = window.setTimeout(function () {
						window.location.reload()
					}, 1500)
			}, b)
		},
		"dom/action/save/draft.click" : function (a, b) {
			var c = this;
			h.call(c, l.SAVE_DRAFT, function (a) {
				f.alert("success", "邮件保存成功！"),
				c.draftId = a.data
			}, b)
		},
		"dom/action/add/attachment.click" : function (a, b) {
			b.preventDefault();
			var c = this;
			c.publish(m, {
				joborder : 0,
				clientcompany : 0
			}, c.attachmentRefresh, c.attachmentArr),
			c.attachmentRefresh = !1
		},
		formatEmail : function (a) {
			var b = /^(".*")( (<.*>))?$/;
			return b.exec(a),
			'""' === RegExp.$1 ? RegExp.$3.replace("<", "").replace(">", "") : a.replace("<", "&lt;").replace(">", "&gt;")
		},
		"dom/action/preview.click" : function (b, d) {
			var e = this,
			f = a(d.target);
			f.is(":checked") ? e.$to.val().length ? e.publish("ajax", {
				url : l.PREVIEW,
				data : {
					data : JSON.stringify({
						email : e.$to.val(),
						title : e.$subject.val(),
						content : CKEDITOR.instances["email-content"].getData()
					})
				},
				type : "post"
			}, c().done(function (a) {
					a.status && (e.$subject.closest(".control-group").addClass("hide"), e.$subjuctView.removeClass("hide").find("input").val(a.data.title), e.$content.closest(".control-group").addClass("hide"), e.$contentView.removeClass("hide").html(a.data.content))
				})) : (e.$subject.closest(".control-group").addClass("hide"), e.$subjuctView.removeClass("hide").find("input").val(""), e.$content.closest(".control-group").addClass("hide"), e.$contentView.removeClass("hide").html("")) : (e.$subject.closest(".control-group").removeClass("hide"), e.$subjuctView.addClass("hide"), e.$content.closest(".control-group").removeClass("hide"), e.$contentView.addClass("hide"))
		},
		"dom/action/toggle/control.click" : function (a, b, c) {
			b.preventDefault();
			var d = this;
			switch (c) {
			case "cc":
				d.$controlCc.toggleClass("hide"),
				d.$cc.tagit("removeAll");
				break;
			case "bcc":
				d.$controlBcc.toggleClass("hide"),
				d.$bcc.tagit("removeAll")
			}
		},
		"dom/action/email/type.change" : function (b, c) {
			var d = this,
			e = a(c.target),
			f = e.val(),
			g = f.split(",");
			this._emailType = g,
			d.$to.data("emailType", g),
			d.$cc.data("emailType", g),
			d.$bcc.data("emailType", g)
		}
	})
}), define("troopjs-requirejs/template!app/widget/mail-center/sidebar/main.html", [], function () {
	return function (a) {
		var b = "",
		c = a.emailEnabled;
		return b += '\n<span class="sidebar_switch icon-on-switch ttip_r" oldtitle="Hide Sidebar">Sidebar switch</span>\n<div class="sidebar">\n    <div class="antiScroll">\n        <div class="antiscroll-inner">\n            <div class="antiscroll-content">\n                <div class="sidebar_inner">\n                    <ul class="nav nav-list">\n                        <li class="nav-header sepH_b" data-weave="shared/helper/translation" data-i18n="Mail Center"></li>\n                        <li class="sepH_b">\n                            <button class="btn ',
		c || (b += "disabled"),
		b += '" data-weave="shared/helper/translation" data-i18n="Reception" data-action="check/mail"></button>\n                            <button class="btn ',
		c || (b += "disabled"),
		b += '" data-weave="shared/helper/translation" data-i18n="Compose Mail" data-action="compose/mail"></button>\n                        </li>\n                        <li>\n                            <a href="#" data-href="mbox=inbox" data-action="filter">\n                                <span data-weave="shared/helper/translation" data-i18n="Inbox"></span>\n                                <span class="pull-right">\n                                    <span class="unread-count"></span> /\n                                    <span class="inbox-count"></span>\n                                </span>\n                            </a>\n                        </li>\n                        <li>\n                            <a href="#" data-href="mbox=sending" data-action="filter">\n                                <span data-weave="shared/helper/translation" data-i18n="Sending Box"></span>\n                                <span class="pull-right sending-count"></span>\n                            </a>\n                        </li>\n                        <li>\n                            <a href="#" data-href="mbox=outbox" data-action="filter">\n                                <span data-weave="shared/helper/translation" data-i18n="Sent Box"></span>\n                                <span class="pull-right outbox-count"></span>\n                            </a>\n                        </li>\n                        <li>\n                            <a href="#" data-href="mbox=draft" data-action="filter">\n                                <span data-weave="shared/helper/translation" data-i18n="Drafts"></span>\n                                <span class="pull-right draft-count"></span>\n                            </a>\n                        </li>\n                        <li>\n                            <a href="#" data-href="mbox=trash" data-action="filter">\n                                <span data-weave="shared/helper/translation" data-i18n="Trash"></span>\n                                <span class="pull-right trash-count"></span>\n                            </a>\n                        </li>\n                    </ul>\n                    \n                    <ul class="nav nav-list folder-list" data-action="folder/list">\n                        <li class="nav-header">\n                            <span data-action="nav/header">\n                                <b class="icon-expandable"></b>\n                                <span data-weave="shared/helper/translation" data-i18n="Folder"></span>\n                                <span class="edit hide" data-weave="shared/helper/translation" data-i18n="Edit" data-action="edit/folder"></span>\n                            </span>\n                        </li>\n                        <li class="folder-tree">\n                        </li>\n                    </ul>\n\n                    <ul class="nav nav-list">\n                        <li class="nav-header" data-weave="shared/helper/translation" data-i18n="Settings"></li>\n                        <li><a href="/email" data-weave="shared/helper/translation" data-i18n="Email Setting"></a></li>\n                    </ul>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>'
	}
}), define("app/widget/mail-center/sidebar/main", ["jquery", "shared/services/route", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "jquery.tree"], function (a, b, c, d, e, f) {
	function g(a, b) {
		function c(a, e) {
			b && e && b(e),
			d.unsubscribe(q, c)
		}
		var d = this;
		d.subscribe(q, c),
		d.publish("make/route", {
			filter : a,
			page : 1
		})
	}
	function h(a) {
		var b = this;
		b.publish("ajax", {
			url : m.FOLDER_LIST
		}, d().done(function (c) {
				b.$folderList.find(".folder-tree").tree("loadData", c),
				b.publish("update/email/folder", c),
				b._folderLoaded || i.call(b),
				b._folderLoaded = !0,
				b.publish(p),
				a && a.resolve()
			}))
	}
	function i() {
		var a,
		b,
		c,
		d = this,
		e = d._path,
		f = 0;
		if (e)
			for (a = e.length, f; a > f; f++)
				l.test(e[f]) && (b = e[f].split("!"), c = b[1], d.$element.find("li").removeClass("hover"), d.$element.find('[data-href="' + window.decodeURIComponent(c) + '"]').closest("li").addClass("hover"))
	}
	function j() {
		var a = this;
		d(function (b) {
			a.html(e, a._json, b)
		}).done(function () {
			a.publish("root/register/sidebar"),
			k.call(a)
		})
	}
	function k() {
		var a = this,
		b = a.$element;
		a.$inbox = b.find(".inbox-count"),
		a.$sending = b.find(".sending-count"),
		a.$outbox = b.find(".outbox-count"),
		a.$draft = b.find(".draft-count"),
		a.$trash = b.find(".trash-count"),
		a.$unread = b.find(".unread-count").text(a.unreadCount),
		a.$link = a.$element.find(".nav-list a"),
		a.$folderList = a.$element.find(".folder-list"),
		a.$element.on("mouseenter mouseleave", ".folder-list", function (b) {
			"mouseenter" === b.type ? a.$element.find(".edit").removeClass("hide") : a.$element.find(".edit").addClass("hide")
		}),
		a.$folderList.find(".folder-tree").tree({
			data : {},
			onCreateLi : function (a, b) {
				var c = b.find(".jqtree-title"),
				d = "icon-folder-close icon-blue";
				"shared" === a.permission && (d += " icon-folder-share"),
				c.before('<i class="' + d + '"></i>&nbsp;'),
				c.after('<sapn class="pull-right">' + a.count + "</sapn>"),
				b.find(".jqtree-element").attr("data-action", "filter").attr("data-id", a.id).attr("data-href", "folder_id=" + a.id)
			},
			selectable : !1,
			slide : !1
		}),
		h.call(this),
		a.publish(o),
		a._rendered = !0
	}
	var l = /^filter!/,
	m = {
		CHECK_MAIL : "/rest/mail/check",
		COUNT : "/rest/mail/group_count",
		FOLDER_LIST : "/rest/folder/list?type=email"
	},
	n = "mail-center/reload/mail",
	o = "mail-center/update/sidebar/count",
	p = "root/update/sidebar",
	q = "filter/get/count";
	return c.extend(function () {
		b().start()
	}, {
		"hub:memory/context" : function (a, b) {
			var c = this;
			c._json.emailEnabled = "" !== b.user.email && "" !== b.user.emailpassword,
			c.unreadCount = b.email_count,
			j.call(c)
		},
		"hub:memory/side-bar/update/folder" : function () {
			h.call(this)
		},
		"hub:memory/route" : function (a, b) {
			var c = this;
			c._path = b.path,
			c._type = c._path ? c._path[0] : "",
			c._rendered && i.call(c)
		},
		"hub:memory/mail-center/update/sidebar/count" : function () {
			var b = this;
			"started" === b.phase && b.publish("ajax", {
				url : m.COUNT
			}, d().done(function (c) {
					b._json = a.extend(!0, b._json, c);
					for (var d in c)
						b["$" + d] && b["$" + d].length && b["$" + d].text(c[d])
				}))
		},
		"hub/mail-center/sidebar/update/unread" : function (a, b) {
			var c = this;
			c.$unread.text(1 * c.$unread.text() + b)
		},
		"dom/action.click" : a.noop,
		"dom/action/check/mail.click" : function (b, c) {
			var e = this,
			g = a(c.target);
			e.publish("ajax", {
				url : m.CHECK_MAIL
			}, d().done(function (a) {
					a.status ? (e.publish(n), e.publish(o)) : f.alert("error", a.mesage),
					g.removeClass("disabled")
				}), g)
		},
		"dom/action/compose/mail.click" : function (b, c) {
			var d = a(c.target);
			d.hasClass("disabled") || (window.location.hash = "compose")
		},
		"dom/action/edit/folder.click" : function (a, b) {
			b.preventDefault(),
			b.stopPropagation();
			var c = this;
			c.publish("modal/add-to-folder/show", "edit")
		},
		"dom/action/filter.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target),
			f = e.attr("data-href");
			g.call(d, f, function (a) {
				e.find(".pull-right").text(a)
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/activity-alert/main.html", [], function () {
	return function (a) {
		var b = "",
		c = a.value.oneday,
		d = this.emailEnabled;
		return b += '\n<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3 data-weave="shared/helper/translation" data-i18n="超出下列预设值时，系统将自动发送邮件通知"></h3>\n</div>\n<div class="modal-body">\n    <form action="#" class="form-horizontal" id="activity-alert-form">\n        <div class="control-group">\n            <label class="control-label" data-weave="shared/helper/translation" data-i18n="Alert period"></label>\n            <div class="controls text_line" data-weave="shared/helper/translation" data-i18n="1 day"></div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label" data-weave="shared/helper/translation" data-i18n="View candidate\'s detail"></label>\n            <div class="controls">\n                <input type="text" class="input-small" name="viewCandidateDetail" value="' + c.CandidateView + '">\n            </div>\n        </div>\n        <div class="control-group">\n            <label class="control-label" data-weave="shared/helper/translation" data-i18n="View candidate\'s attachment"></label>\n            <div class="controls">\n                <input type="text" class="input-small" name="viewCandidateAttachment" value="' + c.CandidateAttachmentView + '">\n            </div>\n        </div>\n        <div class="control-group">\n            <label class="control-label" data-weave="shared/helper/translation" data-i18n="Download candidate\'s attachment"></label>\n            <div class="controls">\n                <input type="text" class="input-small" name="downloadCandidateAttachment" value="' + c.CandidateAttachmentDownload + '">\n            </div>\n        </div>\n        <div class="control-group">\n            <label class="control-label" data-weave="shared/helper/translation" data-i18n="候选人列表翻页"></label>\n            <div class="controls">\n                <input type="text" class="input-small" name="candidateList" value="' + c.CandidateList + '">\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label" data-weave="shared/helper/translation" data-i18n="To"></label>\n            <div class="controls">\n                \n                ',
		b += d ? '\n                <input type="text" name="receiver" data-weave="shared/widget/common/tagit/main" value="' + a.value.emailto + '">\n                <p class="hint">请使用"回车键"或者"逗号"确认邮件地址，不设置邮箱代表不发送警报邮件。</p>\n                ' : '\n                <input type="text" disabled="disabled" class="span4">\n                <p class="help-block">\n                    <sapn class="text-error">邮件功能还未启用，请在个人信息板块的邮件设置中心，填写管理员的邮箱密码，并测试通过！</sapn>\n                </p>\n                ',
		b += '\n            </div>\n        </div>\n    </form>\n</div>\n<div class="modal-footer">\n    <button class="btn btn-primary" data-action="save" data-weave="shared/helper/translation" data-i18n="Save" form="activity-alert-form"></button>\n</div>'
	}
}), define("app/widget/modal/activity-alert/main", ["jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "shared/helper/utils", "shared/helper/validate"], function (a, b, c, d, e, f) {
	function g() {
		var a = this;
		a.publish("ajax", {
			url : j.CONFIG,
			type : "get",
			cache : !1
		}, b().done(function (c) {
				var e = c[0];
				e.value = JSON.parse(e.value),
				a._json = e,
				b(function (b) {
					a.html(d, a._json, b)
				}).done(function () {
					h.call(a)
				})
			}))
	}
	function h() {
		var a = this,
		b = a.$element;
		a.$form = b.find("form"),
		a.$viewCandidateDetail = b.find('[name="viewCandidateDetail"]'),
		a.$viewCandidateAttachment = b.find('[name="viewCandidateAttachment"]'),
		a.$downloadCandidateAttachment = b.find('[name="downloadCandidateAttachment"]'),
		a.$candidateList = b.find('[name="candidateList"]'),
		a.$receiver = b.find('[name="receiver"]'),
		f(a.$form, {
			rules : {
				viewCandidateDetail : {
					number : !0
				},
				viewCandidateAttachment : {
					number : !0
				},
				downloadCandidateAttachment : {
					number : !0
				},
				candidateList : {
					number : !0
				},
				viewContactDetail : {
					number : !0
				},
				contactList : {
					number : !0
				}
			}
		})
	}
	var i = "operation_log_alert",
	j = {
		CONFIG : "/rest/data/configvalue?keys=operation_log_alert",
		CONFIG_ADD : "/rest/data/configvalue/add"
	};
	return c.extend({
		"hub:memory/context" : function (a, b) {
			var c = this;
			b.user.emailpassword && (c.emailEnabled = !0)
		},
		"hub/modal/activity-alert/show" : function () {
			var a = this,
			b = a.$element;
			g.call(this),
			b.modal("show")
		},
		"dom/action.click" : a.noop,
		"dom/action/save.click" : function (c, d) {
			d.preventDefault();
			var f = this,
			g = f.$element,
			h = a(d.target);
			if (f.$form.valid()) {
				var k = JSON.stringify({
						oneday : {
							CandidateList : parseInt(f.$candidateList.val().trim(), 10),
							CandidateView : parseInt(f.$viewCandidateDetail.val().trim(), 10),
							CandidateAttachmentView : parseInt(f.$viewCandidateAttachment.val().trim(), 10),
							CandidateAttachmentDownload : parseInt(f.$downloadCandidateAttachment.val().trim(), 10)
						},
						emailto : f.$receiver.val()
					}),
				l = {
					type : "",
					name : i,
					value : k
				};
				f.publish("ajax", {
					url : j.CONFIG_ADD,
					data : {
						data : JSON.stringify(l)
					},
					type : "post"
				}, b().done(function (a) {
						g.modal("hide"),
						a.status ? e.alert("success", "设置成功！") : e.alert("error", a.message)
					}), h)
			}
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/add-attachments/main.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\r\n    <button type="button" class="close" data-dismiss="modal">×</button>\r\n    <h3 data-weave="shared/helper/translation" data-i18n="Choose attachments"></h3>\r\n</div>\r\n<div class="modal-body">\r\n    <div class="tabbable">\r\n        <ul class="nav nav-tabs">\r\n            <li class="candidate hide"><a href="#candidate" data-toggle="tab" data-weave="shared/helper/translation" data-i18n="People"></a></li>\r\n            <li class="joborder hide"><a href="#joborder" data-toggle="tab" data-weave="shared/helper/translation" data-i18n="Job"></a></li>\r\n            <li class="clientcompany hide"><a href="#clientcompany" data-toggle="tab" data-weave="shared/helper/translation" data-i18n="Client"></a></li>\r\n            <li class="local-upload">\r\n                <a href="#local-upload" data-toggle="tab" data-weave="shared/helper/translation" data-i18n="From local"></a>\r\n            </li>\r\n        </ul>\r\n        <div class="tab-content">\r\n            <div class="tab-pane candidate hide" id="candidate">\r\n            </div>\r\n            <div class="tab-pane joborder hide" id="joborder">\r\n            </div>\r\n            <div class="tab-pane clientcompany hide" id="clientcompany">\r\n            </div>\r\n            <div class="tab-pane hide" id="local-upload">\r\n                <form action="#" class="form-horizontal" type="post" enctype="multipart/form-data">\r\n                    <fieldset>\r\n                        <div class="control-group formSep">\r\n                            <label class="control-label" data-weave="shared/helper/translation" data-i18n="File upload"></label>\r\n                            <div class="controls">\r\n                                <div class="upload-file"></div>\r\n                            </div>\r\n                        </div>\r\n                    </fieldset>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="modal-footer">\r\n    <button class="btn btn-primary" data-action="confirm" data-weave="shared/helper/translation" data-i18n="Confirm"></button>\r\n</div>';
		return a
	}
}), define("troopjs-requirejs/template!app/widget/modal/add-attachments/items.html", [], function () {
	return function (a) {
		var b = "",
		c = a.items;
		b += "\n",
		a.title && (b += "\n<label><strong>" + a.title + "</strong></label>\n"),
		b += "\n\n";
		for (var d = 0, e = c.length; e > d; d++)
			b += '\n<label class="checkbox">\n    ', b += c[d].tag ? '\n    <span class="label" style="background-color: ' + c[d].tag.color + ';">' + c[d].tag.value + "</span>\n    " : '\n    <span class="label" data-weave="shared/helper/translation" data-i18n="Unknown"></span>\n    ', b += '\n    <input type="checkbox" value="' + c[d].id + '" data-action="attachment" data-ext="' + c[d].ext.toLowerCase() + '"> \n    <span class="file-type-icon ' + c[d].ext.toLowerCase() + '">' + c[d].originname + '</span>\n    <a href="/rest/file/preview/' + c[d].uuidname + '" target="_blank" title="Open in new tab"><span class="icon-new-window icon-blue"></span></a>\n</label>\n';
		return b
	}
}), define("app/widget/modal/add-attachments/main", ["jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "template!./items.html", "shared/helper/utils", "shared/helper/blurb", "app/widget/common/select2/main"], function (a, b, c, d, e, f, g) {
	function h() {
		var b = this;
		b.$btnFile.data("json", {
			multiple : !0,
			data : {
				type : "attachment"
			},
			beforeSubmit : function () {
				this.$controls = b.$btnFile.closest(".controls"),
				this.$controls.addClass("text_line")
			},
			success : function (c) {
				if (this.$controls.removeClass("text_line"), c.status) {
					var d = a(e({
								items : c.data
							}));
					b.$localTab.append(d),
					d.find(":checkbox").trigger("click"),
					d.find("[data-weave]").weave()
				} else
					f.alert("error", c.message)
			},
			error : function () {
				this.$controls.removeClass("text_line")
			}
		}).attr("data-weave", "shared/widget/common/upload/main(json)").weave()
	}
	function i(c, d, g, h) {
		var i = this,
		j = i.$element.find("." + d),
		k = a("#" + d);
		j.removeClass("hide"),
		j.addClass("active"),
		j.prevAll().hasClass("active") && j.removeClass("active"),
		h || k.empty();
		var l = function (b) {
			var d;
			if (d = b.length, "object" == typeof g && b.length && (c = g[b[0].external_id]), d) {
				var f = a(e({
							title : c,
							items : b
						}));
				k.append(f),
				i.attachmentArr && k.find(":checkbox").each(function () {
					var b = a(this),
					c = b.val(),
					d = 0,
					e = i.attachmentArr.length;
					for (d; e > d; d++)
						c == i.attachmentArr[d].id && b.prop("checked", !0)
				}),
				f.find("[data-weave]").weave()
			}
		},
		m = function (a, b) {
			f.alert("error", "Load attachments error: " + b)
		};
		if (a.isPlainObject(g))
			for (var o in g)
				i.publish("ajax", {
					url : n.FILE_LIST.replace("<type>", d).replace("<id>", o)
				}, b().done(l).fail(m));
		else
			a.isArray(g) && (g = g.join()), i.publish("ajax", {
				url : n.FILE_LIST.replace("<type>", d).replace("<id>", g)
			}, b().done(l).fail(m))
	}
	function j(c) {
		var d = this,
		e = d.$element.find("." + c),
		f = a("#" + c),
		h = a('<select class="input-xxlarge">').prop("name", c).attr("data-action", "option");
		e.removeClass("hide"),
		e.addClass("active"),
		e.prevAll().hasClass("active") && e.removeClass("active"),
		h.append(a('<option value=""></option>')).appendTo(f),
		"joborder" == c ? d.publish("ajax", {
			url : n.LIVE_JOBS
		}, b().done(function (b) {
				for (var c, d = 0, e = b.length; e > d; d += 1)
					c = b[d], a("<option>").val(c.id).text(c.jobTitle + "(ID:" + c.id + ")").appendTo(h);
				h.select2({
					placeholder : g.t("Please select")
				})
			})) : "clientcompany" == c && d.publish("ajax", {
			url : n.CLIENT.replace("<uid>", d._user.id)
		}, b().done(function (b) {
				if (b.list)
					for (var c, d = 0, e = b.list.length; e > d; d += 1)
						c = b.list[d], a("<option>").val(c.id).text(c.name).appendTo(h);
				h.select2({
					placeholder : g.t("Please select")
				})
			}))
	}
	function k() {
		var a = this;
		a.$element.find(".candidate, .joborder, .clientcompany").removeClass("active").addClass("hide"),
		a.$element.find("#candidate, #joborder, #clientcompany").empty(),
		a.$element.find(".local-upload, #local-upload").removeClass("active"),
		a.$element.find("#local-upload").children(":not(form)").remove()
	}
	function l() {
		var a = this;
		b(function (b) {
			a.html(d, a._json, b)
		}).done(function () {
			m.call(a)
		})
	}
	function m() {
		var a = this;
		a.$localTab = a.$element.find("#local-upload"),
		a.$btnFile = a.$element.find(".upload-file"),
		h.call(a)
	}
	var n = {
		FILE_LIST : "/rest/file/list/<type>/<id>",
		LIVE_JOBS : "/rest/joborder/livejobs",
		CLIENT : "/rest/client/list?paginate_by=10000&user_id=<uid>&allow_new_job=1"
	};
	return c.extend({
		"sig/stop" : function (a, b) {
			this.$element.find("select").select2("destroy"),
			b.resolve()
		},
		"hub:memory/context" : function (a, b) {
			this._user = b.user,
			l.call(this)
		},
		"hub/modal/attachments/show" : function (a, b, c, d, e) {
			var f,
			g = this,
			h = g.$element;
			if (g.attachmentArr = d, g._hasAttachment = !c, g._modal = e, !g._hasAttachment)
				if (k.call(g), b && Object.keys(b).length)
					for (f in b)
						b[f] ? i.call(g, "", f, b[f]) : j.call(g, f);
				else
					g.$element.find('[href="#local-upload"]').trigger("click");
			g.$element.off("hidden"),
			g.$element.on("hidden", function () {
				g.publish(g._modal, {}, !0)
			}),
			h.modal("show")
		},
		"dom/action.click.change" : a.noop,
		"dom/action/confirm.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = d.$element,
			f = [];
			d.attachmentArr ? f = d.attachmentArr : e.find("input:checked").each(function () {
					var b = a(this);
					f.push({
						id : this.value,
						name : b.parent().find(".file-type-icon").text().trim(),
						type : b.parent().find(".label")[0].outerHTML,
						ext : b.data("ext")
					})
				}),
			d.publish("receive/attachments", f),
			d.publish(d._modal, {}, !0),
			d._hasAttachment = !0,
			e.modal("hide")
		},
		"dom/action/option.change" : function (b, c) {
			var d = this,
			e = a(c.target),
			f = e.find(":selected"),
			g = e.attr("name"),
			h = e.val(),
			j = f.text();
			h && (f.remove(), i.call(d, j, g, h, !0))
		},
		"dom/action/attachment.change" : function (b, c) {
			var d = this,
			e = a(c.target),
			f = e.val();
			d.attachmentArr && (e.is(":checked") ? d.attachmentArr.push({
					id : f,
					name : e.parent().find(".file-type-icon").text().trim(),
					ext : e.data("ext"),
					type : e.parent().find(".label")[0].outerHTML
				}) : d.attachmentArr = a.grep(d.attachmentArr, function (a) {
						return a.id != f
					}))
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/add-floating-attachments/main.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\r\n    <button type="button" class="close" data-dismiss="modal">×</button>\r\n    <h3 data-weave="shared/helper/translation" data-i18n="Choose attachments"></h3>\r\n</div>\r\n<div class="modal-body">\r\n    <div class="tabbable">\r\n        <ul class="nav nav-tabs">\r\n            <li class="active"><a data-weave="shared/helper/translation" data-i18n="People"></a></li>\r\n        </ul>\r\n        <div class="tab-content">\r\n            <div class="tab-pane active"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="modal-footer">\r\n    <button class="btn btn-primary" data-action="confirm" data-weave="shared/helper/translation" data-i18n="Confirm"></button>\r\n</div>';
		return a
	}
}), define("troopjs-requirejs/template!app/widget/modal/add-floating-attachments/items.html", [], function () {
	return function (a) {
		var b = "",
		c = a.items;
		b += "\n<label><strong>" + a.title + "</strong></label>\n";
		for (var d = 0, e = c.length; e > d; d++)
			b += '\n<label class="checkbox">\n    ', b += c[d].tag ? '\n    <span class="label" style="background-color: ' + c[d].tag.color + ';">' + c[d].tag.value + "</span>\n    " : '\n    <span class="label" data-weave="shared/helper/translation" data-i18n="Unknown"></span>\n    ', b += '\n    <input type="checkbox" data-external="' + c[d].external_id + '" value="' + c[d].id + '" data-ext="' + c[d].ext.toLowerCase() + '" data-action="attachment">\n    <span class="file-type-icon ' + c[d].ext.toLowerCase() + '">' + c[d].originname + '</span>\n    <a href="/rest/file/preview/' + c[d].uuidname + '" target="_blank" title="Open in new tab"><span class="icon-new-window icon-blue"></span></a>\n</label>\n';
		return b
	}
}), define("app/widget/modal/add-floating-attachments/main", ["jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "template!./items.html", "shared/helper/utils"], function (a, b, c, d, e, f) {
	function g(c) {
		var d = this,
		g = function () {
			var a = [];
			return c.forEach(function (b) {
				a.push(b.id)
			}),
			a.join()
		}
		(),
		h = function (f) {
			var g;
			c.forEach(function (c) {
				g = f.filter(function (a) {
						return a.external_id === c.id
					});
				var h = a(e({
							title : c.name,
							items : g
						}));
				h.find("[data-weave]").weave(b().done(function () {
						d.$pane.append(h)
					}))
			})
		},
		i = function (a, b) {
			f.alert("error", "Load attachments error: " + b)
		};
		d.publish("ajax", {
			url : k.FILE_LIST.replace("<id>", g)
		}, b().done(h).fail(i))
	}
	function h() {
		var a = this;
		a.$pane.empty()
	}
	function i(a) {
		var b = this;
		b.html(d, b._json, a)
	}
	function j(a) {
		var b = this;
		b.$pane = b.$element.find(".tab-pane"),
		a.resolve()
	}
	var k = {
		FILE_LIST : "/rest/file/list/candidate/<id>"
	};
	return c.extend({
		"sig/initialize" : function (a, b) {
			i.call(this, b)
		},
		"sig/start" : function (a, b) {
			j.call(this, b)
		},
		"hub:memory/context" : function (a, b) {
			this._user = b.user
		},
		"hub/modal/floating-attachments/show" : function (a, b, c, d) {
			var e = this,
			f = e.$element;
			e._hasAttachment = !c,
			e._modal = d,
			e._hasAttachment || (h.call(e), g.call(e, b)),
			e.$element.off("hidden"),
			e.$element.on("hidden", function () {
				e.publish(e._modal, {}, !0)
			}),
			f.modal("show")
		},
		"dom/action.click.change" : a.noop,
		"dom/action/confirm.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = d.$element,
			f = [];
			d.attachmentArr ? f = d.attachmentArr : e.find("input:checked").each(function () {
					var b = this,
					c = a(b);
					f.push({
						id : b.value,
						name : c.parent().find(".file-type-icon").text().trim(),
						type : c.parent().find(".label")[0].outerHTML,
						external_id : c.data("external"),
						ext : c.data("ext")
					})
				}),
			d.publish("receive/floating-attachments", f),
			d.publish(d._modal, {}, !0),
			d._hasAttachment = !0,
			e.modal("hide")
		},
		"dom/action/attachment.change" : function (b, c) {
			var d = this,
			e = a(c.target),
			f = e.val();
			d.attachmentArr && (e.is(":checked") ? d.attachmentArr.push({
					id : f,
					name : e.parent().text().trim()
				}) : d.attachmentArr = a.grep(d.attachmentArr, function (a) {
						return a.id != f
					}))
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/add-floating/main.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\r\n    <button type="button" class="close" data-dismiss="modal">×</button>\r\n    <ul class="inline pull-right">\r\n        <li>\r\n            <span data-i18n="Autocomplate Email Type" data-weave="shared/helper/translation"></span>:\r\n            <select name="email-type" class="input-small" data-action="email/type">\r\n                <option value="email,email1,email2" data-i18n="Any email" data-weave="shared/helper/translation"></option>\r\n                <option value="email" data-i18n="Private email" data-weave="shared/helper/translation"></option>\r\n                <option value="email1" data-i18n="Work email" data-weave="shared/helper/translation"></option>\r\n                <option value="email2" data-i18n="Other" data-weave="shared/helper/translation"></option>\r\n            </select>\r\n        </li>\r\n        <li><a href="#" data-action="cc" data-weave="shared/helper/translation" data-i18n="Cc"></a></li>\r\n        <li><a href="#" data-action="bcc" data-weave="shared/helper/translation" data-i18n="Bcc"></a></li>\r\n        <li>\r\n            <span class="dropdown mass-mail">\r\n                <a href="#" class="dropdown-toggle" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Mass Mail"></a>\r\n                <div class="dropdown-menu">\r\n                    <p class="clearfix">\r\n                        <div class="comtree inline" style="width: 250px;" data-name="mass-group" data-weave="shared/widget/common/comtree/main" data-url="/rest/folder/list?type=candidate"></div>\r\n                    </p>\r\n                    <button class="btn" data-weave="shared/helper/translation" data-i18n="Add" data-action="mass/add"></button>\r\n                </div>\r\n            </span>\r\n        </li>\r\n        <li>\r\n            <a href="#" data-action="choose" data-i18n="Attachment" data-weave="shared/helper/translation"></a>\r\n        </li>\r\n    </ul>\r\n    <h3><span data-weave="shared/helper/translation" data-i18n="Floating"></span></h3>\r\n</div>\r\n<div class="modal-body shrink">\r\n\r\n    <form action="#" class="form-horizontal" id="add-floating-form">\r\n        <div class="control-group">\r\n            <label class="control-label" for="" data-weave="shared/helper/translation" data-i18n="Candidate"></label>\r\n            <div class="controls text_line names"></div>\r\n        </div>\r\n\r\n        <div class="control-group">\r\n            <label class="control-label">\r\n                <span data-weave="shared/helper/translation" data-i18n="To"></span>\r\n                <span class="f_req">*</span>\r\n            </label>\r\n            <div class="controls">\r\n                <div class="span665">\r\n                    <input type="text" name="receiver" data-max="200" data-weave="app/widget/modal/add-floating/receiver">\r\n                    <div class="hint clear"><span data-weave="shared/helper/translation" data-i18n="Receiver must be"></span> <span class="label label-red" data-weave="shared/helper/translation" data-i18n="Contact"></span></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="control-group control-cc hide">\r\n            <label class="control-label" data-weave="shared/helper/translation" data-i18n="Cc"></label>\r\n            <div class="controls">\r\n                <div class="span665">\r\n                    <input type="text" data-max="100" name="cc" data-weave="app/widget/common/email-suggestion/main">\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="control-group control-bcc hide">\r\n            <label class="control-label" data-weave="shared/helper/translation" data-i18n="Bcc"></label>\r\n            <div class="controls">\r\n                <div class="span665">\r\n                    <input type="text" data-max="100" name="bcc" data-weave="app/widget/common/email-suggestion/main">\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="control-group">\r\n            <label class="control-label">\r\n                <span data-weave="shared/helper/translation" data-i18n="Subject"></span>\r\n                <span class="f_req">*</span>\r\n            </label>\r\n            <div class="controls">\r\n                <input type="text" class="span655" name="subject">\r\n            </div>\r\n        </div>\r\n\r\n        <div class="control-group control-attachment hide">\r\n            <label class="control-label" for="" data-weave="shared/helper/translation" data-i18n="Attachment"></label>\r\n            <div class="controls text_line">\r\n                <ul class="unstyled">\r\n                </ul>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="control-group">\r\n            <label class="control-label">\r\n                <span data-i18n="Email Template" data-weave="shared/helper/translation"></span>\r\n            </label>\r\n            <div class="controls">\r\n                <select name="template" data-action="template" data-weave="shared/widget/common/select-template/main(\'floating\')"></select>\r\n            </div>\r\n        </div>\r\n\r\n        <textarea name="floating-email-content"  data-template="true" data-signature="true" data-weave="shared/widget/common/ckeditor/main"></textarea>\r\n\r\n    </form>\r\n</div>\r\n<div class="modal-footer">\r\n    <label class="checkbox pull-left">\r\n        <input type="checkbox" name="individually" value="true" checked="checked">\r\n        <span data-i18n="Send Personally" data-weave="shared/helper/translation"></span>\r\n    </label>\r\n    <button class="btn btn-primary" data-action="send" data-weave="shared/helper/translation" data-i18n="Send" form="add-floating-form"></button>\r\n</div>';
		return a
	}
}), define("app/widget/modal/add-floating/main", ["jquery", "troopjs-utils/deferred", "troopjs-utils/when", "shared/widget/modal/base", "template!./main.html", "shared/helper/utils", "shared/helper/validate", "shared/helper/blurb"], function (a, b, c, d, e, f, g, h) {
	function i() {
		var a = this,
		b = a.$element.find(".btn.disabled");
		b.length && b.removeClass("disabled"),
		a.publish("editor/reset"),
		a._templateId = "",
		a.$receiver.tagit("removeAll"),
		a.$controlAttachment.addClass("hide").find("ul").html(""),
		a.$controlCc.addClass("hide").find("input").tagit("removeAll"),
		a.$controlBcc.addClass("hide").find("input").tagit("removeAll"),
		a.$sender.html("").addClass("hide").prev().removeClass("hide")
	}
	function j(a) {
		var c = this;
		b(function (a) {
			c.html(e, a)
		}).done(function () {
			k.call(c, a)
		})
	}
	function k(a) {
		var b = this,
		c = b.$element;
		b.$form = c.find("form"),
		b.$sender = c.find('[name="sender"]'),
		b.$receiver = c.find('[name="receiver"]'),
		b.$subject = c.find('[name="subject"]'),
		b.$controlAttachment = c.find(".control-attachment"),
		b.$content = c.find("textarea"),
		b.$individually = c.find('[name="individually"]'),
		b.$massGroup = c.find('[name="mass-group"]'),
		b.$controlCc = c.find(".control-cc"),
		b.$controlBcc = c.find(".control-bcc"),
		b.$cc = c.find('[name="cc"]'),
		b.$bcc = c.find('[name="bcc"]'),
		b.$names = c.find(".names"),
		g(b.$form, {
			rules : {
				receiver : {
					required : !0,
					emails : !0
				},
				subject : {
					required : !0
				}
			}
		}),
		a.resolve()
	}
	var l = {
		SEND_EMAIL : "/rest/floating/add",
		SIGNATURE : "/rest/data/userconfig/?user_id="
	},
	m = {
		email : h.t("Private email"),
		email1 : h.t("Work email"),
		email2 : h.t("Other")
	};
	return d.extend({
		"sig/initialize" : function (a, b) {
			j.call(this, b)
		},
		"hub/modal/add-floating/show" : function (a, b, c) {
			var d = this,
			e = d.$element;
			c ? d.publish("modal/register/cleanup") : (i.call(d), d._onSuccess = b.onSuccess, d._forceRefresh = !0, d._templateVariable = b.templateVariable || {}, d._sender = b.sender, d.$names.text(b.names.join(", ")), d._sender && (d._sender.forEach(function (a) {
						d.$sender.append('<option value="' + a.id + '">' + a.name + "</option>")
					}), d.$sender.removeClass("hide").val(d.userId), d.$sender.prev().addClass("hide")), d._attachment = b.attachment ? b.attachment : null, d._checkAttachment = b.checkAttachment ? b.checkAttachment : !1),
			e.modal({
				show : !0,
				backdrop : "static"
			})
		},
		"hub/email/template/switch" : function (a, b) {
			var c = this;
			c.$element.is(":hidden") || (c._templateId = b.id, c.$subject.val(b.title))
		},
		"hub/receive/floating-attachments" : function (a, b) {
			for (var c, d = this, e = "", f = 0, g = b.length; g > f; f++)
				c = b[f], d.$controlAttachment.find('[data-id="' + c.id + '"]').length || (e += '<li data-external="' + c.external_id + '" data-id="' + c.id + '">' + c.type + '<span class="file-type-icon ' + c.ext + '">' + c.name + '</span> <a href="#" data-action="attachment/remove"><span class="icon-remove-small"></span></a></li>');
			e.length && d.$controlAttachment.removeClass("hide").find("ul").append(e)
		},
		"dom/action.click.change" : a.noop,
		"dom/action/attachment/remove" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = window.confirm("确定要删除此附件吗？");
			e && a(c.target).closest("li").remove(),
			d.$controlAttachment.find("ul li").length || d.$controlAttachment.addClass("hide")
		},
		"dom/action/send.click" : function (c, d) {
			var e = this,
			g = a(d.target),
			h = e.$element;
			if (e.$form.valid()) {
				if (!e.$controlAttachment.find("li").length && !window.confirm("附件中还未选择人才的推荐报告！请点击“确定”继续发送给客户，或者点击“取消”返回选择附件。"))
					return !1;
				var i = function () {
					var b = [];
					return e._attachment.forEach(function (c) {
						var d = [];
						e.$controlAttachment.find('li[data-external="' + c.id + '"]').each(function () {
							d.push(a(this).data("id"))
						}),
						b.push({
							id : c.id,
							attachment_ids : d
						})
					}),
					b
				}
				(),
				j = {
					content : CKEDITOR.instances[e.$content.attr("name")].getData(),
					subject : e.$subject.val(),
					candidates : i,
					to : e.$receiver.val().replace(/\[.*\] /gi, ""),
					individually : e.$individually.is(":checked"),
					template_id : e._templateId,
					jobsubmission_id : e._jobsubmissionId,
					cc : e.$cc.val().replace(/\[.*\] /gi, ""),
					bcc : e.$bcc.val().replace(/\[.*\] /gi, "")
				};
				e._sender && (j.user_id = e.$sender.val()),
				e.publish("ajax", {
					url : l.SEND_EMAIL,
					data : {
						data : JSON.stringify(j)
					},
					type : "post",
					dataType : "json"
				}, b().done(function (a) {
						a.status ? (f.alert("success", "Floating邮件发送成功!"), e._onSuccess && e._onSuccess(a)) : f.alert("error", a.message)
					}), g),
				h.modal("hide")
			}
		},
		"dom/action/choose.click" : function (a, b) {
			b.preventDefault();
			var c = this;
			c.publish("modal/unregister/cleanup"),
			c.$element.modal("hide"),
			c.publish("modal/floating-attachments/show", c._attachment, c._forceRefresh, "modal/add-floating/show"),
			c._forceRefresh = !1
		},
		"dom/action/switch/sender.change" : function (b, c) {
			var d = this,
			e = a(c.target),
			f = e.val();
			d.publish("editor/change/userid", f)
		},
		"dom/action/dropdown.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = d.closest(".dropdown"),
			f = e.find(".dropdown-menu"),
			g = a(document);
			e.toggleClass("open"),
			g.on("click.filter.dropdown", function (b) {
				var c = a(b.target);
				c.closest(f).length || (e.removeClass("open"), g.off("click.filter.dropdown"))
			})
		},
		"dom/action/mass/add.click" : function (c, d) {
			d.preventDefault();
			var e = this,
			g = a(d.target),
			h = "/rest/candidate/list?<query>&paginate_by=200&type=contact",
			i = e.$massGroup.val(),
			j = g.closest(".dropdown");
			i && (j.removeClass("open"), e.publish("ajax", {
					url : h.replace("<query>", "folder_id=" + i)
				}, b().done(function (a) {
						var b,
						c,
						d = 0,
						g = a.list.length,
						h = [],
						i = e._emailType ? e._emailType[0] : "";
						for (d; g > d; d++)
							b = a.list[d], c = [b.englishName, b.chineseName].join(" ").trim(), (!e._emailType || e._emailType.length > 1) && (b.email ? i = "email" : b.email1 ? i = "email1" : b.email2 && (i = "email2")), b[i] ? e.$receiver.tagit("createTag", '"' + c + '" [' + m[i] + "] <" + b[i] + ">") : h.push('<a href="/candidate#detail!id=' + b.id + '" target="_blank">' + c + "</a>");
						h.length && (e._emailType.length > 1 ? f.alert("info", "以下人才没有任何邮箱:<br>" + h.join(", ")) : f.alert("info", "以下人才没有" + m[i] + "邮箱:<br>" + h.join(", ")))
					})))
		},
		"dom/action/cc.click" : function (b, c) {
			c.preventDefault();
			var d = this;
			a(c.target),
			d.$controlCc.hasClass("hide") ? d.$controlCc.removeClass("hide") : d.$controlCc.addClass("hide").find("input").tagit("removeAll")
		},
		"dom/action/bcc.click" : function (b, c) {
			c.preventDefault();
			var d = this;
			a(c.target),
			d.$controlBcc.hasClass("hide") ? d.$controlBcc.removeClass("hide") : d.$controlBcc.addClass("hide").find("input").tagit("removeAll")
		},
		"dom/action/email/type.change" : function (b, c) {
			var d = this,
			e = a(c.target),
			f = e.val(),
			g = f.split(",");
			this._emailType = g,
			d.$receiver.data("emailType", g),
			d.$cc.data("emailType", g),
			d.$bcc.data("emailType", g)
		}
	})
}), define("app/widget/modal/add-floating/receiver", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "shared/helper/utils", "shared/helper/blurb", "jquery.tagit"], function (a, b, c, d, e) {
	function f(b) {
		var d = this,
		e = {
			tagLimit : d.tagLimit
		};
		a.extend(!0, e, {
			allowSpaces : !0,
			autocomplete : {
				source : function (a, b) {
					var e = this,
					f = e.element.tagit("assignedTags");
					d.publish("ajax", {
						url : g + window.encodeURIComponent(a.term)
					}, c().done(function (a) {
							var c = [],
							e = d.$element.data("emailType"),
							g = i;
							e && (g = e),
							a.forEach(function (a) {
								var b,
								d = [a.englishName, a.chineseName].join(" ").trim();
								g.forEach(function (e) {
									a[e] && (b = '"' + d + '" [' + h[e] + "]" + " <" + a[e] + ">", f.indexOf(b) < 0 && c.push(b))
								})
							}),
							b(c)
						}))
				}
			},
			beforeTagAdded : function (a, b) {
				return b.fromAutocomplete ? void 0 : !1
			}
		}),
		d.$element.tagit(e),
		b.resolve()
	}
	var g = "/rest/candidate/email_autocomplete?type=contact&email=",
	h = {
		email : e.t("Private email"),
		email1 : e.t("Work email"),
		email2 : e.t("Other")
	},
	i = ["email", "email1", "email2"];
	return b.extend(function () {
		this.tagLimit = this.$element.data("max")
	}, {
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/add-note/main.html", [], function () {
	return function () {
		for (var a = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3 data-weave="shared/helper/translation" data-i18n="Notes"></h3>\n</div>\n<div class="modal-body">\n    <form action="#" class="form-horizontal" id="add-note-form">\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Type"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <select name="category" class="input-medium required" data-action="note/type">\n                    <option value="" data-weave="shared/helper/translation" data-i18n="Please select"></option>\n                </select>\n            </div>\n        </div>\n\n        <div class="control-group control-group-question hide">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Note"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls text_line controls-question">\n            </div>\n        </div>\n        \n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Status"></span>\n            </label>\n            <div class="controls">\n                <select name="status" class="input-medium"></select>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Event Date"></span>\n            </label>\n            <div class="controls">\n                <input name="date" type="text" class="input-small required dateISO" data-weave="shared/widget/common/date-picker/main">\n                <select name="hour" class="input-mini">\n                    ', b = 0, c = 24; c > b; b++)
			a += '\n                    <option value="' + b + '">' + b + "</option>\n                    ";
		a += '\n                </select>\n                <select name="minute" class="input-mini">\n                    ';
		for (var b = 0, c = 60; c > b; b += 5)
			a += '\n                    <option value="' + b + '">' + b + "</option>\n                    ";
		return a += '\n                </select>\n            </div>\n        </div>\n    </form>\n</div>\n<div class="modal-footer">\n    <a href="#" class="btn pull-left" data-action="zen/mode" data-weave="shared/helper/translation" data-i18n="Fullscreen"></a>\n    <button class="btn btn-primary" data-action="save" data-weave="shared/helper/translation" data-i18n="Save" form="add-note-form"></button>\n</div>'
	}
}), define("troopjs-requirejs/template!app/widget/modal/add-note/questions.html", [], function () {
	return function (a) {
		var b = "",
		c = function () {
			return parseInt(1e5 * Math.random(), 10)
		};
		b += "\n";
		for (var d = 0, e = a.length; e > d; d++)
			b += "\n", a[d].field && (b += "\n<div>" + a[d].field + "</div>\n"), b += '\n\n<div class="sepH_b">\n    <textarea cols="30" rows="1" name="record-' + c() + '" class="span655 required" data-weave="shared/widget/common/autosize/main"></textarea>\n</div>\n\n';
		return b
	}
}), define("troopjs-requirejs/template!app/widget/modal/add-note/status.html", [], function () {
	return function (a) {
		for (var b = '<option value="" data-weave="shared/helper/translation" data-i18n="Please select"></option>\n', c = 0, d = a.length; d > c; c++)
			b += '\n<option value="' + a[c].code + '">' + a[c].value + "</option>\n";
		return b
	}
}), define("app/widget/modal/add-note/main", ["jquery", "shared/widget/modal/base", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "template!./questions.html", "template!./status.html", "shared/helper/utils", "shared/helper/validate", "shared/helper/blurb"], function (a, b, c, d, e, f, g, h, i, j) {
	function k() {
		var a = localStorage.getItem(s);
		return a
	}
	function l() {
		var a = this,
		b = k();
		if (b && (b = JSON.parse(b), b.external_id === a.id && b.external_type === a.externalType && b.jobsubmission_id === a.jobsubmissionId && (a.$category.val(b.category).trigger("change"), b.content.forEach(function (b, c) {
						a.$element.find("textarea").eq(c).val(b)
					}), b.status && a.$status.val(b.status), b.date))) {
			var c = new Date(b.date);
			a.$date.val(c.getFullYear() + "-" + (parseInt(c.getMonth(), 10) + 1) + "-" + c.getDate()),
			a.$hour.val(c.getHours()),
			a.$minute.val(c.getMinutes())
		}
	}
	function m() {
		localStorage.removeItem(s)
	}
	function n() {
		var b = this;
		b._saveTimeId = setInterval(function () {
				var c = [];
				b.$element.find("textarea").each(function () {
					c.push(a(this).val())
				});
				var d = {
					external_id : b.id,
					content : c,
					category : b.$category.val(),
					status : b.$status.val(),
					external_type : b.externalType,
					jobsubmission_id : b.jobsubmissionId,
					date : b.$date.val() + " " + b.$hour.val() + ":" + b.$minute.val()
				};
				localStorage.setItem(s, JSON.stringify(d))
			}, 300)
	}
	function o() {
		var a = this;
		m(),
		clearInterval(a._saveTimeId)
	}
	function p() {
		var a = this;
		c(function (b) {
			a.html(e, b)
		}).done(function () {
			q.call(a)
		})
	}
	function q() {
		var b = this,
		c = b.$element;
		b.$form = c.find("form"),
		b.$category = c.find('[name="category"]'),
		b.$status = c.find('[name="status"]'),
		b.$controlGroupQeustion = c.find(".control-group-question"),
		b.$controlsQuestion = c.find(".controls-question"),
		b.$date = c.find('[name="date"]'),
		b.$hour = c.find('[name="hour"]'),
		b.$minute = c.find('[name="minute"]'),
		i(b.$form, {
			rules : {
				category : {
					required : !0
				}
			}
		}),
		c.on("hidden", function () {
			o.call(b),
			b.$category.prop("disabled", !1).find("option:eq(0)").prop("selected", !0),
			b.$controlGroupQeustion.addClass("hide"),
			b.$category.children().not(":eq(0)").remove()
		}),
		c.on("show", function () {
			b.data && b.data.items && b.$element.find("textarea").each(function (c) {
				a(this).val(b.data.items[c].value)
			})
		})
	}
	var r,
	s = "modal/add-note",
	t = {
		ADD : "/rest/note/add",
		CATEGORY : "/rest/data/options?type=<type>",
		STATUS : "/rest/data/options?type=<type>"
	},
	u = {
		HAS_CONTENT : j.t("Do you want to change type? It will clear all you notes.")
	};
	return b.extend({
		"hub:memory/context" : function (a, b) {
			var c = this;
			c._userId = b.user.id,
			p.call(c)
		},
		"hub/modal/add-note/show" : function (b, e) {
			var f = this,
			h = f.$element,
			i = [],
			j = c();
			if (f._userId) {
				if (f.externalType = e.externalType, f.optionType = e.optionType, f.id = e.id, f.onSuccess = e.onSuccess, f.data = e.data, f.jobsubmissionId = e.jobsubmissionId || "", f.data ? (f._json = [f.data.category], f.$category.append('<option value="' + f.data.category.code + '" data-index="' + 0 + '">' + f.data.category.value + "</option>")) : (i.push(j.promise()), f.publish("ajax", {
							url : t.CATEGORY.replace("<type>", f.optionType)
						}, j.done(function (a) {
								f._json = a,
								f._json.forEach(function (a, b) {
									f.$category.append('<option value="' + a.code + '" data-index="' + b + '">' + a.value + "</option>")
								})
							}))), "candidate" === f.externalType) {
					f.$status.closest(".control-group").removeClass("hide");
					var k = c(),
					m = "jobsubmission_note_category" === f.optionType ? "jobsubmission_status" : "candidate_status";
					i.push(k.promise()),
					f.publish("ajax", {
						url : t.STATUS.replace("<type>", m)
					}, c().done(function (b) {
							var d = a(g(b));
							d.filter("[data-weave]").weave(c().done(function () {
									f.$status.html(d),
									k.resolve()
								}))
						})),
					f.$element.find('[data-action="zen/mode"]').removeClass("hide")
				} else
					f.$status.empty().closest(".control-group").addClass("hide"), f.$element.find('[data-action="zen/mode"]').addClass("hide");
				d.apply(a, i).done(function () {
					if (f.data) {
						if (f.$category.val(f.data.category.code).trigger("change").prop("disabled", !0), f.data.status && f.$status.val(f.data.status.code), f.data.date) {
							var a = new Date(f.data.date);
							f.$date.val(a.getFullYear() + "-" + (parseInt(a.getMonth(), 10) + 1) + "-" + a.getDate()),
							f.$hour.val(a.getHours()),
							f.$minute.val(a.getMinutes())
						}
						f.jobsubmissionId = f.data.jobsubmission ? f.data.jobsubmission : ""
					} else {
						var b = new Date;
						f.$date.val(b.getFullYear() + "-" + (b.getMonth() + 1) + "-" + b.getDate()),
						f.$hour.val(b.getHours()),
						f.$minute.val(5 * Math.floor(b.getMinutes() / 5))
					}
					l.call(f),
					n.call(f),
					h.modal({
						show : !0,
						backdrop : "static"
					})
				})
			}
		},
		"hub/modal/add-note/update" : function (b, c) {
			var d = this,
			e = a("body");
			e.removeClass("add-note-zen-mode"),
			d.$category.val(c.category).trigger("change"),
			d.$status.val(c.status),
			c.content.forEach(function (a, b) {
				d.$element.find("textarea").eq(b).val(a)
			});
			var f = new Date(c.date);
			d.$date.val(f.getFullYear() + "-" + (parseInt(f.getMonth(), 10) + 1) + "-" + f.getDate()),
			d.$hour.val(f.getHours()),
			d.$minute.val(f.getMinutes())
		},
		"hub/modal/add-note/hide" : function () {
			var b = this,
			c = a("body");
			c.removeClass("add-note-zen-mode"),
			b.$element.modal("hide")
		},
		"dom/action.click.change" : a.noop,
		"dom/action/save.click" : function (b, d) {
			d.preventDefault();
			var e = this,
			f = a(d.target),
			g = [];
			if (e.$form.valid()) {
				e.$element.find("textarea").each(function () {
					g.push(a(this).val())
				});
				var i = {
					external_id : e.id,
					content : g,
					category : e.$category.val(),
					status : e.$status.val(),
					external_type : e.externalType,
					jobsubmission_id : e.jobsubmissionId,
					date : e.$date.val() + " " + e.$hour.val() + ":" + e.$minute.val()
				};
				e.data && (i.id = e.data.id),
				e.publish("ajax", {
					url : t.ADD,
					data : {
						data : JSON.stringify(i)
					},
					type : "POST"
				}, c().done(function (a) {
						a.status ? (e.$element.modal("hide"), h.alert("success", "编辑备注成功!"), e.onSuccess && e.onSuccess(a)) : h.alert("error", a.message)
					}), f)
			}
		},
		"dom/action/note/type.change" : function (b, d) {
			var e,
			g = this,
			h = a(d.target),
			i = h.find(":selected").data("index"),
			j = !1;
			if (g.$element.find(".controls-question textarea").each(function () {
					a(this).val().length && (j = !0)
				}), !j || (e = window.confirm(u.HAS_CONTENT))) {
				if (i === r)
					return g.$controlGroupQeustion.addClass("hide"), void 0;
				var k = a(f(JSON.parse(g._json[i].ext)));
				k.find("[data-weave]").weave(c(function () {
						g.$controlsQuestion.html(k),
						g.$controlGroupQeustion.removeClass("hide")
					}))
			}
		},
		"dom/action/zen/mode.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a("body"),
			f = a(window).height(),
			g = a('<div class="add-note-fullscreen"></div>'),
			h = [];
			d.$element.find("textarea").each(function () {
				h.push(a(this).val())
			});
			var i = {
				external_id : d.id,
				content : h,
				$category : d.$category.clone(),
				$status : d.$status.clone(),
				category : d.$category.val(),
				status : d.$status.val(),
				external_type : d.externalType,
				jobsubmission_id : d.jobsubmissionId,
				date : d.$date.val() + " " + d.$hour.val() + ":" + d.$minute.val(),
				onSuccess : d.onSuccess
			};
			d.data && (i.id = d.data.id),
			g.css({
				height : f
			}),
			e.prepend(g),
			g.data("json", i).data("category", d._json).attr("data-weave", "app/widget/modal/add-note/zen(json, category)").weave(),
			e.addClass("add-note-zen-mode")
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/add-note/zen.html", [], function () {
	return function (a) {
		var b = '<div class="actions">\n    <button class="btn btn-primary" data-action="save" data-weave="shared/helper/translation" data-i18n="Save" form="add-note-zen-form"></button>\n    <a href="#" class="btn" data-action="close" data-weave="shared/helper/translation" data-i18n="Back"></a>\n</div>\n<form action="#" class="form-horizontal" id="add-note-zen-form">\n    ';
		if (a.length) {
			b += '\n    <div class="control-group">\n        <label class="control-label" data-weave="shared/helper/translation" data-i18n="Attachment"></label>\n        <div class="controls text_line">\n                ';
			for (var c = 0, d = a.length; d > c; c++) {
				b += "\n                ";
				var e = a[c];
				b += "\n                ",
				b += e.tag ? '\n                <span class="label" style="background-color: ' + e.tag.color + ';">' + e.tag.value + "</span>\n                " : '\n                <span class="label"  data-weave="shared/helper/translation" data-i18n="Unknown"></span>\n                ',
				b += '\n                <a href="#" class="file-type-icon ' + e.ext.toLowerCase() + ' view" data-action="preview(' + e.uuidname + ", '" + e.ext + "')\">" + e.originname + "</a>\n                <br>\n                "
			}
			b += "\n            </ul>\n        </div>\n    </div>\n    "
		}
		b += '\n\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Type"></span>\n            <span class="f_req">*</span>\n        </label>\n        <div class="controls">\n            <select name="category" class="input-medium required" data-action="note/type">\n            </select>\n        </div>\n    </div>\n\n    <div class="control-group control-group-question hide">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Note"></span>\n            <span class="f_req">*</span>\n        </label>\n        <div class="controls text_line controls-question">\n        </div>\n    </div>\n    \n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Status"></span>\n        </label>\n        <div class="controls">\n            <select name="status" class="input-medium"></select>\n        </div>\n    </div>\n\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Event Date"></span>\n        </label>\n        <div class="controls">\n            <input name="date" type="text" class="input-small required dateISO" data-weave="shared/widget/common/date-picker/main">\n            <select name="hour" class="input-mini">\n                ';
		for (var c = 0, d = 24; d > c; c++)
			b += '\n                <option value="' + c + '">' + c + "</option>\n                ";
		b += '\n            </select>\n            <select name="minute" class="input-mini">\n                ';
		for (var c = 0, d = 60; d > c; c += 5)
			b += '\n                <option value="' + c + '">' + c + "</option>\n                ";
		return b += "\n            </select>\n        </div>\n    </div>\n</form>"
	}
}), define("app/widget/modal/add-note/zen", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./zen.html", "template!./questions.html", "shared/helper/utils", "shared/helper/validate"], function (a, b, c, d, e, f, g) {
	function h(a) {
		var b = this;
		b.publish("slide/helper/close"),
		b.publish("ajax", {
			url : k.ATTACHMENT + b._json.external_id
		}, c().done(function (c) {
				b.html(d, c, a)
			}))
	}
	function i() {
		var b = this,
		c = b.$element,
		d = a(window);
		b.$form = c.find("form"),
		b.$category = c.find('[name="category"]'),
		b.$status = c.find('[name="status"]'),
		b.$controlGroupQeustion = c.find(".control-group-question"),
		b.$controlsQuestion = c.find(".controls-question"),
		b.$date = c.find('[name="date"]'),
		b.$hour = c.find('[name="hour"]'),
		b.$minute = c.find('[name="minute"]'),
		b.$category.append(b._json.$category.children()).val(b._json.category),
		b.$category.trigger("change"),
		b.$status.append(b._json.$status.children()).val(b._json.status),
		b.$category.prop("disabled", b._json.$category.is(":disabled")),
		b._json.content.forEach(function (a, c) {
			b.$element.find("textarea").eq(c).val(a)
		});
		var e = new Date(b._json.date);
		b.$date.val(e.getFullYear() + "-" + (parseInt(e.getMonth(), 10) + 1) + "-" + e.getDate()),
		b.$hour.val(e.getHours()),
		b.$minute.val(e.getMinutes()),
		d.resize(function () {
			b.$element.css("height", d.height())
		}),
		g(b.$form, {
			rules : {
				category : {
					required : !0
				}
			}
		})
	}
	var j,
	k = {
		ADD : "/rest/note/add",
		ATTACHMENT : "/rest/file/list/candidate/"
	};
	return b.extend(function (a, b, c, d) {
		this._json = c,
		this._category = d
	}, {
		"sig/initialize" : function (a, b) {
			h.call(this, b)
		},
		"sig/start" : function (a, b) {
			i.call(this, b)
		},
		"dom/action.click.change" : a.noop,
		"dom/action/save.click" : function (b, d) {
			d.preventDefault();
			var e = this,
			g = a(d.target),
			h = [];
			if (e.$form.valid()) {
				e.$element.find("textarea").each(function () {
					h.push(a(this).val())
				});
				var i = {
					external_id : e._json.external_id,
					content : h,
					category : e.$category.val(),
					status : e.$status.val(),
					external_type : e._json.external_type,
					jobsubmission_id : e._json.jobsubmission_id,
					date : e.$date.val() + " " + e.$hour.val() + ":" + e.$minute.val()
				};
				e.data && (i.id = e.data.id),
				e.publish("ajax", {
					url : k.ADD,
					data : {
						data : JSON.stringify(i)
					},
					type : "POST"
				}, c().done(function (a) {
						e.$element.modal("hide"),
						a.status ? (f.alert("success", "编辑备注成功!"), e._json.onSuccess && e._json.onSuccess(a), e.publish("modal/add-note/hide"), e.publish("slide/helper/close"), e.$element.remove()) : f.alert("error", a.message)
					}), g)
			}
		},
		"dom/action/note/type.change" : function (b, d) {
			var f = this,
			g = a(d.target),
			h = g.find(":selected").data("index");
			if (h === j)
				return f.$controlGroupQeustion.addClass("hide"), void 0;
			var i = a(e(JSON.parse(f._category[h].ext)));
			i.find("[data-weave]").weave(c(function () {
					f.$controlsQuestion.html(i),
					f.$controlGroupQeustion.removeClass("hide")
				}))
		},
		"dom/action/close.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = [];
			d.$element.find("textarea").each(function () {
				e.push(a(this).val())
			});
			var f = {
				content : e,
				category : d.$category.val(),
				status : d.$status.val(),
				date : d.$date.val() + " " + d.$hour.val() + ":" + d.$minute.val()
			};
			d.publish("slide/helper/close"),
			d.publish("modal/add-note/update", f),
			this.$element.remove()
		},
		"dom/action/preview.click" : function (b, c, d, e) {
			c.preventDefault();
			var f = this;
			a(c.target),
			f.publish("slide-helper/attachment/reload", d, null, e)
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/add-shortlist/main.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3 data-weave="shared/helper/translation" data-i18n="Shortlist"></h3>\n</div>\n<div class="modal-body">\n    <form action="#" class="form-horizontal" id="add-shortlist-form">\n        \n        <div class="control-group">\n            <label class="control-label label-people" data-weave="shared/helper/translation" data-i18n="Candidate"></label>\n            <label class="control-label label-company" data-weave="shared/helper/translation" data-i18n="Company"></label>\n            <div class="controls text_line">\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label for="" class="control-label" data-weave="shared/helper/translation" data-i18n="Live Jobs"></label>\n            <div class="controls">\n                <p class="clearfix">\n                    <select name="job" class="span4"></select>\n                </p>\n            </div>\n        </div>\n    </form>\n    \n</div>\n<div class="modal-footer">\n    <button class="btn btn-primary" data-action="save.click" data-weave="shared/helper/translation" data-i18n="Shortlist" form="add-shortlist-form"></button>\n</div>';
		return a
	}
}), define("troopjs-requirejs/template!app/widget/modal/add-shortlist/job-options.html", [], function () {
	return function (a) {
		for (var b = "", c = 0, d = a.length; d > c; c++)
			b += "\n", b += a[c].inshortlist || a[c].intargetcompany ? '\n<option value="' + a[c].id + '" disabled="disabled" style="color:#ccc;">' + a[c].jobTitle + " (ID:" + a[c].id + ") of <strong>" + a[c].client.name + "</strong></option>\n" : '\n<option value="' + a[c].id + '">' + a[c].jobTitle + " (ID:" + a[c].id + ") of <strong>" + a[c].client.name + "</strong></option>\n", b += "\n";
		return b
	}
}), define("app/widget/modal/add-shortlist/main", ["jquery", "shared/widget/modal/base", "troopjs-utils/deferred", "template!./main.html", "template!./job-options.html", "shared/helper/utils", "shared/helper/validate", "app/widget/common/select2/main"], function (a, b, c, d, e, f, g) {
	function h(a) {
		var b = this;
		b.html(d, b._json, a)
	}
	function i(a) {
		var b = this;
		b.$job = b.$element.find('[name="job"]'),
		b.$labelPeople = b.$element.find(".label-people"),
		b.$labelCompany = b.$element.find(".label-company"),
		b.$form = b.$element.find("form"),
		g(b.$form, {
			rules : {
				job : {
					required : !0
				}
			}
		}),
		b.$element.on("hidden", function () {
			b.$job.children().not(":eq(0)").remove(),
			b.$job.unweave()
		}),
		a.resolve()
	}
	var j = {
		JOBLIST : "rest/joborder/livejobs?<type>=<id>",
		ADD_SHORTLIST_COMPANY : "/rest/joborder/<id>/targetcompany/add",
		ADD_SHORTLIST_PEOPLE : "/rest/joborder/<id>/shortlist/add"
	};
	return b.extend({
		"sig/initialize" : function (a, b) {
			h.call(this, b)
		},
		"sig/start" : function (a, b) {
			i.call(this, b)
		},
		"sig/stop" : function (a, b) {
			this.$job.select2("destroy"),
			b.resolve()
		},
		"hub/modal/addshortlist/show" : function (a, b) {
			var c = this,
			d = c.$element,
			e = d.find(".text_line");
			j.JOBLIST,
			c._ids = b.ids,
			c._onSuccess = b.onSuccess,
			c._type = b.type,
			e.text(b.names.join(", ")),
			"people" === c._type ? (c.$job.data("type", "candidate_id"), c.$labelPeople.removeClass("hide"), c.$labelCompany.addClass("hide")) : "company" === c._type && (c.$job.data("type", "client_id"), c.$labelPeople.addClass("hide"), c.$labelCompany.removeClass("hide")),
			1 === c._ids.length ? c.$job.data("typeId", c._ids[0]) : c.$job.data("typeId", ""),
			c.$job.attr("data-weave", "app/widget/common/job-select/main").weave(),
			d.modal("show")
		},
		"dom/action.click" : a.noop,
		"dom/action/save.click" : function (b, d) {
			var e,
			g,
			h = this,
			i = h.$element,
			k = a(d.target),
			l = h.$job.val();
			h.$form.valid() && (l || f.alert("error", "Job Id丢失，请关闭弹出层，重新添加!"), "people" === h._type ? (e = {
						candidate_ids : h._ids
					}, g = j.ADD_SHORTLIST_PEOPLE.replace("<id>", l)) : "company" === h._type && (e = {
						client_ids : h._ids
					}, g = j.ADD_SHORTLIST_COMPANY.replace("<id>", l)), h.publish("ajax", {
					url : g,
					data : {
						data : JSON.stringify(e)
					},
					type : "post"
				}, c().done(function (a) {
						i.modal("hide"),
						a.status ? (f.alert("success", "Add shortlist successfully!"), h._onSuccess && h._onSuccess(a)) : f.alert("error", a.message)
					}), k))
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/add-target-company/main.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3 data-weave="shared/helper/translation" data-i18n="Target Company"></h3>\n</div>\n<div class="modal-body">\n\n    <form action="#" class="form-horizontal" id="target-company-form">\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Company"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <input type="text" name="target" class="span4 required">\n            </div>\n        </div>\n    </form>\n</div>\n<div class="modal-footer">\n    <button class="btn btn-danger pull-left hide" data-dismiss="modal" data-action="delete" data-weave="shared/helper/translation" data-i18n="Delete"></button>\n    <button class="btn btn-primary" data-action="save" data-weave="shared/helper/translation" data-i18n="Save" form="target-company-form"></button>\n</div>';
		return a
	}
}), define("app/widget/modal/add-target-company/main", ["jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "template!app/widget/common/company-suggestion/main.html", "shared/helper/utils", "shared/helper/validate", "shared/helper/blurb", "app/widget/common/select2/main"], function (a, b, c, d, e, f, g, h) {
	function i(a) {
		var c = this;
		b(function (a) {
			c.html(d, c._json, a)
		}).done(function () {
			j.call(c, a)
		})
	}
	function j(b) {
		var c = this,
		d = c.$element;
		c.$form = d.find("form"),
		c.$target = d.find('[name="target"]'),
		c.$notes = d.find('[name="notes"]'),
		c.$importance = d.find('[name="importance"]'),
		c.$target.select2({
			placeholder : "请选择",
			minimumInputLength : 1,
			ajax : {
				url : k.CLIENT,
				dataType : "json",
				quietMillis : 100,
				data : function (a, b) {
					return {
						company_name : a,
						page : b
					}
				},
				results : function (a) {
					var b = a.current < a.pages;
					return {
						results : a.list,
						more : b
					}
				}
			},
			initSelection : function (b, c) {
				var d = a(b).val();
				"" !== d && a.ajax(k.CLIENT, {
					data : {
						id : d
					},
					dataType : "json"
				}).done(function (a) {
					a.list.length && c(a.list[0])
				})
			},
			formatResult : function (a) {
				return a.ctype = l[a.type],
				e(a)
			},
			formatSelection : function (a, b) {
				b.text(a.name)
			},
			escapeMarkup : function (a) {
				return a
			}
		}),
		g(c.$form, {}),
		d.on("hidden", function () {
			c.$target.val("").trigger("change")
		}),
		b.resolve()
	}
	var k = {
		LIST : "/rest/client/list?company_name=",
		TARGETS : "/rest/joborder/<jobid>/targetcompany/add",
		CLIENT : "/rest/client/list"
	},
	l = {
		client : h.t("client company"),
		bding : h.t("bding company"),
		normal : "",
		generated : ""
	};
	return c.extend({
		"sig/initialize" : function (a, b) {
			i.call(this, b)
		},
		"hub/modal/add-target-company/show" : function (a, b) {
			var c = this,
			d = c.$element;
			c._jobid = b.jobid,
			c._onSuccess = b.onSuccess,
			c._data = b.data,
			c._data && (c.$notes.val(c._data.note), c.$importance.val(c._data.importance), c.$target.select2("val", c._data.client.id)),
			d.modal("show")
		},
		"dom/action.click" : a.noop,
		"dom/action/save.click" : function (c, d) {
			d.preventDefault();
			var e = this,
			g = e.$element,
			h = a(d.targt);
			if (e.$form.valid()) {
				var i = {
					client_ids : [e.$target.val()],
					note : e.$notes.val(),
					importance : e.$importance.val()
				};
				e.data && (i.id = e.data.id),
				g.modal("hide"),
				e.publish("ajax", {
					url : k.TARGETS.replace("<jobid>", e._jobid),
					data : {
						data : JSON.stringify(i)
					},
					type : "post"
				}, b().done(function (a) {
						g.modal("hide"),
						a.status ? (f.alert("success", "添加成功"), e._onSuccess && e._onSuccess()) : f.alert("error", a.message)
					}), h)
			}
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/add-task/main.html", [], function () {
	return function (a) {
		for (var b = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3>\n        <span data-weave="shared/helper/translation" data-i18n="Add Task"></span> - <span class="name"></span>\n    </h3>\n</div>\n<div class="modal-body">\n    <form action="#" class="form-horizontal" id="add-task-form">\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Date"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <input name="date" type="text" class="input-small required dateISO" data-weave="shared/widget/common/date-picker/main">\n                <select name="hour" class="input-mini">\n                    ', c = 0, d = 24; d > c; c++)
			b += '\n                    <option value="' + c + '">' + c + "</option>\n                    ";
		b += '\n                </select>\n                <select name="minute" class="input-mini">\n                    ';
		for (var c = 0, d = 60; d > c; c += 5)
			b += '\n                    <option value="' + c + '">' + c + "</option>\n                    ";
		b += '\n                </select>\n                <label class="checkbox inline">\n                    <input type="checkbox" name="allday" data-action="allday">\n                    <span data-weave="shared/helper/translation" data-i18n="All day"></span>\n                </label>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Category"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <select name="category" class="input-medium required">\n                    <option value="" data-weave="shared/helper/translation" data-i18n="Please select"></option>\n                    ';
		for (var c = 0, d = a.length; d > c; c++)
			b += "\n                    ", a[c].is_buildin || (b += '\n                    <option value="' + a[c].code + '">' + a[c].value + "</option>\n                    "), b += "\n                    ";
		return b += '\n                </select>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Notes"></span>\n            </label>\n            <div class="controls">\n                <textarea cols="30" rows="1" name="notes" class="span4" data-weave="shared/widget/common/autosize/main"></textarea>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Reminder"></span>\n            </label>\n            <div class="controls">\n                <span data-weave="shared/helper/translation" data-i18n="In advance"></span>\n                <select class="input-small" name="reminder">\n                    <option value="" data-weave="shared/helper/translation" data-i18n="Please select"></option>\n                    <option value="0" data-weave="shared/helper/translation" data-i18n="0 分钟"></option>\n                    <option value="-5" data-weave="shared/helper/translation" data-i18n="5 分钟"></option>\n                    <option value="-10" data-weave="shared/helper/translation" data-i18n="10 分钟"></option>\n                    <option value="-15" data-weave="shared/helper/translation" data-i18n="15 分钟"></option>\n                    <option value="-30" data-weave="shared/helper/translation" data-i18n="30 分钟"></option>\n                    <option value="-60" data-weave="shared/helper/translation" data-i18n="1 小时"></option>\n                    <option value="-120" data-weave="shared/helper/translation" data-i18n="2 小时"></option>\n                    <option value="-180" data-weave="shared/helper/translation" data-i18n="3 小时"></option>\n                    <option value="-240" data-weave="shared/helper/translation" data-i18n="4 小时"></option>\n                    <option value="-300" data-weave="shared/helper/translation" data-i18n="5 小时"></option>\n                    <option value="-360" data-weave="shared/helper/translation" data-i18n="6 小时"></option>\n                </select>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Participant"></span>\n            </label>\n            <div class="controls">\n                <div class="span4">\n                    <select multiple name="participant" class="span4 required" data-weave="shared/widget/common/user-list/main">\n                    </select>\n                </div>\n            </div>\n        </div>\n\n        <div class="control-group control-creator hide">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Creator"></span>\n            </label>\n\n            <div class="controls text_line">\n            </div>\n        </div>\n\n    </form>\n\n</div>\n<div class="modal-footer">\n    <button class="btn btn-primary" data-action="save.click" data-weave="shared/helper/translation" data-i18n="Save" form="add-task-form"></button>\n</div>'
	}
}), define("app/widget/modal/add-task/main", ["jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "shared/helper/utils", "shared/helper/validate"], function (a, b, c, d, e, f) {
	function g() {
		var a = this;
		a.publish("ajax", {
			url : i.CATEGORY
		}, b().done(function (c) {
				a._json = c,
				b(function (b) {
					a.html(d, a._json, b)
				}).done(function () {
					h.call(a)
				})
			}))
	}
	function h() {
		var a = this,
		b = a.$element;
		b.find(".modal-footer button"),
		a.$form = b.find("form"),
		a.$category = b.find("[name=category]"),
		a.$date = b.find('[name="date"]'),
		a.$hour = b.find('[name="hour"]'),
		a.$minute = b.find('[name="minute"]'),
		a.$notes = b.find('[name="notes"]'),
		a.$allday = b.find('[name="allday"]'),
		a.$controlCreator = b.find(".control-creator"),
		a.$participant = b.find('[name="participant"]'),
		a.$name = b.find(".name"),
		a.$reminder = b.find('[name="reminder"]'),
		f(a.$form, {
			rules : {
				notes : {
					maxlength : 1e3
				}
			}
		}),
		b.on("hidden", function () {
			a.$controlCreator.addClass("hide"),
			a.$controlCreator.addClass("hide").find(".text_line").empty(),
			a.$name.empty(),
			a.$allday.prop("checked", !1).closest(".controls").find("select").removeClass("hide")
		})
	}
	var i = {
		ADD : "/rest/todo/add",
		CATEGORY : "/rest/data/options?type=todo_category"
	};
	return c.extend({
		"hub:memory/context" : function (a, b) {
			var c = this;
			c.userId = b.user.id,
			g.call(this)
		},
		"hub/modal/add/task/show" : function (a, b) {
			var c = this,
			d = c.$element;
			d.find(".modal-footer button");
			var e;
			if (c._type = b.type, c._id = b.id, c._onSucess = b.onSuccess, c._data = b.data, b.name && c.$name.text(b.name), c._data) {
				if (c._data.allday && c.$allday.trigger("click"), c.$notes.val(c._data.content || ""), c._data.category && c.$category.val(c._data.category.code || ""), e = new Date(c._data.date), c.$date.val(e.getFullYear() + "-" + (parseInt(e.getMonth(), 10) + 1) + "-" + e.getDate()), c.$hour.val(e.getHours()), c.$minute.val(e.getMinutes()), c.$reminder.val(c._data.delta), c._data.addedBy && c.$controlCreator.removeClass("hide").find(".text_line").append('<a href="#user/preview#' + c._data.addedBy.id + '" data-action="profile/open">' + c._data.addedBy.englishName + "</a>"), c._data.users) {
					var f = [];
					c._data.users.forEach(function (a) {
						f.push(a.id)
					}),
					c.$participant.val(f).trigger("change")
				}
			} else {
				c.$reminder.val(-10),
				c.$participant.val(c.userId).trigger("change");
				var g = new Date;
				c.$date.val(g.getFullYear() + "-" + (g.getMonth() + 1) + "-" + g.getDate()),
				c.$hour.val(g.getHours()),
				c.$minute.val(5 * Math.floor(g.getMinutes() / 5))
			}
			d.modal("show")
		},
		"dom/action.click.change" : a.noop,
		"dom/action/save.click" : function (c, d) {
			var f = this,
			g = f.$element,
			h = a(d.target);
			!function () {
				var b = [];
				return f.$element.find('[name="user"]').each(function () {
					b.push(a(this).val())
				}),
				b
			}
			();
			var j = {
				category : f.$category.val(),
				content : f.$notes.val(),
				date : f.$date.val() + " " + f.$hour.val() + ":" + f.$minute.val(),
				external_type : f._type || null,
				external_id : f._id || null,
				allday : f.$allday.is(":checked"),
				users : f.$participant.val(),
				delta : f.$reminder.val()
			};
			f.$form.valid() && (f._data && f._data.id && (j.id = f._data.id), f.publish("ajax", {
					url : i.ADD,
					data : {
						data : JSON.stringify(j)
					},
					type : "post"
				}, b().done(function (a) {
						g.modal("hide"),
						a.status ? (e.alert("success", "Add todo successfully!"), f._onSucess && f._onSucess(a.data)) : e.alert("error", a.message)
					}), h), g.modal("hide"))
		},
		"dom/action/allday.change" : function (b, c) {
			var d = a(c.target),
			e = d.is(":checked");
			e ? d.closest(".controls").find("select").addClass("hide") : d.closest(".controls").find("select").removeClass("hide")
		},
		"dom/action/open/profile.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			f = d.attr("href");
			e.window({
				url : f,
				name : "User Profile",
				width : "1024"
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/allocation-revenue/main.html", [], function () {
	return function (a) {
		var b = "",
		c = a.userlist || a.assignments;
		a.clientContract || (a.joborder ? a.joborder.clientContract : null);
		var d = this._operator;
		if (b += '\n<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3 data-weave="shared/helper/translation" data-i18n="Revenue Allocation"></h3>\n</div>\n<div class="modal-body">\n    <form action="#" class="form-horizontal" id="allocation-revenue-form">\n        <fieldset>\n            <div class="control-group">\n                <label class="control-label">\n                    <span data-weave="shared/helper/translation" data-i18n="Fees"></span>\n                    <span class="f_req">*</span>\n                </label>\n                <div class="controls">\n                    <input type="text" name="fees" class="input-medium" data-action="update/revenue" data-weave="shared/helper/translation(\'placeholder\')" data-i18n="Currency symbol">\n                    <span class="hint"><span data-weave="shared/helper/translation" data-i18n="Digits only"></span>, <span data-weave="shared/helper/translation" data-i18n="Currency unit"></span> 50000</span>\n                </div>\n            </div>\n\n            <table class="table table-striped table-bordered table-condensed">\n                <colgroup>\n                    <col width="20%" />\n                    <col width="30%" />\n                    <col width="50%" />\n                </colgroup>\n                <thead>\n                    <tr>\n                        <th data-weave="shared/helper/translation" data-i18n="User"></th>\n                        <th data-weave="shared/helper/translation" data-i18n="Role"></th>\n                        <th data-weave="shared/helper/translation" data-i18n="Revenue"></th>\n                    </tr>\n                </thead>\n                <tfoot>\n                    <tr>\n                        <th colspan="2" data-weave="shared/helper/translation" data-i18n="Revenue Allocation"></td>\n                        <td>￥ <span class="revenue-sum"><span></td>\n                    </tr>\n                </tfoot>\n                <tbody>\n                    ', c) {
			b += "\n                    ";
			for (var e = 0, f = c.length; f > e; e++)
				b += "\n                    <tr>\n                        <td>" + c[e].user.englishName + "</td>\n                        <td>" + c[e].type + '</td>\n                        <td>\n                            <div>\n                                <input type="text" name="revenue-percentage-' + e + '" class="span1 revenue-percentage required" placeholder="%" data-action="revenue/percentage">\n                                <input type="text" name="per-revenue-' + e + '" class="span2 per-revenue required" data-action="per/revenue" data-user-id="' + c[e].user.id + '" data-user-type="' + c[e].type + '" value="', (0 == c[e].revenue || c[e].revenue) && (b += "" + c[e].revenue), b += '" data-weave="shared/helper/translation(\'placeholder\')" data-i18n="Currency symbol">\n                            </div>\n                        </td>\n                    </tr>\n                    ';
			b += "\n                    "
		}
		return b += '\n                </tbody>\n            </table>\n        </fieldset>\n    </form>\n    \n</div>\n<div class="modal-footer">\n    ',
		"consultant" === d && a.active && (b += '\n    <div class="pull-left">\n        <button class="btn btn-danger" data-action="invalid/allocation(' + a.id + ')" data-weave="shared/helper/translation" data-i18n="Backout"></button>\n    </div>\n    '),
		b += "\n\n    ",
		a.propertyIsEnumerable("active") && !a.active && (b += '\n    <div class="pull-left">\n        <p class="clearfix">\n            <button class="btn disabled pull-left" data-weave="shared/helper/translation" data-i18n="Backout"></button>\n        </p>\n        \n        <p>\n            <span data-weave="shared/helper/translation" data-i18n="Invalid Reason"></span>: \n            ' + a.invalidReason.value + "\n        </p>\n    </div>\n    "),
		b += "\n    \n    ",
		b += a.propertyIsEnumerable("active") && !a.active || !this._editable ? '\n    <button class="btn" data-weave="shared/helper/translation" data-i18n="Close" data-dismiss="modal"></button>\n    ' : '\n    <button class="btn btn-primary" data-action="save" data-weave="shared/helper/translation" data-i18n="Save" form="allocation-revenue-form"></button>\n    ',
		b += "\n</div>"
	}
}), define("app/widget/modal/allocation-revenue/main", ["compose", "jquery", "troopjs-utils/deferred", "troopjs-utils/when", "shared/widget/modal/base", "template!./main.html", "shared/helper/utils", "shared/helper/validate"], function (a, b, c, d, e, f, g, h) {
	function i() {
		var a = this,
		b = a.$fee.val().trim();
		b >= 0 && (a.$amout.text(b), a.$payment.text(b))
	}
	function j(a, b) {
		var d = this;
		d.publish("ajax", {
			url : n.LOAD_INVOICE.replace("<id>", a)
		}, c().done(function (a) {
				d._json = a
			}).always(function () {
				b.resolve()
			}))
	}
	function k() {
		var a = this,
		c = a._json,
		d = c.feeCharge;
		a.$fee.val(d),
		a.fee = d,
		a.$perRevenve.each(function () {
			b(this).trigger("change")
		}),
		a.$receiver.trigger("change"),
		i.call(a)
	}
	function l(a) {
		var b = this;
		c(function (a) {
			b._json.operator = b._operator,
			b.html(f, b._json, a)
		}).done(function () {
			m.call(b, a)
		})
	}
	function m(a) {
		var b = this,
		c = b.$element;
		b.$form = c.find("form"),
		b.$fee = c.find('[name="fees"]'),
		b.$amout = c.find(".amout"),
		b.$payment = c.find(".payment"),
		b.$perRevenve = c.find(".per-revenue"),
		b.$revenueSum = c.find(".revenue-sum"),
		b._editable || c.find("input").prop("readonly", !0),
		h(b.$form, {
			rules : {
				fees : {
					required : !0,
					number : !0
				}
			}
		}),
		a.resolve()
	}
	var n = {
		FINANCE : "/rest/data/userlist?role=Finance",
		LOAD_INVOICE : "/rest/invoice/<id>",
		CONTRACT : "/rest/client/<id>/contracts",
		CONTACT_DETAIL : "/rest/candidate/<id>",
		REFUND_CONFIRM : "/rest/invoice/<id>/refundconfirm"
	},
	o = /^(?:\d?\d|100)$/;
	return e.extend(function (a, b, c) {
		this._editable = "finance" === c ? !1 : !0
	}, {
		"hub/modal/allocation-revenue/show" : function (a, d) {
			var e = this,
			f = e.$element;
			if (f.find(".modal-footer button"), e._saveUrl = d.saveUrl, e._onSuccess = d.onSuccess, e._json = d.jobAttr, e._operator = d.operator, e._owner = d.owner, e._edit = !1, d.invoiceId)
				e._edit = !0, c(function (a) {
					j.call(e, d.invoiceId, a)
				}).done(function () {
					c(function (a) {
						l.call(e, a)
					}).done(function () {
						k.call(e)
					})
				});
			else {
				for (var g = e._json.userlist = [], h = e._json.users, i = !0, m = h.length; m--; ) {
					for (var n = !1, o = g.length; o--; )
						g[o].user.id == h[m].user.id && (g[o].type += ", " + h[m].type, n = !0);
					n || g.push(JSON.parse(JSON.stringify(h[m])))
				}
				b.each(g, function (a, b) {
					return b.user.id === e._owner.id ? (b.type += ", Owner", i = !1, !1) : void 0
				}),
				i && g.push({
					type : "Owner",
					user : e._owner
				}),
				l.call(e, c())
			}
			f.modal("show")
		},
		"hub:memory/context" : function (a, b) {
			this._user = b.user
		},
		"dom/action.click.change.input" : b.noop,
		"dom/action/update/revenue.change" : function (a, c) {
			this.fee = b(c.target).val().trim(),
			i.call(this)
		},
		"dom/action/per/revenue.change" : function (a, c) {
			var d = this,
			e = b(c.target),
			f = parseFloat(e.val(), 10),
			g = function () {
				var a = 0;
				return d.$perRevenve.each(function () {
					var c = b(this).val();
					(0 === c || c) && (a += parseFloat(b(this).val(), 10))
				}),
				a
			}
			();
			d.fee && e.prev().val(100 * (f / d.fee) + "%"),
			d.$revenueSum.text(g)
		},
		"dom/action/revenue/percentage.change" : function (a, c) {
			var d = this,
			e = b(c.target),
			f = e.val().trim().replace("%", "");
			o.test(f) && d.fee && (e.next().val(d.fee * f / 100).trigger("change"), e.val(f + "%"))
		},
		"dom/action/save.click" : function (a, d) {
			d.preventDefault();
			var e = this,
			f = b(d.target),
			h = e.$element;
			if (e.$form.valid()) {
				var i = function () {
					var a = [];
					return e.$perRevenve.each(function () {
						var c = b(this);
						a.push({
							type : c.attr("data-user-type"),
							user_id : c.attr("data-user-id"),
							revenue : c.val()
						})
					}),
					a
				}
				(),
				j = {
					feeCharge : e.$fee.val(),
					invoiceAmount : e.$fee.val(),
					assignments : i,
					note : ""
				};
				e._edit && (j.id = e._json.id),
				e.publish("ajax", {
					url : e._saveUrl,
					data : {
						data : JSON.stringify(j)
					},
					type : "post"
				}, c().done(function (a) {
						h.modal("hide"),
						a.status ? (g.alert("success", "Save invoice successfully!"), e._onSuccess && e._onSuccess(a)) : g.alert("error", a.message)
					}), f)
			}
		},
		"dom/action/invalid/allocation.click" : function (a, b, c) {
			b.preventDefault();
			var d = this;
			d.$element.modal("hide"),
			d.publish("modal/confirm/invalid-invoice/show", {
				id : c,
				onSuccess : function () {
					window.location.reload()
				}
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/arrange-interview/main.html", [], function () {
	return function () {
		for (var a = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3 data-weave="shared/helper/translation" data-i18n="Arrange Client Interview"></h3>\n</div>\n<div class="modal-body">\n\n    <form action="#" class="form-horizontal" id="arrange-interview-form">\n\n        <div class="control-group">\n            <label class="control-label" data-weave="shared/helper/translation" data-i18n="Candidate"></label>\n            <div class="controls text_line name">\n            </div>\n        </div>\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Interview date"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <input name="date" type="text" class="input-small date" data-weave="shared/widget/common/date-picker/main">\n                <select name="hour" class="input-mini">\n                    ', b = 0, c = 24; c > b; b++)
			a += '\n                    <option value="' + b + '">' + b + "</option>\n                    ";
		a += '\n                </select>\n                <select name="minute" class="input-mini">\n                    ';
		for (var b = 0, c = 60; c > b; b += 5)
			a += '\n                    <option value="' + b + '">' + b + "</option>\n                    ";
		return a += '\n                </select>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Reminder"></span>\n            </label>\n            <div class="controls">\n                <span data-weave="shared/helper/translation" data-i18n="In advance"></span> \n                <select class="input-small" name="reminder">\n                    <option value="" data-weave="shared/helper/translation" data-i18n="Please select"></option>\n                    <option value="0" data-weave="shared/helper/translation" data-i18n="0 分钟"></option>\n                    <option value="-5" data-weave="shared/helper/translation" data-i18n="5 分钟"></option>\n                    <option value="-10" data-weave="shared/helper/translation" data-i18n="10 分钟"></option>\n                    <option value="-15" data-weave="shared/helper/translation" data-i18n="15 分钟"></option>\n                    <option value="-30" data-weave="shared/helper/translation" data-i18n="30 分钟"></option>\n                    <option value="-60" data-weave="shared/helper/translation" data-i18n="1 小时"></option>\n                    <option value="-120" data-weave="shared/helper/translation" data-i18n="2 小时"></option>\n                    <option value="-180" data-weave="shared/helper/translation" data-i18n="3 小时"></option>\n                    <option value="-240" data-weave="shared/helper/translation" data-i18n="4 小时"></option>\n                    <option value="-300" data-weave="shared/helper/translation" data-i18n="5 小时"></option>\n                    <option value="-360" data-weave="shared/helper/translation" data-i18n="6 小时"></option>\n                </select>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Interviewer"></span>\n            </label>\n            <div class="controls">\n                <input type="text" name="interviewer" class="input-large" data-weave="app/widget/common/people-list/main" data-url="/">\n            </div>\n\n            <div class="controls hide">\n                <input type="text" name="interviewer1" class="input-large" data-weave="app/widget/common/people-list/main" data-url="/">\n                <a href="#" class="remove" data-action="remove/field"><span class="icon-remove"></span></a>\n            </div>\n\n            <div class="controls hide">\n                <input type="text" name="interviewer2" class="input-large" data-weave="app/widget/common/people-list/main" data-url="/">\n                <a href="#" class="remove" data-action="remove/field"><span class="icon-remove"></span></a>\n            </div>\n\n            <div class="controls controls-add text_line">\n                <a href="#" data-action="add/interviewer" data-weave="shared/helper/translation" data-i18n="Add"></a>\n            </div>\n        </div>\n        \n    </form>\n</div>\n<div class="modal-footer">\n    <button class="btn btn-danger pull-left hide" data-action="save(\'invalid\')" data-weave="shared/helper/translation" data-i18n="Backout"></button>\n    <button class="btn btn-primary btn-reactive hide" data-action="save(\'reactive\')" data-weave="shared/helper/translation" data-i18n="Cancel Backout"></button>\n    <button class="btn btn-primary btn-save hide" data-action="save" data-weave="shared/helper/translation" data-i18n="Save" form="arrange-interview-form"></button>\n</div>'
	}
}), define("app/widget/modal/arrange-interview/main", ["jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "shared/helper/utils", "shared/helper/validate"], function (a, b, c, d, e, f) {
	function g(a) {
		var b = this;
		b.html(d, b._json, a)
	}
	function h(a) {
		var b = this,
		c = b.$element;
		b.$form = c.find("form"),
		b.$date = c.find('[name="date"]'),
		b.$hour = c.find('[name="hour"]'),
		b.$minute = c.find('[name="minute"]'),
		b.$interviewer = c.find('[name="interviewer"]'),
		b.$interviewer1 = c.find('[name="interviewer1"]'),
		b.$interviewer2 = c.find('[name="interviewer2"]'),
		b.$reminder = c.find('[name="reminder"]'),
		b.$btnSave = c.find(".btn-save"),
		b.$btnReactive = c.find(".btn-reactive"),
		b.$btnDanger = c.find(".btn-danger"),
		f(b.$form, {
			rules : {
				date : {
					required : !0
				}
			}
		}),
		c.on("hide", function () {
			delete b._flowId,
			b.$interviewer.select2("data", null),
			b.$interviewer1.select2("data", null).closest(".controls").addClass("hide"),
			b.$interviewer2.select2("data", null).closest(".controls").addClass("hide"),
			b.$btnSave.addClass("hide"),
			b.$btnReactive.addClass("hide"),
			b.$btnDanger.addClass("hide")
		}),
		a.resolve()
	}
	var i = {
		SAVE : "/rest/joborder/shortlist/<id>/arrangeclientinterview",
		CONTACT : "/rest/candidate/list?company_id=<id>&current=latest&ordering=englishName"
	};
	return c.extend({
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"sig/start" : function (a, b) {
			h.call(this, b)
		},
		"hub/modal/interview/show" : function (a, b) {
			var c = this,
			d = c.$element,
			e = d.find(".name"),
			f = i.CONTACT.replace("<id>", b.client.id);
			if (c._jobsubmissionId = b.jobsubmissionId, c.$interviewer.data("url", f), c.$interviewer1.data("url", f), c.$interviewer2.data("url", f), e.text(b.name), b.data) {
				b.data.active ? (c.$btnSave.removeClass("hide"), c.$btnDanger.removeClass("hide")) : c.$btnReactive.removeClass("hide"),
				c._id = b.id,
				c._flowId = b.data.id,
				c._onSuccess = b.onSuccess;
				var g = new Date(b.data.date);
				c.$date.val(g.getFullYear() + "-" + (parseInt(g.getMonth(), 10) + 1) + "-" + g.getDate()),
				c.$hour.val(g.getHours()),
				c.$minute.val(g.getMinutes()),
				c.$reminder.val(b.data.delta),
				b.data.interviewer && c.$interviewer.val(b.data.interviewer),
				b.data.interviewer1 && c.$interviewer1.val(b.data.interviewer1).closest(".controls").removeClass("hide"),
				b.data.interviewer2 && c.$interviewer1.val(b.data.interviewer2).closest(".controls").removeClass("hide")
			} else
				c._id = b.id, c._onSuccess = b.onSuccess, c._client = b.client, c._candidate = b.candidate, c._jobid = b.jobid, c._sid = b.sid, c.$reminder.val(-10), c.$btnSave.removeClass("hide");
			d.modal("show")
		},
		"dom/action.click" : a.noop,
		"dom/action/save.click" : function (c, d, f) {
			var g,
			h,
			j = this,
			k = j.$element,
			l = a(d.target);
			j.$form.valid() && (g = {
					date : j.$date.val() + " " + j.$hour.val() + ":" + j.$minute.val(),
					delta : j.$reminder.val(),
					interviewer : j.$interviewer.val(),
					interviewer1 : j.$interviewer1.val(),
					interviewer2 : j.$interviewer2.val(),
					active : "invalid" === f ? !1 : !0
				}, j._flowId ? (g.id = j._flowId, h = function (a) {
					j._onSuccess(a)
				}) : h = function (a) {
				j._onSuccess(a),
				j.publish("modal/email/confirm/show", {
					client : j._client,
					candidate : j._candidate,
					jobid : j._jobid,
					sid : j._sid,
					onSuccess : j._onSuccess,
					jobsubmissionId : j._jobsubmissionId
				})
			}, j.publish("ajax", {
					url : i.SAVE.replace("<id>", j._id),
					data : {
						data : JSON.stringify(g)
					},
					type : "post"
				}, b().done(function (a) {
						k.modal("hide"),
						a.status ? ("invalid" === f ? e.alert("success", "客户面试作废") : "reactive" === f ? e.alert("success", "客户面试取消作废") : e.alert("success", "客户面试保存成功"), h && h(a)) : e.alert("error", a.message)
					}), l))
		},
		"dom/action/add/interviewer.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = d.closest(".control-group").find(".controls").filter(".hide").eq(0);
			return e.length ? (e.removeClass("hide"), void 0) : (alert("最多添加3个面试官!"), void 0)
		},
		"dom/action/remove/field.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = d.closest(".controls").addClass("hide");
			e.find("input").val(""),
			e.find('[data-woven*="shared/widget/common/comtree/main"]').length && e.find('[data-woven*="shared/widget/common/comtree/main"]').woven()[0].reset()
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/auto-share/main.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3>自动验证共享</h3>\n</div>\n<div class="modal-body">\n    <p>\n        自动验证共享成功！\n    </p>\n    <p>\n        请到候选人列表搜索查看该候选人，无需重复输入！\n    </p>\n\n</div>\n<div class="modal-footer">\n    <button class="btn btn-primary" data-action="confirm" data-weave="shared/helper/translation" data-i18n="Confirm"></button>\n</div>';
		return a
	}
}), define("app/widget/modal/auto-share/main", ["compose", "jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "shared/helper/utils"], function (a, b, c, d, e, f) {
	function g(a) {
		var b = this;
		b.html(e, b._json, a)
	}
	function h(a) {
		a.resolve()
	}
	var i = {
		VALID : "/rest/candidate/autoshare"
	};
	return d.extend({
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"sig/start" : function (a, b) {
			h.call(this, b)
		},
		"hub/modal/auto-share/show" : function (a, b) {
			var c = this,
			d = c.$element;
			c._type = b.type,
			c._val = b.val,
			c._onSuccess = b.onSuccess,
			d.modal("show")
		},
		"dom/action.click" : b.noop,
		"dom/action/valid.click" : function () {
			var a = this,
			b = a.$element;
			b.find('[name="date"]');
			var d;
			a.$form.valid() && (d = {
					email : a.$email.val(),
					mobile : a.$mobile.val()
				}, a.publish("ajax", {
					url : i.VALID,
					data : {
						data : JSON.stringify(d)
					},
					type : "post"
				}, c().done(function (b) {
						b.status ? b.data ? (f.alert("success", "验证成功！"), a._onSuccess && a._onSuccess(b)) : f.alert("error", "验证不匹配！") : f.alert("error", "验证不匹配！")
					})), b.modal("hide"))
		},
		"dom/action/confirm.click" : function () {
			var a = this,
			b = a.$element,
			d = {};
			d[a._type] = a._val,
			a.publish("ajax", {
				url : i.VALID,
				data : {
					data : JSON.stringify(d)
				},
				type : "post"
			}, c().done(function (b) {
					b.status ? b.data ? (f.alert("success", "自动验证共享成功！"), a._onSuccess && a._onSuccess(b)) : f.alert("error") : f.alert("error")
				})),
			b.modal("hide")
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/contract/main.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3 data-weave="shared/helper/translation" data-i18n="Contract"></h3>\n</div>\n<div class="modal-body">\n    <form action="#" class="form-horizontal" id="add-contract-form">\n        \n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Contract Name"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <input type="text" name="name" class="input-large">\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Invoice Title"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <input type="text" name="title" class="input-large">\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Fee Structure"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <textarea name="feeStructure" cols="30" rows="5"></textarea>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Probation"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <select name="probation" class="input-medium">\n                    <option value="1 month">1 month</option>\n                    <option value="2 months">2 months</option>\n                    <option value="3 months">3 months</option>\n                    <option value="4 months">4 months</option>\n                    <option value="5 months">5 months</option>\n                    <option value="6 months">6 months</option>\n                    <option value="7 months">7 months</option>\n                    <option value="8 months">8 months</option>\n                    <option value="9 months">9 months</option>\n                    <option value="10 months">10 months</option>\n                    <option value="11 months">11 months</option>\n                    <option value="12 months">12 months</option>\n                </select>\n            </div>\n        </div>\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Start Date"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <input type="text" class="input-medium" name="startDate" data-weave="shared/widget/common/date-picker/main">\n            </div>\n        </div>\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="End Date"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <input type="text" class="input-medium" name="endDate" data-weave="shared/widget/common/date-picker/main">\n            </div>\n        </div>\n    </form>\n</div>\n<div class="modal-footer">\n    <button class="btn btn-primary" data-action="save" data-weave="shared/helper/translation" data-i18n="Save" form="add-contract-form"></button>\n</div>';
		return a
	}
}), define("app/widget/modal/contract/main", ["compose", "jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "shared/helper/utils", "shared/helper/blurb", "shared/helper/validate"], function (a, b, c, d, e, f, g, h) {
	function i() {
		var a = this,
		b = a._json;
		a.$start.val(b.startDate),
		a.$end.val(b.expireDate),
		a.$title.val(b.invoiceTitle),
		a.$probation.find('option[value="' + b.probation + '"]').prop("selected", !0),
		a.$feeStructure.val(b.feeStructure),
		a.$contractName.val(b.contractName)
	}
	function j(a) {
		var b = this;
		b.html(e, b._json, a)
	}
	function k(a) {
		var b = this,
		c = b.$element;
		b.$form = c.find("form"),
		b.$start = c.find('[name="startDate"]'),
		b.$end = c.find('[name="endDate"]'),
		b.$title = c.find('[name="title"]'),
		b.$probation = c.find('[name="probation"]'),
		b.$feeStructure = c.find('[name="feeStructure"]'),
		b.$contractName = c.find('[name="name"]'),
		b.$contractName.val(l.CONTRACT),
		h(b.$form, {
			rules : {
				name : {
					required : !0
				},
				title : {
					required : !0
				},
				feeStructure : {
					required : !0
				},
				probation : {
					required : !0
				},
				startDate : {
					required : !0,
					date : !0
				},
				endDate : {
					required : !0,
					date : !0
				}
			}
		}),
		a.resolve()
	}
	var l = {
		CONTRACT : "Contract",
		REQUIRED_MESSAGE : "This field is required"
	};
	for (var m in l)
		l.hasOwnProperty(m) && (l[m] = g.t(l[m]));
	return d.extend({
		"sig/initialize" : function (a, b) {
			j.call(this, b)
		},
		"sig/start" : function (a, b) {
			k.call(this, b)
		},
		"hub/modal/add/contract/show" : function (a, b, c, d, e) {
			var f = this,
			g = f.$element;
			f._url = b,
			f._onSuccess = d,
			f._clientId = c,
			e ? (f._json = e, i.call(f)) : f._json = null,
			g.modal("show")
		},
		"dom/action.click" : b.noop,
		"dom/action/save.click" : function (a, d) {
			d.preventDefault();
			var e = this,
			g = b(d.target),
			h = e.$element;
			if (e.$form.valid()) {
				!function () {
					var a = [];
					return h.find('[name="structure"]').each(function () {
						var c = b(this).val(),
						d = b(this).next().val().trim();
						a.push(c + ": " + d)
					}),
					a.join("<br />")
				}
				();
				var i = {
					startDate : e.$start.val().trim(),
					expireDate : e.$end.val().trim(),
					invoiceTitle : e.$title.val().trim(),
					probation : e.$probation.val().trim(),
					feeStructure : e.$feeStructure.val().trim(),
					contractName : e.$contractName.val().trim(),
					client : {
						id : e._clientId
					}
				};
				e._json && e._json.id && (i.id = e._json.id),
				h.modal("hide"),
				e._url ? e.publish("ajax", {
					url : e._url,
					data : {
						data : JSON.stringify(i)
					},
					type : "post"
				}, c().done(function (a) {
						h.modal("hide"),
						a.status ? (f.alert("success", "Add contract successfully!"), e._onSuccess && e._onSuccess(a)) : f.alert("error", a.message)
					}), g) : e._onSuccess(i)
			}
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/data-migration/main.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3 data-weave="shared/helper/translation" data-i18n="Data Migration"></h3>\n</div>\n<div class="modal-body">\n    <form action="#" class="form-horizontal" id="data-migration-form">\n        <div class="control-group">\n            <label class="control-label type"></label>\n            <div class="controls text_line number">\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label" data-weave="shared/helper/translation" data-i18n="Current Owner"></label>\n            <div class="controls text_line username">\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="New Owner"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <select data-placeholder="Choose a user..." name="owner" id="owner" class="input-medium" data-weave="shared/widget/common/user-list/main"></select>\n            </div>\n        </div>\n\n        <div class="control-group control-share" data-weave="shared/widget/common/add-share/main">\n        </div>\n    </form>\n</div>\n<div class="modal-footer">\n    <button class="btn btn-primary" data-action="save" data-weave="shared/helper/translation" data-i18n="Save" form="data-migration-form"></button>\n</div>';
		return a
	}
}), define("app/widget/modal/data-migration/main", ["jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "shared/helper/utils", "config", "shared/helper/validate", "shared/helper/blurb"], function (a, b, c, d, e, f, g, h) {
	function i(a) {
		var b = this;
		b.html(d, b._json, a)
	}
	function j(a) {
		var b = this,
		c = b.$element;
		b.$form = c.find("form"),
		b.$name = c.find(".username"),
		b.$shareControl = c.find(".control-share"),
		b.$toUser = c.find("#owner"),
		b.$number = c.find(".number"),
		b.$type = c.find(".type"),
		b.$btn = c.find("button.btn"),
		g(b.$form, {
			rules : {
				owner : {
					required : !0
				}
			}
		}),
		a.resolve()
	}
	var k = "/rest/manage/datamigration/<id>",
	l = {
		Candidate : h.t("Candidate"),
		Client : h.t("Client Company"),
		LiveJobs : h.t("Live Jobs"),
		SucessfulJobs : h.t("Successed jobs but not received payment")
	};
	return c.extend({
		"sig/initialize" : function (a, b) {
			i.call(this, b)
		},
		"sig/start" : function (a, b) {
			j.call(this, b)
		},
		"hub/modal/data-migration/show" : function (a, b) {
			var c = this,
			d = c.$element;
			c._id = b.id,
			c._onSuccess = b.onSuccess,
			c._hasShare = b.hasShare,
			c._type = b.type,
			c._hasShare ? c.$shareControl.removeClass("hide") : c.$shareControl.addClass("hide"),
			c.$name.text(b.name),
			c.$number.text(b.number),
			c.$type.text(l[b.type]),
			d.modal("show")
		},
		"dom/action.click" : a.noop,
		"dom/action/save.click" : function (c, d) {
			var f = this,
			g = f.$element,
			h = a(d.target),
			i = window.confirm("是否确定需要转移改数据？此步骤不可逆！");
			if (i && f.$form.valid()) {
				var j = {
					type : f._type,
					to_user_id : parseInt(f.$toUser.val(), 10)
				};
				f._hasShare && (j.shares = function () {
					var b = [];
					return a('[name="share_with"]').each(function () {
						var c = a(this),
						d = c.val(),
						e = c.next().find(a("input").add("select")).val();
						b.push({
							type : d,
							value : e
						})
					}),
					b
				}
					()),
				f.publish("ajax", {
					url : k.replace("<id>", f._id),
					data : {
						data : JSON.stringify(j)
					},
					type : "POST"
				}, b().done(function (a) {
						g.modal("hide"),
						a.status ? (e.alert("success", "数据转移成功！"), f._onSuccess(a)) : e.alert("error", a.message)
					}), h)
			}
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/email-confirm/main.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3 data-weave="shared/helper/translation" data-i18n="Send email confirm">Send email confirm</h3>\n</div>\n<div class="modal-body align-center">\n    <p>\n        <button class="btn" data-action="confirm/candidate"  data-weave="shared/helper/translation" data-i18n="Email Confirm with Candidate"></button>\n    </p>\n    <p>\n        <button class="btn" data-action="confirm/client" data-weave="shared/helper/translation" data-i18n="Email Confirm with Client"></button>\n    </p>\n</div>\n<div class="modal-footer">\n    <button class="btn btn-primary" data-action="close" data-weave="shared/helper/translation" data-i18n="Close"></button>\n</div>';
		return a
	}
}), define("app/widget/modal/email-confirm/main", ["compose", "jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "shared/helper/utils"], function (a, b, c, d, e, f) {
	function g(a) {
		var b = this;
		b.html(e, b._json, a)
	}
	function h(a) {
		a.resolve()
	}
	return d.extend({
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"sig/start" : function (a, b) {
			h.call(this, b)
		},
		"hub/modal/email/confirm/show" : function (a, b) {
			var c = this,
			d = c.$element;
			c.obj = b,
			c._jobsubmissionId = b.jobsubmissionId,
			b.client && (c._client = b.client),
			b.candidate && (c._candidate = b.candidate),
			b.jobid && (c._jobid = b.jobid),
			b.sid && (c._sid = b.sid),
			b.onSuccess && (c._onSuccess = b.onSuccess),
			d.modal("show")
		},
		"dom/action.click" : b.noop,
		"dom/action/confirm/candidate.click" : function (a, b) {
			b.preventDefault();
			var c = this,
			d = c._candidate.email,
			e = c._candidate.name;
			d || f.alert("info", '以下人才没有私人邮箱:<br><a href="/candidate#detail!id=' + c._candidate.id + '" target="_blank">' + e + "</a>"),
			c.$element.modal("hide"),
			c.publish("modal/sendemail/show", {
				emails : [d],
				category : "emailconfirmwithcandidate",
				jobsubmissionId : c._jobsubmissionId,
				names : ['"' + e + '" [私人]'],
				emailTemplate : "candidate_interview",
				onSuccess : function (a) {
					c._onSuccess && c._onSuccess(a),
					c.publish("modal/email/confirm/show", c.obj)
				},
				templateVariable : {
					candidate_id : c._candidate.id,
					clientcontact_id : c._client.contact.ids[0],
					job_id : c._jobid
				},
				attachment : {
					joborder : 0,
					clientcompany : 0
				}
			})
		},
		"dom/action/confirm/client.click" : function (a, b) {
			b.preventDefault();
			var c = this,
			d = c._client.contact.names,
			e = c._client.contact.emails,
			g = c._client.contact.ids,
			h = [];
			e.forEach(function (a, b) {
				a || (h.push('<a href="/candidate#detail!id=' + g[b] + '" target="_blank">' + d[b] + "</a>"), g.splice(b, 1), d.splice(b, 1))
			}),
			h.length && f.alert("info", "以下人才没有邮箱:<br>" + h.join(" ")),
			c.$element.modal("hide"),
			c.publish("modal/sendemail/show", {
				parseEmail : !0,
				individually : !1,
				emails : c._client.contact.emails,
				category : "emailconfirmwithclient",
				jobsubmissionId : c._jobsubmissionId,
				names : c._client.contact.names,
				emailTemplate : "client_interview",
				onSuccess : function (a) {
					c._onSuccess && c._onSuccess(a),
					c.publish("modal/email/confirm/show", c.obj)
				},
				templateVariable : {
					candidate_id : c._candidate.id,
					clientcontact_id : c._client.contact.ids[0],
					job_id : c._jobid
				},
				attachment : {
					joborder : 0,
					clientcompany : 0
				}
			})
		},
		"dom/action/close.click" : function (a, b) {
			b.preventDefault();
			var c = this;
			c.$element.modal("hide")
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/invalid-invoice/main.html", [], function () {
	return function (a) {
		var b = "",
		c = a.reasons;
		b += '\n<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3>确认作废</h3>\n</div>\n<div class="modal-body">\n\n    <form action="#" class="form-horizontal" id="invalid-invoice-form">\n        <p>确认作废后, 系统将从报表中删除相关业绩分配, 并且将自动通知项目参与者及财务</p>\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Invalid Reason"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <select name="reason">\n                    <option value="">请选择</option>\n                    ';
		for (var d = 0, e = c.length; e > d; d++)
			b += '\n                    <option value="' + c[d].code + '">' + c[d].value + "</option>\n                    ";
		return b += '\n                </select>\n            </div>\n        </div>\n\n    </form>\n</div>\n<div class="modal-footer">\n    <button class="btn" data-action="cancel" data-weave="shared/helper/translation" data-i18n="Cancel"></button>\n    <button class="btn btn-primary" data-action="add" data-weave="shared/helper/translation" data-i18n="Confirm" form="invalid-invoice-form"></button>\n</div>'
	}
}), define("app/widget/modal/invalid-invoice/main", ["compose", "jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "shared/helper/utils", "shared/helper/validate"], function (a, b, c, d, e, f, g) {
	function h(a) {
		var b = this;
		b.publish("ajax", {
			url : j.REASON
		}, c().done(function (c) {
				b._json.reasons = c,
				b.html(e, b._json, a)
			}))
	}
	function i(a) {
		var b = this;
		b.$form = b.$element.find("form"),
		b.$reason = b.$element.find('[name="reason"]'),
		g(b.$form, {
			rules : {
				reason : {
					required : !0
				}
			}
		}),
		a.resolve()
	}
	var j = {
		REASON : "/rest/data/options?type=invoice_invalid_reason",
		INVALID_INVOICE : "/rest/invoice/<id>/invalidinvoice"
	};
	return d.extend({
		"sig/initialize" : function (a, b) {
			h.call(this, b)
		},
		"sig/start" : function (a, b) {
			i.call(this, b)
		},
		"hub/modal/confirm/invalid-invoice/show" : function (a, b) {
			var c = this,
			d = c.$element;
			c._id = b.id,
			c._onSuccess = b.onSuccess,
			d.modal("show")
		},
		"dom/action.click" : b.noop,
		"dom/action/add.click" : function (a, b) {
			b.preventDefault();
			var d = this,
			e = d.$element;
			if (d.$form.valid()) {
				var g = {
					data : JSON.stringify({
						invalidReason : d.$reason.find(":selected").val()
					})
				};
				d.publish("ajax", {
					url : j.INVALID_INVOICE.replace("<id>", d._id),
					type : "post",
					data : g
				}, c().done(function (a) {
						a.status ? (d._onSuccess && d._onSuccess(a), f.alert("success", "作废发票成功!")) : f.alert("error", a.message)
					})),
				e.modal("hide")
			}
		},
		"dom/action/cancel.click" : function (a, b) {
			b.preventDefault();
			var c = this,
			d = c.$element;
			d.modal("hide")
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/invoice-alert/main.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button> \n    <h3 data-weave="shared/helper/translation" data-i18n="Revenue Allocation Confirm"></h3>\n</div>\n<div class="modal-body">\n    <p>\n        <span data-weave="shared/helper/translation" data-i18n="Following revenue allocation has been added"></span>:\n    </p>\n    <ul class="unstyled">\n    </ul>\n    <p>\n        <span data-weave="shared/helper/translation" data-i18n="Do you want to add another"></span>?\n    </p>\n    \n</div>\n<div class="modal-footer">\n    <button class="btn" data-action="no" data-weave="shared/helper/translation" data-i18n="Cancel"></button>\n    <button class="btn btn-primary" data-action="yes" data-weave="shared/helper/translation" data-i18n="Confirm"></button>\n</div>';
		return a
	}
}), define("troopjs-requirejs/template!app/widget/modal/invoice-alert/item.html", [], function () {
	return function (a) {
		for (var b = "", c = 0, d = a.length; d > c; c++)
			b += '\n<li class="row-fluid">\n    <span class="span4">\n    	<span data-weave="shared/helper/translation" data-i18n="Invoice Amount"></span>:\n    </span>\n    <span class="span8">￥' + a[c].invoiceAmount + "</span>\n</li>\n";
		return b
	}
}), define("app/widget/modal/invoice-alert/main", ["compose", "jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "template!./item.html", "shared/helper/utils"], function (a, b, c, d, e, f) {
	function g(a) {
		var b = this;
		b.html(e, b._json, a)
	}
	function h(a) {
		var b = this;
		b.$ul = b.$element.find("ul"),
		a.resolve()
	}
	return d.extend({
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"sig/start" : function (a, b) {
			h.call(this, b)
		},
		"hub/modal/invoice-alert/show" : function (a, d) {
			var e = this,
			g = e.$element;
			g.find(".modal-footer button"),
			e._id = d.id,
			e._name = d.name,
			e._candidateId = d.candidateId,
			e._onSuccess = d.onSuccess,
			e._owner = d.owner,
			e._offerInfo = d.offerInfo;
			var h = b(f(d.invoices));
			h.find("[data-weave]").weave(c().done(function () {
					e.$ul.html(h)
				})),
			g.modal("show")
		},
		"dom/action.click" : b.noop,
		"dom/action/yes.click" : function () {
			var a = this,
			b = a.$element;
			b.modal("hide"),
			a.publish("job/item/open/invoice/modal", {
				id : a._id,
				owner : a._owner,
				name : a._name,
				candidateId : a._candidateId,
				onSuccess : a._onSuccess
			})
		},
		"dom/action/no.click" : function () {
			var a = this,
			b = a.$element;
			b.modal("hide")
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/invoice-client/main.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button> \n    <h3 data-weave="shared/helper/translation" data-i18n="Invoice sent"></h3>\n</div>\n<div class="modal-body">\n    <p>\n        这笔发票已经寄出了?\n    </p>\n    <form action="#" class="form-horizontal" id="invoice-client-form">\n        \n        <div class="control-group">\n            <label for="" class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Sent Date"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <input type="text" class="input-medium" name="sentDate" data-weave="shared/widget/common/date-picker/main">\n            </div>\n        </div>\n    </form>\n    \n</div>\n<div class="modal-footer">\n    <button class="btn" data-dismiss="modal" data-weave="shared/helper/translation" data-i18n="Cancel"></button>\n    <button class="btn btn-primary" data-action="yes" data-weave="shared/helper/translation" data-i18n="Confirm" form="invoice-client-form"></button>\n</div>  ';
		return a
	}
}), define("app/widget/modal/invoice-client/main", ["compose", "jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "shared/helper/utils", "shared/helper/validate"], function (a, b, c, d, e, f, g) {
	function h(a) {
		var b = this;
		b.html(e, b._json, a)
	}
	function i(a) {
		var b = this;
		b.$form = b.$element.find("form"),
		g(b.$form, {
			rules : {
				sentDate : {
					required : !0,
					dateISO : !0
				}
			}
		}),
		a.resolve()
	}
	var j = {
		SEND_TO_CLIENT : "/rest/invoice/<id>/invoicesent"
	};
	return d.extend({
		"sig/initialize" : function (a, b) {
			h.call(this, b)
		},
		"sig/start" : function (a, b) {
			i.call(this, b)
		},
		"hub/modal/invoice-client/show" : function (a, b, c) {
			var d = this,
			e = d.$element;
			e.find(".modal-footer button"),
			d._id = b,
			d._onSuccess = c,
			e.modal("show")
		},
		"dom/action.click" : b.noop,
		"dom/action/yes.click" : function (a, b) {
			b.preventDefault();
			var d = this,
			e = d.$element;
			if (d.$form.valid()) {
				var g = {
					sentDate : d.$element.find('[name="sentDate"]').val()
				};
				e.modal("hide"),
				d.publish("ajax", {
					url : j.SEND_TO_CLIENT.replace("<id>", d._id),
					data : {
						data : JSON.stringify(g)
					},
					type : "post"
				}, c().done(function (a) {
						a.status ? (f.alert("success", "Add invoice sent successful!"), d._onSuccess && d._onSuccess(a)) : f.alert("error", a.message)
					}))
			}
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/invoice-finance/main.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button> \n    <h3 data-i18n="Send invoice" data-weave="shared/helper/translation"></h3>\n</div>\n<div class="modal-body">\n    <form action="#" class="form-horizontal" id="invoice-finance-form">\n        <div class="control-group">\n            <label class="control-label" data-weave="shared/helper/translation" data-i18n="Candidate"></label>\n            <div class="controls text_line name"></div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label" data-weave="shared/helper/translation" data-i18n="Salary"></label>\n            <div class="controls text_line">\n                <span data-weave="shared/helper/translation" data-i18n="Annual Salary"></span>: <span data-weave="shared/helper/translation" data-i18n="Currency symbol"></span> <span class="annual-salary"></span>\n                <br>\n                <span data-weave="shared/helper/translation" data-i18n="Salary Structure"></span>: <span class="salary-structure"></span>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label" for="receiver">\n                <span data-weave="shared/helper/translation" data-i18n="Invoice Receiver"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <select name="receiver" class="input-xlarge required" data-action="receiver">\n                    <option value=""></option>\n                </select>\n                <input type="hidden" name="candidate-id">\n                <p class="text-error receiver-error hide"><span data-weave="shared/helper/translation" data-i18n="Phone or address is empty"\n></span>, [<a href="#" target="_blank" data-weave="shared/helper/translation" data-i18n="Edit Contact"></a>] <span data-weave="shared/helper/translation" data-i18n="Please fill in the information"></span></p>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Mobile"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <input type="text" class="input-medium required" name="mobile" readonly>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Address"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <textarea name="address" class="span4 required" data-weave="shared/widget/common/autosize/main" readonly></textarea>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Contract"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <p>\n                    <select name="contract" class="input-xlarge contract-select required" data-action="contract">\n                        <option value=""></option>\n                    </select>\n                    <span class="contract-info text-error hide" data-weave="shared/helper/translation" data-i18n="Edit Company and Add Contract"></span>\n                </p>\n                <p class="contract-details hide">\n\n                    <span data-weave="shared/helper/translation" data-i18n="Invoice Title"></span>: \n                    <span class="hint title"></span>\n                    <br>\n                    <span data-weave="shared/helper/translation" data-i18n="Fee Structure"></span>: \n                    <span class="hint structure"></span>\n                    <br>\n                    <span data-weave="shared/helper/translation" data-i18n="Probation"></span>: \n                    <span class="hint probation"></span>\n\n                </p>\n            </div>\n        </div>\n\n        <div class="control-group control-fee hide">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Invoice Amount"></span>\n            </label>\n            <div class="controls text_line red">\n                \n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Invoice Finance"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <select name="finance" class="input-medium required">\n                    <option value=""></option>\n                </select>\n            </div>\n        </div>\n\n        <div class="control-group control-received hide">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Payment Received"></span>\n            </label>\n            <div class="controls text_line">\n                <span class="red"></span>&nbsp;&nbsp;\n                <span class="muted"></span>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Estimated Reception"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <input type="text" class="input-medium required" name="date" data-weave="shared/widget/common/date-picker/main">\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label" data-weave="shared/helper/translation" data-i18n="Notes"></label>\n            <div class="controls">\n                <textarea name="note" class="span4" data-weave="shared/widget/common/autosize/main"></textarea>\n            </div>\n        </div>\n        \n    </form>\n    \n</div>\n<div class="modal-footer">\n    <button class="btn" data-dismiss="modal" data-i18n="Cancel" data-weave="shared/helper/translation"></button>\n    <button class="btn btn-primary" data-action="yes" data-i18n="Confirm" data-weave="shared/helper/translation" form="invoice-finance-form"></button>\n</div>';
		return a
	}
}), define("app/widget/modal/invoice-finance/main", ["compose", "jquery", "troopjs-utils/deferred", "troopjs-utils/when", "shared/widget/modal/base", "template!./main.html", "shared/helper/utils", "shared/helper/validate", "shared/helper/blurb", "app/widget/common/select2/main"], function (a, b, c, d, e, f, g, h, i) {
	function j(a, b) {
		for (var c, d = [], e = 0, f = b.length; f > e; e++)
			c = b[e].name || b[e].englishName + " " + b[e].chineseName, d.push("<option value='" + b[e].id + "'>" + c + "</option>");
		a.find("option:not(:first-child)").remove().end().append(d.join(""))
	}
	function k(a) {
		var b = this;
		b.publish("ajax", {
			url : p.LOAD_INVOICE.replace("<id>", b._invoiceId)
		}, c().done(function (a) {
				b._json = a
			}).always(function () {
				a.resolve()
			}))
	}
	function l() {
		var a = this;
		a.$contract.children().length > 1 ? (a.$contract.trigger("change"), a.$contractSelect.removeClass("hide").closest(".controls").removeClass("text_line"), a.$contractInfo.addClass("hide")) : (a.$contractSelect.addClass("hide").closest(".controls").addClass("text_line"), a.$contractInfo.removeClass("hide"))
	}
	function m(a) {
		var e = this,
		f = "object" == typeof e._json.client ? e._json.client.id : e._json.client,
		g = [],
		h = c(),
		i = c(),
		k = c(),
		m = "finance" === e._operator ? p.CONTACT1.replace("<id>", e._data.receiver.id) : p.CONTACT;
		g.push(h.promise(), i.promise(), k.promise()),
		e.publish("ajax", {
			url : p.FINANCE
		}, h.done(function (a) {
				j(e.$finance, a)
			})),
		e.publish("ajax", {
			url : m.replace("<cid>", f).replace("<id>", e._user.id)
		}, i.done(function (a) {
				j(e.$receiver, a.list)
			})),
		e.publish("ajax", {
			url : p.CONTRACT.replace("<id>", f)
		}, k.done(function (a) {
				j(e.$contract, a);
				var c = a;
				e.$contract.find("option:not(:first-child)").remove();
				for (var d = 0, f = c.length; f > d; d++) {
					var g = c[d],
					h = b("<option value='" + g.id + "'>" + g.contractName + "</option>");
					h.data({
						title : g.invoiceTitle,
						probation : g.probation,
						structure : g.feeStructure
					}),
					e.$contract.append(h)
				}
				l.call(e)
			})),
		d.apply(b, g).then(function () {
			a && a.resolve()
		})
	}
	function n(a) {
		var b = this;
		b.html(f, b._json, a)
	}
	function o(a) {
		var b = this,
		c = b.$element;
		b.$form = c.find("form"),
		b.$name = c.find(".name"),
		b.$receiver = c.find('[name="receiver"]').select2({
				placeholder : "请选择"
			}),
		b.$contract = c.find('[name="contract"]').select2({
				placeholder : "请选择"
			}),
		b.$finance = c.find('[name="finance"]').select2({
				placeholder : "请选择"
			}),
		b.$date = c.find('[name="date"]'),
		b.$note = c.find('[name="note"]'),
		b.$mobile = c.find('[name="mobile"]'),
		b.$address = c.find('[name="address"]'),
		b.$candidateId = c.find('[name="candidate-id"]'),
		b.$contractDetails = c.find(".contract-details"),
		b.$contractInfo = c.find(".contract-info"),
		b.$contractSelect = c.find(".contract-select"),
		b.$controlFee = c.find(".control-fee"),
		b.$controlReceived = c.find(".control-received"),
		b.$receiverError = c.find(".receiver-error"),
		h(b.$form),
		c.on("hidden", function () {
			b.$receiverError.addClass("hide")
		}),
		a.resolve()
	}
	var p = {
		FINANCE : "/rest/data/userlist?role=Finance",
		CONTACT : "/rest/candidate/list?paginate_by=200&company_id=<cid>&user_id=<id>&type=contact&ordering=englishName",
		CONTACT1 : "/rest/candidate/list?id=<id>",
		LOAD_INVOICE : "/rest/invoice/<id>",
		CONTRACT : "/rest/client/<id>/contracts",
		CONTACT_DETAIL : "/rest/candidate/<id>",
		REFUND_CONFIRM : "/rest/invoice/<id>/refundconfirm",
		SEND_TO_FINANCE : "/rest/invoice/<id>/sendinvoice",
		EDIT : "/rest/invoice/<id>/note"
	},
	q = {
		CURRENCY_SYM : i.t("Currency symbol")
	};
	return e.extend({
		"sig/initialize" : function (a, b) {
			n.call(this, b)
		},
		"sig/start" : function (a, b) {
			o.call(this, b)
		},
		"sig/stop" : function (a, b) {
			var c = this;
			c.$receiver.select2("destroy"),
			c.$contract.select2("destroy"),
			c.$finance.select2("destroy"),
			b.resolve()
		},
		"hub:memory/context" : function (a, b) {
			this._user = b.user
		},
		"hub/modal/invoice-finance/show" : function (a, b) {
			var d = this,
			e = d.$element;
			e.find(".modal-footer button"),
			d._invoiceId = b.invoiceId,
			d._onSuccess = b.onSuccess,
			d._name = b.name,
			d._data = b.data,
			d._operator = b.operator,
			d.$name.text(d._name),
			d.$element.find(".annual-salary").text(d.formatCurrency(b.offerInfo.annualSalary)),
			d.$element.find(".salary-structure").text(b.offerInfo.salaryStructure || ""),
			"finance" === d._operator ? (d.$finance.select2("readonly", !0), d.$contract.select2("readonly", !0), d.$receiver.select2("readonly", !0), d.$date.prop("readonly", !0)) : (d.$finance.select2("readonly", !1), d.$contract.select2("readonly", !1), d.$receiver.select2("readonly", !1), d.$date.prop("readonly", !1)),
			c(function (a) {
				k.call(d, a)
			}).done(function () {
				c(function (a) {
					m.call(d, a)
				}).done(function () {
					e.modal("show"),
					d._data && (d.$finance.val(d._data.finance.id).trigger("change"), d.$contract.val(d._data.clientContract.id).trigger("change"), d.$receiver.val(d._data.receiver.id).trigger("change"), d.$date.val(d._data.estimatepaymentReceivedDate.split(" ")[0]), d.$note.val(d._data.note), d.$controlFee.removeClass("hide").find(".text_line").text(q.CURRENCY_SYM + " " + d.formatCurrency(d._data.feeCharge)), d._data.paymentReceived ? (d.$controlReceived.removeClass("hide").find(".red").text(q.CURRENCY_SYM + " " + d.formatCurrency(d._data.paymentReceived)), d.$controlReceived.find(".muted").text(d.formatDate(d._data.paymentReceivedDate))) : d.$controlReceived.addClass("hide"))
				})
			})
		},
		"dom/action.click.change" : b.noop,
		"dom/action/contract.change" : function (a, c) {
			var d = this,
			e = b(c.target),
			f = e.find(":selected").data();
			f.title ? (d.$contractDetails.removeClass("hide"), d.$contractDetails.find(".title").text(f.title), d.$contractDetails.find(".probation").text(f.probation), d.$contractDetails.find(".structure").text(f.structure)) : d.$contractDetails.addClass("hide")
		},
		"dom/action/receiver.change" : function (a, d) {
			var e = this,
			f = b(d.target),
			g = f.val();
			g ? e.publish("ajax", {
				url : p.CONTACT_DETAIL.replace("<id>", g)
			}, c().done(function (a) {
					e.$candidateId.val(a.id),
					e.$address.val(a.address),
					e.$mobile.val(a.mobile),
					a.mobile && a.address || e.$receiverError.removeClass("hide").find("a").attr("href", "/candidate#add!id=" + a.id)
				})) : (e.$mobile.val(""), e.$address.val(""))
		},
		"dom/action/yes.click" : function (a, d) {
			d.preventDefault();
			var e,
			f = this,
			h = b(d.target),
			i = f.$element,
			j = {},
			k = "";
			f.$form.valid() && ("finance" === f._operator ? (j = {
						note : f.$note.val(),
						id : f._invoiceId
					}, k = "发票编辑成功!", e = p.EDIT.replace("<id>", f._invoiceId)) : (j = {
						estimatepaymentReceivedDate : f.$date.val(),
						note : f.$note.val(),
						finance : f.$finance.val(),
						clientContract : f.$contract.val(),
						receiver : f.$receiver.val()
					}, k = "已通知财务开票", e = p.SEND_TO_FINANCE.replace("<id>", f._invoiceId)), f.publish("ajax", {
					url : e,
					data : {
						data : JSON.stringify(j)
					},
					type : "post"
				}, c().done(function (a) {
						i.modal("hide"),
						a.status ? (g.alert("success", k), f._onSuccess && f._onSuccess(a)) : g.alert("error", a.message)
					}), h))
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/kpi-column-config/main.html", [], function () {
	return function (a) {
		var b = "",
		c = a.note;
		b += '\n<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button> \n    <h3 data-weave="shared/helper/translation" data-i18n="Columns"></h3>\n</div>\n<div class="modal-body">\n    \n    <ul class="unstyled two-columns clearfix">\n        <li>\n            <label class="checkbox" data-action="empty"><input type="checkbox" data-action="column" data-mapping="keyin candidates" checked="checked" /><span data-weave="shared/helper/translation" data-i18n="Keyin Candidates"></span></label>\n        </li>\n        <li>\n            <label class="checkbox" data-action="empty"><input type="checkbox" data-action="column" data-mapping="owned candidates" checked="checked" /><span data-weave="shared/helper/translation" data-i18n="Owned Candidates"></span></label>\n        </li>\n        <li>\n            <label class="checkbox" data-action="empty"><input type="checkbox" data-action="column" data-mapping="clients" checked="checked" /><span data-weave="shared/helper/translation" data-i18n="Company Added"></span></label>\n        </li>\n        <li>\n            <label class="checkbox" data-action="empty"><input type="checkbox" data-action="column" data-mapping="candidate email sent" checked="checked" /><span data-weave="shared/helper/translation" data-i18n="Send Emails"></span></label>\n        </li>\n        <li>\n            <label class="checkbox" data-action="empty"><input type="checkbox" data-action="column" data-mapping="floating" checked="checked" /><span data-weave="shared/helper/translation" data-i18n="Floating CV"></span></label>\n        </li>\n        <li>\n            <label class="checkbox" data-action="empty"><input type="checkbox" data-action="column" data-mapping="notes" checked="checked" /><span data-weave="shared/helper/translation" data-i18n="Note"></span></label>\n        </li>\n        <li>\n            <label class="checkbox" data-action="empty"><input type="checkbox" data-action="column" data-mapping="attachments" checked="checked" /><span data-weave="shared/helper/translation" data-i18n="Attachment"></span></label>\n        </li>\n        <li>\n            <label class="checkbox" data-action="empty"><input type="checkbox" data-action="column" data-mapping="todos" checked="checked" /><span data-weave="shared/helper/translation" data-i18n="Task"></span></label>\n        </li>\n        <li>\n            <label class="checkbox" data-action="empty"><input type="checkbox" data-action="column" data-mapping="shortlist" checked="checked" /><span data-weave="shared/helper/translation" data-i18n="Shortlist"></span></label>\n        </li>\n        <li>\n            <label class="checkbox" data-action="empty"><input type="checkbox" data-action="column" data-mapping="live jobs" checked="checked" /><span data-weave="shared/helper/translation" data-i18n="Living Jobs"></span></label>\n        </li>\n        <li>\n            <label class="checkbox" data-action="empty"><input type="checkbox" data-action="column" data-mapping="job new added" checked="checked" /><span data-weave="shared/helper/translation" data-i18n="New Added Jobs"></span></label>\n        </li>\n        <li>\n            <label class="checkbox" data-action="empty"><input type="checkbox" data-action="column" data-mapping="updated jobs" checked="checked" /><span data-weave="shared/helper/translation" data-i18n="Updated Jobs"></span></label>\n        </li>\n        <li>\n            <label class="checkbox" data-action="empty"><input type="checkbox" data-action="column" data-mapping="cv sent" checked="checked" /><span data-weave="shared/helper/translation" data-i18n="CVs Sent"></span></label>\n        </li>\n        <li>\n            <label class="checkbox" data-action="empty"><input type="checkbox" data-action="column" data-mapping="client interview" checked="checked" /><span data-weave="shared/helper/translation" data-i18n="Client Interview"></span></label>\n        </li>\n        <li>\n            <label class="checkbox" data-action="empty"><input type="checkbox" data-action="column" data-mapping="offer signed" checked="checked" /><span data-weave="shared/helper/translation" data-i18n="Offer Signed"></span></label>\n        </li>\n        <li>\n            <label class="checkbox" data-action="empty"><input type="checkbox" data-action="column" data-mapping="cv sent by owner" checked="checked" /><span data-weave="shared/helper/translation" data-i18n="[Owner] Sent to client"></span></label>\n        </li>\n        <li>\n            <label class="checkbox" data-action="empty"><input type="checkbox" data-action="column" data-mapping="client interview by owner" checked="checked" /><span data-weave="shared/helper/translation" data-i18n="[Owner] Client interview"></span></label>\n        </li>\n        <li>\n            <label class="checkbox" data-action="empty"><input type="checkbox" data-action="column" data-mapping="offer signed by owner" checked="checked" /><span data-weave="shared/helper/translation" data-i18n="[Owner] Offer signed"></span></label>\n        </li>\n        ';
		for (var d = 0, e = c.length; e > d; d++)
			b += '\n        <li>\n            <label class="checkbox" data-action="empty"><input type="checkbox" data-action="column" data-mapping="' + c[d].code + '" checked="checked" />[<span data-weave="shared/helper/translation" data-i18n="Note"></span>] ' + c[d].value + "</label>\n        </li>\n        ";
		return b += '\n    </ul>\n    \n</div>\n<div class="modal-footer">\n    <button class="btn btn-primary" data-action="save" data-weave="shared/helper/translation" data-i18n="Save"></button>\n</div>  '
	}
}), define("app/widget/modal/kpi-column-config/main", ["jquery", "troopjs-utils/deferred", "shared/widget/base/main", "template!./main.html", "shared/helper/utils"], function (a, b, c, d, e) {
	function f(a) {
		var c = this;
		c.publish("ajax", {
			url : h.NOTE_CATEGORY
		}, b().done(function (b) {
				c._json.note = b,
				c.html(d, c._json, a)
			}))
	}
	function g(a) {
		var c = this;
		c.$checkbox = c.$element.find(":checkbox"),
		c.publish("ajax", {
			url : h.USERCONFIG
		}, b().done(function (a) {
				var b,
				d;
				if (a && a.kpiFields) {
					b = a.kpiFields;
					for (d in b)
						b[d] || c.$checkbox.filter('[data-mapping="' + d + '"]').prop("checked", !1)
				} else
					e.alert("error", a.message)
			})),
		a.resolve()
	}
	var h = {
		CONFIG_ADD : "/rest/data/userconfig/add",
		NOTE_CATEGORY : "rest/data/options?type=candidate_note_category,jobsubmission_note_category",
		USERCONFIG : "/rest/data/userconfig/"
	};
	return c.extend({
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"sig/start" : function (a, b) {
			g.call(this, b)
		},
		"hub/modal/kpi-column-config/show" : function () {
			var a = this,
			b = a.$element;
			b.modal("show")
		},
		"dom/action.click" : a.noop,
		"dom/action/save.click" : function (c, d) {
			var f = this,
			g = a(d.target),
			i = {},
			j = {};
			f.$checkbox.each(function () {
				var b = a(this);
				j[b.data("mapping")] = b.prop("checked")
			}),
			i.kpiFields = JSON.stringify(j),
			f.$element.modal("hide"),
			f.publish("ajax", {
				url : h.CONFIG_ADD,
				data : {
					data : JSON.stringify(i)
				},
				type : "post"
			}, b().done(function (a) {
					a.status ? e.alert("success", "Update custom kpi fields success.") : e.alert("error", a.message)
				}), g)
		},
		"dom/action/column.click" : function (b, c) {
			var d = this;
			d.publish("kpi/toggle/column", a(c.target).attr("data-mapping"))
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/login-alert/main.html", [], function () {
	return function (a) {
		var b = "",
		c = this.emailEnabled,
		d = a.emailto || "";
		return b += '\n<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3 data-weave="shared/helper/translation" data-i18n="超出下列预设值时，系统将自动发送邮件通知"></h3>\n</div>\n<div class="modal-body">\n    <form action="#" class="form-horizontal" id="login-alert-form">\n        \n        <div class="control-group">\n            <label class="control-label" data-weave="shared/helper/translation" data-i18n="Alert period"></label>\n            <div class="controls text_line" data-weave="shared/helper/translation" data-i18n="1 day"></div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Multiple Login Times"></span>\n            </label>\n            <div class="controls">\n                <input type="number" class="input-small" name="times" value="' + a.times + '">\n                <p class="hint help-block">\n                    计算用户从不同的IP地址登陆系统的次数。<br>\n                    如一个用户当天在Office内登陆3次，则算1次。<br>\n                    如一个用户当天在Office及家里，各登陆1次，则算2次。\n                </p>\n            </div>\n        </div>\n        \n        <div class="control-group">\n            <label class="control-label" data-weave="shared/helper/translation" data-i18n="To"></label>\n            <div class="controls">\n                \n                ',
		b += c ? '\n                <input type="text" name="receiver" value="' + d + '" data-weave="shared/widget/common/tagit/main">\n                <p class="hint">请使用"回车键"或者"逗号"确认邮件地址，不设置邮箱代表不发送警报邮件。</p>\n                ' : '\n                <input type="text" disabled="disabled" class="span4">\n                <p class="help-block">\n                    <sapn class="text-error">邮件功能还未启用，请在个人信息板块的邮件设置中心，填写管理员的邮箱密码，并测试通过！</sapn>\n                </p>\n                ',
		b += '\n            </div>\n        </div>\n    </form>\n    \n\n</div>\n<div class="modal-footer">\n    <button class="btn btn-primary" data-action="save.click" data-weave="shared/helper/translation" data-i18n="Save" form="login-alert-form"></button>\n</div>'
	}
}), define("app/widget/modal/login-alert/main", ["compose", "jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "shared/helper/utils", "shared/helper/validate"], function (a, b, c, d, e, f, g) {
	function h() {
		var a = this;
		a.publish("ajax", {
			url : j.CONFIG,
			type : "get",
			cache : !1
		}, c().done(function (b) {
				if (b.length) {
					var d = b[0];
					a._json = JSON.parse(d.value)
				}
				c(function (b) {
					a.html(e, a._json, b)
				}).done(function () {
					i.call(a)
				})
			}))
	}
	function i() {
		var a = this,
		b = a.$element;
		a.$form = b.find("form"),
		a.$receiver = b.find('[name="receiver"]'),
		a.$times = b.find('[name="times"]'),
		g(a.$form, {
			rules : {
				times : {
					required : !0
				}
			}
		})
	}
	var j = {
		CONFIG : "/rest/data/configvalue?keys=loginlog_alert",
		CONFIG_ADD : "/rest/data/configvalue/add"
	};
	return d.extend({
		"hub:memory/context" : function (a, b) {
			var c = this;
			b.user.emailpassword && (c.emailEnabled = !0),
			h.call(this)
		},
		"hub/modal/login-alert/show" : function () {
			var a = this,
			b = a.$element;
			b.find(".modal-footer button"),
			b.find(".text_line"),
			b.modal("show")
		},
		"dom/action.click" : b.noop,
		"dom/action/save.click" : function (a, d) {
			d.preventDefault();
			var e = this,
			g = e.$element,
			h = b(d.targt);
			if (e.$form.valid()) {
				var i = JSON.stringify({
						times : parseInt(e.$times.val(), 10),
						emailto : e.$receiver.val()
					}),
				k = {
					type : "",
					name : "loginlog_alert",
					value : i
				};
				g.modal("hide"),
				e.publish("ajax", {
					url : j.CONFIG_ADD,
					data : {
						data : JSON.stringify(k)
					},
					type : "post"
				}, c().done(function (a) {
						g.modal("hide"),
						a.status ? f.alert("success", "设置成功！") : f.alert("error", a.message)
					}), h)
			}
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/mass-edit/main.html", [], function () {
	return function (a) {
		for (var b = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3 data-weave="shared/helper/translation" data-i18n="Mass Edit"></h3>\n</div>\n<div class="modal-body">\n    <form action="#" class="form-horizontal two-cols-form clearfix" id="mass-edit-form">\n        <div class="control-group">\n            <label class="control-label" data-weave="shared/helper/translation" data-i18n="Status"></label>\n            <div class="controls">\n                <select name="status" class="span3">\n                    <option value="" data-weave="shared/helper/translation" data-i18n="Please select"></option>\n                    ', c = 0, d = a.status.length; d > c; c++)
			b += '\n                    <option value="' + a.status[c].code + '">' + a.status[c].value + "</option>\n                    ";
		return b += '\n                </select>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label">MPC</label>\n            <div class="controls">\n                <label class="radio inline">\n                    <input type="radio" value="1" name="mpc"> <span data-weave="shared/helper/translation" data-i18n="Yes"></span>\n                </label>\n                <label class="radio inline">\n                    <input type="radio" value="0" name="mpc"> <span data-weave="shared/helper/translation" data-i18n="No"></span>\n                </label>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label for="" class="control-label" data-weave="shared/helper/translation" data-i18n="Gender"></label>\n            <div class="controls clearfix">\n                <label class="radio inline">\n                    <input type="radio" id="genderMale" name="gender" value="true"> <span data-weave="shared/helper/translation" data-i18n="Male"></span>\n                </label>\n                <label class="radio inline">\n                    <input type="radio" id="genderFemale" name="gender" value="false"> <span data-weave="shared/helper/translation" data-i18n="Female"></span>\n                </label>\n            </div>\n        </div>\n        <div class="control-group">\n            <label for="" class="control-label" data-weave="shared/helper/translation" data-i18n="Function"></label>\n            <div class="controls clearfix">\n                <div class="comtree span3" data-name="function" data-url="/rest/data/function" data-weave="shared/widget/common/comtree/main"></div>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label" data-weave="shared/helper/translation" data-i18n="Current City"></label>\n            <div class="controls">\n                <div class="comtree span3" data-name="location" data-required="true" data-url="/rest/data/city" data-weave="shared/widget/common/comtree/main"></div>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label for="" class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Intention City"></span>\n            </label>\n\n            <div class="controls clearfix">\n                <div class="comtree span3" data-name="city" data-url="/rest/data/city" data-weave="shared/widget/common/comtree/main"></div>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label" data-weave="shared/helper/translation" data-i18n="Folder"></label>\n            <div class="controls">\n                <div class="comtree span3" data-name="folder" data-url="/rest/folder/list?type=candidate" data-weave="shared/widget/common/comtree/main"></div>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label data-weave="shared/helper/translation" data-i18n="Owner" class="control-label"></label>\n            <div class="controls">\n                <select name="owner" class="input-medium required" data-weave="shared/widget/common/user-list/main(0)"></select>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label for="" class="control-label" data-weave="shared/helper/translation" data-i18n="Tags"></label>\n            <div class="controls">\n                <div class="span3">\n                    <input type="text" name="tags" data-type="tag" autocomplete="off" data-weave="shared/widget/common/tagit/main">\n                </div>\n            </div>\n        </div>\n\n        <div class="control-group" data-weave="shared/widget/common/add-share/main(false)"></div>\n    </form>\n    <p>除管理员之外，对于非拥有的候选人，批量修改“拥有者”及“共享”将无效</p>\n</div>\n<div class="modal-footer">\n    <a href="#" class="btn" data-weave="shared/helper/translation" data-i18n="Cancel" data-dismiss="modal"></a>\n    <button href="#" class="btn btn-primary" data-weave="shared/helper/translation" data-i18n="Save" data-action="save" form="mass-edit-form"></button>\n</div>'
	}
}), define("app/widget/modal/mass-edit/main", ["jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "shared/helper/utils", "shared/helper/blurb"], function (a, b, c, d, e, f) {
	function g(a) {
		var c = this;
		c.publish("ajax", {
			url : i.STATUS
		}, b().done(function (b) {
				c._json.status = b,
				c.html(d, c._json, a)
			}))
	}
	function h(a) {
		var b = this,
		c = b.$element.find("form");
		b.$gender = c.find('[name="gender"]:radio'),
		b.$tags = c.find('[name="tags"]'),
		b.$mpc = c.find('[name="mpc"]'),
		b.$city = c.find('[name="city"]'),
		b.$location = c.find('[name="location"]'),
		b.$owner = c.find('[name="owner"]'),
		b.$folder = c.find('[name="folder"]'),
		b.$status = c.find('[name="status"]'),
		b.$function = c.find('[name="function"]'),
		b.$function.woven()[0],
		b.$city.woven()[0],
		b.$location.woven()[0],
		b.$folder.woven()[0],
		b.$element.on("hidden", function () {
			b.$owner.val("").trigger("change")
		}),
		a.resolve()
	}
	var i = {
		EDIT : "/rest/candidate/batch_edit",
		STATUS : "/rest/data/options?type=candidate_status"
	},
	j = {
		SUCCESSFUL : f.t("Operate successfully")
	};
	return c.extend({
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"sig/start" : function (a, b) {
			h.call(this, b)
		},
		"hub/modal/mass-edit/show" : function (a, b, c) {
			var d = this;
			d._ids = b,
			d._onSuccess = c,
			d.$element.modal("show")
		},
		"dom/action.click" : a.noop,
		"dom/action/save.click" : function (c, d) {
			d.preventDefault();
			var f = this,
			g = a(d.target),
			h = function () {
				var b = [];
				return f.$element.find('[name="share_with"]').each(function () {
					var c = a(this),
					d = c.val(),
					e = function () {
						var a;
						return c.next().find("select").length ? a = c.next().find("select").val() : c.next().find("input").length && (a = c.next().find("input").val()),
						a
					}
					();
					b.push({
						type : d,
						value : e
					})
				}),
				b
			}
			(),
			k = function () {
				var a = null;
				return f.$gender.filter(":checked").length && (a = "true" === f.$gender.filter(":checked").val()),
				a
			}
			(),
			l = parseInt(f.$mpc.filter(":checked").val(), 10),
			m = {
				gender : k,
				tags : f.$tags.val(),
				location : f.$location.val(),
				city : f.$city.val(),
				owner : f.$owner.val(),
				shares : h,
				is_mpc : "number" == typeof l ? l : null,
				folder_id : f.$folder.val(),
				status : f.$status.val(),
				"function" : f.$function.val()
			};
			f.publish("ajax", {
				url : i.EDIT,
				data : {
					data : JSON.stringify({
						ids : f._ids,
						data : m
					})
				},
				type : "post"
			}, b().done(function (a) {
					f.$element.modal("hide"),
					a.status ? (f._onSuccess && f._onSuccess(), e.alert("success", j.SUCCESSFUL)) : e.alert("error", a.message)
				}), g)
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/merge-company/main.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3>\n        <span data-weave="shared/helper/translation" data-i18n="Merge duplicate company"></span>\n    </h3>\n</div>\n<div class="modal-body">\n    <form action="#" class="form-horizontal" id="merge-company-form">\n        <div class="alert alert-error">\n            <p>被合并公司的所有数据，包括“Note”，“People”等都将被转移到以下所选公司，此步骤不可逆！</p>\n        </div>\n        <div class="control-group">\n            <label>请搜索并选择一家公司，接收被合并公司的数据</label>\n            <div class="input-prepend input-append">\n                <span class="add-on"><i class="icon-search"></i></span>\n                <input type="text" class="input-large search-input">\n                <button class="btn" data-weave="shared/helper/translation" data-i18n="Search" data-action="search/company"></button>\n            </div>\n        </div>\n        \n\n        <div class="search_page company-list widget-spin hide">\n            <div class="search_panel clearfix"></div>\n            <button class="btn" data-weave="shared/helper/translation" data-i18n="Merge Company" data-action="merge/company"></button>\n        </div>\n    </form>\n</div>';
		return a
	}
}), define("troopjs-requirejs/template!app/widget/modal/merge-company/company.html", [], function () {
	return function (a) {
		for (var b = "", c = 0, d = a.length; d > c; c++) {
			b += "\n";
			var e = a[c];
			b += '\n<div class="search_item">\n    <div>\n        <input type="radio" name="company" value="' + e.id + '">\n        <a href="/company#detail!id=' + e.id + '" target="_blank">' + e.name + '</a> <span class="muted"><span data-weave="shared/helper/translation" data-i18n="People"></span>: ' + e.people_count + "</span>\n    </div>\n    ",
			e.name1 && (b += "\n    <div>" + e.name1 + "</div>\n    "),
			b += "\n\n    ",
			e.name2 && (b += "\n    <div>" + e.name2 + "</div>\n    "),
			b += "\n</div>\n"
		}
		return b
	}
}), define("app/widget/modal/merge-company/main", ["jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "shared/helper/utils", "template!./company.html"], function (a, b, c, d, e, f) {
	function g() {
		var a = this;
		b(function (b) {
			a.html(d, a._json, b)
		}).done(function () {
			h.call(a)
		})
	}
	function h() {
		var a = this,
		b = a.$element;
		a.$list = b.find(".company-list"),
		b.on("hidden", function () {
			a.$list.find(".search_panel").empty(),
			a.$list.addClass("widget-spin hide")
		})
	}
	var i = {
		CLIENT : "/rest/client/",
		LIST : "/rest/client/list?company_name=",
		MERGE : "/rest/client/merge"
	};
	return c.extend({
		"hub:memory/context" : function (a, b) {
			var c = this;
			c.myself = {
				value : b.user.id,
				label : b.user.englishName
			},
			g.call(this)
		},
		"hub/modal/merge-company/show" : function (a, b) {
			var c = this,
			d = c.$element;
			d.find(".modal-footer button"),
			c._ids = b.ids,
			c._onSuccess = b.onSuccess,
			d.modal("show")
		},
		"dom/action.click.change" : a.noop,
		"dom/action/search/company.click" : function (c, d) {
			d.preventDefault();
			var e = this,
			g = e.$element.find(".search-input").val().trim(),
			h = a(d.target);
			g.length && (e.$list.removeClass("hide").addClass("widget-spin"), e.publish("ajax", {
					url : i.LIST + window.encodeURIComponent(g)
				}, b().done(function (c) {
						if (c.count) {
							var d = b(),
							g = a(f(c.list, d));
							g.find("[data-weave]").weave(),
							e.$list.find(".search_panel").html(g),
							e.$list.removeClass("widget-spin")
						} else
							e.$list.addClass("hide")
					}), h))
		},
		"dom/action/merge/company.click" : function (c, d) {
			d.preventDefault();
			var f,
			g = this,
			h = a(d.target),
			j = g.$list.find(":radio:checked");
			if (j.length) {
				var k = parseInt(j.val(), 10);
				f = window.confirm("确定要合并到所选择的公司吗？"),
				f && g.publish("ajax", {
					url : i.MERGE,
					data : {
						data : JSON.stringify({
							merge_to : k,
							merge_from : g._ids
						})
					},
					type : "post"
				}, b().done(function (a) {
						g.$element.modal("hide"),
						a.status ? (e.alert("success", "合并成功！"), g._onSuccess && g._onSuccess(k)) : e.alert("error", a.message)
					}), h)
			}
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/offer-signed/main.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3 data-weave="shared/helper/translation" data-i18n="Offer Signed"></h3>\n</div>\n<div class="modal-body">\n\n    <form action="#" class="form-horizontal" id="offer-signed-form">\n\n        <div class="control-group">\n            <label class="control-label" data-weave="shared/helper/translation" data-i18n="Candidate"></label>\n            <div class="controls text_line">\n            </div>\n        </div>\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Total Package"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <input type="text" name="package" class="input-medium" data-i18n="Currency symbol" data-weave="shared/helper/translation(\'placholder\')">\n                <span class="hint"><span data-i18n="Digits only" data-weave="shared/helper/translation"></span>, <span data-weave="shared/helper/translation" data-i18n="Currency unit"></span>  300000</span>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Salary Structure"></span>\n            </label>\n            <div class="controls">\n                <textarea name="salaryStructure" class="span4" data-weave="shared/widget/common/autosize/main"></textarea>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Signed Date"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <input type="text" name="signed" class="input-medium" data-weave="shared/widget/common/date-picker/main">\n            </div>\n        </div>\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Onboard Date"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <input type="text" name="onboard" class="input-medium" data-weave="shared/widget/common/date-picker/main">\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Consultant"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <select name="consultant" class="input-medium"></select>\n                <div class="hint" data-weave="shared/helper/translation" data-i18n="The offer is recorded under this consultant\'s account in the KPI reports"></div>\n            </div>\n        </div>\n    </form>\n</div>\n<div class="modal-footer">\n    <button class="btn btn-danger pull-left hide" data-action="save(\'invalid\')" data-weave="shared/helper/translation" data-i18n="Backout"></button>\n    <button class="btn btn-primary btn-reactive hide" data-action="save(\'reactive\')" data-weave="shared/helper/translation" data-i18n="Cancel Backout"></button>\n    <button class="btn btn-primary btn-save hide" data-action="save" data-weave="shared/helper/translation" data-i18n="Save" form="offer-signed-form"></button>\n</div>';
		return a
	}
}), define("app/widget/modal/offer-signed/main", ["compose", "jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "shared/helper/utils", "shared/helper/validate"], function (a, b, c, d, e, f, g) {
	function h(a) {
		var b = this;
		b.html(e, b._json, a)
	}
	function i(a) {
		var b = this,
		c = b.$element;
		b.$form = c.find("form"),
		b.$signed = c.find('[name="signed"]'),
		b.$package = c.find('[name="package"]'),
		b.$onboard = c.find('[name="onboard"]'),
		b.$consultant = c.find('[name="consultant"]'),
		b.$salaryStructure = c.find('[name="salaryStructure"]'),
		b.$btnSave = c.find(".btn-save"),
		b.$btnReactive = c.find(".btn-reactive"),
		b.$btnDanger = c.find(".btn-danger"),
		g(b.$form, {
			rules : {
				"package" : {
					required : !0,
					number : !0,
					min : 0
				},
				signed : {
					required : !0
				},
				onboard : {
					required : !0
				},
				consultant : {
					required : !0
				}
			}
		}),
		b.$element.on("hidden", function () {
			b.$consultant.unweave(),
			b.$btnSave.addClass("hide"),
			b.$btnReactive.addClass("hide"),
			b.$btnDanger.addClass("hide")
		}),
		a.resolve()
	}
	var j = {
		SIGN : "/rest/joborder/shortlist/<sid>/offersign",
		INVALID_OFFER : "rest/joborder/shortlist/<sid>/invalidoffersign"
	},
	k = "shared/widget/common/user-list/main";
	return d.extend({
		"sig/initialize" : function (a, b) {
			h.call(this, b)
		},
		"sig/start" : function (a, b) {
			i.call(this, b)
		},
		"hub/modal/offersigned/show" : function (a, b) {
			var d = this,
			e = d.$element,
			f = e.find(".text_line"),
			g = c();
			d._obj = b,
			d._id = b.id,
			d._onSuccess = b.onSuccess,
			b.detail ? (d._detail = b.detail, d.$signed.val(d.formatDate(d._detail.signDate)), d.$onboard.val(d.formatDate(d._detail.onboardDate)), d.$package.val(d._detail.annualSalary), d.$salaryStructure.val(d._detail.salaryStructure), g.done(function () {
					d.$consultant.val(d._detail.user.id).trigger("change")
				}), d._detail.active ? (d.$btnDanger.removeClass("hide"), d.$btnSave.removeClass("hide")) : d.$btnReactive.removeClass("hide")) : d.$btnSave.removeClass("hide"),
			b.mainConsultantId && g.done(function () {
				d.$consultant.val(b.mainConsultantId).trigger("change")
			}),
			d.$consultant.data("list", b.userlist).attr("data-weave", k + "(list)").weave(g),
			f.text(b.name),
			e.modal("show")
		},
		"dom/action.click" : b.noop,
		"dom/action/save.click" : function (a, d, e) {
			var g = this,
			h = g.$element,
			i = b(d.target);
			if (g.$form.valid()) {
				var k = {
					signDate : g.$signed.val(),
					onboardDate : g.$onboard.val(),
					annualSalary : g.$package.val().trim(),
					salaryStructure : g.$salaryStructure.val(),
					user_id : g.$consultant.val(),
					active : "invalid" === e ? !1 : !0
				};
				g._obj.detail && (k.id = g._detail.id),
				g.publish("ajax", {
					url : j.SIGN.replace("<sid>", g._id),
					data : {
						data : JSON.stringify(k)
					},
					type : "post"
				}, c().done(function (a) {
						h.modal("hide"),
						a.status ? ("invalid" == e ? f.alert("success", "Offer已作废") : "reactive" === e ? f.alert("success", "Offer已取消作废") : f.alert("success", "Offer保存成功"), g._onSuccess && g._onSuccess(a)) : f.alert("error", a.message)
					}), i)
			}
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/onboard/main.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3 data-weave="shared/helper/translation" data-i18n="Onboard"></h3>\n</div>\n<div class="modal-body">\n    <form action="#" class="form-horizontal" id="onboard-form">\n        \n        <div class="control-group">\n            <label for="" class="control-label" data-weave="shared/helper/translation" data-i18n="Candidate"></label>\n            <div class="controls text_line">\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label for="" class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Onboard Date"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <input name="onboard" type="text" class="input-medium" data-weave="shared/widget/common/date-picker/main">\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Probation End"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <input name="probation" type="text" class="input-medium" data-weave="shared/widget/common/date-picker/main">\n                <span class="hint">试用期结束系统会自动提醒</span>\n            </div>\n        </div>\n    </form>\n</div>\n<div class="modal-footer">\n    <button class="btn btn-primary" data-action="save" data-weave="shared/helper/translation" data-i18n="Save" form="onboard-form"></button>\n</div>';
		return a
	}
}), define("app/widget/modal/onboard/main", ["compose", "jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "shared/helper/utils", "shared/helper/validate"], function (a, b, c, d, e, f, g) {
	function h(a) {
		var b = this;
		b.html(e, b._json, a)
	}
	function i(a) {
		var b = this;
		b.$form = b.$element.find("form"),
		b.$onboard = b.$element.find('[name="onboard"]'),
		b.$probation = b.$element.find('[name="probation"]'),
		g(b.$form, {
			rules : {
				onboard : {
					required : !0
				},
				probation : {
					required : !0
				}
			}
		}),
		a.resolve()
	}
	var j = "/rest/joborder/shortlist/<id>/onboard";
	return d.extend({
		"sig/initialize" : function (a, b) {
			h.call(this, b)
		},
		"sig/start" : function (a, b) {
			i.call(this, b)
		},
		"hub/modal/onboard/show" : function (a, b) {
			var c = this,
			d = c.$element,
			e = d.find(".text_line");
			c._flowId = null,
			c._id = b.id,
			c._detail = b.detail,
			c._onSuccess = b.onSuccess,
			c._detail && (c._flowId = c._detail.id, c.$probation.val(c.formatDate(c._detail.probationDate)), c.$onboard.val(c.formatDate(c._detail.onboardDate))),
			e.text(b.name),
			d.modal("show")
		},
		"dom/action.click" : b.noop,
		"dom/action/save.click" : function (a, d) {
			var e = this,
			g = e.$element,
			h = b(d.target);
			if (e.$form.valid()) {
				if (!e._id)
					return f.alert("error", "对不起，信息有丢失，请刷新页面后重试！"), void 0;
				var i = {
					onboardDate : e.$onboard.val(),
					probationDate : e.$probation.val()
				};
				e._flowId && (i.id = e._flowId),
				e.publish("ajax", {
					url : j.replace("<id>", e._id),
					data : {
						data : JSON.stringify(i)
					},
					type : "post"
				}, c().done(function (a) {
						g.modal("hide"),
						a.status ? (f.alert("success", "候选人的基本信息已经更新（包括目前公司，职位及薪资），候选人状态已更新为“成功的候选人”"), e._onSuccess && e._onSuccess(a)) : f.alert("error", a.message)
					}), h)
			}
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/paste-resume/main.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3 data-weave="shared/helper/translation" data-i18n="Paste Resume"></h3>\n</div>\n<div class="modal-body shrink">\n\n    <form action="#" class="form-horizontal" id="paste-resume-form">\n    \n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="File Name"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <input type="text" name="name" class="required span5" data-weave="shared/helper/translation(\'value\')" data-i18n="Paste Resume">\n            </div>\n        </div>\n        \n        <textarea name="paste-resume-content" data-weave="shared/widget/common/ckeditor/main"></textarea>\n\n    </form>\n</div>\n<div class="modal-footer">\n    <button class="btn btn-primary" data-action="save" data-weave="shared/helper/translation" data-i18n="Save" form="paste-resume-form"></button>\n</div>';
		return a
	}
}), define("app/widget/modal/paste-resume/main", ["jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "shared/helper/utils", "shared/helper/blurb", "shared/helper/validate"], function (a, b, c, d, e, f) {
	function g(a) {
		var b = this;
		b.html(d, a)
	}
	function h(a) {
		var b = this;
		b.$name = b.$element.find('[name="name"]'),
		b.$content = b.$element.find("textarea"),
		b.validate(b.$element.find("form")),
		a.resolve()
	}
	var i = {
		SAVE : "/rest/file/htmlfile"
	};
	return {
		SUCCESSFUL : f.t("Operate successfully")
	},
	c.extend({
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"sig/start" : function (a, b) {
			h.call(this, b)
		},
		"hub/modal/paste-resume/show" : function (a, b) {
			var c = this;
			c._onSuccess = b.onSuccess,
			c._externalId = b.external_id,
			c.publish("editor/reset"),
			c.$element.modal("show")
		},
		"dom/action.click" : a.noop,
		"dom/action/save.click" : function (c, d) {
			d.preventDefault();
			var f = this,
			g = a(d.target);
			f.publish("ajax", {
				url : i.SAVE,
				data : {
					data : JSON.stringify({
						html : ["<html><head><title></title></head><body>" + CKEDITOR.instances[f.$content.attr("name")].getData() + "</body></html>"],
						originname : f.$name.val().trim(),
						external_id : f._externalId
					})
				},
				type : "post"
			}, b().done(function (a) {
					a.status ? f._onSuccess(a) : e.alert(a.message),
					f.$element.modal("hide")
				}), g)
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/payment-received/main.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button> \n    <h3 data-weave="shared/helper/translation" data-i18n="Invoice received payment"></h3>\n</div>\n<div class="modal-body">\n    <p>\n        这笔发票已经到款了?\n    </p>\n     <form action="#" class="form-horizontal" id="payment-received-form">\n        \n        <div class="control-group">\n            <label for="" class="control-label" data-weave="shared/helper/translation" data-i18n="Invoice Amount"></label>\n            <div class="controls text_line">\n                ￥ <span class="text"></span>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label for="" class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Payment Received"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <input name="payment" type="text" class="input-medium">\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label for="" class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Received Date"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <input name="receivedDate" type="text" class="input-medium" data-weave="shared/widget/common/date-picker/main">\n            </div>\n        </div>\n    </form>\n    \n</div>\n<div class="modal-footer">\n    <button class="btn" data-dismiss="modal" data-weave="shared/helper/translation" data-i18n="Cancel"></button>\n    <button class="btn btn-primary" data-action="yes" data-weave="shared/helper/translation" data-i18n="Confirm" form="payment-received-form"></button>\n</div>';
		return a
	}
}), define("app/widget/modal/payment-received/main", ["compose", "jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "shared/helper/utils", "shared/helper/validate"], function (a, b, c, d, e, f, g) {
	function h(a) {
		var b = this;
		b.html(e, b._json, a)
	}
	function i(a) {
		var b = this;
		b.$form = b.$element.find("form"),
		b.$payment = b.$element.find('[name="payment"]'),
		b.$receivedDate = b.$element.find('[name="receivedDate"]'),
		g(b.$form, {
			rules : {
				payment : {
					required : !0,
					number : !0
				},
				receivedDate : {
					required : !0,
					dateISO : !0
				}
			}
		}),
		a.resolve()
	}
	var j = {
		PAYMENT_RECEIVED : "/rest/invoice/<id>/paymentreceived"
	};
	return d.extend({
		"sig/initialize" : function (a, b) {
			h.call(this, b)
		},
		"sig/start" : function (a, b) {
			i.call(this, b)
		},
		"hub/modal/payment-received/show" : function (a, b, c, d) {
			var e = this,
			f = e.$element;
			f.find(".modal-footer button"),
			e._id = c,
			e._onSuccess = d,
			e.$element.find(".text_line .text").text(e.formatCurrency(b)),
			f.modal("show")
		},
		"dom/action.click" : b.noop,
		"dom/action/yes.click" : function (a, d) {
			d.preventDefault();
			var e = this,
			g = e.$element,
			h = b(d.target);
			if (e.$form.valid()) {
				var i = {
					paymentReceivedDate : e.$receivedDate.val(),
					paymentReceived : e.$payment.val().trim()
				};
				g.modal("hide"),
				e.publish("ajax", {
					url : j.PAYMENT_RECEIVED.replace("<id>", e._id),
					data : {
						data : JSON.stringify(i)
					},
					type : "post"
				}, c().done(function (a) {
						a.status ? (f.alert("success", "Add payment received successful!"), e._onSuccess && e._onSuccess(a)) : f.alert("error", "Add payment received error: " + a.message)
					}), h)
			}
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/reset-invoice/main.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3 data-weave="shared/helper/translation" data-i18n="Reset invoice"></h3>\n</div>\n<div class="modal-body">\n\n    <p>\n        确认后，发票状态将重置为：待财务开票<br>\n        并且系统将发消息通知所有项目成员\n    </p>\n\n</div>\n<div class="modal-footer">\n    <button class="btn" data-action="no" data-weave="shared/helper/translation" data-i18n="Cancel"></button>\n    <button class="btn btn-primary" data-action="yes" data-weave="shared/helper/translation" data-i18n="Confirm"></button>\n</div>';
		return a
	}
}), define("app/widget/modal/reset-invoice/main", ["compose", "jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "shared/helper/utils"], function (a, b, c, d, e, f) {
	function g(a) {
		var b = this;
		b.html(e, b._json, a)
	}
	function h(a) {
		a.resolve()
	}
	var i = {
		RESET_INVOICE : "/rest/invoice/<id>/resetinvoice"
	};
	return d.extend({
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"sig/start" : function (a, b) {
			h.call(this, b)
		},
		"hub/modal/reset-invoice/show" : function (a, b, c) {
			var d = this,
			e = d.$element;
			d._id = b,
			d._onSuccess = c,
			e.modal("show")
		},
		"dom/action.click" : b.noop,
		"dom/action/no.click" : function (a, b) {
			b.preventDefault();
			var c = this;
			c.$element.modal("hide")
		},
		"dom/action/yes.click" : function (a, d) {
			d.preventDefault();
			var e = this,
			g = b(d.target);
			e.publish("ajax", {
				url : i.RESET_INVOICE.replace("<id>", e._id),
				type : "post"
			}, c().done(function (a) {
					e.$element.modal("hide"),
					a.status ? (f.alert("success", "重置发票状态已成功！"), e._onSuccess && e._onSuccess()) : f.alert("error", a.message)
				}), g)
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/send-email/main.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\r\n    <button type="button" class="close" data-dismiss="modal">×</button>\r\n    <ul class="inline pull-right">\r\n        <li>\r\n            <span data-i18n="Autocomplate Email Type" data-weave="shared/helper/translation"></span>:\r\n            <select name="email-type" class="input-small" data-action="email/type">\r\n                <option value="email,email1,email2" data-i18n="Any email" data-weave="shared/helper/translation"></option>\r\n                <option value="email" data-i18n="Private email" data-weave="shared/helper/translation"></option>\r\n                <option value="email1" data-i18n="Work email" data-weave="shared/helper/translation"></option>\r\n                <option value="email2" data-i18n="Other" data-weave="shared/helper/translation"></option>\r\n            </select>\r\n        </li>\r\n        <li><a href="#" data-action="cc" data-weave="shared/helper/translation" data-i18n="Cc"></a></li>\r\n        <li><a href="#" data-action="bcc" data-weave="shared/helper/translation" data-i18n="Bcc"></a></li>\r\n        <li>\r\n            <a href="#" data-action="choose" data-i18n="Attachment" data-weave="shared/helper/translation"></a>\r\n        </li>\r\n    </ul>\r\n    <h3 data-weave="shared/helper/translation" data-i18n="Send Emails"></h3>\r\n</div>\r\n<div class="modal-body shrink">\r\n\r\n    <form action="#" class="form-horizontal" id="send-email-form">\r\n        <div class="control-group kpi-user hide">\r\n            <label class="control-label" data-weave="shared/helper/translation" data-i18n="KPI User"></label>\r\n            \r\n            <div class="controls">\r\n                <input name="kpi-user" class="input-large"/>\r\n                <span class="hint" data-weave="shared/helper/translation" data-i18n="CV Sent KPI user"></span>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="control-group">\r\n            <label class="control-label">\r\n                <span data-weave="shared/helper/translation" data-i18n="To"></span>\r\n                <span class="f_req">*</span>\r\n            </label>\r\n            <div class="controls">\r\n                <div class="span665">\r\n                    <input type="text" name="receiver" data-max="100" data-weave="app/widget/common/email-suggestion/main">\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="control-group control-cc hide">\r\n            <label class="control-label" data-weave="shared/helper/translation" data-i18n="Cc"></label>\r\n            <div class="controls">\r\n                <div class="span665">\r\n                    <input type="text" data-max="100" name="cc" data-weave="app/widget/common/email-suggestion/main">\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="control-group control-bcc hide">\r\n            <label class="control-label" data-weave="shared/helper/translation" data-i18n="Bcc"></label>\r\n            <div class="controls">\r\n                <div class="span665">\r\n                    <input type="text" data-max="100" name="bcc" data-weave="app/widget/common/email-suggestion/main">\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="control-group">\r\n            <label class="control-label">\r\n                <span data-weave="shared/helper/translation" data-i18n="Subject"></span>\r\n                <span class="f_req">*</span>\r\n            </label>\r\n            <div class="controls">\r\n                <input type="text" class="span655" name="subject">\r\n            </div>\r\n        </div>\r\n\r\n        <div class="control-group control-attachment hide">\r\n            <label class="control-label" for="" data-weave="shared/helper/translation" data-i18n="Attachment"></label>\r\n            <div class="controls text_line">\r\n                <ul class="unstyled">\r\n                </ul>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="control-group">\r\n            <label class="control-label">\r\n                <span data-i18n="Email Template" data-weave="shared/helper/translation"></span>\r\n            </label>\r\n            <div class="controls">\r\n                <select name="template" data-action="template" data-weave="shared/widget/common/select-template/main(\'candidate_email\')"></select>\r\n            </div>\r\n        </div>\r\n\r\n        <textarea name="send-email-content"  data-template="true" data-signature="true" data-weave="shared/widget/common/ckeditor/main"></textarea>\r\n\r\n    </form>\r\n</div>\r\n<div class="modal-footer">\r\n    <label class="checkbox pull-left">\r\n        <input type="checkbox" name="individually" value="true" checked="checked">\r\n        <span data-i18n="Send Personally" data-weave="shared/helper/translation"></span>\r\n    </label>\r\n    <button class="btn skip hide" data-action="skip" data-skip="1" data-weave="shared/helper/translation" data-i18n="Skip send"></button>\r\n    <button class="btn btn-primary" data-action="send" data-weave="shared/helper/translation" data-i18n="Send" form="send-email-form"></button>\r\n</div>';
		return a
	}
}), define("app/widget/modal/send-email/main", ["jquery", "troopjs-utils/deferred", "troopjs-utils/when", "shared/widget/modal/base", "template!./main.html", "shared/helper/utils", "shared/helper/validate", "app/widget/common/select2/main"], function (a, b, c, d, e, f, g) {
	function h() {
		var a = this,
		b = a.$element.find(".btn.disabled");
		b.length && b.removeClass("disabled"),
		a.publish("editor/reset"),
		a.$template.unweave(),
		a._templateId = "",
		a.$receiver.tagit("removeAll"),
		a.$controlCc.addClass("hide").find("input").tagit("removeAll"),
		a.$controlBcc.addClass("hide").find("input").tagit("removeAll"),
		a.$controlAttachment.addClass("hide").find("ul").html("")
	}
	function i() {
		var a = this;
		b(function (b) {
			a.html(e, b)
		}).done(function () {
			j.call(a)
		})
	}
	function j() {
		var a = this,
		b = a.$element;
		a.$form = b.find("form"),
		a.$receiver = b.find('[name="receiver"]'),
		a.$controlCc = b.find(".control-cc"),
		a.$controlBcc = b.find(".control-bcc"),
		a.$cc = b.find('[name="cc"]'),
		a.$bcc = b.find('[name="bcc"]'),
		a.$subject = b.find('[name="subject"]'),
		a.$controlAttachment = b.find(".control-attachment"),
		a.$content = b.find('[name="send-email-content"]'),
		a.$individually = b.find('[name="individually"]'),
		a.$kpiUser = b.find('[name="kpi-user"]'),
		a.$kpiControl = b.find(".kpi-user"),
		a.$template = b.find('[name="template"]'),
		g(a.$form, {
			rules : {
				receiver : {
					required : !0,
					emails : !0
				},
				cc : {
					emails : !0
				},
				bcc : {
					emails : !0
				},
				subject : {
					required : !0
				}
			}
		})
	}
	var k,
	l = {
		SEND_EMAIL : "/rest/mail/send",
		SIGNATURE : "/rest/data/userconfig/?user_id="
	},
	m = "shared/widget/common/select-template/main";
	return d.extend({
		"hub:memory/context" : function (a, b) {
			var c = this;
			c.userId = b.user.id,
			c.username = b.user.englishName,
			i.call(c)
		},
		"hub/modal/sendemail/show" : function (b, c, d) {
			var e = this,
			f = e.$element;
			if (d)
				e.publish("modal/register/cleanup");
			else {
				h.call(e),
				e._to = c.emails,
				e._onSuccess = c.onSuccess,
				e._forceRefresh = !0,
				e._cvSendUrl = c.cvSendUrl,
				e._category = c.category || "",
				e._jobsubmissionId = c.jobsubmissionId,
				e._templateVariable = c.templateVariable || {},
				e._emailTemplate = c.emailTemplate,
				e._joborderId = c.joborderId,
				e._parseEmail = c.parseEmail,
				c.individually === k || c.individually ? e.$individually.prop("checked", !0) : e.$individually.prop("checked", !1),
				e._parseEmail || 1 === e._to.length && !a.isEmptyObject(e._templateVariable) ? e.$template.data("variable", e._templateVariable).attr("data-weave", m + '("' + e._emailTemplate + '"")').weave() : e.$template.attr("data-weave", m + '("' + e._emailTemplate + '"")').weave(),
				c.refreshPage && (e._refreshPage = c.refreshPage),
				e._attachment = c.attachment ? c.attachment : null,
				e._checkAttachment = c.checkAttachment ? c.checkAttachment : !1,
				c.sids && (e._sids = c.sids),
				"cv_sent" === e._emailTemplate ? e.$kpiControl.removeClass("hide") : e.$kpiControl.addClass("hide"),
				"cv_sent" === c.type && c.skipSend ? (e.$element.find(".skip").removeClass("hide"), c.sender && (e.$kpiUser.select2({
							data : c.sender
						}), e.$kpiUser.val(c.myId).trigger("change"))) : e.$element.find(".skip").addClass("hide");
				for (var g = 0, i = c.names.length; i > g; g++)
					e.$receiver.tagit("createTag", c.names[g] + " <" + c.emails[g] + ">")
			}
			f.modal({
				show : !0,
				backdrop : "static"
			})
		},
		"hub/email/template/switch" : function (a, b) {
			var c = this;
			c.$element.is(":hidden") || (c._templateId = b.id, c.$subject.val(b.title))
		},
		"hub/receive/attachments" : function (a, b) {
			for (var c = this, d = "", e = 0, f = b.length; f > e; e++)
				c.$controlAttachment.find('[data-id="' + b[e].id + '"]').length || (d += '<li data-id="' + b[e].id + '">' + b[e].type + '<span class="file-type-icon ' + b[e].ext + '">' + b[e].name + '</span> <a href="#" data-action="attachment/remove"><span class="icon-remove-small"></span></a></li>');
			d.length && c.$controlAttachment.removeClass("hide").find("ul").append(d)
		},
		"dom/action.click.change" : a.noop,
		"dom/action/attachment/remove" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = window.confirm("确定要删除此附件吗？");
			e && a(c.target).closest("li").remove(),
			d.$controlAttachment.find("ul li").length || d.$controlAttachment.addClass("hide")
		},
		"dom/action/send.click" : function (d, e) {
			var g = this,
			h = a(e.target),
			i = g.$element,
			j = [];
			if (g.$form.valid()) {
				var k = function () {
					var b = [];
					return g.$controlAttachment.find("li").each(function () {
						b.push(a(this).data("id"))
					}),
					b.join()
				}
				(),
				m = {
					cc : g.$cc.val().replace(/\[.*\] /gi, ""),
					bcc : g.$bcc.val().replace(/\[.*\] /gi, ""),
					content : CKEDITOR.instances[g.$content.attr("name")].getData(),
					subject : g.$subject.val(),
					attachment : k,
					to : g.$receiver.val().replace(/\[.*\] /gi, ""),
					individually : g.$individually.is(":checked"),
					category : g._category,
					template_id : g._templateId,
					jobsubmission_id : g._jobsubmissionId,
					joborder_id : g._joborderId
				};
				if (g._templateVariable)
					for (var n in g._templateVariable)
						m[n] = g._templateVariable[n];
				if (h.data("skip")) {
					if (!window.confirm("Are you really want to proceed without sending email ?"))
						return;
					m.skip = 1
				} else if (!k && g._checkAttachment && !window.confirm("附件中还未选择候选人的推荐报告！请点击“确定”继续发送给客户，或者点击“取消”返回选择附件。"))
					return;
				var o = b();
				if (j.push(o.promise()), g.publish("ajax", {
						url : l.SEND_EMAIL,
						data : {
							data : JSON.stringify(m)
						},
						type : "post",
						dataType : "json"
					}, o.done(function (a) {
							a.status ? (f.alert("success", "邮件发送成功!"), g._onSuccess && g._onSuccess(a)) : f.alert("error", a.message)
						}), h), g._cvSendUrl) {
					var p = b();
					j.push(p.promise()),
					g.publish("ajax", {
						url : g._cvSendUrl,
						data : {
							data : JSON.stringify({
								sids : g._sids,
								user_id : g.$kpiUser.val()
							})
						},
						type : "post"
					}, p.done(function (a) {
							var b = a;
							if (b.status) {
								if (f.alert("success", "邮件发送成功!"), g._onSuccess)
									for (var c in b.data)
										g._onSuccess({
											status : b.status,
											data : b.data[c]
										})
							} else
								f.alert("error", b.message)
						}), h)
				}
				c.apply(a, j).done(function () {
					g._refreshPage && window.setTimeout(function () {
						window.location.reload()
					}, 500)
				}),
				i.modal("hide")
			}
		},
		"dom/action/skip.click" : function () {
			var a = this,
			c = a.$element;
			window.confirm("Are you really want to proceed without sending email ?") && (a.publish("ajax", {
					url : a._cvSendUrl,
					data : {
						data : JSON.stringify({
							sids : a._sids,
							user_id : a.$kpiUser.val()
						})
					},
					type : "post"
				}, b().done(function (b) {
						b.status ? (a._onSuccess && a._onSuccess(), a._refreshPage && window.setTimeout(function () {
								window.location.reload()
							}, 500)) : f.alert("error", b.message)
					})), c.modal("hide"))
		},
		"dom/action/cc.click" : function (b, c) {
			c.preventDefault();
			var d = this;
			a(c.target),
			d.$controlCc.hasClass("hide") ? d.$controlCc.removeClass("hide") : d.$controlCc.addClass("hide").find("input").tagit("removeAll")
		},
		"dom/action/bcc.click" : function (b, c) {
			c.preventDefault();
			var d = this;
			a(c.target),
			d.$controlBcc.hasClass("hide") ? d.$controlBcc.removeClass("hide") : d.$controlBcc.addClass("hide").find("input").tagit("removeAll")
		},
		"dom/action/choose.click" : function (a, b) {
			b.preventDefault();
			var c = this;
			c.publish("modal/unregister/cleanup"),
			c.$element.modal("hide"),
			c.publish("modal/attachments/show", c._attachment, c._forceRefresh, null, "modal/sendemail/show"),
			c._forceRefresh = !1
		},
		"dom/action/email/type.change" : function (b, c) {
			var d = this,
			e = a(c.target),
			f = e.val(),
			g = f.split(",");
			this._emailType = g,
			d.$receiver.data("emailType", g),
			d.$cc.data("emailType", g),
			d.$bcc.data("emailType", g)
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/setting-email/main.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3 data-weave="shared/helper/translation" data-i18n="Email Template"></h3>\n</div>\n<div class="modal-body">\n\n    <form action="#" class="form-horizontal" id="setting-email-form">\n        <div class="control-group formSep">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="名称"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <input type="text" name="email-name" class="input-xxlarge required">\n            </div>\n        </div>\n        <div class="control-group formSep">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Subject"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <input type="text" name="subject" class="input-xxlarge required">\n            </div>\n        </div>\n\n        <div class="control-group">\n            <textarea name="setting-content" data-variable="user,candidate,clientContact,job" data-weave="shared/widget/common/ckeditor/main"></textarea>\n        </div>\n\n    </form>\n</div>\n<div class="modal-footer">\n    <button class="btn" data-dismiss="modal" data-action="setting/popup/save" data-weave="shared/helper/translation" data-i18n="Cancel"></button>\n    <button class="btn btn-primary" data-action="setting/popup/save" data-weave="shared/helper/translation" data-i18n="Save" form="setting-email-form"></button>\n</div>';
		return a
	}
}), define("app/widget/modal/setting-email/main", ["jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "shared/helper/utils", "shared/helper/validate"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		b.html(d, a)
	}
	function g(a) {
		var b = this,
		c = b.$element;
		b.$email = c.find('[name="email-name"]'),
		b.$subject = c.find('[name="subject"]'),
		b.$editor = c.find("textarea"),
		b.$form = c.find("form"),
		b.editor = CKEDITOR.instances["setting-content"],
		a.resolve()
	}
	return c.extend({
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"sig/start" : function (a, b) {
			g.call(this, b)
		},
		"hub/modal/setting-email/show" : function (a, b, c, d, e, f, g, h, i, j) {
			var k = this,
			l = k.$element;
			k._url = b,
			k._onSuccess = c,
			k.$email.attr("name", d),
			k._userId = j,
			e ? (k.$email.val(f).data("id", e), k.$subject.val(g), k.editor.setData(h)) : (k.$email.val("").data("id", ""), k.$subject.val(""), k.editor.setData("")),
			l.modal("show")
		},
		"dom/action.click" : a.noop,
		"dom/action/setting/popup/save.click" : function (c, d) {
			d.preventDefault();
			var f = this,
			g = f.$element,
			h = a(d.target),
			i = f.$email.data("id"),
			j = f.$email.val(),
			k = f.$email.attr("name"),
			l = f.$subject.val(),
			m = {},
			n = f.editor.getData();
			if (f.$form.valid()) {
				if (!n)
					return f.editor.focusManage.focus(), void 0;
				m = {
					type : k,
					name : j,
					title : l,
					content : n,
					user_id : f._userId
				},
				i && (m.id = i),
				f.publish("ajax", {
					url : f._url,
					data : {
						data : JSON.stringify(m)
					},
					type : "post"
				}, b().done(function (a) {
						g.modal("hide"),
						a.status ? (f._onSuccess && f._onSuccess(), e.alert("success", "Update [ " + j + " ] success.")) : e.alert("error", a.message)
					}), h)
			}
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/share-revenue/main.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button> \n    <h3 data-weave="shared/helper/translation" data-i18n="Share revenue"></h3>\n</div>\n<div class="modal-body">\n    <form action="#" class="form-horizontal" id="share-revenue-form">\n        <div class="control-group">\n            <label class="control-label">Client: <span class="f_req">*</span></label>\n            <div class="controls">\n                <select name="client" class="input-medium" data-action="client">\n                    <option value="">Please select</option>\n                </select>\n            </div>\n        </div>\n        <table class="table">\n            <colgroup>\n                <col width="50%">\n                <col width="50%">\n            </colgroup>\n            <thead>\n                <tr>\n                    <th data-weave="shared/helper/translation" data-i18n="User"></th>\n                    <th data-weave="shared/helper/translation" data-i18n="Share Revenue"></th>\n                </tr>\n            </thead>\n            <tfoot>\n                <tr>\n                    <td colspan="2">\n                        <a href="#" data-action="add/user" data-weave="shared/helper/translation" data-i18n="Add more"></a>\n                    </td>\n                </tr>\n            </tfoot>\n            <tbody>\n                <tr>\n                    <td>\n                        <select name="user" class="input-medium">\n                            <option value="">Select User</option>\n                        </select>\n                    </td>\n                    <td>\n                        <div class="input-prepend">\n                            <span class="add-on"><span class="icon-cny"></span></span><input type="text" name="revenue" class="input-medium">\n                        </div>\n                    </td>\n                </tr>\n            </tbody>\n        </table>\n        <div class="control-group">\n            <label class="control-label">Note:</label>\n            <div class="controls">\n                <textarea name="note" class="span4" cols="60" rows="5"></textarea>\n            </div>\n        </div>\n    </form>\n    \n</div>\n<div class="modal-footer">\n    <button class="btn btn-primary" data-action="save" data-weave="shared/helper/translation" data-i18n="Save" form="share-revenue-form"></button>\n</div>';
		return a
	}
}), define("troopjs-requirejs/template!app/widget/modal/share-revenue/user.html", [], function () {
	return function () {
		var a = '<tr>\n    <td>\n        <select name="user" class="input-medium">\n            <option value="">Select User</option>\n        </select>\n    </td>\n    <td>\n        <div class="input-prepend">\n            <span class="add-on"><span class="icon-cny"></span></span><input type="text" name="revenue" class="input-medium">\n        </div>\n        <span>\n            <a href="#" class="remove" class="icon-remove" data-action="remove/user"></a>\n        </span>\n    </td>\n</tr>';
		return a
	}
}), define("app/widget/modal/share-revenue/main", ["compose", "jquery", "troopjs-utils/deferred", "troopjs-utils/when", "shared/widget/modal/base", "template!./main.html", "template!./user.html", "shared/helper/utils", "shared/helper/validate"], function (a, b, c, d, e, f, g, h, i) {
	function j(a, b) {
		for (var c, d = [], e = 0, f = b.length; f > e; e++)
			c = b[e].name || b[e].englishName, d.push("<option value='" + b[e].id + "'>" + c + "</option>");
		a.append(d.join(""))
	}
	function k(a) {
		var b = this;
		b.html(f, b._json, a)
	}
	function l(a) {
		var c = this,
		d = c.$element.find("form");
		c.$client = c.$element.find('[name="client"]'),
		c.$remaining = c.$element.find(".m-remaining"),
		c.$note = c.$element.find("[name=note]"),
		c.$tbody = c.$element.find("tbody"),
		b.get(m.CLIENT).done(function (a) {
			for (var b, d = [], e = 0, f = a.list.length; f > e; e++)
				b = a.list[e].name || a.list[e].englishName, d.push("<option value='" + a.list[e].id + "'>" + b + "</option>");
			c.$client.append(d.join(""))
		}),
		b.get(m.USER).done(function (a) {
			c._user = a,
			j(c.$element.find('select[name="user"]'), a)
		}),
		i(d, {
			rules : {
				client : {
					required : !0
				}
			}
		}),
		a.resolve()
	}
	var m = {
		CLIENT : "/rest/client/list?paginate_by=9999",
		USER : "/rest/data/userlist"
	};
	return e.extend(function () {}, {
		"sig/initialize" : function (a, b) {
			k.call(this, b)
		},
		"sig/start" : function (a, b) {
			l.call(this, b)
		},
		"hub/modal/share-revenue/show" : function (a, b) {
			var c = this;
			c._saveUrl = b.saveUrl,
			c._onSuccess = b.onSuccess,
			c.$element.modal("show")
		},
		"dom/action.click.change" : b.noop,
		"dom/action/save.click" : function (a, d) {
			d.preventDefault();
			var e = this,
			f = b(d.target),
			g = e.$element.find("form"),
			i = function () {
				var a = [];
				return e.$element.find('select[name="user"]').each(function () {
					var c = b(this).val();
					if (c) {
						var d = b(this).closest("td").next().find('input[name="revenue"]').val().trim();
						d && a.push({
							user_id : c,
							revenue : d,
							type : ""
						})
					}
				}),
				a
			}
			();
			if (!g.valid())
				return !1;
			var j = {
				client : {
					id : e.$client.val()
				},
				note : e.$note.val().trim(),
				assignments : i
			};
			e.$element.modal("hide"),
			e.publish("ajax", {
				url : e._saveUrl,
				data : {
					data : JSON.stringify(j)
				},
				type : "post"
			}, c().done(function (a) {
					a.status ? e._onSuccess(a) : h.alert("error", "Share revenue error: " + a.message)
				}), f)
		},
		"dom/action/client.change" : function (a, c) {
			var d = this,
			e = b(c.target);
			d.$remaining.text(d.formatCurrency(e.find("option:selected").attr("data-remaining")) || "")
		},
		"dom/action/add/user.click" : function (a, c) {
			c.preventDefault();
			var d = this,
			e = d.$element.find('select[name="user"]').prop("disabled", !0);
			d.$tbody.append(g());
			var f = d.$tbody.find('select[name="user"]').last();
			j(f, d._user),
			e.each(function () {
				var a = b(this).val();
				a && f.find('[value="' + b(this).val() + '"]').remove()
			})
		},
		"dom/action/remove/user.click" : function (a, c) {
			c.preventDefault();
			var d = this,
			e = b(c.target);
			e.closest("tr").remove(),
			d.$element.find('select[name="user"]').last().prop("disabled", !1)
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/target-company/main.html", [], function () {
	return function () {
		for (var a = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3 data-weave="shared/helper/translation" data-i18n="Target Company"></h3>\n</div>\n<div class="modal-body">\n\n    <form action="#" class="form-horizontal" id="target-company-form">\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Target Company"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <input type="text" name="target" class="span4 required">\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Notes"></span>\n            </label>\n            <div class="controls">\n                <textarea cols="30" rows="1" name="notes" class="span4" data-weave="shared/widget/common/autosize/main"></textarea>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Event Date"></span>\n            </label>\n            <div class="controls">\n                <input name="date" type="text" class="input-small required dateISO" data-weave="shared/widget/common/date-picker/main">\n                <select name="hour" class="input-mini">\n                    ', b = 0, c = 24; c > b; b++)
			a += '\n                    <option value="' + b + '">' + b + "</option>\n                    ";
		a += '\n                </select>\n                <select name="minute" class="input-mini">\n                    ';
		for (var b = 0, c = 60; c > b; b += 5)
			a += '\n                    <option value="' + b + '">' + b + "</option>\n                    ";
		return a += '\n                </select>\n            </div>\n        </div>\n\n    </form>\n</div>\n<div class="modal-footer">\n    <button class="btn btn-danger pull-left hide" data-dismiss="modal" data-action="delete" data-weave="shared/helper/translation" data-i18n="Delete"></button>\n    <button class="btn btn-primary" data-action="save" data-weave="shared/helper/translation" data-i18n="Save" form="target-company-form"></button>\n</div>'
	}
}), define("app/widget/modal/target-company/main", ["jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "template!app/widget/common/company-suggestion/main.html", "shared/helper/utils", "shared/helper/validate", "shared/helper/blurb", "app/widget/common/select2/main"], function (a, b, c, d, e, f, g, h) {
	function i(a) {
		var c = this;
		b(function (a) {
			c.html(d, c._json, a)
		}).done(function () {
			j.call(c, a)
		})
	}
	function j(b) {
		var c = this,
		d = c.$element;
		c.$form = d.find("form"),
		c.$target = d.find('[name="target"]'),
		c.$date = d.find('[name="date"]'),
		c.$hour = d.find('[name="hour"]'),
		c.$minute = d.find('[name="minute"]'),
		c.$notes = d.find('[name="notes"]'),
		c.$btnDel = d.find(".btn-danger"),
		c.$target.select2({
			placeholder : "请选择",
			minimumInputLength : 1,
			ajax : {
				url : k.CLIENT,
				dataType : "json",
				quietMillis : 100,
				data : function (a, b) {
					return {
						company_name : a,
						page : b
					}
				},
				results : function (a) {
					var b = a.current < a.pages;
					return {
						results : a.list,
						more : b
					}
				}
			},
			initSelection : function (b, c) {
				var d = a(b).val();
				"" !== d && a.ajax(k.CLIENT, {
					data : {
						id : d
					},
					dataType : "json"
				}).done(function (a) {
					a.list.length && c(a.list[0])
				})
			},
			formatResult : function (a) {
				return a.ctype = l[a.type],
				e(a)
			},
			formatSelection : function (a, b) {
				b.text(a.name)
			},
			escapeMarkup : function (a) {
				return a
			}
		}),
		g(c.$form, {}),
		d.on("hidden", function () {
			c.$target.val("").trigger("change"),
			c.$btnDel.addClass("hide")
		}),
		b.resolve()
	}
	var k = {
		SAVE : "/rest/candidate/targetcompany/add",
		DEL : "/rest/candidate/targetcompany/del",
		CLIENT : "/rest/client/list"
	},
	l = {
		client : h.t("client company"),
		bding : h.t("bding company"),
		normal : "",
		generated : ""
	};
	return c.extend({
		"sig/initialize" : function (a, b) {
			i.call(this, b)
		},
		"sig/stop" : function (a, b) {
			var c = this;
			c.$target.select2("destroy"),
			b.resolve()
		},
		"hub/modal/target-company/show" : function (a, b) {
			var c = this,
			d = c.$element;
			if (c.candidate_id = b.id, c.onSuccess = b.onSuccess, c.data = b.data, c.data) {
				c.$notes.val(c.data.note || "");
				var e = new Date(c.data.date);
				c.$date.val(e.getFullYear() + "-" + (parseInt(e.getMonth(), 10) + 1) + "-" + e.getDate()),
				c.$hour.val(e.getHours()),
				c.$minute.val(e.getMinutes()),
				c.$target.val(c.data.client.id).trigger("change"),
				c.$target.prop("disabled", !0),
				c.$btnDel.removeClass("hide")
			} else {
				var f = new Date;
				c.$date.val(f.getFullYear() + "-" + (f.getMonth() + 1) + "-" + f.getDate()),
				c.$hour.val(f.getHours()),
				c.$minute.val(5 * Math.floor(f.getMinutes() / 5)),
				c.$target.prop("disabled", !1)
			}
			d.modal("show")
		},
		"dom/action.click" : a.noop,
		"dom/action/save.click" : function (c, d) {
			d.preventDefault();
			var e = this,
			g = e.$element,
			h = a(d.targt);
			if (e.$form.valid()) {
				var i = {
					candidate_id : e.candidate_id,
					client_id : e.$target.val(),
					note : e.$notes.val(),
					date : e.$date.val() + " " + e.$hour.val() + ":" + e.$minute.val()
				};
				e.data && (i.id = e.data.id),
				g.modal("hide"),
				e.publish("ajax", {
					url : k.SAVE,
					data : {
						data : JSON.stringify(i)
					},
					type : "post"
				}, b().done(function (a) {
						g.modal("hide"),
						a.status ? (f.alert("success", "添加成功"), e.onSuccess && e.onSuccess()) : f.alert("error", a.message)
					}), h)
			}
		},
		"dom/action/delete.click" : function (c, d) {
			d.preventDefault();
			var e = this,
			g = e.$element,
			h = a(d.targt),
			i = window.confirm("确定要删除吗？");
			if (i) {
				var j = {
					ids : [e.data.id]
				};
				g.modal("hide"),
				e.publish("ajax", {
					url : k.DEL,
					data : {
						data : JSON.stringify(j)
					},
					type : "post"
				}, b().done(function (a) {
						g.modal("hide"),
						a.status ? e.onSuccess && e.onSuccess() : f.alert("error", a.message)
					}), h)
			}
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/tree-config/main.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3>编辑/新增节点名称</h3>\n</div>\n<div class="modal-body">\n    <form action="#" class="form-horizontal">\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="Node Name"></span>\n                <span class="f_req">*</span>\n            </label>\n            <div class="controls">\n                <input name="name" type="text" class="input-medium required">\n            </div>\n        </div>\n    </form>\n</div>\n<div class="modal-footer">\n    <button class="btn btn-primary" data-action="save" data-weave="shared/helper/translation" data-i18n="Confirm"></button>\n</div>';
		return a
	}
}), define("app/widget/modal/tree-config/main", ["jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "shared/helper/utils", "shared/helper/validate"], function (a, b, c, d, e, f) {
	function g(a) {
		var b = this;
		b.html(d, a)
	}
	function h(a) {
		var b = this;
		b.$form = b.$element.find("form"),
		b.$name = b.$element.find('[name="name"]'),
		f(b.$form),
		a.resolve()
	}
	return c.extend({
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"sig/start" : function (a, b) {
			h.call(this, b)
		},
		"hub/modal/tree-config/show" : function (a, b) {
			var c = this,
			d = c.$element;
			switch (c.operation = "", c.$tree = b.$tree, c.node = b.node, c.onSuccess = b.onSuccess, b.operation) {
			case "edit":
				c.operation = "updateNode",
				c.$name.val(c.node.name);
				break;
			case "after":
				c.operation = "addNodeAfter";
				break;
			case "before":
				c.operation = "addNodeBefore";
				break;
			case "parent":
				c.operation = "addParentNode";
				break;
			case "append":
				c.operation = "appendNode"
			}
			"edit" === c.operation && c.$name.val(c.node.name),
			d.modal("show")
		},
		"dom/action.click" : a.noop,
		"dom/action/save.click" : function (a, b) {
			b.preventDefault();
			var c = this,
			d = c.$element;
			return c.$form.valid() ? (d.modal("hide"), "updateNode" === c.operation ? c.$tree.tree("updateNode", c.node, c.$name.val().trim()) : c.$tree.tree(c.operation, {
					label : c.$name.val().trim()
				}, c.node), void 0) : !1
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/upload-document/main.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3 data-weave="shared/helper/translation" data-i18n="File upload"></h3>\n</div>\n<div class="modal-body" style="height: 380px;">\n    <form action="#" class="form-horizontal">\n        \n        <div class="control-group">\n            <label class="control-label" data-weave="shared/helper/translation" data-i18n="Folder"></label>\n            <div class="controls">\n                <div class="comtree span3" data-name="folder" data-weave="shared/widget/common/comtree/main"></div>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label for="" class="control-label" data-weave="shared/helper/translation" data-i18n="File upload"></label>\n            <div class="controls">\n                <div class="upload-file"></div>\n                <p class="hint">支持文件多选(按Shift键),批量上传</p>\n            </div>\n        </div>\n    </form>\n</div>\n<div class="modal-footer">\n    <button class="btn" data-action="close" data-weave="shared/helper/translation" data-i18n="Close"></button>\n</div>';
		return a
	}
}), define("app/widget/modal/upload-document/main", ["jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "shared/helper/utils"], function (a, b, c, d, e) {
	function f() {
		var a = this;
		a.$btnFile.data("json", {
			multiple : !0,
			data : {
				type : "document"
			},
			beforeUpload : function () {
				return a.$folder.val().length ? (this.data.folder_id = a.$folder.val(), !0) : (e.alert("error", "请先选择文件夹!"), !1)
			},
			beforeSubmit : function () {
				this.$controls = a.$btnFile.closest(".controls"),
				this.$controls.addClass("text_line")
			},
			success : function (b) {
				this.$controls.removeClass("text_line"),
				b.status ? (a._onSuccess && a._onSuccess(b), e.alert("success", "文档上传成功!"), a.$element.modal("hide")) : e.alert("error", b.message)
			},
			error : function () {
				this.$controls.removeClass("text_line")
			}
		}).attr("data-weave", "shared/widget/common/upload/main(json)").weave()
	}
	function g(a) {
		var b = this;
		b.html(d, b._json, a)
	}
	function h(a) {
		var b = this;
		b.$form = b.$element.find("form"),
		b.$folder = b.$element.find('[name="folder"]'),
		b.$btnFile = b.$element.find(".upload-file"),
		b.folderWidget = b.$element.find('[data-name="folder"]').woven()[0],
		f.call(b),
		a.resolve()
	}
	return c.extend({
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"sig/start" : function (a, b) {
			h.call(this, b)
		},
		"hub:memory/update/document/folder" : function (a, b) {
			var c = this;
			c.folderWidget.loadData(b)
		},
		"hub/modal/upload-document/show" : function (a, b) {
			var c = this,
			d = c.$element;
			c._onSuccess = b.onSuccess,
			d.modal("show")
		},
		"dom/action.click" : a.noop,
		"dom/action/close.click" : function () {
			var a = this;
			a.$element.modal("hide")
		}
	})
}), define("troopjs-requirejs/template!app/widget/modal/video/main.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3 data-weave="shared/helper/translation" data-i18n="Play Video"></h3>\n</div>\n<div class="modal-body">\n    <div class="video-wrapper">\n        <video id="modal-video" class="video-js vjs-default-skin" controls preload="auto" data-setup="{}" width="100%" height="100%"></video>\n    </div>\n</div>';
		return a
	}
}), define("app/widget/modal/video/main", ["jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "shared/helper/utils", "videojs"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		b.html(d, b._json, a)
	}
	function f(a) {
		var b = this,
		c = b.$element;
		b.player = videojs("modal-video"),
		c.on("hide", function () {
			b.player.pause()
		}),
		a.resolve()
	}
	return c.extend({
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		},
		"sig/start" : function (a, b) {
			f.call(this, b)
		},
		"hub/modal/video/show" : function (a, b) {
			var c = this,
			d = c.$element;
			c.player.src(b),
			d.modal({
				show : !0,
				backdrop : "static"
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/notification-center/filter/main.html", [], function () {
	return function () {
		var a = '<ul class="nav nav-pills line_sep">\n    <li class="dropdown">\n        <a href="#" class="dropdown-toggle" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Category"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <select name="type" class="input-medium">\n                        <option value="Request for Share" data-weave="shared/helper/translation" data-i18n="Request Share"></option>\n                        <option value="Shared" data-weave="shared/helper/translation" data-i18n="Has Shared"></option>\n                        <option value="Reminder" data-weave="shared/helper/translation" data-i18n="Calendar Reminder"></option>\n                        <option value="Shortlist" data-weave="shared/helper/translation" data-i18n="Shortlist"></option>\n                        <option value="Offer Signed" data-weave="shared/helper/translation" data-i18n="Offer Signed"></option>\n                        <option value="Job Rejected" data-weave="shared/helper/translation" data-i18n="Job Rejected"></option>\n                        <option value="Invoice Added" data-weave="shared/helper/translation" data-i18n="Invoice Added"></option>\n                        <option value="Invoice edited" data-weave="shared/helper/translation" data-i18n="Invoice edited"></option>\n                        <option value="Invoice To be sent" data-weave="shared/helper/translation" data-i18n="Invoice To be sent"></option>\n                        <option value="Invoice Received" data-weave="shared/helper/translation" data-i18n="Invoice Received"></option>\n                        <option value="Invoice Invalid" data-weave="shared/helper/translation" data-i18n="Invoice Invalid"></option>\n                        <option value="Candidate Edited" data-weave="shared/helper/translation" data-i18n="Candidate Edited"></option>\n                    </select>\n                </div>\n                <button class="btn" type="submit" data-action="form(\'type\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" class="dropdown-toggle" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Date"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <ul class="unstyled">\n                    <li>\n                        <a href="#dateAdded__today=" data-action="date" data-weave="shared/helper/translation" data-i18n="Today"></a>\n                    </li>\n                    <li>\n                        <a href="#dateAdded__this_week=" data-action="date" data-weave="shared/helper/translation" data-i18n="This week"></a>\n                    </li>\n                    <li>\n                        <a href="#dateAdded__this_month=" data-action="date" data-weave="shared/helper/translation" data-i18n="This month"></a>\n                    </li>\n                    <li>\n                        <a href="#dateAdded__six_months_ago=" data-action="date" data-weave="shared/helper/translation" data-i18n="> 6 months"></a>\n                    </li>\n                </ul>\n                <p>\n                    <input type="text" name="from" class="input-small" data-weave="shared/widget/common/date-picker/main">\n                    -\n                    <input type="text" name="to" class="input-small" data-weave="shared/widget/common/date-picker/main">\n                </p>\n                \n                <button class="btn" type="submit" data-action="form(\'date\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n</ul>\n\n<p class="sepH_b">\n    <span class="tag label label-info deletable hide" data-query="type" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Category"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="date" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Date"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <a href="#" class="hide save-filter" data-action="filter/save/toggle" data-weave="shared/helper/translation" data-i18n="Save as"></a>\n</p>\n\n<form action="#" class="form-horizontal save-filter-form hide">\n    <input type="text" class="input-medium">\n    <button class="btn" data-action="filter/save" data-weave="shared/helper/translation" data-i18n="Save"></button>\n    <button class="btn" data-action="filter/save/toggle" data-weave="shared/helper/translation" data-i18n="Close"></button>\n</form>\n\n<p class="sepH_b">\n    <button class="btn" data-action="filter/search" data-weave="shared/helper/translation" data-i18n="Search"></button>\n</p>';
		return a
	}
}), define("app/widget/notification-center/filter/main", ["compose", "jquery", "shared/widget/filter/base", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "shared/helper/utils", "shared/widget/filter/query"], function (a, b, c, d, e, f, g, h) {
	function i() {
		var a;
		h.addAttr({
			type : function (b) {
				a = b.find("select").val(),
				a.length && this.addQuery("type", "type=" + window.encodeURIComponent(a))
			},
			date : function (a) {
				var b = a.find('input[name="from"]').val(),
				c = a.find('input[name="to"]').val();
				b && c && this.addQuery("date", "dateAdded__gt=" + b + "&dateAdded__lt=" + c)
			}
		})
	}
	function j(a) {
		this.html(f, this._json, a)
	}
	function k(a) {
		var c,
		d = this,
		e = a[0],
		f = a[1];
		switch (e.indexOf("dateAdded") > -1 && (e = "dateAdded"), e) {
		case "dateAdded":
			if (a[0].indexOf("gt") > -1 || a[0].indexOf("lt") > -1) {
				if (a[0].indexOf("gt") > -1 ? d.updateFrom = f : a[0].indexOf("lt") > -1 && (d.updateTo = f), d.updateFrom && d.updateTo)
					return d.$element.find('[data-query="date"]').removeClass("hide").find("span").text(d.updateFrom + " - " + d.updateTo), h.addQuery("date", "dateAdded__gt=" + d.updateFrom + "&dateAdded__lt=" + d.updateTo), void 0
			} else
				d.$element.find('a[data-action="date"]').each(function () {
					return b(this).attr("href").substring(1) == a[0] + "=" ? (c = b(this).text(), !1) : void 0
				}), d.$element.find('[data-query="date"]').removeClass("hide").find("span").text(c), h.addQuery("date", a[0] + "=");
			break;
		case "type":
			c = d.$element.find('[name="' + e + '"]').find('[value="' + window.decodeURIComponent(f) + '"]').text(),
			d.$element.find('[data-query="' + e + '"]').removeClass("hide").find("span").text(c),
			h.addQuery(e, e + "=" + f);
			break;
		case "byfilter":
			break;
		default:
			d.$element.find('[data-query="' + e + '"]').removeClass("hide").find("span").text(window.decodeURIComponent(f)),
			h.addQuery(e, e + "=" + f)
		}
	}
	var l = {
		SAVE_FILTER : "/rest/data/queryfilter/message/add"
	};
	return c.extend(function () {
		var a = this;
		h.url = l.SAVE_FILTER,
		a._setFilter = k,
		i.call(a)
	}, {
		"sig/initialize" : function (a, b) {
			j.call(this, b)
		},
		"hub:memory/filter/set" : a.around(function (a) {
			return function (b, c) {
				a.call(this, b, c)
			}
		}),
		"dom/action.click" : b.noop,
		"dom/action/date.click" : function (a, c) {
			c.preventDefault();
			var d = b(c.target);
			b('[data-query="date"]').removeClass("hide").find("span").text(d.text()),
			h.addQuery("date", d.attr("href").substring(1)),
			d.closest("form").find("button").trigger("click")
		}
	})
}), define("troopjs-requirejs/template!app/widget/notification-center/item.html", [], function () {
	return function (a) {
		function b(a) {
			return [a.englishName, a.chineseName].join(" ")
		}
		var c = "",
		d = a,
		e = d.dateAdded.split(" "),
		f = e[0],
		g = e[1],
		h = d.fromuser;
		d.touser;
		var i;
		switch (d.type) {
		case "Request for Share":
		case "Offer Signed":
		case "Candidate Edited":
			i = "label-pink";
			break;
		case "Shared":
		case "Invoice Received":
			i = "label-red";
			break;
		case "Invoice Added":
		case "Invoice edited":
		case "Shortlist":
			i = "label-purple";
			break;
		case "Invoice To be sent":
			i = "label-lightblue";
			break;
		case "Invoice Sent":
			i = "label-blue";
			break;
		case "Job Rejected":
			i = "label-inverse"
		}
		return c += '\n\n<div class="activity-item clearfix">\n    ',
		"Request for Share" === d.type || "Shared" === d.type ? (c += '\n    <div class="pull-left span2 activity-time">\n        <p>\n            <span>' + g + "</span>\n            <span>" + f + '</span>\n        </p>\n    </div>\n    <div class="pull-left span10 activity-detail">\n        \n        <div class="well">\n            <div class="title">\n                <span class="label" data-weave="shared/helper/translation" data-i18n="' + d.type + '"></span>\n                <span class="pull-right">\n                    ', c += "Shared" === d.type || d.processed ? "\n                    <span>已共享</span>\n                    " : '\n                    <button class="btn btn-primary btn-mini" data-action="confirm/share(' + d.candidate.id + ", " + h.id + ", " + d.id + ')">共享</button>\n                    ', c += '\n                </span>\n            </div>\n            <div class="content">\n                <p>\n                    <a href="/candidate#detail!id=' + d.candidate.id + '" target="_blank">' + b(d.candidate) + '</a>\n                </p>\n                <p>\n                    From: <a href="/user#detail!id=' + h.id + '" data-action="profile/open">' + h.englishName + "</a>\n                </p>\n                \n            </div>\n        </div>\n        \n    </div>\n\n    ") : "Invoice To be sent" === d.type || "Invoice Added" === d.type || "Invoice Invalid" === d.type || "Offer Signed" === d.type || "Invoice edited" === d.type || "Invoice Sent" === d.type || "Invoice Received" === d.type || "Job Rejected" === d.type || "Shortlist" === d.type ? c += '\n    <div class="pull-left span2 activity-time">\n        <p>\n            <span>' + g + "</span>\n            <span>" + f + '</span>\n        </p>\n    </div>\n    <div class="pull-left span10 activity-detail">\n        <div class="well">\n            <div class="title">\n                <span class="label ' + i + '" data-weave="shared/helper/translation" data-i18n="' + d.type + '"></span>\n            </div>\n            <div class="content">\n                <p>\n                    <a href="/job#detail!id=' + d.joborder.id + '" target="_blank">' + d.joborder.jobTitle + " (ID: " + d.joborder.id + ')</a> \n                </p>\n                <p>\n                    <a href="/candidate#detail!id=' + d.candidate.id + '" data-action="profile/open">' + b(d.candidate) + "</a> \n                </p>\n                \n            </div>\n        </div>\n    </div>\n    " : "Candidate Edited" === d.type && (c += '\n    <div class="pull-left span2 activity-time">\n        <p>\n            <span>' + g + "</span>\n            <span>" + f + '</span>\n        </p>\n    </div>\n    <div class="pull-left span10 activity-detail">\n        <div class="well">\n            <div class="title">\n                <span class="label ' + i + '" data-weave="shared/helper/translation" data-i18n="' + d.type + '"></span>\n            </div>\n            <div class="content">\n                <p>\n                    候选人: <a href="/candidate#detail!id=' + d.candidate.id + '" target="_blank">' + b(d.candidate) + '</a> \n                </p>\n                <p>\n                    编辑者: <a href="/user/preview#' + d.fromuser.id + '" data-action="profile/open">' + d.fromuser.englishName + "</a> \n                </p>                \n            </div>\n        </div>\n    </div>\n    "),
		c += "\n</div>"
	}
}), define("app/widget/notification-center/item", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "shared/helper/utils", "template!./item.html"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		c(function (a) {
			b.html(e, b._json, a)
		}).then(function () {
			a.resolve()
		})
	}
	var g = {
		ADD_SHARE : "/rest/candidate/<id>/addshare"
	};
	return b.extend(function (a, b, c) {
		var d = this;
		d._json = c
	}, {
		"sig/initialize" : function (a, b) {
			var c = this;
			f.call(c, b)
		},
		"dom/action.click" : a.noop,
		"dom/action/confirm/share.click" : function (b, e, f, h, i) {
			e.preventDefault();
			var j = this,
			k = a(e.target),
			l = window.confirm("确认要共享此候选人?");
			l && j.publish("ajax", {
				url : g.ADD_SHARE.replace("<id>", f),
				data : {
					data : JSON.stringify({
						shares : [{
								type : "people",
								value : h
							}
						],
						message_id : i
					})
				},
				type : "post",
				dataType : "json"
			}, c().done(function (a) {
					if (a.status) {
						var b = k.closest(".pull-right");
						b.text("已共享")
					} else
						d.alert("error", "Share candidate error.")
				}))
		},
		"dom/action/profile/open.click" : function (b, c) {
			c.preventDefault();
			var e = a(c.target),
			f = e.attr("href");
			d.window({
				url : f,
				name : "User Profile",
				width : "1024"
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/notification-center/list/main.html", [], function () {
	return function () {
		var a = '<!-- pagination -->\n<div class="pagination clearfix hide" data-weave="shared/widget/pagination/main(\'' + this._listType + '\')"></div>\n\n<div class="row-fluid loading-area widget-spin"></div>\n\n<!-- pagination -->\n<div class="pagination clearfix hide" data-weave="shared/widget/pagination/main(\'' + this._listType + "')\"></div>";
		return a
	}
}), define("app/widget/notification-center/list/main", ["jquery", "shared/widget/list/base", "troopjs-utils/deferred", "template!./main.html"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		c(function (a) {
			b.html(d, a)
		}).done(function () {
			b.$container = b.$element.find(".row-fluid"),
			a.resolve()
		})
	}
	var f = {
		LIST : "/rest/user/msglist?paginate_by=20"
	};
	return b.extend(function () {
		this._url = f.LIST,
		this._listType = "notification-center"
	}, {
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		},
		"hub:memory/route" : function (a, b) {
			var c = this;
			c.publish("service/route", b),
			b.source || c.publish("sidebar/set/default")
		},
		appendItems : function (a) {
			var b = this;
			a.forEach(function (a) {
				b.$container.append('<div class="activity-item clearfix"></div>'),
				b.$container.children().last().data("json", a).attr("data-weave", "app/widget/notification-center/item(json)").weave()
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/plugins/import-excel/main.html", [], function () {
	return function () {
		var a = '<p class="muted">在使用前请您耐心仔细阅读地<a href="http://support.gllue.com/?p=798" target="_blank" data-weave="shared/helper/translation" data-i18n="Tutorial"></a>。</p>\n<p class="muted">下载<a href="/rest/importer/export_template?model=candidate">Gllue Excel导入模版</a></p>\n\n<form action="#" class="form-horizontal" type="post" enctype="multipart/form-data">\n    <fieldset>\n        <div class="control-group">\n            <label class="control-label" data-weave="shared/helper/translation" data-i18n="Upload Excel"></label>\n            <div class="controls">\n                <div class="upload-file"></div>\n            </div>\n\n            <div class="controls control-progress hide">\n                <div class="span4">\n                    <div class="progress progress-striped active">\n                        <div class="bar"></div>\n                    </div>\n                </div>\n            </div>\n\n        </div>\n\n        <div class="control-group control-result hide">\n            <label class="control-label"></label>\n            <div class="controls text_line">\n                <p class="file-name"></p>\n                <p>\n                    <span data-weave="shared/helper/translation" data-i18n="总数据"></span>:\n                    <b class="total-item"></b>\n                </p>\n                <p>\n                    <span data-weave="shared/helper/translation" data-i18n="出错数据"></span>:\n                    <b class="failed-item text-error"></b>\n                </p>\n\n                <p class="has-failed">\n                    Excel有错误数据，请下载以上文件，并且处理错误后再重新上传\n                </p>\n\n                <p class="no-failed">\n                    <button class="btn" data-weave="shared/helper/translation" data-i18n="Import to system" data-action="import/to/system"></button>\n                </p>\n            </div>\n        </div>\n    </fieldset>\n</form>';
		return a
	}
}), define("app/widget/plugins/import-excel/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d, e) {
	function f() {
		var a = this;
		a.$btnFile.data("json", {
			model : "candidate",
			url : i.IMPORT,
			beforeSubmit : function (b) {
				a.$progressControl.removeClass("hide"),
				a.$result.addClass("hide"),
				a.$hasFailed.add(a.$noFailed).addClass("hide"),
				a.fileName = b[0].value.name
			},
			uploadProgress : function (b, c, d, e) {
				a.$progressControl.find(".bar").width(e + "%")
			},
			success : function (b) {
				a.timeout = setTimeout(function () {
						a.$progressControl.addClass("hide")
					}, 500),
				a.$result.removeClass("hide"),
				b.status ? (a.uuidname = b.data.uuidname, a.$fileName.html('<a href="' + i.DOWNLOAD + a.uuidname + '">' + a.fileName + "</a>"), a.$total.text(b.data.total), a.$failed.text(b.data.failed), b.data.failed ? (a.$hasFailed.removeClass("hide"), a.$noFailed.find(".btn").addClass("disabled")) : (a.$noFailed.removeClass("hide"), a.$noFailed.find(".btn").removeClass("disabled"))) : e.alert("error", b.message)
			},
			error : function () {
				a.timeout = setTimeout(function () {
						a.$progressControl.addClass("hide")
					}, 500)
			},
			validate : function (a) {
				return /\.csv$/i.test(a.name) ? !0 : !1
			},
			onValidateError : function () {
				e.alert("error", "文件必须是csv格式文件")
			}
		}).attr("data-weave", "shared/widget/common/upload/main(json)").weave()
	}
	function g(a) {
		var b = this;
		b.html(d, a)
	}
	function h(a) {
		var b = this,
		c = b.$element;
		b.$btnFile = c.find(".upload-file"),
		b.$result = c.find(".control-result"),
		b.$progressControl = c.find(".control-progress"),
		b.$total = c.find(".total-item"),
		b.$failed = c.find(".failed-item"),
		b.$hasFailed = c.find(".has-failed"),
		b.$noFailed = c.find(".no-failed"),
		b.$fileName = c.find(".file-name"),
		f.call(b),
		a.resolve()
	}
	var i = {
		IMPORT : "/rest/importer/upload",
		DOWNLOAD : "/rest/file/download/"
	};
	return b.extend({
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"sig/start" : function (a, b) {
			h.call(this, b)
		},
		"sig/stop" : function (a, b) {
			var c = this;
			clearTimeout(c.timeout),
			b.resolve()
		},
		"dom/action.click" : a.noop,
		"dom/action/import/to/system.click" : function (b, d) {
			d.preventDefault();
			var f = this,
			g = a(d.target);
			f.publish("ajax", {
				url : i.IMPORT,
				data : {
					data : JSON.stringify({
						model : "candidate",
						uuidname : f.uuidname
					})
				},
				type : "post"
			}, c().done(function (a) {
					a.status && (a.data.failed ? (f.$fileName.find("a").attr("href", i.DOWNLOAD + a.data.uuidname), f.$total.text(a.data.total), f.$failed.text(a.data.failed), e.alert("success", "导入失败！"), f.$hasFailed.removeClass("hide"), f.$noFailed.addClass("hide")) : (e.alert("success", "导入成功！"), f.$result.addClass("hide")))
				}), g)
		}
	})
}), define("troopjs-requirejs/template!app/widget/plugins/import-resume/filter/main.html", [], function () {
	return function () {
		var a = '<ul class="nav nav-pills line_sep">\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Keywords"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <input type="text" name="keyword" data-weave="shared/widget/common/tagit/main">\n                    <div class="help-block" data-weave="shared/helper/translation" data-i18n="Separate keywords">Use "Enter" to separate multiple Keywords</div>\n                </div>\n                \n                <button class="btn" type="submit" data-action="form(\'keyword\')" data-weave="shared/helper/translation" data-i18n="Add"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Chinese Name"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <input type="text" class="input-medium" autocomplete="off">\n                </div>\n                <button class="btn" type="submit" data-action="form(\'chineseName\')" data-weave="shared/helper/translation" data-i18n="Add"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="English Name"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <input type="text" class="input-medium" autocomplete="off">\n                </div>\n                <button class="btn" type="submit" data-action="form(\'englishName\')" data-weave="shared/helper/translation" data-i18n="Add"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="City"></a>\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <div class="comtree span" data-name="city" data-url="/rest/data/city" data-weave="shared/widget/common/comtree/main"></div>\n                </div>\n                <button class="btn" type="submit" data-action="form(\'city\')" data-weave="shared/helper/translation" data-i18n="Add"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Company"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <input type="text" class="input-medium" autocomplete="off">\n                    <p class="help-block">只允许搜索单个关键字</p>\n                </div>\n                \n                <button class="btn" type="submit" data-action="form(\'company\')" data-weave="shared/helper/translation" data-i18n="Add"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Title"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <input type="text" class="input-medium" autocomplete="off">\n                    <p class="help-block">只允许搜索单个关键字</p>\n                </div>\n                <button class="btn" type="submit" data-action="form(\'title\')" data-weave="shared/helper/translation" data-i18n="Add"></button>\n            </form>\n        </div>\n    </li>\n    \n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Resume date"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#">\n                <!-- <ul class="unstyled">\n                    <li>\n                        <a href="#lastUpdateDate__today=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="Today"></a>\n                    </li>\n                    <li>\n                        <a href="#lastUpdateDate__this_week=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="This week"></a>\n                    </li>\n                    <li>\n                        <a href="#lastUpdateDate__this_month=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="This month"></a>\n                    </li>\n                    <li>\n                        <a href="#lastUpdateDate__six_months_ago=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="> 6 months"></a>\n                    </li>\n                </ul> -->\n                <input type="text" name="from" class="date input-small" data-weave="shared/widget/common/date-picker/main">\n                -\n                <input type="text" name="to" class="date input-small" data-weave="shared/widget/common/date-picker/main">\n                <button class="btn" type="submit" data-action="form(\'filetime\')" data-weave="shared/helper/translation" data-i18n="Add"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Resume status"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <select name="status">\n                    <option value="0">可导入</option>\n                    <option value="1">已存在</option>\n                </select>\n                <button class="btn" type="submit" data-action="form(\'status\')" data-weave="shared/helper/translation" data-i18n="Add"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Upload Date"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#">\n                <!-- <ul class="unstyled">\n                    <li>\n                        <a href="#lastUpdateDate__today=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="Today"></a>\n                    </li>\n                    <li>\n                        <a href="#lastUpdateDate__this_week=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="This week"></a>\n                    </li>\n                    <li>\n                        <a href="#lastUpdateDate__this_month=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="This month"></a>\n                    </li>\n                    <li>\n                        <a href="#lastUpdateDate__six_months_ago=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="> 6 months"></a>\n                    </li>\n                </ul> -->\n                <input type="text" name="from" class="date input-small" data-weave="shared/widget/common/date-picker/main">\n                -\n                <input type="text" name="to" class="date input-small" data-weave="shared/widget/common/date-picker/main">\n                <button class="btn" type="submit" data-action="form(\'dateAdded\')" data-weave="shared/helper/translation" data-i18n="Add"></button>\n            </form>\n        </div>\n    </li>\n</ul>\n\n<p class="sepH_b">\n    <span class="tag label label-info deletable hide" data-query="keyword" data-action="tag/remove"><b data-i18n="Keywords" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="chineseName" data-action="tag/remove"><b data-i18n="Chinese Name" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="englishName" data-action="tag/remove"><b data-i18n="English Name" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="city" data-action="tag/remove"><b data-i18n="City" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="company" data-action="tag/remove"><b data-i18n="Company" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="title" data-action="tag/remove"><b data-i18n="Title" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="filetime" data-action="tag/remove"><b data-i18n="Resume date" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="status" data-action="tag/remove"><b data-i18n="Resume status" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="dateAdded" data-action="tag/remove"><b data-i18n="Resume date" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n</p>\n\n<form action="#" class="form-horizontal save-filter-form hide">\n    <input type="text" class="input-medium">\n    <button class="btn" data-action="filter/save" data-weave="shared/helper/translation" data-i18n="Save"></button>\n    <button class="btn" data-action="filter/save/toggle" data-weave="shared/helper/translation" data-i18n="Close"></button>\n</form>\n\n<p class="sepH_b">\n    <button class="btn" data-action="filter/search" data-weave="shared/helper/translation" data-i18n="Search"></button>\n</p>';
		return a
	}
}), define("app/widget/plugins/import-resume/filter/main", ["compose", "jquery", "shared/widget/filter/base", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "shared/widget/filter/query", "shared/helper/utils"], function (a, b, c, d, e, f, g) {
	function h() {
		g.addAttr({
			keyword : function (a) {
				var c = a.find("input").val();
				c.length && (b('[data-query="keyword"]').removeClass("hide").find("span").text(c), this.addQuery("keyword", "content=" + c))
			},
			chineseName : function (a) {
				var c = a.find("input").val();
				c.length && (b('[data-query="chineseName"]').removeClass("hide").find("span").text(c), this.addQuery("chineseName", "chineseName=" + c))
			},
			englishName : function (a) {
				var c = a.find("input").val();
				c.length && (b('[data-query="englishName"]').removeClass("hide").find("span").text(c), this.addQuery("englishName", "englishName=" + c))
			},
			city : function (a) {
				var c = b.trim(a.find('[name="city"]').val()),
				d = a.find('[name="city"]').data("text");
				(c.length || d.length) && (b('[data-query="city"]').removeClass("hide").find("span").text(d), this.addQuery("city", "city=" + d))
			},
			company : function (a) {
				var c = a.find("input").val();
				c.length && (b('[data-query="company"]').removeClass("hide").find("span").text(c), this.addQuery("company", "company=" + c))
			},
			title : function (a) {
				var c = a.find("input").val();
				c.length && (b('[data-query="title"]').removeClass("hide").find("span").text(c), this.addQuery("title", "title=" + c))
			},
			filetime : function (a) {
				var c = a.find('input[name="from"]').val(),
				d = a.find('input[name="to"]').val();
				c && d && (b('[data-query="filetime"]').removeClass("hide").find("span").text(c + " - " + d), this.addQuery("filetime", "filetime__gt=" + c + "&filetime__lt=" + d))
			},
			status : function (a) {
				var c = a.find("select").val(),
				d = a.find('[value="' + c + '"]').text();
				(c.length || d.length) && (b('[data-query="status"]').removeClass("hide").find("span").text(d), this.addQuery("status", "has_candidate_id=" + c))
			},
			dateAdded : function (a) {
				var c = a.find('input[name="from"]').val(),
				d = a.find('input[name="to"]').val();
				c && d && (b('[data-query="dateAdded"]').removeClass("hide").find("span").text(c + " - " + d), this.addQuery("dateAdded", "dateAdded__gt=" + c + "&dateAdded__lt=" + d))
			}
		})
	}
	function i(a) {
		this.html(f, this._json, a)
	}
	function j(a) {
		a.resolve()
	}
	var k = "plugins/import-resume/update/source";
	return c.extend(function () {
		var a = this;
		g.url = null,
		a._setFilter = b.noop,
		h.call(a)
	}, {
		"sig/initialize" : function (a, b) {
			i.call(this, b)
		},
		"sig/start" : function (a, b) {
			j.call(this, b)
		},
		"hub/list/load" : function (a, b) {
			var c = this;
			c.publish(k, b.filter)
		}
	})
}), define("troopjs-requirejs/template!app/widget/plugins/import-resume/main.html", [], function () {
	return function () {
		var a = '<form class="upload-form" action="#" type="post" enctype="multipart/form-data">\n    <div>\n        <button class="btn btn-file"></button>\n        <span class="muted">(请将简历文件夹压缩成zip格式后上传，压缩文件不超过40MB。上传完成后，系统将自动开始识别简历。识别完成的简历将出现在下方列表中。)</span>\n        <p class="text-error hide">目前系统正在处理上一次的批量导入请求，请耐心等待，预计还剩<span class="check-progress"></span>秒</p>\n    </div>\n</form>\n\n\n<div class="search_page">\n    <div id="filter-container" class="well" data-weave="app/widget/plugins/import-resume/filter/main"></div>\n</div>\n\n<table class="table table-striped import-resume-table">\n    <colgroup>\n        <col width="">\n        <col width="65">\n        <col width="100">\n        <col width="">\n        <col width="">\n        <col width="">\n        <col width="">\n        <col width="170">\n        <col width="200">\n        <col width="170">\n        <col>\n        <col>\n    </colgroup>\n    <thead>\n        <tr>\n            <th class="table_checkbox">\n                <input type="checkbox" data-action="select/all">\n            </th>\n            <th data-weave="shared/helper/translation" data-i18n="Attachment"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Name"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Gender"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Date of birth"></th>\n            <th data-weave="shared/helper/translation" data-i18n="City"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Mobile"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Email"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Company"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Title"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Resume date"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Resume status"></th>\n        </tr>\n    </thead>\n    <tbody>\n    </tbody>\n</table>';
		return a
	}
}), define("troopjs-requirejs/template!app/widget/plugins/import-resume/attachment.html", [], function () {
	return function (a) {
		function b(a) {
			return a.replace(/(.*\/)*/, "")
		}
		var c = "",
		d = 0,
		e = a.length;
		for (c += '\n<span class="dropdown">\n    <button class="btn btn-mini" data-action="show/attachments">\n        <i class="icon-paper-clip"></i> <span class="count">' + e + '</span>\n    </button>\n\n    <div class="dropdown-menu dropdown-resume">\n\n        <ul class="nav nav-stack attachment-list">\n            ', d; e > d; d++) {
			c += "\n            ";
			var f = a[d];
			c += '\n            <li>\n                <div class="clearfix">\n                    <div class="sepH_a">\n                        <span class="pull-right">' + f.filetime + '</span>\n                        <span data-action="resume/preview(' + f.filename + ')">' + b(f.filename) + '</span>\n                    </div>\n                    <div class="sepH_a clearfix">\n                        <span class="pull-right">\n                            <button class="btn btn-mini" data-action="resume/preview(' + f.filename + ')" data-i18n="Preview" data-weave="shared/helper/translation"></button>\n                        </span>\n                    </div>\n                </div>\n            </li>\n            '
		}
		return c += "\n        </ul>\n    </div>\n</span>"
	}
}), define("app/widget/plugins/import-resume/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "template!./attachment.html", "shared/helper/utils", "jquery.datatables.fixedheader"], function (a, b, c, d, e, f) {
	function g(b) {
		var c = this,
		d = window.confirm("确定要删除所选择的数据吗？"),
		e = [];
		d && (b.forEach(function (a) {
				a.filelist && a.filelist.forEach(function (a) {
					e.push(a.filename)
				})
			}), a.ajax({
				url : m.DELETE,
				data : {
					data : JSON.stringify({
						filelist : e
					})
				},
				type : "POST"
			}).done(function (a) {
				a.status ? (c.publish("plugins/import-resume/update/source"), f.alert("success", "删除" + b.length + "条数据成功!")) : f.alert("error", a.data)
			}).fail(function (a, b) {
				f.alert("error", b)
			}))
	}
	function h() {
		var a = this;
		a.publish("ajax", {
			url : m.CHECK
		}, c().done(function (b) {
				b.total ? (a.$element.find(".upload-form p.text-error").removeClass("hide"), a.$btnFile.addClass("disabled"), a.$element.find(".check-progress").text(b.left.toFixed(2)), setTimeout(function () {
						h.call(a)
					}, 500)) : (a.$btnFile.removeClass("disabled"), a.$element.find(".upload-form p.text-error").addClass("hide"))
			}))
	}
	function i() {
		var a = this;
		a.publish("plugins/import-resume/toggle/bacthadd", a.$element.find('[name="resume-checkbox"]:checked'))
	}
	function j(a) {
		var b = this;
		b.html(d, a)
	}
	function k(a) {
		var b = this;
		b.$btnFile = b.$element.find(".btn-file"),
		b.oTable = b.$element.find("table").dataTable({
				bPaginate : !1,
				bAutoWidth : !1,
				sAjaxDataProp : "",
				aoColumns : p,
				sDom : "<'row'fi<'dt_actions'>>t",
				fnInfoCallback : function (a, b, c, d, e) {
					return "总共: " + e + "条结果"
				},
				oLanguage : {
					sSearch : "搜索"
				}
			}),
		b.$element.find(".dt_actions").attr("data-weave", n).weave(),
		b.$btnFile.data("json", {
			type : null,
			url : m.UPLOAD,
			beforeSubmit : function () {
				b.publish("plugins/import-resume/modal/upload/show")
			},
			uploadProgress : function (a, c, d, e) {
				b.publish("plugins/import-resume/modal/upload/upload-progress", e)
			},
			success : function (a) {
				a.status ? b.publish("plugins/import-resume/modal/upload/check") : (f.alert("error", a.data), b.publish("plugins/import-resume/modal/upload/close"))
			},
			validate : function (a) {
				return o.test(a.name) ? a.size > 4e7 ? (f.alert("error", "压缩文件不超过40MB!"), !1) : !0 : (f.alert("error", "请以zip压缩包格式后上传！"), !1)
			}
		}).attr("data-weave", "shared/widget/common/upload/main(json, validate)").weave(c().done(function () {
				h.call(b)
			})),
		a.resolve()
	}
	var l,
	m = {
		UPLOAD : "/rest/importer/upload",
		CHECK : "/rest/importer/check",
		LIST : "/rest/importer/list",
		DELETE : "/rest/importer/delete",
		PREVIEW : "/rest/importer/preview?f="
	},
	n = "app/widget/plugins/import-resume/table-action",
	o = /\.zip$/,
	p = [{
			mData : null,
			bSortable : !1,
			mRender : function (a, b, c) {
				var d = '<input type="checkbox" data-existed="' + (c.candidate_id ? "true" : "false") + '" data-action="select/one" name="resume-checkbox" value="' + c.index + '">';
				return d
			}
		}, {
			mData : "filename",
			bSortable : !1,
			mRender : function (b, c, d) {
				var f = "";
				if (d.filelist) {
					var g = a(e(d.filelist));
					g.find("[data-weave]").weave(),
					f = g[0].outerHTML
				}
				return f
			}
		}, {
			mData : null,
			sType : "string",
			mRender : function (a, b, c) {
				return c.englishName + (c.englishName ? "<br>" : "") + c.chineseName
			}
		}, {
			mData : "gender",
			sType : "string",
			mRender : function (a) {
				var b;
				return b = a ? "男" : "女"
			}
		}, {
			mData : "dateOfBirth",
			sType : "date"
		}, {
			mData : "city",
			sType : "string"
		}, {
			mData : "mobile",
			sType : "numeric"
		}, {
			mData : "email",
			sType : "string"
		}, {
			mData : "company",
			sType : "string"
		}, {
			mData : "title",
			sType : "string"
		}, {
			mData : "filetime",
			sType : "date",
			mRender : function (a) {
				return a.replace(/T.*$/, "")
			}
		}, {
			mData : "candidate_id",
			sType : "string",
			mRender : function (a) {
				var b;
				return b = a ? '<span class="label">已存在</span>' : '<span class="label label-info">可导入</span>'
			}
		}
	],
	q = m.LIST,
	r = "",
	s = "",
	t = "";
	return b.extend({
		"sig/initialize" : function (a, b) {
			j.call(this, b)
		},
		"sig/start" : function (a, b) {
			k.call(this, b)
		},
		"hub/plugins/import-resume/collect/selected" : function (b, c) {
			var d = this,
			e = [],
			h = d.oTable.fnGetData();
			if (d.oTable.find("tbody :checked").each(function (a, b) {
					e.push(parseInt(b.value, 10))
				}), h = a.grep(h, function (a) {
						return e.indexOf(a.index) > -1
					}), "import" === c) {
				if (!h.length)
					return f.alert("error", "请先选择要导入的数据！"), void 0;
				d.publish("plugins/modal/batch-add/show", h)
			} else if ("delete" === c) {
				if (!h.length)
					return f.alert("error", "请先选择要删除的数据！"), void 0;
				g.call(d, h)
			}
		},
		"hub/plugins/import-resume/update/source" : function (a, b) {
			var d = this;
			b !== l && (t = b, q = m.LIST + "?" + t + r + s),
			d.publish("ajax", {
				url : q
			}, c().done(function (a) {
					d.oTable.fnClearTable(),
					d.oTable.fnAddData(a),
					d.oTable.fnDraw()
				}))
		},
		"hub:momery/plugins/import-resume/initial/load" : function (a, b) {
			var c = this;
			b.required && (s = "&required=" + b.required),
			c.publish("plugins/import-resume/update/source", s)
		},
		"hub/plugins/import-resume/change/zip" : function (a, b) {
			var c = this;
			r = b ? "&dirname=" + b : "",
			q = m.LIST + "?" + (t ? t : "") + (r ? r : "") + (s ? s : ""),
			c.publish("plugins/import-resume/update/source")
		},
		"hub/plugins/import-resume/change/required" : function (a, b) {
			var c = this;
			s = b ? "&required=" + b : "",
			q = m.LIST + "?" + (t ? t : "") + (r ? r : "") + (s ? s : ""),
			c.publish("plugins/import-resume/update/source")
		},
		"dom/action.click" : a.noop,
		"dom/action/select/one.click" : function (b, c) {
			var d = this,
			e = a(c.target);
			e.is(":checked") ? e.closest("tr").addClass("rowChecked") : e.closest("tr").removeClass("rowChecked"),
			i.call(d)
		},
		"dom/action/select/all.click" : function (b, c) {
			var d = this,
			e = a(c.target),
			f = e.prop("checked"),
			g = d.oTable.find(":checkbox").not(":disabled").prop("checked", f);
			f ? g.closest("tr").addClass("rowChecked") : g.closest("tr").removeClass("rowChecked"),
			i.call(d)
		},
		"dom/action/show/attachments" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = d.closest(".dropdown");
			e.hasClass("open") ? e.removeClass("open") : (e.addClass("open"), a(document).on("click.resume.dropdown", function (b) {
					a(b).closest(e).length || (e.removeClass("open"), a(document).off("click.resume.dropdown"))
				}))
		},
		"dom/action/resume/preview.click" : function (a, b, c) {
			b.preventDefault();
			var d = this,
			e = window.encodeURIComponent(c);
			d.publish("slide-helper/attachment/reload", e, "importer")
		}
	})
}), define("troopjs-requirejs/template!app/widget/plugins/import-resume/modal/batch-add.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3>导入正式数据库</h3>\n</div>\n<div class="modal-body">\n    <form action="#" class="form-horizontal">\n        <fieldset>\n            <div class="control-group">\n                <label class="control-label">已选导入数据量</label>\n                <div class="controls text_line total"></div>\n            </div>\n            <div class="control-group">\n                <label class="control-label" data-weave="shared/helper/translation" data-i18n="Industry"></label>\n                <div class="controls">\n                    <div class="comtree span3" data-name="industry" data-url="/rest/data/industry" data-weave="shared/widget/common/comtree/main"></div>\n                </div>\n            </div>\n            <div class="control-group">\n                <label class="control-label" data-weave="shared/helper/translation" data-i18n="Function"></label>\n                <div class="controls">\n                    <div class="comtree span3" data-name="function" data-url="/rest/data/function" data-weave="shared/widget/common/comtree/main"></div>\n                </div>\n            </div>\n            <div class="control-group formSep">\n                <label class="control-label" data-weave="shared/helper/translation" data-i18n="Tags"></label>\n                <div class="controls">\n                    <input type="text" name="tag" data-weave="shared/widget/common/tagit/main">\n                    <div class="help-block" data-weave="shared/helper/translation" data-i18n="Separate keywords">Use "Enter" to separate multiple Keywords</div>\n                </div>\n            </div>\n            <div class="control-group">\n                <label class="control-label" data-weave="shared/helper/translation" data-i18n="Source"></label>\n                <div class="controls">\n                    <select name="source" data-weave="app/widget/common/source/main"></select>\n                </div>\n            </div>\n            <div class="control-group">\n                <label class="control-label" data-weave="shared/helper/translation" data-i18n="Owner"></label>\n                <div class="controls">\n                    <select data-placeholder="Choose a user..." name="owner" id="owner" class="input-medium" data-weave="shared/widget/common/user-list/main">\n                    </select>\n                </div>\n            </div>\n            ';
		return "partial" === this.shareType && (a += '\n            <div class="control-group control-share" data-weave="shared/widget/common/add-share/main">\n            </div>\n            '),
		a += '\n        </fieldset>\n    </form>\n    <div class="process hide">\n        <p>导入结束前请不要关闭本窗口!</p>\n        <p>导入进度: <span class="current">0</span>/<span class="total"></span></p>\n        <p>导入成功: <span class="successes">0</span></p>\n        <p>导入失败: <span class="fails">0</span></p>\n    </div>\n</div>\n<div class="modal-footer">\n    <button class="btn btn-danger hide abort" data-weave="shared/helper/translation" data-i18n="Abort import" data-action="close"></button>\n    <button class="btn btn-close" data-weave="shared/helper/translation" data-i18n="Close" data-action="close"></button>\n    <button class="btn btn-primary start" data-weave="shared/helper/translation" data-i18n="Confirm" data-action="start"></button>\n</div>'
	}
}), define("app/widget/plugins/import-resume/modal/batch-add", ["jquery", "config", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./batch-add.html", "shared/helper/utils"], function (a, b, c, d, e, f) {
	function g() {
		var b,
		c,
		d,
		e = this;
		e.$closeBtn.addClass("hide"),
		e.$startBtn.addClass("hide"),
		e.$abortBtn.removeClass("hide"),
		e.items.length && a.ajax({
			url : k.IMPORT,
			data : {
				data : JSON.stringify(e._data.splice(0, l))
			},
			type : "POST"
		}).done(function (a) {
			a.status ? (b = parseInt(e.$current.text(), 10) + a.data.length, c = parseInt(e.$successes.text(), 10) + a.data.filter(function (a) {
						return a
					}).length, d = b - c, e.$current.text(b), e.$successes.text(c), e.$fails.text(d), e._data.length && m ? g.call(e) : setTimeout(function () {
					window.location.reload()
				}, 1e3)) : (h.call(e), f.alert("info", "导入已完成！共" + b + "条数据,成功导入" + c + "条, 失败" + d + "条.", !1))
		}).fail(function (a, b) {
			f.alert("error", b)
		})
	}
	function h() {
		var a = this;
		a.$element.modal("hide"),
		m = !1
	}
	function i(a) {
		var b = this;
		b.html(e, b._json, a)
	}
	function j(a) {
		var b = this,
		c = b.$element;
		b.$industry = c.find('[name="industry"]'),
		b.$owner = c.find('[name="owner"]'),
		b.$fn = c.find('[name="function"]'),
		b.$tag = c.find('[name="tag"]'),
		b.$source = c.find('[name="source"]'),
		b.$form = c.find("form"),
		b.$process = c.find(".process"),
		b.$current = c.find(".current"),
		b.$successes = c.find(".successes"),
		b.$fails = c.find(".fails"),
		b.$closeBtn = c.find(".btn-close"),
		b.$abortBtn = c.find(".abort"),
		b.$startBtn = c.find(".start"),
		c.on("hidden", function () {
			b.$form.removeClass("hide"),
			b.$process.addClass("hide"),
			b.$closeBtn.removeClass("hide"),
			b.$startBtn.removeClass("hide"),
			b.$abortBtn.addClass("hide"),
			m = !1
		}),
		a.resolve()
	}
	var k = {
		IMPORT : "/rest/candidate/batchadd"
	},
	l = 2,
	m = !0;
	return d.extend({
		shareType : b.shareType,
		"sig/initialize" : function (a, b) {
			i.call(this, b)
		},
		"sig/start" : function (a, b) {
			j.call(this, b)
		},
		"hub/plugins/import-resume/modal/batch-add/show" : function (a, b, c) {
			var d = this,
			e = d.$element,
			f = b.length;
			d.items = b,
			d.onSuccess = c,
			d.$element.find(".total").text(f),
			e.modal("show")
		},
		"dom/action.click" : a.noop,
		"dom/action/start.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = function () {
				var b = [];
				return a('[name="share_with"]').each(function () {
					var c = a(this),
					d = c.val(),
					e = c.next().find(a("input").add("select")).val();
					b.push({
						type : d,
						value : e
					})
				}),
				b
			}
			(),
			f = {
				source_id : d.$source.val() || "",
				owner_id : d.$owner.val(),
				industry_id : d.$industry.val() || "",
				function_id : d.$fn.val() || "",
				tags : d.$tag.val(),
				shares : e
			};
			d._data = [],
			a.each(d.items, function (b, c) {
				d._data.push(a.extend({}, c, f))
			}),
			d.$form.addClass("hide"),
			d.$process.removeClass("hide"),
			g.call(d)
		},
		"dom/action/close.click" : function (a, b) {
			b.preventDefault(),
			h.call(this)
		}
	})
}), define("troopjs-requirejs/template!app/widget/plugins/import-resume/modal/upload.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\n    <h3 data-weave="shared/helper/translation" data-i18n="Upload Resume"></h3>\n</div>\n<div class="modal-body">\n    <p>批量导入过程中需要几分钟，请耐心等待，不要关闭页面</p>\n    <p class="resume-uploading">\n        简历上传中...<span class="upload-progress"></span>%\n    </p>\n    <p class="resume-uploaded hide">简历上传已经完毕！</p>\n    <p class="resume-checking hide">\n        正在后台处理简历,还剩下<span class="check-progress"></span>秒\n    </p>\n        \n    <p class="resume-checked hide">\n        后台处理简历已经完毕\n    </p>\n</div>\n<div class="modal-footer">\n    <button class="btn invisible" data-weave="shared/helper/translation" data-i18n="Close" data-action="close"></button>&nbsp;\n</div>';
		return a
	}
}), define("app/widget/plugins/import-resume/modal/upload", ["compose", "jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./upload.html", "shared/helper/utils"], function (a, b, c, d, e) {
	function f() {
		var a = this;
		a.$element.modal("hide")
	}
	function g() {
		var a = this;
		a.publish("ajax", {
			url : j.CHECK
		}, c().done(function (b) {
				b.total ? (a.$checkProgress.text(b.left.toFixed(2)), setTimeout(function () {
						g.call(a)
					}, 500)) : (a.publish("plugins/import-resume/ziplist/reload"), a.$checkProgress.text(0), a.$closeBtn.removeClass("invisible"), a.$checking.addClass("hide"), a.$checked.removeClass("hide"))
			}))
	}
	function h(a) {
		var b = this;
		b.html(e, b._json, a)
	}
	function i(a) {
		var b = this;
		b.$uploading = b.$element.find(".resume-uploading"),
		b.$uploaded = b.$element.find(".resume-uploaded"),
		b.$checking = b.$element.find(".resume-checking"),
		b.$checked = b.$element.find(".resume-checked"),
		b.$uploadProgress = b.$element.find(".upload-progress"),
		b.$checkProgress = b.$element.find(".check-progress"),
		b.$closeBtn = b.$element.find(".btn"),
		a.resolve()
	}
	var j = {
		CHECK : "/rest/importer/check"
	};
	return d.extend({
		"sig/initialize" : function (a, b) {
			h.call(this, b)
		},
		"sig/start" : function (a, b) {
			i.call(this, b)
		},
		"hub/plugins/import-resume/modal/upload/show" : function () {
			var a = this,
			b = a.$element;
			a.$uploading.removeClass("hide"),
			a.$uploaded.add(a.$checking).add(a.$checked).addClass("hide"),
			b.modal({
				backdrop : "static",
				keyboard : !1
			})
		},
		"hub/plugins/import-resume/modal/upload/close" : function () {
			f.call(this)
		},
		"hub/plugins/import-resume/modal/upload/upload-progress" : function (a, b) {
			var c = this;
			c.$uploadProgress.text(b)
		},
		"hub/plugins/import-resume/modal/upload/check" : function () {
			var a = this;
			setTimeout(function () {
				a.$uploading.addClass("hide"),
				a.$uploaded.add(a.$checking).removeClass("hide"),
				g.call(a)
			}, 500)
		},
		"dom/action.click" : b.noop,
		"dom/action/close.click" : function () {
			f.call(this)
		}
	})
}), define("troopjs-requirejs/template!app/widget/plugins/import-resume/table-action.html", [], function () {
	return function () {
		var a = '<div class="btn-group">\n    <a href="#" class="btn dropdown-toggle" data-action="dropdown">\n        简历压缩包选择\n        <span class="caret"></span>\n    </a>\n\n    <ul class="dropdown-menu fixed" data-weave="app/widget/plugins/import-resume/ziplist">\n    </ul>\n\n</div>\n<div class="btn-group">\n    <a href="#" class="btn dropdown-toggle" data-action="dropdown">\n        Completeness筛选\n        <span class="caret"></span>\n    </a>\n    <ul class="dropdown-menu fixed required">\n        <li>\n            <button class="btn" data-i18n="Filter" data-weave="shared/helper/translation" data-action="required/filter"></button>\n        </li>\n        <li class="divider"></li>\n        <li>是否识别出下列数据</li>\n        <li>\n            <label class="checkbox">\n                <input type="checkbox" value="chineseName">\n                <span data-i18n="Chinese Name" data-weave="shared/helper/translation"></span>\n            </label>\n        </li>\n        <li>\n            <label class="checkbox">\n                <input type="checkbox" value="englishName">\n                <span data-i18n="English Name" data-weave="shared/helper/translation"></span>\n            </label>\n        </li>\n        <li>\n            <label class="checkbox">\n                <input type="checkbox" checked value="chineseName|englishName">\n                <span data-i18n="Chinese Name or English Name" data-weave="shared/helper/translation"></span>\n            </label>\n        </li>\n        <li>\n            <label class="checkbox">\n                <input type="checkbox" value="gender">\n                <span data-i18n="Gender" data-weave="shared/helper/translation"></span>\n            </label>\n        </li>\n        <li>\n            <label class="checkbox">\n                <input type="checkbox" value="dateOfBirth">\n                <span data-i18n="Date of birth" data-weave="shared/helper/translation"></span>\n            </label>\n        </li>\n        <li>\n            <label class="checkbox">\n                <input type="checkbox" value="city">\n                <span data-i18n="City" data-weave="shared/helper/translation"></span>\n            </label>\n        </li>\n        <li>\n            <label class="checkbox">\n                <input type="checkbox" value="mobile">\n                <span data-i18n="Mobile" data-weave="shared/helper/translation"></span>\n            </label>\n        </li>\n        <li>\n            <label class="checkbox">\n                <input type="checkbox" value="email">\n                <span data-i18n="Email" data-weave="shared/helper/translation"></span>\n            </label>\n        </li>\n        <li>\n            <label class="checkbox">\n                <input type="checkbox" checked value="mobile|email">\n                <span data-i18n="Mobile or Email" data-weave="shared/helper/translation"></span>\n            </label>\n        </li>\n        <li>\n            <label class="checkbox">\n                <input type="checkbox" value="company">\n                <span data-i18n="Company" data-weave="shared/helper/translation"></span>\n            </label>\n        </li>\n        <li>\n            <label class="checkbox">\n                <input type="checkbox" value="title">\n                <span data-i18n="Title" data-weave="shared/helper/translation"></span>\n            </label>\n        </li>\n    </ul>\n</div>\n<a href="#" class="btn" data-action="batch/add">导入正式数据库</a>\n<a href="#" class="btn" data-action="batch/delete" data-weave="shared/helper/translation" data-i18n="Delete"></a>';
		return a
	}
}), define("app/widget/plugins/import-resume/table-action", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./table-action.html", "shared/helper/utils"], function (a, b, c, d) {
	function e() {
		var b = this,
		c = [];
		b.$required.find(":checkbox:checked").each(function () {
			c.push(a(this).val())
		}),
		b.publish("plugins/import-resume/initial/load", {
			required : c.join(",")
		})
	}
	function f(a) {
		var b = this;
		b.html(d, b._json, a)
	}
	function g(a) {
		var b = this;
		b.$required = b.$element.find(".required"),
		b.$btnBatchAdd = b.$element.find('[data-action="batch/add"]'),
		e.call(b),
		a.resolve()
	}
	return b.extend({
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"sig/start" : function (a, b) {
			g.call(this, b)
		},
		"hub/plugins/import-resume/toggle/bacthadd" : function (b, c) {
			var d = this,
			e = c.filter(function (b, c) {
					return a(c).data("existed")
				});
			e.length ? d.$btnBatchAdd.addClass("disabled") : d.$btnBatchAdd.removeClass("disabled")
		},
		"dom/action.click.change" : a.noop,
		"dom/action/batch/add.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target);
			e.hasClass("disabled") || d.publish("plugins/import-resume/collect/selected", "import")
		},
		"dom/action/batch/delete.click" : function (a, b) {
			b.preventDefault();
			var c = this;
			c.publish("plugins/import-resume/collect/selected", "delete")
		},
		"dom/action/dropdown.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target),
			f = e.siblings(".dropdown-menu"),
			g = a(document),
			h = e.closest(".btn-group");
			d.$element.find(".btn-group").removeClass("open"),
			h.toggleClass("open"),
			g.on("click.btn.dropdown", function (b) {
				var c = a(b.target);
				!c.closest(f).length && h.hasClass("open") && (h.removeClass("open"), g.off("click.btn.dropdown"))
			})
		},
		"dom/action/required/filter.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			f = a(c.target);
			f.closest(".btn-group").removeClass("open"),
			e.call(d)
		}
	})
}), define("troopjs-requirejs/template!app/widget/plugins/import-resume/ziplist.html", [], function () {
	return function (a) {
		var b = "",
		c = a.zip;
		b += '\n<li>\n    <label class="radio">\n        <input type="radio" name="resume-radio" checked data-action="zip/select">\n        <span>所有简历压缩包</span>\n    </label>\n</li>\n';
		for (var d = 0, e = c.length; e > d; d++)
			b += '\n<li>\n    <label class="radio">\n        <input type="radio" name="resume-radio" data-action="zip/select(\'' + c[d].filename.replace(".zip", "") + "')\">\n        <span>" + c[d].filename + '</span>\n        <p class="hint">' + this.formatDate(c[d].createdate) + "</p>\n    </label>\n</li>\n";
		return b
	}
}), define("app/widget/plugins/import-resume/ziplist", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./ziplist.html", "shared/helper/utils"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		b.publish("ajax", {
			url : f.ZIP
		}, c().done(function (a) {
				b._json.zip = a
			}).done(function () {
				b.html(d, b._json, a)
			}))
	}
	var f = {
		ZIP : "/rest/importer/listzip"
	};
	return b.extend({
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		},
		"hub:memory/plugins/import-resume/ziplist/reload" : function () {
			var a = c(),
			b = this;
			a.done(function () {
				b.$element.find(":radio").eq(1).trigger("click")
			}),
			e.call(b, a)
		},
		"dom/action.change" : a.noop,
		"dom/action/zip/select.change" : function (a, b, c) {
			var d = this;
			d.publish("plugins/import-resume/change/zip", c)
		}
	})
}), define("troopjs-requirejs/template!app/widget/plugins/modal/batch-add.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3>导入正式数据库</h3>\n</div>\n<div class="modal-body">\n    <form action="#" class="form-horizontal">\n        <fieldset>\n            <div class="control-group">\n                <label class="control-label">已选导入数据量</label>\n                <div class="controls text_line total"></div>\n            </div>\n            <div class="control-group">\n                <label class="control-label" data-weave="shared/helper/translation" data-i18n="Industry"></label>\n                <div class="controls">\n                    <div class="comtree span3" data-name="industry" data-url="/rest/data/industry" data-weave="shared/widget/common/comtree/main"></div>\n                </div>\n            </div>\n            <div class="control-group">\n                <label class="control-label" data-weave="shared/helper/translation" data-i18n="Function"></label>\n                <div class="controls">\n                    <div class="comtree span3" data-name="function" data-url="/rest/data/function" data-weave="shared/widget/common/comtree/main"></div>\n                </div>\n            </div>\n            <div class="control-group formSep">\n                <label class="control-label" data-weave="shared/helper/translation" data-i18n="Tags"></label>\n                <div class="controls">\n                    <input type="text" name="tag" data-weave="shared/widget/common/tagit/main">\n                    <div class="help-block" data-weave="shared/helper/translation" data-i18n="Separate keywords">Use "Enter" to separate multiple Keywords</div>\n                </div>\n            </div>\n            <div class="control-group">\n                <label class="control-label" data-weave="shared/helper/translation" data-i18n="Source"></label>\n                <div class="controls">\n                    <select name="source" data-weave="app/widget/common/source/main"></select>\n                </div>\n            </div>\n            <div class="control-group">\n                <label class="control-label" data-weave="shared/helper/translation" data-i18n="Owner"></label>\n                <div class="controls">\n                    <select data-placeholder="Choose a user..." name="owner" id="owner" class="input-medium" data-weave="shared/widget/common/user-list/main">\n                    </select>\n                </div>\n            </div>\n            ';
		return "partial" === this.shareType && (a += '\n            <div class="control-group control-share" data-weave="shared/widget/common/add-share/main">\n            </div>\n            '),
		a += '\n        </fieldset>\n    </form>\n    <div class="process hide">\n        <p>导入结束前请不要关闭本窗口!</p>\n        <p>导入进度: <span class="current">0</span>/<span class="total"></span></p>\n        <p>导入成功: <span class="successes">0</span></p>\n        <p>导入失败: <span class="fails">0</span></p>\n    </div>\n</div>\n<div class="modal-footer">\n    <button class="btn btn-danger hide abort" data-weave="shared/helper/translation" data-i18n="Abort import" data-action="close"></button>\n    <button class="btn btn-close" data-weave="shared/helper/translation" data-i18n="Close" data-action="close"></button>\n    <button class="btn btn-primary start" data-weave="shared/helper/translation" data-i18n="Confirm" data-action="start"></button>\n</div>'
	}
}), define("app/widget/plugins/modal/batch-add", ["jquery", "config", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./batch-add.html", "shared/helper/utils"], function (a, b, c, d, e, f) {
	function g() {
		var a,
		b,
		d,
		e = this;
		e.$closeBtn.addClass("hide"),
		e.$startBtn.addClass("hide"),
		e.$abortBtn.removeClass("hide"),
		e.items.length && e.publish("ajax", {
			url : k.IMPORT,
			data : {
				data : JSON.stringify(e._data.splice(0, l))
			},
			type : "POST"
		}, c().done(function (c) {
				c.status ? (a = parseInt(e.$current.text(), 10) + c.data.length, b = parseInt(e.$successes.text(), 10) + c.data.filter(function (a) {
							return a
						}).length, d = a - b, e.$current.text(a), e.$successes.text(b), e.$fails.text(d), e._data.length && m ? g.call(e) : setTimeout(function () {
						window.location.reload()
					}, 1e3)) : (h.call(e), f.alert("info", "导入已完成！共" + a + "条数据,成功导入" + b + "条, 失败" + d + "条.", !1))
			}))
	}
	function h() {
		var a = this;
		a.$element.modal("hide"),
		m = !1
	}
	function i(a) {
		var b = this;
		b.html(e, b._json, a)
	}
	function j(a) {
		var b = this,
		c = b.$element;
		b.$industry = c.find('[name="industry"]'),
		b.$owner = c.find('[name="owner"]'),
		b.$fn = c.find('[name="function"]'),
		b.$tag = c.find('[name="tag"]'),
		b.$source = c.find('[name="source"]'),
		b.$form = c.find("form"),
		b.$process = c.find(".process"),
		b.$current = c.find(".current"),
		b.$successes = c.find(".successes"),
		b.$fails = c.find(".fails"),
		b.$closeBtn = c.find(".btn-close"),
		b.$abortBtn = c.find(".abort"),
		b.$startBtn = c.find(".start"),
		c.on("hidden", function () {
			b.$form.removeClass("hide"),
			b.$process.addClass("hide"),
			b.$closeBtn.removeClass("hide"),
			b.$startBtn.removeClass("hide"),
			b.$abortBtn.addClass("hide"),
			m = !1
		}),
		a.resolve()
	}
	var k = {
		IMPORT : "/rest/candidate/batchadd"
	},
	l = 2,
	m = !0;
	return d.extend({
		shareType : b.shareType,
		"sig/initialize" : function (a, b) {
			i.call(this, b)
		},
		"sig/start" : function (a, b) {
			j.call(this, b)
		},
		"hub/plugins/modal/batch-add/show" : function (b, c, d, e) {
			var f = this,
			g = f.$element,
			h = c.length;
			if (f.items = c, f.onSuccess = d, e) {
				var i = new RegExp(e, "gi");
				f.$source.find("option").each(function () {
					var b = a(this);
					return i.test(b.text()) ? (b.prop("selected", !0), !1) : void 0
				})
			}
			f.$element.find(".total").text(h),
			g.modal("show")
		},
		"dom/action.click" : a.noop,
		"dom/action/start.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = function () {
				var b = [];
				return a('[name="share_with"]').each(function () {
					var c = a(this),
					d = c.val(),
					e = c.next().find(a("input").add("select")).val();
					b.push({
						type : d,
						value : e
					})
				}),
				b
			}
			(),
			f = {
				source_id : d.$source.val() || "",
				owner_id : d.$owner.val(),
				industry_id : d.$industry.val() || "",
				function_id : d.$fn.val() || "",
				tags : d.$tag.val(),
				shares : e
			};
			d._data = [],
			a.each(d.items, function (b, c) {
				d._data.push(a.extend({}, c, f))
			}),
			d.$form.addClass("hide"),
			d.$process.removeClass("hide"),
			g.call(d)
		},
		"dom/action/close.click" : function (a, b) {
			b.preventDefault(),
			h.call(this)
		}
	})
}), define("troopjs-requirejs/template!app/widget/reporting/kpi/attachment-reporting/detail/main.html", [], function () {
	return function (a) {
		for (var b = '<colgroup>\n    <col width="">\n    <col width="">\n    <col width="">\n    <col width="">\n    <col width="">\n    <col width="">\n    <col width="">\n</colgroup>\n<thead>\n    <tr>\n        <th><span data-weave="shared/helper/translation" data-i18n="People"></span>/<span data-weave="shared/helper/translation" data-i18n="Job"></span></th>\n        <th data-weave="shared/helper/translation" data-i18n="Company"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Attachment Type"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Attachment Name"></th>\n        <th data-weave="shared/helper/translation" data-i18n="File Size"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Upload Date"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Upload User"></th>\n    </tr>\n</thead>\n<tbody>\n    ', c = 0, d = a.length; d > c; c++) {
			b += "\n    ";
			var e = a[c];
			b += "\n    <tr>\n        <td>\n            ",
			"candidate" === e.type ? b += '\n            <a href="/candidate#detail!id=' + e.target.id + '" target="_blank">' + [e.target.englishName, e.target.chineseName].join(" ").trim() + "</a>\n            " : "joborder" === e.type && (b += '\n            <a href="/company#detail!id=' + e.target.id + '" target="_blank">' + e.target.jobTitle + "</a>\n            "),
			b += "\n        </td>\n        <td>\n            ",
			"candidate" === e.type ? (b += "\n            ", e.target.company && (b += '\n            <a href="/company#detail!id=' + e.target.company.id + '" target="_blank">' + e.target.company.name + "</a>\n            "), b += "\n            ") : "joborder" === e.type ? b += '\n            <a href="/company#detail!id=' + e.target.client.id + '" target="_blank">' + e.target.client.name + "</a>\n            " : "clientcompany" === e.type && (b += '\n            <a href="/company#detail!id=' + e.target.id + '" target="_blank">' + e.target.name + "</a>\n            "),
			b += '\n        </td>\n        <td><span class="label" style="background-color: ' + e.tag.color + '">' + (e.tag.value || "未知") + "</span></td>\n        <td>" + e.originname + "</td>\n        <td>" + (e.filesize / 1024).toFixed(2) + "KB</td>\n        <td>" + e.dateAdded + '</td>\n        <td><a href="/user/preview#' + e.addedBy.id + '" data-action="user/open">' + e.addedBy.englishName + "</a></td>\n    </tr>\n    "
		}
		return b += "\n</tbody>"
	}
}), define("app/widget/reporting/kpi/attachment-reporting/detail/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "shared/helper/utils", "jquery.datatables"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		b.publish("ajax", {
			url : h.LIST.replace("<ids>", b._ids)
		}, c().done(function (c) {
				b._json = c,
				b.html(e, b._json, a)
			}))
	}
	function g(a) {
		var b = this;
		b.oTable = b.$element.dataTable({
				sDom : "t",
				bPaginate : !1,
				bLengthChange : !1,
				aaSorting : []
			}),
		a.resolve()
	}
	var h = {
		LIST : "/rest/file/list?paginate_by=200&id__s=<ids>"
	};
	return b.extend(function (a, b, c) {
		var d = this;
		d._ids = c
	}, {
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"sig/start" : function (a, b) {
			g.call(this, b)
		},
		"sig/stop" : function (a, b) {
			this.oTable.fnDestroy(),
			b.resolve()
		}
	})
}), define("troopjs-requirejs/template!app/widget/reporting/kpi/attachment-reporting/main.html", [], function () {
	return function (a) {
		var b = "",
		c = a.attachments;
		b += '\n<div class="row-fluid">\n    <div class="span12">\n        <p class="text-right">\n            <button class="btn" data-weave="shared/helper/translation" data-i18n="Export Reporting" data-action="export/csv"></button>    \n        </p>\n\n        <table class="table table-striped table-bordered dTableR invisible">\n            <thead>\n                <tr>\n                    <th data-mapping="id">ID</th>\n                    <th data-mapping="name" data-weave="shared/helper/translation" data-i18n="User"></th>\n                    <th data-mapping="attachments" data-weave="shared/helper/translation" data-i18n="All Attachments"></th>\n                    ';
		for (var d = 0, e = c.length; e > d; d++)
			b += '\n                    <th data-mapping="' + c[d].code + '">' + c[d].value + "</th>\n                    ";
		b += '\n                    <th data-mapping="candidate_unknown" data-weave="shared/helper/translation" data-i18n="Unknown Type Candidates\' Attachments"></th>\n                    <th data-mapping="clientcompany_unknown" data-weave="shared/helper/translation" data-i18n="Unknown Type Companies\' Attachments"></th>\n                    <th data-mapping="joborder_unknown" data-weave="shared/helper/translation" data-i18n="Unknown Type Jobs\' Attachments"></th>\n                </tr>\n            </thead>\n            <tbody>\n\n            </tbody>\n            <tfoot>\n                <tr class="sum">\n                    <th></th>\n                    <th data-weave="shared/helper/translation" data-i18n="Summary"></th>\n                    <th data-mapping="attachments"></th>\n                    ';
		for (var d = 0, e = c.length; e > d; d++)
			b += '\n                    <th data-mapping="' + c[d].code + '"></th>\n                    ';
		b += '\n                    <th data-mapping="candidate_unknown"></th>\n                    <th data-mapping="clientcompany_unknown"></th>\n                    <th data-mapping="joborder_unknown"></th>\n                </tr>\n                <tr class="team">\n                    <th></th>\n                    <th data-weave="shared/helper/translation" data-i18n="Team highest" class="highlight"></th>\n                    <th data-mapping="attachments"></th>\n                    ';
		for (var d = 0, e = c.length; e > d; d++)
			b += '\n                    <th data-mapping="' + c[d].code + '"></th>\n                    ';
		b += '\n                    <th data-mapping="candidate_unknown"></th>\n                    <th data-mapping="clientcompany_unknown"></th>\n                    <th data-mapping="joborder_unknown"></th>\n                </tr>\n                <tr class="company">\n                    <th></th>\n                    <th data-weave="shared/helper/translation" data-i18n="Company highest" class="highlight"></th>\n                    <th data-mapping="attachments"></th>\n                    ';
		for (var d = 0, e = c.length; e > d; d++)
			b += '\n                    <th data-mapping="' + c[d].code + '"></th>\n                    ';
		return b += '\n                    <th data-mapping="candidate_unknown"></th>\n                    <th data-mapping="clientcompany_unknown"></th>\n                    <th data-mapping="joborder_unknown"></th>\n                </tr>\n            </tfoot>\n        </table>\n    </div>\n</div>'
	}
}), define("app/widget/reporting/kpi/attachment-reporting/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "jquery.datatables"], function (a, b, c, d, e) {
	function f(a, b, c) {
		var d,
		e = "";
		switch (A.type) {
		case "user":
			"Active" !== c.status && (e = "muted"),
			d = '<a class="' + e + '" data-action="user/open" href="/user/preview#' + c.id + '">' + a + "</a>";
			break;
		case "team":
			d = '<a href="#' + c.id + '" data-action="lookup(' + c.id + ')">' + a + "</a>";
			break;
		default:
			d = a
		}
		return d
	}
	function g(b, c, d, e) {
		var f = this,
		g = f.COLUMNS[b].mData;
		d > 0 && a(c).attr("data-action", 'details/show("' + g + '", ' + e.id + ")").addClass("info")
	}
	function h(a) {
		var b = {};
		return a.replace(/([^?=&]+)(=([^&]*))?/g, function (a, c, d, e) {
			b[c] = e
		}),
		b
	}
	function i(a) {
		var b = x.REPORT + "&type=<type>",
		c = "&filter=<filter>&<filter>_id=<id>",
		d = "&start=<start>&end=<end>";
		return a.filter && (a.filter_id || 0 === a.filter_id) && (b += c.replace(/<filter>/g, a.filter).replace(/<id>/, a.filter_id)),
		a.start && a.end && (b += d.replace(/<start>/, a.start).replace(/<end>/, a.end)),
		b = b.replace(/<type>/, a.type)
	}
	function j(a) {
		var b = "/rest/report/kpidetail?kpi_type=attachment&type=<type>",
		c = "&filter=<filter>&<filter>_id=<id>",
		d = "&start=<start>&end=<end>";
		return a.filter && (a.filter_id || 0 === a.filter_id) && (b += c.replace(/<filter>/g, a.filter).replace(/<id>/, a.filter_id)),
		a.start && a.end && (b += d.replace(/<start>/, a.start).replace(/<end>/, a.end)),
		encodeURI(b.replace(/<type>/, a.type))
	}
	function k(a) {
		return a.replace("kpi?", "kpitop?")
	}
	function l() {
		var a,
		b = this,
		c = 2;
		b._json.attachments.forEach(function () {
			a = {
				aTargets : [c],
				fnCreatedCell : function (a, c, d, e, f) {
					return g.call(b, f, a, c, d)
				}
			},
			b.aoColumnDefs.push(a),
			c++
		}),
		b.aoColumnDefs.push({
			aTargets : [c + 1],
			fnCreatedCell : function (a, c, d, e, f) {
				return g.call(b, f, a, c, d)
			}
		}, {
			aTargets : [c + 2],
			fnCreatedCell : function (a, c, d, e, f) {
				return g.call(b, f, a, c, d)
			}
		}, {
			aTargets : [c + 3],
			fnCreatedCell : function (a, c, d, e, f) {
				return g.call(b, f, a, c, d)
			}
		}),
		b.oTable.dataTable({
			sDom : "if<'table-scrollable't>i",
			bPaginate : !1,
			bAutoWidth : !1,
			aoColumns : b.COLUMNS,
			aoColumnDefs : b.aoColumnDefs,
			fnFooterCallback : p,
			fnInfoCallback : function (a, b, c, d, e) {
				return "总共: " + e + "条结果"
			},
			oLanguage : {
				sSearch : "搜索"
			},
			fnInitComplete : function (a) {
				m.call(b),
				a.aoDrawCallback.push({
					fn : function () {
						m.call(b)
					},
					sName : "FixedHeader"
				})
			}
		}).removeClass("invisible")
	}
	function m() {
		var b = this,
		c = b.$element.find(".table-scrollable"),
		d = c.find("table:eq(1)").length;
		b.oTable.find("thead");
		var e,
		f,
		g = b.oTable.offset().top - 40,
		h = b.oTable.outerWidth();
		d ? (e = c.find("table:eq(1)"), f = c.find(".headerWrapper")) : (e = b.oTable.clone(), f = a('<div class="headerWrapper"></div>'), f.append(e)),
		f.css("width", h),
		e.css("width", h),
		e.html("");
		var i = a("thead", b.oTable).clone(!0);
		e.html(i).removeClass("invisible"),
		a("thead>tr th", b.oTable).each(function (b) {
			a("thead>tr th:eq(" + b + ")", e).width(a(this).width())
		}),
		a("thead>tr td", b.oTable).each(function (b) {
			a("thead>tr td:eq(" + b + ")", e).width(a(this).width())
		}),
		d || (f.css({
				position : "absolute",
				top : 0,
				left : 0,
				zIndex : 1e3
			}), c.append(f));
		var j = a(window);
		j.scroll(function () {
			var a = j.scrollTop(),
			b = a - g;
			b > 0 ? f.css({
				top : b
			}) : f.css({
				top : 0
			})
		})
	}
	function n(b, d) {
		var e = this;
		if (e.oTable) {
			var f = i(b),
			g = k(f);
			a.extend(A, b),
			e.oTable.fnClearTable(),
			d && (f += "&detail=1"),
			"user" == b.type ? e.publish("ajax", {
				url : g
			}, c().done(function (a) {
					a && (y = a.teamtop, z = a.companytop)
				}).then(function () {
					o.call(e, f, e.oTable)
				})) : (y = null, z = null, o.call(e, f, e.oTable))
		}
	}
	function o(a, b) {
		var d = this;
		w = a,
		d.publish("ajax", {
			url : a
		}, c().done(function (a) {
				try {
					b.fnAddData(a.aaData),
					b.fnDraw()
				} catch (c) {
					d.publish("error/log", c.message, c.stack)
				}
			}))
	}
	function p(b, c, d, e, f) {
		if (!c.length)
			return a(b).parents("tfoot").hide(), !1;
		f.length ? a(b).parents("tfoot").show() : a(b).parents("tfoot").hide();
		var g,
		h,
		i,
		j,
		k = {};
		for (g = d; e > g; g += 1) {
			i = c[f[g]];
			for (h in i)
				"id" != h && "name" != h && (void 0 === k[h] && (k[h] = 0), k[h] += i[h])
		}
		a(b).find("th").each(function () {
			j = a(this),
			h = j.data("mapping"),
			j.html(k[h])
		}),
		q(a(b).parents("tfoot").find(".team"), y),
		q(a(b).parents("tfoot").find(".company"), z)
	}
	function q(b, c) {
		var d,
		e;
		c ? (b.show(), b.find("th").each(function () {
				e = a(this),
				d = e.data("mapping"),
				c[d] && c[d].name && e.html('<span class="highlight">' + c[d].value + "</span>" + ' (<a data-action="user/open" href="/user/preview#' + c[d].id + '">' + c[d].name + "</a>)")
			})) : b.hide()
	}
	function r(a) {
		var b = this,
		c = b.oTable.fnSettings().aoColumns[a].bVisible;
		b.oTable.fnSetColumnVis(a, c ? !1 : !0)
	}
	function s(b, d, e) {
		var f = this;
		f.publish("ajax", {
			url : b
		}, c().done(function (c) {
				var f,
				g,
				i = h(b);
				c && c.data && (c.data.length > 200 ? g = a('<p class="text-center text-error">系统仅支持显示200条以内的明细!</p>') : (g = a('<table class="table table-striped table-bordered table-candidate table_vam"></table>').data("ids", c.data), f = decodeURI(i.type), g.attr("data-weave", "app/widget/reporting/kpi/attachment-reporting/detail/main(ids)").weave()), d.fnOpen(e, g, "detailCell"))
			}))
	}
	function t() {
		var a = this;
		a.publish("ajax", {
			url : x.ATTACHMENT_CATEGORY
		}, c().done(function (b) {
				a._json.attachments = b,
				b.forEach(function (b) {
					a.COLUMNS.push({
						mData : b.code
					})
				}),
				a.COLUMNS.push({
					mData : "candidate_unknown"
				}, {
					mData : "clientcompany_unknown"
				}, {
					mData : "joborder_unknown"
				}),
				c(function (b) {
					a.html(d, a._json, b)
				}).done(function () {
					u.call(a)
				})
			}))
	}
	function u() {
		var a = this;
		a.oTable = a.$element.find("table"),
		a.publish("ajax", {
			url : x.TEAM_LIST
		}, c().done(function (b) {
				v = b,
				l.call(a)
			}))
	}
	var v,
	w,
	x = {
		TEAM_LIST : "/rest/data/team/list",
		ATTACHMENT_CATEGORY : "/rest/data/options?type=candidate_attachment_category,client_attachment_category,joborder_attachment_category",
		REPORT : "/rest/report/kpi?kpi_type=attachment"
	},
	y = null,
	z = null,
	A = {
		type : "user",
		filter : "",
		filter_id : "",
		start : "",
		end : ""
	};
	return b.extend(function () {
		this.COLUMNS = [{
				mData : "id"
			}, {
				mData : "name"
			}, {
				mData : "attachments"
			}
		],
		this.aoColumnDefs = [{
				bVisible : !1,
				aTargets : [0]
			}, {
				mRender : f,
				aTargets : [1]
			}
		]
	}, {
		"sig/stop" : function (a, b) {
			var c = this;
			c.oTable.fnDestroy(),
			b.resolve()
		},
		"hub:memory/kpi/show" : function (a, b) {
			function c() {
				if ("team" == b.type) {
					if (!v)
						return e.alert("error", "团队列表不存在"), void 0;
					for (var a = !1, c = 0; c < v.length; c += 1)
						v[c].parent_id == b.filter_id && (a = !0);
					a ? n.call(d, b, !0) : n.call(d, b)
				} else
					n.call(d, b)
			}
			var d = this;
			if (d.oTable && !d.oTable.hasClass("invisible"))
				c();
			else
				var f = setInterval(function () {
						d.oTable && !d.oTable.hasClass("invisible") && (c(), clearInterval(f))
					}, 100)
		},
		"hub:memory/context" : function (a, b) {
			this._user = b.user,
			t.call(this)
		},
		"hub/kpi/toggle/column" : function (a, b) {
			var c = this;
			r.call(c, b);
			var d = this.$element.find(".detailCell");
			if (d.length) {
				var e = d.eq(0).closest("tr").prev().children().length;
				d.attr("colspan", e)
			}
		},
		"dom/action.click" : a.noop,
		"dom/action/lookup.click" : function (b, c, d) {
			c.preventDefault();
			var f = this,
			g = a(c.target);
			if (!v)
				return e.alert("error", "团队列表不存在"), void 0;
			for (var h = !1, i = 0; i < v.length; i += 1)
				v[i].parent_id == d && (h = !0);
			A.filter = "team",
			A.filter_id = d,
			h ? this.publish("filter/kpi/update", A, g.html()) : (A.type = "user", this.publish("filter/kpi/update", A, g.html(), !0)),
			n.call(f, A, !0)
		},
		"dom/action/user/open.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			f = d.attr("href");
			e.window({
				url : f,
				name : "User Profile",
				width : "1024"
			})
		},
		"dom/action/details/show.click" : function (b, c, d, e) {
			var f = this,
			g = a(c.target),
			h = g.closest("tr"),
			i = h[0],
			k = {};
			k.type = d,
			k.filter = A.type,
			k.filter_id = e,
			k.start = A.start,
			k.end = A.end;
			var l = j(k);
			f.oTable.fnIsOpen(i) ? (f.oTable.fnClose(i), h.data("detail") !== d ? (s.call(f, l, f.oTable, i), h.data("detail", d), g.closest("td").addClass("selected").siblings().removeClass("selected")) : (h.data("detail", ""), g.closest("td").removeClass("selected"))) : (s.call(f, l, f.oTable, i), h.data("detail", d), g.closest("td").addClass("selected").siblings().removeClass("selected"))
		},
		"dom/action/export/csv.click" : function (a, b) {
			b.preventDefault();
			var c = w + "&output=csv";
			window.open(c)
		}
	})
}), define("troopjs-requirejs/template!app/widget/reporting/kpi/chart/main.html", [], function () {
	return function () {
		var a = '<link rel="stylesheet" href="/assets/libs/nvd3/0.0.1a/nv.d3.css">\n<form action="#" class="form-inline"></form>\n    <select name="chart" data-action="change/view(\'chart\')">\n        <option value="">选择图表类型</option>\n        <option value="lineWithFocusChart">线与焦点图</option>\n        <option value="lineChart">线图</option>\n        <option value="multiBarChart">柱状图</option>\n        <option value="stackedAreaChart">堆积面积图</option>\n        <option value="cumulativeLineChart">累积折线图</option>\n    </select>\n    <select name="slice" class="input-medium" data-action="change/view(\'time_slice\')">\n        <option value="">选择时间划分方式</option>\n        <option value="month">月</option>\n        <option value="week">周</option>\n        <option value="day">日</option>\n    </select>\n</div>\n<div class="chart">\n    <svg style="height: 800px;"></svg>\n</div>';
		return a
	}
}), define("app/widget/reporting/kpi/chart/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "nv", "d3"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		b.html(d, a)
	}
	function f(a, b) {
		var c = a.match(new RegExp("[\\?\\&]" + b + "=([^\\&]*)(\\&?)", "i"));
		return c ? c[1] : c
	}
	function g() {
		var a,
		b = this,
		c = b.route.path.join("&");
		b.$element.find("svg").children().remove(),
		d3.json("/rest/report/kpi_d3?" + c, function (b) {
			nv.addGraph(function () {
				var d = f(c, "chart");
				return a = nv.models[d](),
				a.xAxis.tickFormat(function (a) {
					return d3.time.format("%Y-%m-%d")(new Date(a))
				}).tickValues(b.ticks),
				a.yAxis.tickFormat(d3.format("d")),
				d3.select(".chart svg").datum(b.data).transition().duration(500).call(a),
				nv.utils.windowResize(a.update),
				a
			})
		})
	}
	return b.extend({
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		},
		"hub:memory/route" : function (a, b) {
			var c = this;
			c.route = b,
			g.call(c)
		},
		"dom/action.change" : a.noop,
		"dom/action/change/view.change" : function (b, c, d) {
			var e = this,
			f = a(c.target),
			g = f.val(),
			h = e.route.path;
			h.forEach(function (a, b, c) {
				var e = a.indexOf(d);
				e > -1 && (c[b] = d + "=" + g)
			}),
			window.location.hash = h.join("/")
		}
	})
}), define("troopjs-requirejs/template!app/widget/reporting/kpi/client-reporting/detail/main.html", [], function () {
	return function (a) {
		for (var b = '<colgroup>\n    <col>\n    <col>\n    <col>\n    <col>\n    <col>\n    <col>\n</colgroup>\n\n<thead>\n    <tr>\n        <th data-weave="shared/helper/translation" data-i18n="Company Name"></th>\n        <th data-weave="shared/helper/translation" data-i18n="City"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Industry"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Company Type"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Creator"></th>\n        <th data-weave="shared/helper/translation" data-i18n="BD"></th>\n    </tr>\n</thead>\n\n<tbody>\n    ', c = 0, d = a.length; d > c; c++) {
			b += "\n    ";
			var e = a[c];
			b += '\n    <tr>\n        <td>\n            <a href="/company#detail!id=' + e.id + '" target="_blank">' + e.name + "</a>\n        </td>\n        <td>\n            ",
			e.city && (b += "\n            " + e.city.name + "\n            "),
			b += "\n        </td>\n        <td>\n            ",
			e.industry && (b += "\n            " + e.industry.name + "\n            "),
			b += "\n        </td>\n        <td>\n            ",
			e.type && (b += '\n            <span data-weave="shared/helper/translation" data-i18n="' + e.type + ' company"></span>\n            '),
			b += '\n        </td>\n        <td>\n            <a href="/user/preview#' + e.addedBy.id + '" data-action="user/open">' + e.addedBy.englishName + "</a>\n        </td>\n        <td>\n            ",
			e.bd && (b += '\n            <a href="/user/preview#' + e.bd.id + '" data-action="user/open">' + e.bd.englishName + "</a>\n            "),
			b += "\n        </td>\n    </tr>\n    "
		}
		return b += "\n</tbody>"
	}
}), define("app/widget/reporting/kpi/client-reporting/detail/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "shared/helper/utils", "jquery.datatables"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		b.publish("ajax", {
			url : h.LIST.replace("<ids>", b._ids)
		}, c().done(function (c) {
				b._json = c.list,
				b.html(e, b._json, a)
			}))
	}
	function g(a) {
		var b = this;
		b.oTable = b.$element.dataTable({
				sDom : "t",
				bPaginate : !1,
				bLengthChange : !1,
				aaSorting : []
			}),
		a.resolve()
	}
	var h = {
		LIST : "/rest/client/list?paginate_by=200&id__s=<ids>"
	};
	return b.extend(function (a, b, c) {
		var d = this;
		d._ids = c
	}, {
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"sig/start" : function (a, b) {
			g.call(this, b)
		},
		"sig/stop" : function (a, b) {
			this.oTable.fnDestroy(),
			b.resolve()
		}
	})
}), define("troopjs-requirejs/template!app/widget/reporting/kpi/client-reporting/main.html", [], function () {
	return function () {
		var a = '<div class="row-fluid">\n    <div class="span12">\n        <p class="text-right">\n            <button class="btn" data-weave="shared/helper/translation" data-i18n="Export Reporting" data-action="export/csv"></button>    \n        </p>\n\n        <table class="table table-striped table-bordered dTableR invisible">\n            <thead>\n                <tr>\n                    <th data-mapping="id">ID</th>\n                    <th data-mapping="name" data-weave="shared/helper/translation" data-i18n="User"></th>\n                    <th data-mapping="clients" data-weave="shared/helper/translation" data-i18n="All Companies"></th>\n                    <th data-mapping="generated" data-weave="shared/helper/translation" data-i18n="generated company"></th>\n                    <th data-mapping="normal" data-weave="shared/helper/translation" data-i18n="normal company"></th>\n                    <th data-mapping="bding" data-weave="shared/helper/translation" data-i18n="bding company"></th>\n                    <th data-mapping="client" data-weave="shared/helper/translation" data-i18n="client company"></th>\n                </tr>\n            </thead>\n            <tbody>\n\n            </tbody>\n            <tfoot>\n                <tr class="sum">\n                    <th></th>\n                    <th data-weave="shared/helper/translation" data-i18n="Summary"></th>\n                    <th data-mapping="clients"></th>\n                    <th data-mapping="generated"></th>\n                    <th data-mapping="normal"></th>\n                    <th data-mapping="bding"></th>\n                    <th data-mapping="client"></th>\n                </tr>\n                <tr class="team">\n                    <th></th>\n                    <th data-weave="shared/helper/translation" data-i18n="Team highest" class="highlight"></th>\n                    <th data-mapping="clients"></th>\n                    <th data-mapping="generated"></th>\n                    <th data-mapping="normal"></th>\n                    <th data-mapping="bding"></th>\n                    <th data-mapping="client"></th>\n                </tr>\n                <tr class="company">\n                    <th></th>\n                    <th data-weave="shared/helper/translation" data-i18n="Company highest" class="highlight"></th>\n                    <th data-mapping="clients"></th>\n                    <th data-mapping="generated"></th>\n                    <th data-mapping="normal"></th>\n                    <th data-mapping="bding"></th>\n                    <th data-mapping="client"></th>\n                </tr>\n            </tfoot>\n        </table>\n    </div>\n</div>';
		return a
	}
}), define("app/widget/reporting/kpi/client-reporting/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "jquery.datatables"], function (a, b, c, d, e) {
	function f(a, b, c) {
		var d,
		e = "";
		switch (B.type) {
		case "user":
			"Active" !== c.status && (e = "muted"),
			d = '<a class="' + e + '" data-action="user/open" href="/user/preview#' + c.id + '">' + a + "</a>";
			break;
		case "team":
			d = '<a href="#' + c.id + '" data-action="lookup(' + c.id + ')">' + a + "</a>";
			break;
		default:
			d = a
		}
		return d
	}
	function g(b, c, d, e) {
		var f = C[b].mData;
		d > 0 && a(c).attr("data-action", 'details/show("' + f + '", ' + e.id + ")").addClass("info")
	}
	function h(a) {
		var b = {};
		return a.replace(/([^?=&]+)(=([^&]*))?/g, function (a, c, d, e) {
			b[c] = e
		}),
		b
	}
	function i(a) {
		var b = "/rest/report/kpi?kpi_type=client&type=<type>",
		c = "&filter=<filter>&<filter>_id=<id>",
		d = "&start=<start>&end=<end>";
		return a.filter && (a.filter_id || 0 === a.filter_id) && (b += c.replace(/<filter>/g, a.filter).replace(/<id>/, a.filter_id)),
		a.start && a.end && (b += d.replace(/<start>/, a.start).replace(/<end>/, a.end)),
		b = b.replace(/<type>/, a.type),
		x = b.substring(b.indexOf("?") + 1),
		b
	}
	function j(a) {
		var b = "/rest/report/kpidetail?kpi_type=client&type=<type>",
		c = "&filter=<filter>&<filter>_id=<id>",
		d = "&start=<start>&end=<end>";
		return a.filter && (a.filter_id || 0 === a.filter_id) && (b += c.replace(/<filter>/g, a.filter).replace(/<id>/, a.filter_id)),
		a.start && a.end && (b += d.replace(/<start>/, a.start).replace(/<end>/, a.end)),
		encodeURI(b.replace(/<type>/, a.type))
	}
	function k(a) {
		return a.replace("kpi?", "kpitop?")
	}
	function l() {
		var a = this;
		a.oTable.dataTable({
			sDom : "if<'table-scrollable't>i",
			bPaginate : !1,
			bAutoWidth : !1,
			aoColumns : C,
			aoColumnDefs : D,
			fnFooterCallback : p,
			fnInfoCallback : function (a, b, c, d, e) {
				return "总共: " + e + "条结果"
			},
			oLanguage : {
				sSearch : "搜索"
			},
			fnInitComplete : function (b) {
				m.call(a),
				b.aoDrawCallback.push({
					fn : function () {
						m.call(a)
					},
					sName : "FixedHeader"
				})
			}
		}).removeClass("invisible")
	}
	function m() {
		var b = this,
		c = b.$element.find(".table-scrollable"),
		d = c.find("table:eq(1)").length;
		b.oTable.find("thead");
		var e,
		f,
		g = b.oTable.offset().top - 40,
		h = b.oTable.outerWidth();
		d ? (e = c.find("table:eq(1)"), f = c.find(".headerWrapper")) : (e = b.oTable.clone(), f = a('<div class="headerWrapper"></div>'), f.append(e)),
		f.css("width", h),
		e.css("width", h),
		e.html("");
		var i = a("thead", b.oTable).clone(!0);
		e.html(i).removeClass("invisible"),
		a("thead>tr th", b.oTable).each(function (b) {
			a("thead>tr th:eq(" + b + ")", e).width(a(this).width())
		}),
		a("thead>tr td", b.oTable).each(function (b) {
			a("thead>tr td:eq(" + b + ")", e).width(a(this).width())
		}),
		d || (f.css({
				position : "absolute",
				top : 0,
				left : 0,
				zIndex : 1e3
			}), c.append(f));
		var j = a(window);
		j.scroll(function () {
			var a = j.scrollTop(),
			b = a - g;
			b > 0 ? f.css({
				top : b
			}) : f.css({
				top : 0
			})
		})
	}
	function n(b, d) {
		var e = this;
		if (e.oTable) {
			var f = i(b),
			g = k(f);
			a.extend(B, b),
			e.oTable.fnClearTable(),
			d && (f += "&detail=1"),
			"user" == b.type ? e.publish("ajax", {
				url : g
			}, c().done(function (a) {
					a && (z = a.teamtop, A = a.companytop)
				}).then(function () {
					o.call(e, f, e.oTable)
				})) : (z = null, A = null, o.call(e, f, e.oTable))
		}
	}
	function o(a, b) {
		var d = this;
		w = a,
		d.publish("ajax", {
			url : a
		}, c().done(function (a) {
				try {
					b.fnAddData(a.aaData),
					b.fnDraw()
				} catch (c) {
					d.publish("error/log", c.message, c.stack)
				}
			}))
	}
	function p(b, c, d, e, f) {
		if (!c.length)
			return a(b).parents("tfoot").hide(), !1;
		f.length ? a(b).parents("tfoot").show() : a(b).parents("tfoot").hide();
		var g,
		h,
		i,
		j,
		k = {};
		for (g = d; e > g; g += 1) {
			i = c[f[g]];
			for (h in i)
				"id" != h && "name" != h && (void 0 === k[h] && (k[h] = 0), k[h] += i[h])
		}
		a(b).find("th").each(function () {
			j = a(this),
			h = j.data("mapping"),
			j.html(k[h])
		}),
		q(a(b).parents("tfoot").find(".team"), z),
		q(a(b).parents("tfoot").find(".company"), A)
	}
	function q(b, c) {
		var d,
		e;
		c ? (b.show(), b.find("th").each(function () {
				e = a(this),
				d = e.data("mapping"),
				c[d] && c[d].name && e.html('<span class="highlight">' + c[d].value + "</span>" + ' (<a data-action="user/open" href="/user/preview#' + c[d].id + '">' + c[d].name + "</a>)")
			})) : b.hide()
	}
	function r(a) {
		var b = this,
		c = b.oTable.fnSettings().aoColumns[a].bVisible;
		b.oTable.fnSetColumnVis(a, c ? !1 : !0)
	}
	function s(b, d, e) {
		var f = this;
		f.publish("ajax", {
			url : b
		}, c().done(function (c) {
				h(b);
				var f;
				c && c.data && (c.data.length > 200 ? f = a('<p class="text-center text-error">系统仅支持显示200条以内的明细!</p>') : (f = a('<table class="table table-striped table-bordered table-candidate table_vam"></table>').data("ids", c.data), f.attr("data-weave", "app/widget/reporting/kpi/client-reporting/detail/main(ids)").weave()), d.fnOpen(e, f, "detailCell"))
			}))
	}
	function t() {
		var a = this;
		c(function (b) {
			a.html(d, a._json, b)
		}).done(function () {
			u.call(a)
		})
	}
	function u() {
		var a = this;
		a.oTable = a.$element.find("table"),
		a.publish("ajax", {
			url : y.TEAM_LIST
		}, c().done(function (b) {
				v = b,
				l.call(a)
			}))
	}
	var v,
	w,
	x,
	y = {
		TEAM_LIST : "/rest/data/team/list"
	},
	z = null,
	A = null,
	B = {
		type : "user",
		filter : "",
		filter_id : "",
		start : "",
		end : ""
	},
	C = [{
			mData : "id"
		}, {
			mData : "name"
		}, {
			mData : "clients"
		}, {
			mData : "generated"
		}, {
			mData : "normal"
		}, {
			mData : "bding"
		}, {
			mData : "client"
		}
	],
	D = [{
			bVisible : !1,
			aTargets : [0]
		}, {
			mRender : f,
			aTargets : [1]
		}, {
			aTargets : [2],
			fnCreatedCell : function (a, b, c, d, e) {
				return g(e, a, b, c)
			}
		}, {
			aTargets : [3],
			fnCreatedCell : function (a, b, c, d, e) {
				return g(e, a, b, c)
			}
		}, {
			aTargets : [4],
			fnCreatedCell : function (a, b, c, d, e) {
				return g(e, a, b, c)
			}
		}, {
			aTargets : [5],
			fnCreatedCell : function (a, b, c, d, e) {
				return g(e, a, b, c)
			}
		}, {
			aTargets : [6],
			fnCreatedCell : function (a, b, c, d, e) {
				return g(e, a, b, c)
			}
		}
	];
	return b.extend({
		"sig/stop" : function (a, b) {
			var c = this;
			c.oTable.fnDestroy(),
			b.resolve()
		},
		"hub:memory/kpi/show" : function (a, b) {
			function c() {
				if ("team" == b.type) {
					if (!v)
						return e.alert("error", "团队列表不存在"), void 0;
					for (var a = !1, c = 0; c < v.length; c += 1)
						v[c].parent_id == b.filter_id && (a = !0);
					a ? n.call(d, b, !0) : n.call(d, b)
				} else
					n.call(d, b)
			}
			var d = this;
			if (d.oTable && !d.oTable.hasClass("invisible"))
				c();
			else
				var f = setInterval(function () {
						d.oTable && !d.oTable.hasClass("invisible") && (c(), clearInterval(f))
					}, 100)
		},
		"hub:memory/context" : function (a, b) {
			this._user = b.user,
			t.call(this)
		},
		"hub/kpi/toggle/column" : function (a, b) {
			var c = this;
			r.call(c, b);
			var d = this.$element.find(".detailCell");
			if (d.length) {
				var e = d.eq(0).closest("tr").prev().children().length;
				d.attr("colspan", e)
			}
		},
		"dom/action.click" : a.noop,
		"dom/action/lookup.click" : function (b, c, d) {
			c.preventDefault();
			var f = this,
			g = a(c.target);
			if (!v)
				return e.alert("error", "团队列表不存在"), void 0;
			for (var h = !1, i = 0; i < v.length; i += 1)
				v[i].parent_id == d && (h = !0);
			B.filter = "team",
			B.filter_id = d,
			h ? this.publish("filter/kpi/update", B, g.html()) : (B.type = "user", this.publish("filter/kpi/update", B, g.html(), !0)),
			n.call(f, B, !0)
		},
		"dom/action/user/open.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			f = d.attr("href");
			e.window({
				url : f,
				name : "User Profile",
				width : "1024"
			})
		},
		"dom/action/details/show.click" : function (b, c, d, e) {
			var f = this,
			g = a(c.target),
			h = g.closest("tr"),
			i = h[0],
			k = {};
			k.type = d,
			k.filter = B.type,
			k.filter_id = e,
			k.start = B.start,
			k.end = B.end;
			var l = j(k);
			f.oTable.fnIsOpen(i) ? (f.oTable.fnClose(i), h.data("detail") !== d ? (s.call(f, l, f.oTable, i), h.data("detail", d), g.closest("td").addClass("selected").siblings().removeClass("selected")) : (h.data("detail", ""), g.closest("td").removeClass("selected"))) : (s.call(f, l, f.oTable, i), h.data("detail", d), g.closest("td").addClass("selected").siblings().removeClass("selected"))
		},
		"dom/action/export/csv.click" : function (a, b) {
			b.preventDefault();
			var c = w + "&output=csv";
			window.open(c)
		}
	})
}), define("troopjs-requirejs/template!app/widget/reporting/kpi/filter/main.html", [], function () {
	return function (a) {
		var b = "",
		c = a.user.kpiReportView;
		switch (c) {
		case "Myself":
			c = 1;
			break;
		case "My Team":
			c = 2;
			break;
		case "All":
			c = 3
		}
		return b += '\n<div class="well well-small" >\n    <ul class="nav nav-pills pull-right">\n        <li class="text-line">\n            <span class="period">\n                <span id="from"></span>\n                &ndash;\n                <span id="to"></span>    \n            </span>\n            <span class="all">\n                <span data-weave="shared/helper/translation" data-i18n="All"></span>\n            </span>\n        </li>\n        <li>\n            <a href="#" data-action="change/date(\'today\')" data-weave="shared/helper/translation" data-i18n="Today"></a>\n        </li>\n        <li>\n            <a href="#" data-action="change/date(\'thisweek\')" data-weave="shared/helper/translation" data-i18n="This week"></a>\n        </li>\n        <li>\n            <a href="#" data-action="change/date(\'lastweek\')" data-weave="shared/helper/translation" data-i18n="Last week"></a>\n        </li>\n        <li>\n        <a href="#" data-action="change/date(\'thismonth\')" data-weave="shared/helper/translation" data-i18n="This month"></a>\n        </li>\n        <li>\n            <a href="#" data-action="change/date(\'lastmonth\')" data-weave="shared/helper/translation" data-i18n="Last month"></a>\n        </li>\n        <li>\n            <a href="#" data-action="change/date(\'thisyear\')" data-weave="shared/helper/translation" data-i18n="This year"></a>\n        </li>\n        <li>\n            <a href="#" data-action="change/date(\'lastyear\')" data-weave="shared/helper/translation" data-i18n="Last year"></a>\n        </li>\n        <li>\n            <a href="#" data-action="change/date(\'all\')" data-weave="shared/helper/translation" data-i18n="All"></a>\n        </li>\n        <li class="dropdown pull-right">\n            <a href="#" class="dropdown-toggle" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Custom date"></a>\n            <div class="dropdown-menu filter-content">\n                <form action="#">\n                    <div>\n                        <input type="text" name="from" class="input-small" data-action="date" data-weave="shared/widget/common/date-picker/main">\n                        &ndash;\n                        <input type="text" name="to" class="input-small" data-action="date" data-weave="shared/widget/common/date-picker/main">\n                    </div>\n                    <button id="filter-date" class="btn" type="submit" data-action="custom" data-weave="shared/helper/translation" data-i18n="Search"></button>\n                </form>\n            </div>\n        </li>\n    </ul>\n    <ul class="nav nav-pills">\n        <li class="active">\n        <a href="#" data-action="myself">Myself</a>\n        </li>\n        ',
		2 == c && (b += '\n        <li>\n        <a href="#' + a.user.team.id + '" data-action="myteam">My Team</a>\n        </li>\n        '),
		b += "\n        ",
		3 == c && (b += '\n        <li>\n        <a href="#0" data-action="myteam">My Team</a>\n        </li>\n        '),
		b += '\n        <li class="text-line hide">\n        <span id="category"></span>\n        </li>\n    </ul>\n</div>\n<div class="viewtype hide">\n    <label class="radio"><input name="viewtype" type="radio" value="user" checked="checked" data-action="viewtype" /><span data-weave="shared/helper/translation" data-i18n="By User"></span></label>\n    <label class="radio"><input name="viewtype" type="radio" value="team" data-action="viewtype" /><span data-weave="shared/helper/translation" data-i18n="By Team"></span></label>\n</div>'
	}
}), define("app/widget/reporting/kpi/filter/main", ["compose", "jquery", "shared/widget/filter/base", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d, e) {
	function f(a) {
		var b = new Date(a),
		c = b.getFullYear(),
		d = b.getMonth() + 1,
		e = b.getDate();
		return c + "-" + d + "-" + e
	}
	function g(a, b) {
		a.closest("ul").find(".active").removeClass("active"),
		a.closest("li").addClass("active"),
		this.publish("kpi/show", b)
	}
	function h(a, b) {
		var c = this;
		a && b ? (c.$from.text(a), c.$to.text(b), c.$period.show(), c.$all.hide()) : (c.$period.hide(), c.$all.show())
	}
	function i(a) {
		this.$element.find(".viewtype").toggleClass("hide", a)
	}
	function j() {
		var a = this;
		d(function (b) {
			a.html(e, a._json, b)
		}).done(function () {
			k.call(a)
		})
	}
	function k() {
		var a = this;
		a.$from = a.$element.find("#from"),
		a.$to = a.$element.find("#to"),
		a.$period = a.$element.find(".period"),
		a.$all = a.$element.find(".all"),
		t.filter = "user",
		t.filter_id = this._user.id,
		a.publish("reporting/kpi/filter/set/default")
	}
	var l = Date.now(),
	m = new Date,
	n = l - 864e5 * ((m.getDay() || 7) - 1),
	o = n + 5184e5,
	p = l - 864e5 * (m.getDate() - 1),
	q = new Date(m.getFullYear(), m.getMonth() + 1, 0),
	r = (new Date).getFullYear() + "-01-01",
	s = (new Date).getFullYear() + "-12-31",
	t = {
		type : "user",
		filter : "",
		filter_id : "",
		start : f(n),
		end : f(o)
	};
	return c.extend(function () {}, {
		"hub:memory/context" : function (a, b) {
			this._json.user = this._user = b.user,
			j.call(this)
		},
		"hub:memory/filter/kpi/update" : function (a, c, d, e) {
			b.extend(t, c);
			var f = this.$element.find("#category");
			f.closest("ul").find(".active").removeClass("active"),
			e ? (f.html(d).parent().removeClass("hide"), this.$element.find("input[value=user]").prop("checked", !0)) : (f.parent().addClass("hide"), f.parent().before(b('<li class="active">').append(b('<a data-action="myteam" href="#' + c.filter_id + '">' + d + "</a>"))))
		},
		"hub:memory/reporting/kpi/filter/set/default" : function () {
			var a = this;
			"initialize" !== a.phase && a.$element.find('[data-action*="thisweek"]').trigger("click")
		},
		"dom/action.click" : b.noop,
		"dom/action.change" : b.noop,
		"dom/action/myself.click" : function (a, c) {
			c.preventDefault();
			var d = this._user,
			e = b(c.target);
			t.type = "user",
			t.filter = "user",
			t.filter_id = d.id,
			i.call(this, !0),
			g.call(this, e, t)
		},
		"dom/action/myteam.click" : function (a, c) {
			c.preventDefault(),
			this._user;
			var d = b(c.target),
			e = d.attr("href").slice(1);
			d.parent().nextUntil(".text-line").remove(),
			d.parent().next(".text-line").addClass("hide"),
			t.type = this.$element.find(":checked").val(),
			t.filter = "team",
			t.filter_id = e,
			i.call(this, !1),
			g.call(this, d, t)
		},
		"dom/action/change/date" : function (a, c, d) {
			c.preventDefault(),
			this._user;
			var e,
			i,
			j = b(c.target);
			switch (d) {
			case "today":
				t.start = f(m),
				t.end = f(m);
				break;
			case "thisweek":
				t.start = f(n),
				t.end = f(o);
				break;
			case "thismonth":
				t.start = f(p),
				t.end = f(q);
				break;
			case "thisyear":
				t.start = r,
				t.end = s;
				break;
			case "lastweek":
				i = m.getTime() - 1e3 * 60 * 60 * 24 * (m.getDay() ? m.getDay() : 7),
				e = new Date(i).getTime() - 5184e5,
				t.start = f(e),
				t.end = f(i);
				break;
			case "lastmonth":
				e = new Date(m.getFullYear(), m.getMonth() - 1, 1).getTime(),
				i = new Date(m.getFullYear(), m.getMonth(), 0).getTime(),
				t.start = f(e),
				t.end = f(i);
				break;
			case "lastyear":
				e = new Date(m.getFullYear() - 1, 0, 1).getTime(),
				i = new Date(m.getFullYear() - 1, 11, 31).getTime(),
				t.start = f(e),
				t.end = f(i);
				break;
			case "all":
				e = new Date("1900-1-1").getTime(),
				i = new Date("2099-12-31").getTime(),
				t.start = f(e),
				t.end = f(i)
			}
			"all" !== d ? h.call(this, t.start, t.end) : h.call(this),
			g.call(this, j, t)
		},
		"dom/action/date.click" : function (a, b) {
			b.stopPropagation()
		},
		"dom/action/custom.click" : function (a, c) {
			c.preventDefault(),
			this._user;
			var d = b(c.target),
			e = d.closest("form"),
			f = e.find("[name=from]").val(),
			i = e.find("[name=to]").val(),
			j = d.closest(".dropdown");
			t.start = f,
			t.end = i,
			h.call(this, t.start, t.end),
			g.call(this, d, t),
			j.removeClass("open")
		},
		"dom/action/viewtype.change" : function (a, b) {
			this._user,
			t.type = b.target.value,
			this.publish("kpi/show", t)
		}
	})
}), define("troopjs-requirejs/template!app/widget/reporting/kpi/job-reporting/main.html", [], function () {
	return function () {
		var a = '<div class="row-fluid">\n    <div class="span12">\n        <p class="text-right">\n            <button class="btn" data-weave="shared/helper/translation" data-i18n="Export Reporting" data-action="export/csv"></button>    \n        </p>\n\n        <table class="table table-striped table-bordered dTableR invisible">\n            <thead>\n                <tr>\n                    <th data-mapping="id">ID</th>\n                    <th data-mapping="name" data-weave="shared/helper/translation" data-i18n="User"></th>\n                    <th data-mapping="shortlist" data-weave="shared/helper/translation" data-i18n="Shortlist"></th>\n                    <th data-mapping="job new added" data-weave="shared/helper/translation" data-i18n="New Added Jobs"></th>\n                    <th data-mapping="live jobs" data-weave="shared/helper/translation" data-i18n="Living Jobs"></th>\n                    <th data-mapping="updated jobs" data-weave="shared/helper/translation" data-i18n="Updated Jobs"></th>\n                    <th data-mapping="cv sent" data-weave="shared/helper/translation" data-i18n="CVs Sent"></th>\n                    <th data-mapping="client interview" data-weave="shared/helper/translation" data-i18n="Client Interview"></th>\n                    <th data-mapping="offer signed" data-weave="shared/helper/translation" data-i18n="Offer Signed"></th>\n                </tr>\n            </thead>\n            <tbody>\n\n            </tbody>\n            <tfoot>\n                <tr class="sum">\n                    <th></th>\n                    <th data-weave="shared/helper/translation" data-i18n="Summary"></th>\n                    <th data-mapping="shortlist"></th>\n                    <th data-mapping="job new added"></th>\n                    <th data-mapping="live jobs"></th>\n                    <th data-mapping="updated jobs"></th>\n                    <th data-mapping="cv sent"></th>\n                    <th data-mapping="client interview"></th>\n                    <th data-mapping="offer signed"></th>\n                </tr>\n                <tr class="team">\n                    <th></th>\n                    <th data-weave="shared/helper/translation" data-i18n="Team highest" class="highlight"></th>\n                    <th data-mapping="shortlist"></th>\n                    <th data-mapping="job new added"></th>\n                    <th data-mapping="live jobs"></th>\n                    <th data-mapping="updated jobs"></th>\n                    <th data-mapping="cv sent"></th>\n                    <th data-mapping="client interview"></th>\n                    <th data-mapping="offer signed"></th>\n                </tr>\n                <tr class="company">\n                    <th></th>\n                    <th data-weave="shared/helper/translation" data-i18n="Company highest" class="highlight"></th>\n                    <th data-mapping="shortlist"></th>\n                    <th data-mapping="job new added"></th>\n                    <th data-mapping="live jobs"></th>\n                    <th data-mapping="updated jobs"></th>\n                    <th data-mapping="cv sent"></th>\n                    <th data-mapping="client interview"></th>\n                    <th data-mapping="offer signed"></th>\n                </tr>\n            </tfoot>\n        </table>\n    </div>\n</div>';
		return a
	}
}), define("app/widget/reporting/kpi/job-reporting/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "jquery.datatables"], function (a, b, c, d, e) {
	function f(a, b, c) {
		var d,
		e = "";
		switch (B.type) {
		case "user":
			"Active" !== c.status && (e = "muted"),
			d = '<a class="' + e + '" data-action="user/open" href="/user/preview#' + c.id + '">' + a + "</a>";
			break;
		case "team":
			d = '<a href="#' + c.id + '" data-action="lookup(' + c.id + ')">' + a + "</a>";
			break;
		default:
			d = a
		}
		return d
	}
	function g(b, c, d, e) {
		var f = C[b].mData;
		d > 0 && a(c).attr("data-action", 'details/show("' + f + '", ' + e.id + ")").addClass("info")
	}
	function h(a) {
		var b = {};
		return a.replace(/([^?=&]+)(=([^&]*))?/g, function (a, c, d, e) {
			b[c] = e
		}),
		b
	}
	function i(a) {
		var b = "/rest/report/kpi?type=<type>",
		c = "&filter=<filter>&<filter>_id=<id>",
		d = "&start=<start>&end=<end>";
		return a.filter && (a.filter_id || 0 === a.filter_id) && (b += c.replace(/<filter>/g, a.filter).replace(/<id>/, a.filter_id)),
		a.start && a.end && (b += d.replace(/<start>/, a.start).replace(/<end>/, a.end)),
		b = b.replace(/<type>/, a.type),
		x = b.substring(b.indexOf("?") + 1),
		b
	}
	function j(a) {
		var b = "/rest/report/kpidetail?type=<type>",
		c = "&filter=<filter>&<filter>_id=<id>",
		d = "&start=<start>&end=<end>";
		return a.filter && (a.filter_id || 0 === a.filter_id) && (b += c.replace(/<filter>/g, a.filter).replace(/<id>/, a.filter_id)),
		a.start && a.end && (b += d.replace(/<start>/, a.start).replace(/<end>/, a.end)),
		encodeURI(b.replace(/<type>/, a.type))
	}
	function k(a) {
		return a.replace("kpi?", "kpitop?")
	}
	function l() {
		var a = this;
		a.oTable.dataTable({
			sDom : "if<'table-scrollable't>i",
			bPaginate : !1,
			bAutoWidth : !1,
			aoColumns : C,
			aoColumnDefs : D,
			fnFooterCallback : p,
			fnInfoCallback : function (a, b, c, d, e) {
				return "总共: " + e + "条结果"
			},
			oLanguage : {
				sSearch : "搜索"
			},
			fnInitComplete : function (b) {
				m.call(a),
				b.aoDrawCallback.push({
					fn : function () {
						m.call(a)
					},
					sName : "FixedHeader"
				})
			}
		}).removeClass("invisible")
	}
	function m() {
		var b = this,
		c = b.$element.find(".table-scrollable"),
		d = c.find("table:eq(1)").length;
		b.oTable.find("thead");
		var e,
		f,
		g = b.oTable.offset().top - 40,
		h = b.oTable.outerWidth();
		d ? (e = c.find("table:eq(1)"), f = c.find(".headerWrapper")) : (e = b.oTable.clone(), f = a('<div class="headerWrapper"></div>'), f.append(e)),
		f.css("width", h),
		e.css("width", h),
		e.html("");
		var i = a("thead", b.oTable).clone(!0);
		e.html(i).removeClass("invisible"),
		a("thead>tr th", b.oTable).each(function (b) {
			a("thead>tr th:eq(" + b + ")", e).width(a(this).width())
		}),
		a("thead>tr td", b.oTable).each(function (b) {
			a("thead>tr td:eq(" + b + ")", e).width(a(this).width())
		}),
		d || (f.css({
				position : "absolute",
				top : 0,
				left : 0,
				zIndex : 1e3
			}), c.append(f));
		var j = a(window);
		j.scroll(function () {
			var a = j.scrollTop(),
			b = a - g;
			b > 0 ? f.css({
				top : b
			}) : f.css({
				top : 0
			})
		})
	}
	function n(b, d) {
		var e = this;
		if (e.oTable) {
			var f = i(b),
			g = k(f);
			a.extend(B, b),
			e.oTable.fnClearTable(),
			d && (f += "&detail=1"),
			"user" == b.type ? e.publish("ajax", {
				url : g
			}, c().done(function (a) {
					a && (z = a.teamtop, A = a.companytop)
				}).then(function () {
					o.call(e, f, e.oTable)
				})) : (z = null, A = null, o.call(e, f, e.oTable))
		}
	}
	function o(a, b) {
		var d = this;
		w = a,
		d.publish("ajax", {
			url : a
		}, c().done(function (a) {
				try {
					b.fnAddData(a.aaData),
					b.fnDraw()
				} catch (c) {
					d.publish("error/log", c.message, c.stack)
				}
			}))
	}
	function p(b, c, d, e, f) {
		if (!c.length)
			return a(b).parents("tfoot").hide(), !1;
		f.length ? a(b).parents("tfoot").show() : a(b).parents("tfoot").hide();
		var g,
		h,
		i,
		j,
		k = {};
		for (g = d; e > g; g += 1) {
			i = c[f[g]];
			for (h in i)
				"id" != h && "name" != h && (void 0 === k[h] && (k[h] = 0), k[h] += i[h])
		}
		a(b).find("th").each(function () {
			j = a(this),
			h = j.data("mapping"),
			j.html(k[h])
		}),
		q(a(b).parents("tfoot").find(".team"), z),
		q(a(b).parents("tfoot").find(".company"), A)
	}
	function q(b, c) {
		var d,
		e;
		c ? (b.show(), b.find("th").each(function () {
				e = a(this),
				d = e.data("mapping"),
				c[d] && c[d].name && e.html('<span class="highlight">' + c[d].value + "</span>" + ' (<a data-action="user/open" href="/user/preview#' + c[d].id + '">' + c[d].name + "</a>)")
			})) : b.hide()
	}
	function r(a) {
		var b = this,
		c = b.oTable.fnSettings().aoColumns[a].bVisible;
		b.oTable.fnSetColumnVis(a, c ? !1 : !0)
	}
	function s(b, d, e) {
		var f = this;
		f.publish("ajax", {
			url : b
		}, c().done(function (c) {
				var f,
				g,
				i = h(b);
				if (c && c.data) {
					if (c.data.length > 200)
						g = a('<p class="text-center text-error">系统仅支持显示200条以内的明细!</p>');
					else
						switch (g = a('<table class="table table-striped table-bordered table-candidate table_vam"></table>').data("ids", c.data), f = decodeURI(i.type)) {
						case "floating":
							g.attr("data-weave", "app/widget/reporting/kpi/main-reporting/floating/main(ids)").weave();
							break;
						case "owned candidates":
						case "keyin candidates":
							g.attr("data-weave", "app/widget/reporting/kpi/main-reporting/people/main(ids)").weave();
							break;
						case "candidate email sent":
							g.attr("data-weave", "app/widget/reporting/kpi/main-reporting/email/main(ids)").weave();
							break;
						case "notes":
							g.attr("data-weave", "app/widget/reporting/kpi/main-reporting/action/main(ids, true)").weave();
							break;
						case "shortlist":
						case "cv sent":
						case "offer signed":
						case "cv sent by owner":
						case "offer signed by owner":
							g.attr("data-weave", "app/widget/reporting/kpi/main-reporting/submission/main(ids, " + f + ")").weave();
							break;
						case "job new added":
						case "live jobs":
						case "updated jobs":
							g.attr("data-weave", "app/widget/reporting/kpi/main-reporting/job/main(ids)").weave();
							break;
						case "client interview":
						case "client interview by owner":
							g.attr("data-weave", "app/widget/reporting/kpi/main-reporting/interview/main(ids)").weave();
							break;
						default:
							g.attr("data-weave", "app/widget/reporting/kpi/main-reporting/action/main(ids)").weave()
						}
					d.fnOpen(e, g, "detailCell")
				}
			}))
	}
	function t() {
		var a = this;
		c(function (b) {
			a.html(d, a._json, b)
		}).done(function () {
			u.call(a)
		})
	}
	function u() {
		var a = this;
		a.oTable = a.$element.find("table"),
		a.publish("ajax", {
			url : y.TEAM_LIST
		}, c().done(function (b) {
				v = b,
				l.call(a)
			}))
	}
	var v,
	w,
	x,
	y = {
		TEAM_LIST : "/rest/data/team/list"
	},
	z = null,
	A = null,
	B = {
		type : "user",
		filter : "",
		filter_id : "",
		start : "",
		end : ""
	},
	C = [{
			mData : "id"
		}, {
			mData : "name"
		}, {
			mData : "shortlist"
		}, {
			mData : "job new added"
		}, {
			mData : "live jobs"
		}, {
			mData : "updated jobs"
		}, {
			mData : "cv sent"
		}, {
			mData : "client interview"
		}, {
			mData : "offer signed"
		}
	],
	D = [{
			bVisible : !1,
			aTargets : [0]
		}, {
			mRender : f,
			aTargets : [1]
		}, {
			aTargets : [2],
			fnCreatedCell : function (a, b, c, d, e) {
				return g(e, a, b, c)
			}
		}, {
			aTargets : [3],
			fnCreatedCell : function (a, b, c, d, e) {
				return g(e, a, b, c)
			}
		}, {
			aTargets : [4],
			fnCreatedCell : function (a, b, c, d, e) {
				return g(e, a, b, c)
			}
		}, {
			aTargets : [5],
			fnCreatedCell : function (a, b, c, d, e) {
				return g(e, a, b, c)
			}
		}, {
			aTargets : [6],
			fnCreatedCell : function (a, b, c, d, e) {
				return g(e, a, b, c)
			}
		}, {
			aTargets : [7],
			fnCreatedCell : function (a, b, c, d, e) {
				return g(e, a, b, c)
			}
		}, {
			aTargets : [8],
			fnCreatedCell : function (a, b, c, d, e) {
				return g(e, a, b, c)
			}
		}
	];
	return b.extend({
		"sig/stop" : function (a, b) {
			var c = this;
			c.oTable.fnDestroy(),
			b.resolve()
		},
		"hub:memory/kpi/show" : function (a, b) {
			function c() {
				if ("team" == b.type) {
					if (!v)
						return e.alert("error", "团队列表不存在"), void 0;
					for (var a = !1, c = 0; c < v.length; c += 1)
						v[c].parent_id == b.filter_id && (a = !0);
					a ? n.call(d, b, !0) : n.call(d, b)
				} else
					n.call(d, b)
			}
			var d = this;
			if (d.oTable && !d.oTable.hasClass("invisible"))
				c();
			else
				var f = setInterval(function () {
						d.oTable && !d.oTable.hasClass("invisible") && (c(), clearInterval(f))
					}, 100)
		},
		"hub:memory/context" : function (a, b) {
			this._user = b.user,
			t.call(this)
		},
		"hub/kpi/toggle/column" : function (a, b) {
			var c = this;
			r.call(c, b);
			var d = this.$element.find(".detailCell");
			if (d.length) {
				var e = d.eq(0).closest("tr").prev().children().length;
				d.attr("colspan", e)
			}
		},
		"dom/action.click" : a.noop,
		"dom/action/lookup.click" : function (b, c, d) {
			c.preventDefault();
			var f = this,
			g = a(c.target);
			if (!v)
				return e.alert("error", "团队列表不存在"), void 0;
			for (var h = !1, i = 0; i < v.length; i += 1)
				v[i].parent_id == d && (h = !0);
			B.filter = "team",
			B.filter_id = d,
			h ? this.publish("filter/kpi/update", B, g.html()) : (B.type = "user", this.publish("filter/kpi/update", B, g.html(), !0)),
			n.call(f, B, !0)
		},
		"dom/action/user/open.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			f = d.attr("href");
			e.window({
				url : f,
				name : "User Profile",
				width : "1024"
			})
		},
		"dom/action/details/show.click" : function (b, c, d, e) {
			var f = this,
			g = a(c.target),
			h = g.closest("tr"),
			i = h[0],
			k = {};
			k.type = d,
			k.filter = B.type,
			k.filter_id = e,
			k.start = B.start,
			k.end = B.end;
			var l = j(k);
			f.oTable.fnIsOpen(i) ? (f.oTable.fnClose(i), h.data("detail") !== d ? (s.call(f, l, f.oTable, i), h.data("detail", d), g.closest("td").addClass("selected").siblings().removeClass("selected")) : (h.data("detail", ""), g.closest("td").removeClass("selected"))) : (s.call(f, l, f.oTable, i), h.data("detail", d), g.closest("td").addClass("selected").siblings().removeClass("selected"))
		},
		"dom/action/export/csv.click" : function (a, b) {
			b.preventDefault();
			var c = w + "&output=csv";
			window.open(c)
		}
	})
}), define("troopjs-requirejs/template!app/widget/reporting/kpi/main-reporting/action/main.html", [], function () {
	return function (a) {
		var b = "<colgroup>\n    <col>\n    <col>\n    <col>\n    ";
		this._isAll && (b += "\n    <col>\n    "),
		b += '\n    <col width="500">\n    <col>\n    <col>\n</colgroup>\n\n<thead>\n    <tr>\n        <th>\n            <span data-weave="shared/helper/translation" data-i18n="People"></span>/\n            <span data-weave="shared/helper/translation" data-i18n="Job"></span>\n        </th>\n        <th data-weave="shared/helper/translation" data-i18n="Company"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Title"></th>\n        ',
		this._isAll && (b += '\n        <th data-weave="shared/helper/translation" data-i18n="Category"></th>\n        '),
		b += '\n        <th data-weave="shared/helper/translation" data-i18n="Note"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Date"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Owner"></th>\n    </tr>\n</thead>\n\n<tbody>\n    ';
		for (var c = 0, d = a.length; d > c; c++) {
			b += "\n    ";
			var e = a[c];
			if (b += "\n    <tr>\n        <td>\n            ", "candidate" === e.external_type ? (b += "\n            ", "coldcall" === e.target.type && (b += '\n            <span class="label">Cold Call</span>\n            '), b += "\n            ", b += e.target.islimited ? "\n            ID: " + e.target.id + "\n            " : '\n            <a href="/candidate#detail!id=' + e.target.id + '" target="_blank">' + [e.target.englishName, e.target.chineseName].join(" ").trim() + "</a>\n            ", b += "\n            ") : "joborder" === e.external_type && (b += '\n            <a href="/job#detail!id=' + e.target.id + '" target="_blank">' + e.target.jobTitle + "</a>\n            "), b += "\n        </td>\n        <td>\n            ", "candidate" === e.external_type && e.target.company ? b += '\n            <p class="fixed-width"><a href="/company#detail!id=' + e.target.company.id + '" target="_blank" title="' + e.target.company.name + '">' + e.target.company.name + "</a></p>\n            " : "client" === e.external_type && (b += '\n            <p class="fixed-width"><a href="/company#detail!id=' + e.target.id + '" target="_blank" title="' + e.target.name + '">' + e.target.name + "</a></p>\n            "), b += "\n        </td>\n        <td>\n            ", e.target.title && (b += '\n            <p class="fixed-width">\n            ' + e.target.title + "\n        </p>\n            "), b += "\n        </td>\n        ", this._isAll && (b += "\n        <td>\n            ", e.category && (b += '\n            <span class="label" style="background-color: ' + e.category.color + '">' + e.category.value + "</span>\n            "), b += "\n        </td>\n        "), b += '\n        <td class="note-cell">\n            ', e.items) {
				b += "\n            ";
				for (var f = 0, g = e.items.length; g > f; f++)
					b += "\n            ", e.items[f].field && (b += "\n            <h4>" + e.items[f].field + "</h4>\n            "), b += "\n            <p>\n                " + this.convertText(e.items[f].value) + "\n            </p>\n            ";
				b += "\n            "
			}
			b += "\n        </td>\n        <td>",
			e.date && (b += "" + e.date),
			b += '</td>\n        <td>\n            <a href="/user/preview#' + e.user.id + '" data-action="user/open">' + e.user.englishName + "</a>\n        </td>\n    </tr>\n    "
		}
		return b += "\n</tbody>"
	}
}), define("app/widget/reporting/kpi/main-reporting/action/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "shared/helper/utils", "jquery.datatables"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		b.publish("ajax", {
			url : i.LIST.replace("<ids>", b._ids)
		}, c().done(function (c) {
				b._json = c.list,
				b.html(e, b._json, a)
			}))
	}
	function g(a) {
		var b = this;
		b.oTable = b.$element.dataTable({
				sDom : "t",
				bPaginate : !1,
				bLengthChange : !1,
				aaSorting : []
			}),
		a.resolve()
	}
	var h,
	i = {
		LIST : "/rest/note/list?paginate_by=200&id__s=<ids>"
	};
	return b.extend(function (a, b, c, d) {
		var e = this;
		e._ids = c,
		e._isAll = d !== h ? d : !1
	}, {
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"sig/start" : function (a, b) {
			g.call(this, b)
		},
		"sig/stop" : function (a, b) {
			this.oTable.fnDestroy(),
			b.resolve()
		}
	})
}), define("troopjs-requirejs/template!app/widget/reporting/kpi/main-reporting/email/main.html", [], function () {
	return function (a) {
		for (var b = '<colgroup>\n    <col>\n    <col>\n    <col>\n    <col>\n    <col>\n</colgroup>\n\n<thead>\n    <tr>\n        <th data-weave="shared/helper/translation" data-i18n="Sender"></th>\n        <th data-weave="shared/helper/translation" data-i18n="To"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Subject"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Date"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Attachment"></th>\n    </tr>\n</thead>\n\n<tbody>\n    ', c = 0, d = a.length; d > c; c++) {
			b += "\n    ";
			var e = a[c];
			b += "\n    <tr>\n        <td>" + e._from + "</td>\n        <td>" + e.to + "</td>\n        <td>" + e.subject + "</td>\n        <td>" + (e.dateAdded ? e.dateAdded : "") + "</td>\n        <td>\n             ",
			e.attachment && (b += '\n            <span class="icon-paper-clip"></span>\n            '),
			b += "\n        </td>\n    </tr>\n    "
		}
		return b += "\n</tbody>"
	}
}), define("app/widget/reporting/kpi/main-reporting/email/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		b.publish("ajax", {
			url : f.LIST.replace("<ids>", b._ids)
		}, c().done(function (c) {
				b._json = c.list,
				b.html(d, b._json, a)
			}))
	}
	var f = {
		LIST : "/rest/mail/list?paginate_by=200&id__s=<ids>"
	};
	return b.extend(function (a, b, c) {
		var d = this;
		d._ids = c
	}, {
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		}
	})
}), define("troopjs-requirejs/template!app/widget/reporting/kpi/main-reporting/floating/main.html", [], function () {
	return function (a) {
		for (var b = '<colgroup>\n    <col width="50">\n    <col width="">\n    <col>\n    <col width="">\n    <col width="">\n    <col width="">\n    <col width="">\n    <col width="70">\n</colgroup>\n<thead>\n    <tr>\n        <th>邮件</th>\n        <th data-weave="shared/helper/translation" data-i18n="Candidate"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Contact"></th> \n        <th data-weave="shared/helper/translation" data-i18n="Company"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Note"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Time"></th>\n        <th data-weave="shared/helper/translation" data-i18n="User"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Feedback"></th>\n    </tr>\n</thead>\n<tbody>\n    ', c = 0, d = a.length; d > c; c++) {
			b += "\n    ";
			var e = a[c];
			b += '\n    <tr>\n        <td>\n            <a href="/mail/center#detail!' + e.email + '" target="_blank"><span class="icon-envelope icon-blue"></span></a>\n        </td>\n        <td>\n            <a href="/candidate#detail!id=' + e.candidate.id + '" target="_blank">' + [e.candidate.englishName, e.candidate.chineseName].join(" ").trim() + '</a>\n        </td>\n        <td>\n            <a href="/candidate#detail!id=' + e.clientContact.id + '" target="_blank">' + [e.clientContact.englishName, e.clientContact.chineseName].join(" ").trim() + '</a>\n        </td>\n        <td>\n            <a href="/client#detail!id=' + e.clientContact.company.name + '" target="_blank">' + e.clientContact.company.name + '</a>\n        </td>\n        <td class="note-cell">\n            <p>\n                ' + e.note + "\n            </p>\n        </td>\n        <td>\n            " + e.dateAdded + '\n        </td>\n        <td>\n            <a href="/user/preview#' + e.user.id + '" data-action="user/open">' + e.user.englishName + '</a>\n        </td>\n        <td>\n            <span style="color: ' + e.feedback.color + ';">' + e.feedback.value + "</span>\n        </td>\n    </tr>\n    "
		}
		return b += "\n</tbody>"
	}
}), define("app/widget/reporting/kpi/main-reporting/floating/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "shared/helper/utils", "jquery.datatables"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		b.publish("ajax", {
			url : h.LIST.replace("<ids>", b._ids)
		}, c().done(function (c) {
				b._json = c.list,
				b.html(e, b._json, a)
			}))
	}
	function g(a) {
		var b = this;
		b.oTable = b.$element.dataTable({
				sDom : "t",
				bPaginate : !1,
				bLengthChange : !1,
				aaSorting : [],
				aoColumnDefs : [{
						bSortable : !1,
						aTargets : [0]
					}
				]
			}),
		a.resolve()
	}
	var h = {
		LIST : "/rest/floating/list?paginate_by=200&id__s=<ids>"
	};
	return b.extend(function (a, b, c) {
		var d = this;
		d._ids = c
	}, {
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"sig/start" : function (a, b) {
			g.call(this, b)
		},
		"sig/stop" : function (a, b) {
			this.oTable.fnDestroy(),
			b.resolve()
		}
	})
}), define("troopjs-requirejs/template!app/widget/reporting/kpi/main-reporting/interview/main.html", [], function () {
	return function (a) {
		for (var b = '<colgroup>\n\n</colgroup>\n<thead>\n    <tr>\n        <th data-weave="shared/helper/translation" data-i18n="面试时间"></th>\n        <th data-weave="shared/helper/translation" data-i18n="面试进展"></th> \n        <th data-weave="shared/helper/translation" data-i18n="People"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Job"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Client Company"></th>\n        <th data-weave="shared/helper/translation" data-i18n="User"></th>\n    </tr>\n</thead>\n<tbody>\n    ', c = 0, d = a.length; d > c; c++) {
			b += "\n    ";
			var e = a[c],
			f = e.jobsubmission.candidate,
			g = e.jobsubmission.joborder,
			h = e.user;
			b += "\n    <tr>\n        <td>\n            " + e.date + '\n        </td>\n        <td>\n            <span class="label label-blue" data-weave="shared/helper/translation" data-i18n="' + e.status.replace(":", "") + '"></span>\n        </td>\n        <td>\n            ',
			b += f.islimited ? "\n            ID: " + f.id + "\n            " : '\n            <a href="/candidate#detail!id=' + f.id + '" target="_blank">' + [f.englishName, f.chineseName].join(" ").trim() + "</a>\n            ",
			b += '\n        </td>\n        <td>\n            <a href="/job#detail!id=' + g.id + '" target="_blank">' + g.jobTitle + '</a>\n        </td>\n        <td>\n            <a href="/company#detail!id=' + g.client.id + '" target="_blank">' + g.client.name + '</a>\n        </td>\n        <td>\n            <a href="/user/preview#' + h.id + '" data-action="user/open">' + h.englishName + "</a>\n        </td>\n    </tr>\n    "
		}
		return b += "\n</tbody>"
	}
}), define("app/widget/reporting/kpi/main-reporting/interview/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "shared/helper/utils", "jquery.datatables"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		b.publish("ajax", {
			url : h.LIST.replace("<ids>", b._ids)
		}, c().done(function (c) {
				b._json = c,
				b.html(e, b._json, a)
			}))
	}
	function g(a) {
		var b = this;
		b.oTable = b.$element.dataTable({
				sDom : "t",
				bPaginate : !1,
				bLengthChange : !1,
				aaSorting : []
			}),
		a.resolve()
	}
	var h = {
		LIST : "/rest/joborder/clientinterviewlist?paginate_by=200&id__s=<ids>"
	};
	return b.extend(function (a, b, c) {
		var d = this;
		d._ids = c
	}, {
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"sig/start" : function (a, b) {
			g.call(this, b)
		},
		"sig/stop" : function (a, b) {
			this.oTable.dataTable("destroy"),
			b.resolve()
		}
	})
}), define("troopjs-requirejs/template!app/widget/reporting/kpi/main-reporting/job/main.html", [], function () {
	return function (a) {
		for (var b = '<thead>\n    <tr>\n        <th data-weave="shared/helper/translation" data-i18n="Job"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Function"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Company"></th>\n        <th data-weave="shared/helper/translation" data-i18n="推荐客户"></th>\n        <th data-weave="shared/helper/translation" data-i18n="客户面试人数"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Offer Signed"></th>\n        <th data-weave="shared/helper/translation" data-i18n="进展天数"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Update Date"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Priority"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Main Consultant"></th>\n    </tr>\n</thead>\n\n<tbody>\n    ', c = 0, d = a.length; d > c; c++) {
			b += "\n    ";
			var e = a[c];
			b += '\n    <tr>\n        <td>\n            <a href="/job#detail!id=' + e.id + '" target="_blank">' + e.jobTitle + " （ID: " + e.id + '）</a>\n        </td>\n        <td>\n            <span class="label function">' + e.function .name + '</span>\n        </td>\n        <td>\n            <a href="/company#detail!id=' + e.client.id + '" target="_blank">' + e.client.name + "</a>\n        </td>\n        <td>\n            " + e.cvsent_count + "\n        </td>\n        <td>\n            " + e.clientinterview_count + "\n        </td>\n        <td>\n            " + e.offersign_count + "\n        </td>\n        <td>" + e.livedays + "</td>\n        <td>" + e.lastUpdateDate + "</td>\n        <td>", e.priority && (b += '<span data-weave="shared/helper/translation" data-i18n="' + e.priority + '"></span>'), b += "</td>\n        <td>\n            ";
			for (var f = 0, g = e.users.length; g > f; f++)
				b += "\n            ", "Main Consultant" === e.users[f].type && (b += '\n            <a href="/user/preview#' + e.users[f].user.id + '" data-action="profile/open">' + e.users[f].user.englishName + "</a>\n            "), b += "\n            ";
			b += "\n        </td>\n    </tr>\n    "
	}
	return b += "\n</tbody>"
}
}), define("app/widget/reporting/kpi/main-reporting/job/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "jquery.datatables"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		b.publish("ajax", {
			url : g.LIST.replace("<ids>", b._ids)
		}, c().done(function (c) {
				b._json = c.list,
				b.html(d, b._json, a)
			}))
	}
	function f(a) {
		var b = this;
		b.oTable = b.$element.dataTable({
				sDom : "t",
				bPaginate : !1,
				bLengthChange : !1,
				aoColumns : [null, null, null, null, null, null, null, null, {
						sType : "enum"
					}, null]
			}),
		a.resolve()
	}
	var g = {
		LIST : "/rest/joborder/list?paginate_by=200&id__s=<ids>"
	};
	return a.extend(a.fn.dataTableExt.oSort, {
		"enum-pre" : function (b) {
			var c = a(b).data("i18n");
			switch (c) {
			case "High":
				return 1;
			case "Medium":
				return 2;
			case "Low":
				return 3;
			default:
				return 4
			}
		},
		"enum-asc" : function (a, b) {
			return b > a ? -1 : a > b ? 1 : 0
		},
		"enum-desc" : function (a, b) {
			return b > a ? 1 : a > b ? -1 : 0
		}
	}),
	b.extend(function (a, b, c) {
		var d = this;
		d._ids = c
	}, {
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		},
		"sig/start" : function (a, b) {
			f.call(this, b)
		},
		"sig/stop" : function (a, b) {
			this.oTable.dataTable("destroy"),
			b.resolve()
		}
	})
}), define("troopjs-requirejs/template!app/widget/reporting/kpi/main-reporting/main.html", [], function () {
	return function (a) {
		var b = "",
		c = a.note;
		b += '\n<div class="row-fluid">\n    <div class="span12">\n        <p class="text-right">\n            <button class="btn" data-weave="shared/helper/translation" data-i18n="Export Reporting" data-action="export/csv"></button>    \n            <button data-action="open/column/config" class="btn" data-weave="shared/helper/translation" data-i18n="Columns"></button>\n        </p>\n\n        <table class="table table-striped table-bordered dTableR invisible">\n            <thead>\n                <tr>\n                    <th data-mapping="id">ID</th>\n                    <th data-mapping="name" data-weave="shared/helper/translation" data-i18n="User"></th>\n                    <th data-mapping="keyin candidates" data-weave="shared/helper/translation" data-i18n="Keyin Candidates"></th>\n                    <th data-mapping="owned candidates" data-weave="shared/helper/translation" data-i18n="Owned Candidates"></th>\n                    <th data-mapping="clients" data-weave="shared/helper/translation" data-i18n="Company Added"></th>\n                    <th data-mapping="candidate email sent" data-weave="shared/helper/translation" data-i18n="Send Emails"></th>\n                    <th data-mapping="floating" data-weave="shared/helper/translation" data-i18n="Floating CV"></th>\n                    <th data-mapping="notes" data-weave="shared/helper/translation" data-i18n="Note"></th>\n                    <th data-mapping="attachments" data-weave="shared/helper/translation" data-i18n="Attachment"></th>\n                    <th data-mapping="todos" data-weave="shared/helper/translation" data-i18n="Task"></th>\n                    <th data-mapping="shortlist" data-weave="shared/helper/translation" data-i18n="Shortlist"></th>\n                    <th data-mapping="job new added" data-weave="shared/helper/translation" data-i18n="New Added Jobs"></th>\n                    <th data-mapping="live jobs" data-weave="shared/helper/translation" data-i18n="Living Jobs"></th>\n                    <th data-mapping="updated jobs" data-weave="shared/helper/translation" data-i18n="Updated Jobs"></th>\n                    <th data-mapping="cv sent" data-weave="shared/helper/translation" data-i18n="CVs Sent"></th>\n                    <th data-mapping="client interview" data-weave="shared/helper/translation" data-i18n="Client Interview"></th>\n                    <th data-mapping="offer signed" data-weave="shared/helper/translation" data-i18n="Offer Signed"></th>\n                    <th data-mapping="cv sent by owner" data-weave="shared/helper/translation" data-i18n="[Owner] Sent to client"></th>\n                    <th data-mapping="client interview by owner" data-weave="shared/helper/translation" data-i18n="[Owner] Client interview"></th>\n                    <th data-mapping="offer signed by owner" data-weave="shared/helper/translation" data-i18n="[Owner] Offer signed"></th>\n                    ';
		for (var d = 0, e = c.length; e > d; d++)
			b += '\n                    <th data-mapping="' + c[d].code + '">[<span data-weave="shared/helper/translation" data-i18n="Note"></span>] ' + c[d].value + "</th>\n                    ";
		b += '\n                </tr>\n            </thead>\n            <tbody>\n\n            </tbody>\n            <tfoot>\n                <tr class="sum">\n                    <th></th>\n                    <th data-weave="shared/helper/translation" data-i18n="Summary"></th>\n                    <th data-mapping="keyin candidates"></th>\n                    <th data-mapping="owned candidates"></th>\n                    <th data-mapping="clients"></th>\n                    <th data-mapping="candidate email sent"></th>\n                    <th data-mapping="floating"></th>\n                    <th data-mapping="notes"></th>\n                    <th data-mapping="attachments"></th>\n                    <th data-mapping="todos"></th>\n                    <th data-mapping="shortlist"></th>\n                    <th data-mapping="job new added"></th>\n                    <th data-mapping="live jobs"></th>\n                    <th data-mapping="updated jobs"></th>\n                    <th data-mapping="cv sent"></th>\n                    <th data-mapping="client interview"></th>\n                    <th data-mapping="offer signed"></th>\n                    <th data-mapping="cv sent by owner"></th>\n                    <th data-mapping="client interview by owner"></th>\n                    <th data-mapping="offer signed by owner"></th>\n                    ';
		for (var d = 0, e = c.length; e > d; d++)
			b += '\n                    <th data-mapping="' + c[d].code + '"></th>\n                    ';
		b += '\n                </tr>\n                <tr class="team">\n                    <th></th>\n                    <th data-weave="shared/helper/translation" data-i18n="Team highest" class="highlight"></th>\n                    <th data-mapping="keyin candidates"></th>\n                    <th data-mapping="owned candidates"></th>\n                    <th data-mapping="clients"></th>\n                    <th data-mapping="candidate email sent"></th>\n                    <th data-mapping="floating"></th>\n                    <th data-mapping="notes"></th>\n                    <th data-mapping="attachments"></th>\n                    <th data-mapping="todos"></th>\n                    <th data-mapping="shortlist"></th>\n                    <th data-mapping="job new added"></th>\n                    <th data-mapping="live jobs"></th>\n                    <th data-mapping="updated jobs"></th>\n                    <th data-mapping="cv sent"></th>\n                    <th data-mapping="client interview"></th>\n                    <th data-mapping="offer signed"></th>\n                    <th data-mapping="cv sent by owner"></th>\n                    <th data-mapping="client interview by owner"></th>\n                    <th data-mapping="offer signed by owner"></th>\n                    ';
		for (var d = 0, e = c.length; e > d; d++)
			b += '\n                    <th data-mapping="' + c[d].code + '"></th>\n                    ';
		b += '\n                </tr>\n                <tr class="company">\n                    <th></th>\n                    <th data-weave="shared/helper/translation" data-i18n="Company highest" class="highlight"></th>\n                    <th data-mapping="keyin candidates"></th>\n                    <th data-mapping="owned candidates"></th>\n                    <th data-mapping="clients"></th>\n                    <th data-mapping="candidate email sent"></th>\n                    <th data-mapping="floating"></th>\n                    <th data-mapping="notes"></th>\n                    <th data-mapping="attachments"></th>\n                    <th data-mapping="todos"></th>\n                    <th data-mapping="shortlist"></th>\n                    <th data-mapping="job new added"></th>\n                    <th data-mapping="live jobs"></th>\n                    <th data-mapping="updated jobs"></th>\n                    <th data-mapping="cv sent"></th>\n                    <th data-mapping="client interview"></th>\n                    <th data-mapping="offer signed"></th>\n                    <th data-mapping="cv sent by owner"></th>\n                    <th data-mapping="client interview by owner"></th>\n                    <th data-mapping="offer signed by owner"></th>\n                    ';
		for (var d = 0, e = c.length; e > d; d++)
			b += '\n                    <th data-mapping="' + c[d].code + '"></th>\n                    ';
		b += '\n                </tr>\n                <tr>\n                    <th></th>\n                    <th></th>\n                    <th data-mapping="keyin candidates">\n                        <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="View Chart" data-action="view/chart(\'keyin candidates\')"></button>\n                    </th>\n                    <th data-mapping="owned candidates">\n                        <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="View Chart" data-action="view/chart(\'owned candidates\')"></button>\n                    </th>\n                    <th data-mapping="clients">\n                        <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="View Chart" data-action="view/chart(\'clients\')"></button>\n                    </th>\n                    <th data-mapping="candidate email sent">\n                        <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="View Chart" data-action="view/chart(\'candidate email sent\')"></button>\n                    </th>\n                    <th data-mapping="floating">\n                        <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="View Chart" data-action="view/chart(\'floating\')"></button>\n                    </th>\n                    <th data-mapping="notes">\n                        <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="View Chart" data-action="view/chart(\'note\')"></button>\n                    </th>\n                    <th data-mapping="attachments">\n                        <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="View Chart" data-action="view/chart(\'attachments\')"></button>\n                    </th>\n                    <th data-mapping="todos">\n                        <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="View Chart" data-action="view/chart(\'todos\')"></button>\n                    </th>\n                    <th data-mapping="shortlist">\n                        <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="View Chart" data-action="view/chart(\'shortlist\')"></button>\n                    </th>\n                    <th data-mapping="job new added">\n                        <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="View Chart" data-action="view/chart(\'job new added\')"></button>\n                    </th>\n                    <th data-mapping="live jobs">\n                    </th>\n                    <th data-mapping="updated jobs">\n                        <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="View Chart" data-action="view/chart(\'updated jobs\')"></button>\n                    </th>\n                    <th data-mapping="cv sent">\n                        <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="View Chart" data-action="view/chart(\'cv sent\')"></button>\n                    </th>\n                    <th data-mapping="client interview">\n                        <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="View Chart" data-action="view/chart(\'client interview\')"></button>\n                    </th>\n                    <th data-mapping="offer signed">\n                        <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="View Chart" data-action="view/chart(\'offer signed\')"></button>\n                    </th>\n                    <th data-mapping="cv sent by owner">\n                        <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="View Chart" data-action="view/chart(\'cv sent by owner\')"></button>\n                    </th>\n                    <th data-mapping="client interview by owner">\n                        <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="View Chart" data-action="view/chart(\'client interview by owner\')"></button>\n                    </th>\n                    <th data-mapping="offer signed by owner">\n                        <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="View Chart" data-action="view/chart(\'offer signed by owner\')"></button>\n                    </th>\n                    ';
		for (var d = 0, e = c.length; e > d; d++)
			b += '\n                    <th data-mapping="' + c[d].code + '">\n                        <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="View Chart" data-action="view/chart(\'' + c[d].code + "')\"></button>\n                    </th>\n                    ";
		return b += "\n                </tr>\n            </tfoot>\n        </table>\n    </div>\n</div>"
	}
}), define("app/widget/reporting/kpi/main-reporting/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "jquery.datatables"], function (a, b, c, d, e) {
	function f(a, b, c) {
		var d,
		e = "";
		switch (C.type) {
		case "user":
			"Active" !== c.status && (e = "muted"),
			d = '<a class="' + e + '" data-action="user/open" href="/user/preview#' + c.id + '">' + a + "</a>";
			break;
		case "team":
			d = '<a href="#' + c.id + '" data-action="lookup(' + c.id + ')">' + a + "</a>";
			break;
		default:
			d = a
		}
		return d
	}
	function g(b, c, d, e) {
		var f = D[b].mData;
		d > 0 && a(c).attr("data-action", 'details/show("' + f + '", ' + e.id + ")").addClass("info")
	}
	function h(a) {
		var b = {};
		return a.replace(/([^?=&]+)(=([^&]*))?/g, function (a, c, d, e) {
			b[c] = e
		}),
		b
	}
	function i(a) {
		var b = "/rest/report/kpi?type=<type>",
		c = "&filter=<filter>&<filter>_id=<id>",
		d = "&start=<start>&end=<end>";
		return a.filter && (a.filter_id || 0 === a.filter_id) && (b += c.replace(/<filter>/g, a.filter).replace(/<id>/, a.filter_id)),
		a.start && a.end && (b += d.replace(/<start>/, a.start).replace(/<end>/, a.end)),
		b = b.replace(/<type>/, a.type),
		y = b.substring(b.indexOf("?") + 1),
		b
	}
	function j(a) {
		var b = "/rest/report/kpidetail?type=<type>",
		c = "&filter=<filter>&<filter>_id=<id>",
		d = "&start=<start>&end=<end>";
		return a.filter && (a.filter_id || 0 === a.filter_id) && (b += c.replace(/<filter>/g, a.filter).replace(/<id>/, a.filter_id)),
		a.start && a.end && (b += d.replace(/<start>/, a.start).replace(/<end>/, a.end)),
		encodeURI(b.replace(/<type>/, a.type))
	}
	function k(a) {
		return a.replace("kpi?type=user&", "kpitop?")
	}
	function l(a) {
		for (var b = 0, c = D.length; c > b; b += 1)
			if (D[b].mData == a)
				return b
	}
	function m() {
		var a = this;
		a.publish("ajax", {
			url : z.USERCONFIG
		}, c().done(function (b) {
				var c,
				d,
				f,
				h;
				if (b && b.kpiFields) {
					c = b.kpiFields;
					for (d in c)
						f = l(d), h = {
							bVisible : c[d],
							aTargets : [f],
							fnCreatedCell : function (a, b, c, d, e) {
								return g(e, a, b, c)
							}
						},
					E.push(h)
				} else
					e.alert("error", "No kpiFields in response.");
				a.oTable.dataTable({
					sDom : "if<'table-scrollable't>i",
					bPaginate : !1,
					bAutoWidth : !1,
					aoColumns : D,
					aoColumnDefs : E,
					fnFooterCallback : q,
					fnInfoCallback : function (a, b, c, d, e) {
						return "总共: " + e + "条结果"
					},
					oLanguage : {
						sSearch : "搜索"
					},
					fnInitComplete : function (b) {
						n.call(a),
						b.aoDrawCallback.push({
							fn : function () {
								n.call(a)
							},
							sName : "FixedHeader"
						})
					}
				}).removeClass("invisible")
			}).then(function () {
				a.subscribe("kpi/show", !0, function (b, c) {
					if ("finalized" !== a.phase)
						if ("team" == c.type) {
							if (!w)
								return e.alert("error", "团队列表不存在"), void 0;
							for (var d = !1, f = 0; f < w.length; f += 1)
								w[f].parent_id == c.filter_id && (d = !0);
							d ? o.call(a, c, !0) : o.call(a, c)
						} else
							o.call(a, c)
				})
			}))
	}
	function n() {
		var b = this,
		c = b.$element.find(".table-scrollable"),
		d = c.find("table:eq(1)").length;
		b.oTable.find("thead");
		var e,
		f,
		g = b.oTable.offset().top - 40,
		h = b.oTable.outerWidth();
		d ? (e = c.find("table:eq(1)"), f = c.find(".headerWrapper")) : (e = b.oTable.clone(), f = a('<div class="headerWrapper"></div>'), f.append(e)),
		f.css("width", h),
		e.css("width", h),
		e.html("");
		var i = a("thead", b.oTable).clone(!0);
		e.html(i).removeClass("invisible"),
		a("thead>tr th", b.oTable).each(function (b) {
			a("thead>tr th:eq(" + b + ")", e).width(a(this).width())
		}),
		a("thead>tr td", b.oTable).each(function (b) {
			a("thead>tr td:eq(" + b + ")", e).width(a(this).width())
		}),
		d || (f.css({
				position : "absolute",
				top : 0,
				left : 0,
				zIndex : 1e3
			}), c.append(f));
		var j = a(window);
		j.scroll(function () {
			var a = j.scrollTop(),
			b = a - g;
			b > 0 ? f.css({
				top : b
			}) : f.css({
				top : 0
			})
		})
	}
	function o(b, d) {
		var e = this;
		if (e.oTable) {
			var f = i(b),
			g = k(f);
			a.extend(C, b),
			e.oTable.fnClearTable(),
			d && (f += "&detail=1"),
			"user" == b.type ? e.publish("ajax", {
				url : g
			}, c().done(function (a) {
					a && (A = a.teamtop, B = a.companytop)
				}).then(function () {
					p.call(e, f, e.oTable)
				})) : (A = null, B = null, p.call(e, f, e.oTable))
		}
	}
	function p(a, b) {
		var d = this;
		x = a,
		d.publish("ajax", {
			url : a
		}, c().done(function (a) {
				try {
					b.fnAddData(a.aaData),
					b.fnDraw()
				} catch (c) {
					d.publish("error/log", c.message, c.stack)
				}
			}))
	}
	function q(b, c, d, e, f) {
		if (!c.length)
			return a(b).parents("tfoot").hide(), !1;
		f.length ? a(b).parents("tfoot").show() : a(b).parents("tfoot").hide();
		var g,
		h,
		i,
		j,
		k = {};
		for (g = d; e > g; g += 1) {
			i = c[f[g]];
			for (h in i)
				"id" != h && "name" != h && (void 0 === k[h] && (k[h] = 0), k[h] += i[h])
		}
		a(b).find("th").each(function () {
			j = a(this),
			h = j.attr("data-mapping"),
			j.html(k[h])
		}),
		r(a(b).parents("tfoot").find(".team"), A),
		r(a(b).parents("tfoot").find(".company"), B)
	}
	function r(b, c) {
		var d,
		e;
		c ? (b.show(), b.find("th").each(function () {
				e = a(this),
				d = e.attr("data-mapping"),
				c[d] && c[d].name && e.html('<span class="highlight">' + c[d].value + "</span>" + ' (<a data-action="user/open" href="/user/preview#' + c[d].id + '">' + c[d].name + "</a>)")
			})) : b.hide()
	}
	function s(a) {
		var b = this,
		c = 0,
		d = D.length;
		for (c; d > c && D[c].mData !== a; c++);
		var e = b.oTable.fnSettings().aoColumns[c].bVisible;
		b.oTable.fnSetColumnVis(c, e ? !1 : !0)
	}
	function t(b, d, e) {
		var f = this;
		f.publish("ajax", {
			url : b
		}, c().done(function (c) {
				var f,
				g,
				i = h(b);
				if (c && c.data) {
					if (c.data.length > 200)
						g = a('<p class="text-center text-error">系统仅支持显示200条以内的明细!</p>');
					else
						switch (g = a('<table class="table table-striped table-bordered table-candidate table_vam"></table>').data("ids", c.data), f = decodeURI(i.type)) {
						case "floating":
							g.attr("data-weave", "app/widget/reporting/kpi/main-reporting/floating/main(ids)").weave();
							break;
						case "owned candidates":
						case "keyin candidates":
							g.attr("data-weave", "app/widget/reporting/kpi/main-reporting/people/main(ids)").weave();
							break;
						case "candidate email sent":
							g.attr("data-weave", "app/widget/reporting/kpi/main-reporting/email/main(ids)").weave();
							break;
						case "notes":
							g.attr("data-weave", "app/widget/reporting/kpi/main-reporting/action/main(ids, true)").weave();
							break;
						case "shortlist":
						case "cv sent":
						case "offer signed":
						case "cv sent by owner":
						case "offer signed by owner":
							"offer signed" === f && (f = "offersign"),
							g.attr("data-weave", "app/widget/reporting/kpi/main-reporting/submission/main(ids, " + f + ")").weave();
							break;
						case "job new added":
						case "live jobs":
						case "updated jobs":
							g.attr("data-weave", "app/widget/reporting/kpi/main-reporting/job/main(ids)").weave();
							break;
						case "client interview":
						case "client interview by owner":
							g.attr("data-weave", "app/widget/reporting/kpi/main-reporting/interview/main(ids)").weave();
							break;
						case "attachments":
							g.attr("data-weave", "app/widget/reporting/kpi/attachment-reporting/detail/main(ids)").weave();
							break;
						case "todos":
							g.attr("data-weave", "app/widget/reporting/kpi/task-reporting/detail/main(ids)").weave();
							break;
						case "clients":
							g.attr("data-weave", "app/widget/reporting/kpi/client-reporting/detail/main(ids)").weave();
							break;
						default:
							g.attr("data-weave", "app/widget/reporting/kpi/main-reporting/action/main(ids)").weave()
						}
					d.fnOpen(e, g, "detailCell")
				}
			}))
	}
	function u() {
		var a = this;
		a.publish("ajax", {
			url : z.NOTE_CATEGORY
		}, c().done(function (b) {
				a._json.note = b,
				b.forEach(function (a) {
					D.push({
						mData : a.code
					})
				}),
				c(function (b) {
					a.html(d, a._json, b)
				}).done(function () {
					v.call(a)
				})
			}))
	}
	function v() {
		var a = this;
		a.oTable = a.$element.find("table"),
		a.publish("ajax", {
			url : z.TEAM_LIST
		}, c().done(function (b) {
				w = b,
				m.call(a)
			}))
	}
	var w,
	x,
	y,
	z = {
		TEAM_LIST : "/rest/data/team/list",
		NOTE_CATEGORY : "/rest/data/options?type=candidate_note_category,jobsubmission_note_category",
		USERCONFIG : "/rest/data/userconfig/"
	},
	A = null,
	B = null,
	C = {
		type : "user",
		filter : "",
		filter_id : "",
		start : "",
		end : ""
	},
	D = [{
			mData : "id"
		}, {
			mData : "name"
		}, {
			mData : "keyin candidates"
		}, {
			mData : "owned candidates"
		}, {
			mData : "clients"
		}, {
			mData : "candidate email sent"
		}, {
			mData : "floating"
		}, {
			mData : "notes"
		}, {
			mData : "attachments"
		}, {
			mData : "todos"
		}, {
			mData : "shortlist"
		}, {
			mData : "job new added"
		}, {
			mData : "live jobs"
		}, {
			mData : "updated jobs"
		}, {
			mData : "cv sent"
		}, {
			mData : "client interview"
		}, {
			mData : "offer signed"
		}, {
			mData : "cv sent by owner"
		}, {
			mData : "client interview by owner"
		}, {
			mData : "offer signed by owner"
		}
	],
	E = [{
			bVisible : !1,
			aTargets : [0]
		}, {
			mRender : f,
			aTargets : [1]
		}
	];
	return b.extend({
		"sig/stop" : function (a, b) {
			var c = this;
			c.oTable.fnDestroy(),
			b.resolve()
		},
		"hub:memory/context" : function (a, b) {
			this._user = b.user,
			u.call(this)
		},
		"hub/kpi/toggle/column" : function (a, b) {
			var c = this;
			s.call(c, b);
			var d = this.$element.find(".detailCell");
			if (d.length) {
				var e = d.eq(0).closest("tr").prev().children().length;
				d.attr("colspan", e)
			}
		},
		"dom/action.click" : a.noop,
		"dom/action/lookup.click" : function (b, c, d) {
			c.preventDefault();
			var f = this,
			g = a(c.target);
			if (!w)
				return e.alert("error", "团队列表不存在"), void 0;
			for (var h = !1, i = 0; i < w.length; i += 1)
				w[i].parent_id == d && (h = !0);
			C.filter = "team",
			C.filter_id = d,
			h ? this.publish("filter/kpi/update", C, g.html()) : (C.type = "user", this.publish("filter/kpi/update", C, g.html(), !0)),
			o.call(f, C, !0)
		},
		"dom/action/user/open.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			f = d.attr("href");
			e.window({
				url : f,
				name : "User Profile",
				width : "1024"
			})
		},
		"dom/action/details/show.click" : function (b, c, d, e) {
			var f = this,
			g = a(c.target),
			h = g.closest("tr"),
			i = h[0],
			k = {};
			k.type = d,
			k.filter = C.type,
			k.filter_id = e,
			k.start = C.start,
			k.end = C.end;
			var l = j(k);
			f.oTable.fnIsOpen(i) ? (f.oTable.fnClose(i), h.data("detail") !== d ? (t.call(f, l, f.oTable, i), h.data("detail", d), g.closest("td").addClass("selected").siblings().removeClass("selected")) : (h.data("detail", ""), g.closest("td").removeClass("selected"))) : (t.call(f, l, f.oTable, i), h.data("detail", d), g.closest("td").addClass("selected").siblings().removeClass("selected"))
		},
		"dom/action/open/column/config.click" : function () {
			var a = this;
			a.publish("modal/kpi-column-config/show")
		},
		"dom/action/view/chart.click" : function (a, b, c) {
			var d = "",
			e = y;
			d = "/kpi/chart#" + e + "&time_slice=week&chart=multiBarChart&kpi_type=" + c,
			window.open(d.replace(/&/g, "/"), "_blank")
		},
		"dom/action/export/csv.click" : function (a, b) {
			b.preventDefault();
			var c = x + "&output=csv";
			window.open(c)
		}
	})
}), define("troopjs-requirejs/template!app/widget/reporting/kpi/main-reporting/people/main.html", [], function () {
	return function (a) {
		for (var b = '<colgroup>\n    <col>\n    <col>\n    <col>\n    <col>\n    <col>\n    <col>\n</colgroup>\n\n<thead>\n    <tr>\n        <th data-weave="shared/helper/translation" data-i18n="People"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Company"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Title"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Date"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Keyin"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Owner"></th>\n    </tr>\n</thead>\n\n<tbody>\n    ', c = 0, d = a.length; d > c; c++) {
			b += "\n    ";
			var e = a[c];
			b += "\n    <tr>\n        <td>\n            ",
			b += e.islimited ? "\n            ID: " + e.id + "\n            " : '\n            <a href="/candidate#detail!id=' + e.id + '" target="_blank">' + [e.englishName, e.chineseName].join(" ") + "</a>\n            ",
			b += "\n        </td>\n        <td>\n            ",
			e.company && (b += '\n            <a href="/company#detail!id=' + e.company.id + '" target="_blank">' + e.company.name + "</a>\n            "),
			b += "\n        </td>\n        <td>\n            ",
			e.title && (b += "\n            " + e.title + "\n            "),
			b += "\n        </td>\n        <td>" + e.dateAdded + '</td>\n        <td>\n            <a href="/user/preview#' + e.addedBy.id + '" data-action="user/open">' + e.addedBy.englishName + '</a>\n        </td>\n        <td>\n            <a href="/user/preview#' + e.owner.id + '" data-action="user/open">' + e.owner.englishName + "</a>\n        </td>\n    </tr>\n    "
		}
		return b += "\n</tbody>"
	}
}), define("app/widget/reporting/kpi/main-reporting/people/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "jquery.datatables"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		b.publish("ajax", {
			url : g.LIST.replace("<ids>", b._ids)
		}, c().done(function (c) {
				b._json = c.list,
				b.html(d, b._json, a)
			}))
	}
	function f(a) {
		var b = this;
		b.oTable = b.$element.dataTable({
				sDom : "t",
				bPaginate : !1,
				bLengthChange : !1,
				aaSorting : []
			}),
		a.resolve()
	}
	var g = {
		LIST : "/rest/candidate/list?paginate_by=200&id__s=<ids>"
	};
	return b.extend(function (a, b, c) {
		var d = this;
		d._ids = c
	}, {
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		},
		"sig/start" : function (a, b) {
			f.call(this, b)
		},
		"sig/stop" : function (a, b) {
			this.oTable.fnDestroy(),
			b.resolve()
		}
	})
}), define("troopjs-requirejs/template!app/widget/reporting/kpi/main-reporting/shortlist/main.html", [], function () {
	return function (a) {
		for (var b = '<colgroup>\n    <col>\n    <col>\n    <col>\n    <col>\n    <col>\n    <col>\n</colgroup>\n\n<thead>\n    <tr>\n        <th data-weave="shared/helper/translation" data-i18n="People"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Company"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Title"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Date"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Keyin"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Owner"></th>\n    </tr>\n</thead>\n\n<tbody>\n    ', c = 0, d = a.length; d > c; c++) {
			b += "\n    ";
			var e = a[c];
			b += "\n    <tr>\n        <td>\n            ",
			b += e.islimited ? "\n            ID: " + e.id + "\n            " : '\n            <a href="/candidate#detail!id=' + e.id + '" target="_blank">' + [e.englishName, e.chineseName].join(" ") + "</a>\n            ",
			b += '\n        </td>\n        <td>\n            <a href="/company#detail!id=' + e.company.id + '" target="_blank">' + e.company.name + "</a>\n        </td>\n        <td>" + e.title + "</td>\n        <td>" + e.dateAdded + '</td>\n        <td>\n            <a href="/user/preview#' + e.addedBy.id + '" data-action="user/open">' + e.addedBy.englishName + '</a>\n        </td>\n        <td>\n            <a href="/user/preview#' + e.owner.id + '" data-action="user/open">' + e.owner.englishName + "</a>\n        </td>\n    </tr>\n    "
		}
		return b += "\n</tbody>"
	}
}), define("app/widget/reporting/kpi/main-reporting/shortlist/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "jquery.datatables"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		b.publish("ajax", {
			url : g.LIST.replace("<ids>", b._ids)
		}, c().done(function (c) {
				b._json = c.list,
				b.html(d, b._json, a)
			}))
	}
	function f(a) {
		var b = this;
		b.oTable = b.$element.dataTable({
				sDom : "t",
				bPaginate : !1,
				bLengthChange : !1,
				aaSorting : []
			}),
		a.resolve()
	}
	var g = {
		LIST : "/rest/candidate/list?paginate_by=200&id__s=<ids>"
	};
	return b.extend(function (a, b, c) {
		var d = this;
		d._ids = c
	}, {
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		},
		"sig/start" : function (a, b) {
			f.call(this, b)
		},
		"sig/stop" : function (a, b) {
			this.oTable.fnDestroy(),
			b.resolve()
		}
	})
}), define("troopjs-requirejs/template!app/widget/reporting/kpi/main-reporting/submission/main.html", [], function () {
	return function (a) {
		var b = "",
		c = this.type;
		b += '\n<colgroup>\n    <col>\n    <col>\n    <col>\n    <col>\n    <col>\n    <col>\n</colgroup>\n\n<thead>\n    <tr>\n        <th data-weave="shared/helper/translation" data-i18n="Attachment"></th>\n        <th data-weave="shared/helper/translation" data-i18n="People"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Job"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Client"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Owner"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Operator"></th>\n    </tr>\n</thead>\n\n<tbody>\n    ';
		for (var d = 0, e = a.length; e > d; d++) {
			b += "\n    ";
			var f = a[d];
			b += "\n    <tr>\n        <td>\n            " + f.candidate.attachment_count + "\n        </td>\n        <td>\n            ",
			b += f.candidate.islimited ? "\n            ID: " + f.candidate.id + "\n            " : '\n            <a href="/candidate#detail!id=' + f.candidate.id + '" target="_blank">' + [f.candidate.englishName, f.candidate.chineseName].join(" ") + "</a>\n            ",
			b += '\n        </td>\n        <td>\n            <a href="/job#detail!id=' + f.joborder.id + '" target="_blank">' + f.joborder.jobTitle + '</a>\n        </td>\n        <td>\n            <a href="/company#detail!id=' + f.joborder.client.id + '" target="_blank">' + f.joborder.client.name + '</a>\n        </td>\n        <td>\n            <a href="/user/preview#' + f.candidate.owner.id + '" data-action="user/open">' + f.candidate.owner.englishName + "</a>\n        </td>\n        <td>\n            ";
			var g = f.detail.filter(function (a) {
					return a.type.toLowerCase().indexOf(c) > -1
				});
			g && g.length && (b += '\n            <a href="/user/preview#' + g[0].user.id + '" data-action="user/open">' + g[g.length - 1].user.englishName + "</a>\n            "),
			b += "\n        </td>\n    </tr>\n    "
		}
		return b += "\n</tbody>"
	}
}), define("app/widget/reporting/kpi/main-reporting/submission/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "jquery.datatables"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		b.publish("ajax", {
			url : g.LIST.replace("<ids>", b._ids)
		}, c().done(function (c) {
				b._json = c,
				b.html(d, b._json, a)
			}))
	}
	function f(a) {
		var b = this;
		b.oTable = b.$element.dataTable({
				sDom : "t",
				bPaginate : !1,
				bLengthChange : !1,
				aaSorting : []
			}),
		a.resolve()
	}
	var g = {
		LIST : "/rest/joborder/shortlist?paginate_by=200&id__s=<ids>"
	};
	return b.extend(function (a, b, c, d) {
		var e = this;
		e._ids = c,
		this.type = d.replace(" by owner", "").replace(" ", "")
	}, {
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		},
		"sig/start" : function (a, b) {
			f.call(this, b)
		},
		"sig/stop" : function (a, b) {
			this.oTable.dataTable("destroy"),
			b.resolve()
		}
	})
}), define("app/widget/reporting/kpi/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "shared/helper/utils"], function (a, b) {
	return b.extend({
		"hub:memory/route" : function (b, c) {
			var d = this,
			e = a("<div></div>");
			d.$element.empty(),
			"finalized" !== d.phase && (c.query && "main" === c.query.type ? (d.$element.append(e), e.attr("data-weave", "app/widget/reporting/kpi/main-reporting/main").weave()) : c.query && "attachment" === c.query.type ? (d.$element.append(e), e.attr("data-weave", "app/widget/reporting/kpi/attachment-reporting/main").weave()) : c.query && "note" === c.query.type ? (d.$element.append(e), e.attr("data-weave", "app/widget/reporting/kpi/note-reporting/main").weave()) : c.query && "job" === c.query.type ? (d.$element.append(e), e.attr("data-weave", "app/widget/reporting/kpi/job-reporting/main").weave()) : c.query && "task" === c.query.type ? (d.$element.append(e), e.attr("data-weave", "app/widget/reporting/kpi/task-reporting/main").weave()) : c.query && "company" === c.query.type ? (d.$element.append(e), e.attr("data-weave", "app/widget/reporting/kpi/client-reporting/main").weave()) : window.location.hash = "?type=main")
		}
	})
}), define("troopjs-requirejs/template!app/widget/reporting/kpi/note-reporting/main.html", [], function () {
	return function (a) {
		var b = "",
		c = a.notes;
		b += '\n<div class="row-fluid">\n    <div class="span12">\n        <p class="text-right">\n            <button class="btn" data-weave="shared/helper/translation" data-i18n="Export Reporting" data-action="export/csv"></button>    \n        </p>\n\n        <table class="table table-striped table-bordered dTableR invisible">\n            <thead>\n                <tr>\n                    <th data-mapping="id">ID</th>\n                    <th data-mapping="name" data-weave="shared/helper/translation" data-i18n="User"></th>\n                    <th data-mapping="notes" data-weave="shared/helper/translation" data-i18n="All Notes"></th>\n                    ';
		for (var d = 0, e = c.length; e > d; d++)
			b += '\n                    <th data-mapping="' + c[d].code + '">' + c[d].value + "</th>\n                    ";
		b += '\n                </tr>\n            </thead>\n            <tbody>\n\n            </tbody>\n            <tfoot>\n                <tr class="sum">\n                    <th></th>\n                    <th data-weave="shared/helper/translation" data-i18n="Summary"></th>\n                    <th data-mapping="notes"></th>\n                    ';
		for (var d = 0, e = c.length; e > d; d++)
			b += '\n                    <th data-mapping="' + c[d].code + '"></th>\n                    ';
		b += '\n                </tr>\n                <tr class="team">\n                    <th></th>\n                    <th data-weave="shared/helper/translation" data-i18n="Team highest" class="highlight"></th>\n                    <th data-mapping="notes"></th>\n                    ';
		for (var d = 0, e = c.length; e > d; d++)
			b += '\n                    <th data-mapping="' + c[d].code + '"></th>\n                    ';
		b += '\n                </tr>\n                <tr class="company">\n                    <th></th>\n                    <th data-weave="shared/helper/translation" data-i18n="Company highest" class="highlight"></th>\n                    <th data-mapping="notes"></th>\n                    ';
		for (var d = 0, e = c.length; e > d; d++)
			b += '\n                    <th data-mapping="' + c[d].code + '"></th>\n                    ';
		return b += "\n                </tr>\n            </tfoot>\n        </table>\n    </div>\n</div>"
	}
}), define("app/widget/reporting/kpi/note-reporting/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "jquery.datatables"], function (a, b, c, d, e) {
	function f(a, b, c) {
		var d,
		e = "";
		switch (B.type) {
		case "user":
			"Active" !== c.status && (e = "muted"),
			d = '<a class="' + e + '" data-action="user/open" href="/user/preview#' + c.id + '">' + a + "</a>";
			break;
		case "team":
			d = '<a href="#' + c.id + '" data-action="lookup(' + c.id + ')">' + a + "</a>";
			break;
		default:
			d = a
		}
		return d
	}
	function g(b, c, d, e) {
		var f = this,
		g = f.COLUMNS[b].mData;
		d > 0 && a(c).attr("data-action", 'details/show("' + g + '", ' + e.id + ")").addClass("info")
	}
	function h(a) {
		var b = {};
		return a.replace(/([^?=&]+)(=([^&]*))?/g, function (a, c, d, e) {
			b[c] = e
		}),
		b
	}
	function i(a) {
		var b = y.REPORT + "&type=<type>",
		c = "&filter=<filter>&<filter>_id=<id>",
		d = "&start=<start>&end=<end>";
		return a.filter && (a.filter_id || 0 === a.filter_id) && (b += c.replace(/<filter>/g, a.filter).replace(/<id>/, a.filter_id)),
		a.start && a.end && (b += d.replace(/<start>/, a.start).replace(/<end>/, a.end)),
		b = b.replace(/<type>/, a.type),
		x = b.substring(b.indexOf("?") + 1),
		b
	}
	function j(a) {
		var b = "/rest/report/kpidetail?kpi_type=note&type=<type>",
		c = "&filter=<filter>&<filter>_id=<id>",
		d = "&start=<start>&end=<end>";
		return a.filter && (a.filter_id || 0 === a.filter_id) && (b += c.replace(/<filter>/g, a.filter).replace(/<id>/, a.filter_id)),
		a.start && a.end && (b += d.replace(/<start>/, a.start).replace(/<end>/, a.end)),
		encodeURI(b.replace(/<type>/, a.type))
	}
	function k(a) {
		return a.replace("kpi?", "kpitop?")
	}
	function l() {
		var a,
		b = this,
		c = 2;
		b._json.notes.forEach(function () {
			a = {
				aTargets : [c],
				fnCreatedCell : function (a, c, d, e, f) {
					return g.call(b, f, a, c, d)
				}
			},
			b.aoColumnDefs.push(a),
			c++
		}),
		b.oTable.dataTable({
			sDom : "if<'table-scrollable't>i",
			bPaginate : !1,
			bAutoWidth : !1,
			aoColumns : b.COLUMNS,
			aoColumnDefs : b.aoColumnDefs,
			fnFooterCallback : p,
			fnInfoCallback : function (a, b, c, d, e) {
				return "总共: " + e + "条结果"
			},
			oLanguage : {
				sSearch : "搜索"
			},
			fnInitComplete : function (a) {
				m.call(b),
				a.aoDrawCallback.push({
					fn : function () {
						m.call(b)
					},
					sName : "FixedHeader"
				})
			}
		}).removeClass("invisible")
	}
	function m() {
		var b = this,
		c = b.$element.find(".table-scrollable"),
		d = c.find("table:eq(1)").length;
		b.oTable.find("thead");
		var e,
		f,
		g = b.oTable.offset().top - 40,
		h = b.oTable.outerWidth();
		d ? (e = c.find("table:eq(1)"), f = c.find(".headerWrapper")) : (e = b.oTable.clone(), f = a('<div class="headerWrapper"></div>'), f.append(e)),
		f.css("width", h),
		e.css("width", h),
		e.html("");
		var i = a("thead", b.oTable).clone(!0);
		e.html(i).removeClass("invisible"),
		a("thead>tr th", b.oTable).each(function (b) {
			a("thead>tr th:eq(" + b + ")", e).width(a(this).width())
		}),
		a("thead>tr td", b.oTable).each(function (b) {
			a("thead>tr td:eq(" + b + ")", e).width(a(this).width())
		}),
		d || (f.css({
				position : "absolute",
				top : 0,
				left : 0,
				zIndex : 1e3
			}), c.append(f));
		var j = a(window);
		j.scroll(function () {
			var a = j.scrollTop(),
			b = a - g;
			b > 0 ? f.css({
				top : b
			}) : f.css({
				top : 0
			})
		})
	}
	function n(b, d) {
		var e = this;
		if (e.oTable) {
			var f = i(b),
			g = k(f);
			a.extend(B, b),
			e.oTable.fnClearTable(),
			d && (f += "&detail=1"),
			"user" == b.type ? e.publish("ajax", {
				url : g
			}, c().done(function (a) {
					a && (z = a.teamtop, A = a.companytop)
				}).then(function () {
					o.call(e, f, e.oTable)
				})) : (z = null, A = null, o.call(e, f, e.oTable))
		}
	}
	function o(a, b) {
		var d = this;
		w = a,
		d.publish("ajax", {
			url : a
		}, c().done(function (a) {
				try {
					b.fnAddData(a.aaData),
					b.fnDraw()
				} catch (c) {
					d.publish("error/log", c.message, c.stack)
				}
			}))
	}
	function p(b, c, d, e, f) {
		if (!c.length)
			return a(b).parents("tfoot").hide(), !1;
		f.length ? a(b).parents("tfoot").show() : a(b).parents("tfoot").hide();
		var g,
		h,
		i,
		j,
		k = {};
		for (g = d; e > g; g += 1) {
			i = c[f[g]];
			for (h in i)
				"id" != h && "name" != h && (void 0 === k[h] && (k[h] = 0), k[h] += i[h])
		}
		a(b).find("th").each(function () {
			j = a(this),
			h = j.data("mapping"),
			j.html(k[h])
		}),
		q(a(b).parents("tfoot").find(".team"), z),
		q(a(b).parents("tfoot").find(".company"), A)
	}
	function q(b, c) {
		var d,
		e;
		c ? (b.show(), b.find("th").each(function () {
				e = a(this),
				d = e.data("mapping"),
				c[d] && c[d].name && e.html('<span class="highlight">' + c[d].value + "</span>" + ' (<a data-action="user/open" href="/user/preview#' + c[d].id + '">' + c[d].name + "</a>)")
			})) : b.hide()
	}
	function r(a) {
		var b = this,
		c = b.oTable.fnSettings().aoColumns[a].bVisible;
		b.oTable.fnSetColumnVis(a, c ? !1 : !0)
	}
	function s(b, d, e) {
		var f = this;
		f.publish("ajax", {
			url : b
		}, c().done(function (c) {
				var f,
				g,
				i = h(b);
				c && c.data && (c.data.length > 200 ? g = a('<p class="text-center text-error">系统仅支持显示200条以内的明细!</p>') : (g = a('<table class="table table-striped table-bordered table-candidate table_vam"></table>').data("ids", c.data), f = decodeURI(i.type), g.attr("data-weave", "app/widget/reporting/kpi/main-reporting/action/main(ids)").weave()), d.fnOpen(e, g, "detailCell"))
			}))
	}
	function t() {
		var a = this;
		a.publish("ajax", {
			url : y.NOTE_CATEGORY
		}, c().done(function (b) {
				a._json.notes = b,
				b.forEach(function (b) {
					a.COLUMNS.push({
						mData : b.code
					})
				}),
				c(function (b) {
					a.html(d, a._json, b)
				}).done(function () {
					u.call(a)
				})
			}))
	}
	function u() {
		var a = this;
		a.oTable = a.$element.find("table"),
		a.publish("ajax", {
			url : y.TEAM_LIST
		}, c().done(function (b) {
				v = b,
				l.call(a)
			}))
	}
	var v,
	w,
	x,
	y = {
		TEAM_LIST : "/rest/data/team/list",
		NOTE_CATEGORY : "/rest/data/options?type=candidate_note_category,jobsubmission_note_category",
		REPORT : "/rest/report/kpi?kpi_type=note"
	},
	z = null,
	A = null,
	B = {
		type : "user",
		filter : "",
		filter_id : "",
		start : "",
		end : ""
	};
	return b.extend(function () {
		this.COLUMNS = [{
				mData : "id"
			}, {
				mData : "name"
			}, {
				mData : "notes"
			}
		],
		this.aoColumnDefs = [{
				bVisible : !1,
				aTargets : [0]
			}, {
				mRender : f,
				aTargets : [1]
			}
		]
	}, {
		"sig/stop" : function (a, b) {
			var c = this;
			c.oTable.fnDestroy(),
			b.resolve()
		},
		"hub:memory/kpi/show" : function (a, b) {
			function c() {
				if ("team" == b.type) {
					if (!v)
						return e.alert("error", "团队列表不存在"), void 0;
					for (var a = !1, c = 0; c < v.length; c += 1)
						v[c].parent_id == b.filter_id && (a = !0);
					a ? n.call(d, b, !0) : n.call(d, b)
				} else
					n.call(d, b)
			}
			var d = this;
			if (d.oTable && !d.oTable.hasClass("invisible"))
				c();
			else
				var f = setInterval(function () {
						d.oTable && !d.oTable.hasClass("invisible") && (c(), clearInterval(f))
					}, 100)
		},
		"hub:memory/context" : function (a, b) {
			this._user = b.user,
			t.call(this)
		},
		"hub/kpi/toggle/column" : function (a, b) {
			var c = this;
			r.call(c, b);
			var d = this.$element.find(".detailCell");
			if (d.length) {
				var e = d.eq(0).closest("tr").prev().children().length;
				d.attr("colspan", e)
			}
		},
		"dom/action.click" : a.noop,
		"dom/action/lookup.click" : function (b, c, d) {
			c.preventDefault();
			var f = this,
			g = a(c.target);
			if (!v)
				return e.alert("error", "团队列表不存在"), void 0;
			for (var h = !1, i = 0; i < v.length; i += 1)
				v[i].parent_id == d && (h = !0);
			B.filter = "team",
			B.filter_id = d,
			h ? this.publish("filter/kpi/update", B, g.html()) : (B.type = "user", this.publish("filter/kpi/update", B, g.html(), !0)),
			n.call(f, B, !0)
		},
		"dom/action/user/open.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			f = d.attr("href");
			e.window({
				url : f,
				name : "User Profile",
				width : "1024"
			})
		},
		"dom/action/details/show.click" : function (b, c, d, e) {
			var f = this,
			g = a(c.target),
			h = g.closest("tr"),
			i = h[0],
			k = {};
			k.type = d,
			k.filter = B.type,
			k.filter_id = e,
			k.start = B.start,
			k.end = B.end;
			var l = j(k);
			f.oTable.fnIsOpen(i) ? (f.oTable.fnClose(i), h.data("detail") !== d ? (s.call(f, l, f.oTable, i), h.data("detail", d), g.closest("td").addClass("selected").siblings().removeClass("selected")) : (h.data("detail", ""), g.closest("td").removeClass("selected"))) : (s.call(f, l, f.oTable, i), h.data("detail", d), g.closest("td").addClass("selected").siblings().removeClass("selected"))
		},
		"dom/action/export/csv.click" : function (a, b) {
			b.preventDefault();
			var c = w + "&output=csv";
			window.open(c)
		}
	})
}), define("troopjs-requirejs/template!app/widget/reporting/kpi/task-reporting/detail/main.html", [], function () {
	return function (a) {
		var b,
		c = "";
		c += '\n<colgroup>\n    <col width="">\n    <col width="">\n    <col width="">\n    <col width="">\n    <col width="">\n    <col width="">\n</colgroup>\n<thead>\n    <tr>\n        <th><span data-weave="shared/helper/translation" data-i18n="任务类型"></span></th>\n        <th data-weave="shared/helper/translation" data-i18n="任务对象"></th>\n        <th data-weave="shared/helper/translation" data-i18n="任务备注"></th>\n        <th data-weave="shared/helper/translation" data-i18n="任务时间"></th>\n        <th data-weave="shared/helper/translation" data-i18n="创建时间"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Participant"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Creator"></th>\n    </tr>\n</thead>\n<tbody>\n    ';
		for (var d = 0, e = a.length; e > d; d++) {
			c += "\n    ";
			var f = a[d];
			c += '\n    <tr>\n        <td>\n            <span class="label" style="background-color: ' + f.category.color + ';">' + f.category.value + "</span>\n        </td>\n        <td>\n            ",
			"joborder" === f.external_type ? c += '\n                <a href="/job#detail!id=' + f.target.id + '" target="_blank">' + f.target.name + "</a>\n            " : "client" === f.external_type ? c += '\n                <a href="/company#detail!id=' + f.target.id + '" target="_blank">' + f.target.name + "</a>\n            " : f.target && f.target.candidate ? (c += "\n                ", b = f.target.candidate, c += "\n\n                ", b.islimited ? c += "\n                ID: " + b.id + "\n                " : (c += '\n                <a href="/candidate#detail!id=' + b.id + '" target="_blank">' + [b.englishName, b.chineseName].join(" ").trim() + "</a>\n                ", "coldcall" === b.type && (c += '\n                <span class="label">Cold Call</span>\n                '), c += "\n                "), c += "\n\n            ") : f.target && (c += "\n                ", c += f.target.islimited ? "\n                ID: " + f.target.id + "\n                " : '\n                <a href="/candidate#detail!id=' + f.target.id + '" target="_blank">' + f.target.name + "</a>\n                ", c += "\n            "),
			c += "\n        </td>\n        <td>\n            ",
			f.target && f.target.joborder ? c += '\n            <a href="job#detail!id=' + f.target.joborder.id + '" target="_blank">' + f.target.joborder.jobTitle + " (ID: " + f.target.joborder.id + ")</a>\n            " : (c += "\n                ", b ? b && !b.islimited && (c += "\n                " + (f.content || "") + "\n                ") : c += "\n                " + (f.content || "") + "\n                ", c += "\n            "),
			c += "\n        </td>\n        <td>\n            ",
			c += f.allday ? "\n            " + this.getDate(f.date) + "\n            " : "\n            " + f.date + "\n            ",
			c += "\n        </td>\n        <td>\n            " + f.dateAdded + "\n        </td>\n        <td>\n            ";
			for (var g = 0, h = f.users.length; h > g; g++) {
				c += "\n            ";
				var i = f.users[g];
				c += '\n            <div><a href="/user/preview#' + i.id + '" data-action="open/profile">' + i.englishName + "</a></div>\n            "
			}
			c += '\n        </td>\n        <td>\n            <a href="/user/preview#' + f.addedBy.id + '" data-action="open/profile">' + f.addedBy.englishName + "</a>\n        </td>\n    </tr>\n    "
		}
		return c += "\n</tbody>"
	}
}), define("app/widget/reporting/kpi/task-reporting/detail/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "shared/helper/utils", "jquery.datatables"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		b.publish("ajax", {
			url : h.LIST.replace("<ids>", b._ids)
		}, c().done(function (c) {
				b._json = c.list,
				b.html(e, b._json, a)
			}))
	}
	function g(a) {
		var b = this;
		b.oTable = b.$element.dataTable({
				sDom : "t",
				bPaginate : !1,
				bLengthChange : !1,
				aaSorting : []
			}),
		a.resolve()
	}
	var h = {
		LIST : "/rest/todo/list?paginate_by=200&id__s=<ids>"
	};
	return b.extend(function (a, b, c) {
		var d = this;
		d._ids = c
	}, {
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"sig/start" : function (a, b) {
			g.call(this, b)
		},
		"sig/stop" : function (a, b) {
			this.oTable.fnDestroy(),
			b.resolve()
		},
		getDate : function (a) {
			var b = new Date(a.split(" ")[0]);
			return b.getFullYear() + "-" + (parseInt(b.getMonth(), 10) + 1) + "-" + b.getDate()
		}
	})
}), define("troopjs-requirejs/template!app/widget/reporting/kpi/task-reporting/main.html", [], function () {
	return function (a) {
		var b = "",
		c = a.tasks;
		b += '\n<div class="row-fluid">\n    <div class="span12">\n        <p class="text-right">\n            <button class="btn" data-weave="shared/helper/translation" data-i18n="Export Reporting" data-action="export/csv"></button>    \n        </p>\n\n        <table class="table table-striped table-bordered dTableR invisible">\n            <thead>\n                <tr>\n                    <th data-mapping="id">ID</th>\n                    <th data-mapping="name" data-weave="shared/helper/translation" data-i18n="User"></th>\n                    <th data-mapping="todos" data-weave="shared/helper/translation" data-i18n="All Tasks"></th>\n                    ';
		for (var d = 0, e = c.length; e > d; d++)
			b += '\n                    <th data-mapping="' + c[d].code + '">' + c[d].value + "</th>\n                    ";
		b += '\n                </tr>\n            </thead>\n            <tbody>\n\n            </tbody>\n            <tfoot>\n                <tr class="sum">\n                    <th></th>\n                    <th data-weave="shared/helper/translation" data-i18n="Summary"></th>\n                    <th data-mapping="todos"></th>\n                    ';
		for (var d = 0, e = c.length; e > d; d++)
			b += '\n                    <th data-mapping="' + c[d].code + '"></th>\n                    ';
		b += '\n                </tr>\n                <tr class="team">\n                    <th></th>\n                    <th data-weave="shared/helper/translation" data-i18n="Team highest" class="highlight"></th>\n                    <th data-mapping="todos"></th>\n                    ';
		for (var d = 0, e = c.length; e > d; d++)
			b += '\n                    <th data-mapping="' + c[d].code + '"></th>\n                    ';
		b += '\n                </tr>\n                <tr class="company">\n                    <th></th>\n                    <th data-weave="shared/helper/translation" data-i18n="Company highest" class="highlight"></th>\n                    <th data-mapping="todos"></th>\n                    ';
		for (var d = 0, e = c.length; e > d; d++)
			b += '\n                    <th data-mapping="' + c[d].code + '"></th>\n                    ';
		return b += "\n                </tr>\n            </tfoot>\n        </table>\n    </div>\n</div>"
	}
}), define("app/widget/reporting/kpi/task-reporting/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "jquery.datatables"], function (a, b, c, d, e) {
	function f(a, b, c) {
		var d,
		e = "";
		switch (B.type) {
		case "user":
			"Active" !== c.status && (e = "muted"),
			d = '<a class="' + e + '" data-action="user/open" href="/user/preview#' + c.id + '">' + a + "</a>";
			break;
		case "team":
			d = '<a href="#' + c.id + '" data-action="lookup(' + c.id + ')">' + a + "</a>";
			break;
		default:
			d = a
		}
		return d
	}
	function g(b, c, d, e) {
		var f = this,
		g = f.COLUMNS[b].mData;
		d > 0 && a(c).attr("data-action", 'details/show("' + g + '", ' + e.id + ")").addClass("info")
	}
	function h(a) {
		var b = {};
		return a.replace(/([^?=&]+)(=([^&]*))?/g, function (a, c, d, e) {
			b[c] = e
		}),
		b
	}
	function i(a) {
		var b = y.REPORT + "&type=<type>",
		c = "&filter=<filter>&<filter>_id=<id>",
		d = "&start=<start>&end=<end>";
		return a.filter && (a.filter_id || 0 === a.filter_id) && (b += c.replace(/<filter>/g, a.filter).replace(/<id>/, a.filter_id)),
		a.start && a.end && (b += d.replace(/<start>/, a.start).replace(/<end>/, a.end)),
		b = b.replace(/<type>/, a.type),
		x = b.substring(b.indexOf("?") + 1),
		b
	}
	function j(a) {
		var b = "/rest/report/kpidetail?kpi_type=todo&type=<type>",
		c = "&filter=<filter>&<filter>_id=<id>",
		d = "&start=<start>&end=<end>";
		return a.filter && (a.filter_id || 0 === a.filter_id) && (b += c.replace(/<filter>/g, a.filter).replace(/<id>/, a.filter_id)),
		a.start && a.end && (b += d.replace(/<start>/, a.start).replace(/<end>/, a.end)),
		encodeURI(b.replace(/<type>/, a.type))
	}
	function k(a) {
		return a.replace("kpi?", "kpitop?")
	}
	function l() {
		var a,
		b = this,
		c = 2;
		b._json.tasks.forEach(function () {
			a = {
				aTargets : [c],
				fnCreatedCell : function (a, c, d, e, f) {
					return g.call(b, f, a, c, d)
				}
			},
			b.aoColumnDefs.push(a),
			c++
		}),
		b.oTable.dataTable({
			sDom : "if<'table-scrollable't>i",
			bPaginate : !1,
			bAutoWidth : !1,
			aoColumns : b.COLUMNS,
			aoColumnDefs : b.aoColumnDefs,
			fnFooterCallback : p,
			fnInfoCallback : function (a, b, c, d, e) {
				return "总共: " + e + "条结果"
			},
			oLanguage : {
				sSearch : "搜索"
			},
			fnInitComplete : function (a) {
				m.call(b),
				a.aoDrawCallback.push({
					fn : function () {
						m.call(b)
					},
					sName : "FixedHeader"
				})
			}
		}).removeClass("invisible")
	}
	function m() {
		var b = this,
		c = b.$element.find(".table-scrollable"),
		d = c.find("table:eq(1)").length;
		b.oTable.find("thead");
		var e,
		f,
		g = b.oTable.offset().top - 40,
		h = b.oTable.outerWidth();
		d ? (e = c.find("table:eq(1)"), f = c.find(".headerWrapper")) : (e = b.oTable.clone(), f = a('<div class="headerWrapper"></div>'), f.append(e)),
		f.css("width", h),
		e.css("width", h),
		e.html("");
		var i = a("thead", b.oTable).clone(!0);
		e.html(i).removeClass("invisible"),
		a("thead>tr th", b.oTable).each(function (b) {
			a("thead>tr th:eq(" + b + ")", e).width(a(this).width())
		}),
		a("thead>tr td", b.oTable).each(function (b) {
			a("thead>tr td:eq(" + b + ")", e).width(a(this).width())
		}),
		d || (f.css({
				position : "absolute",
				top : 0,
				left : 0,
				zIndex : 1e3
			}), c.append(f));
		var j = a(window);
		j.scroll(function () {
			var a = j.scrollTop(),
			b = a - g;
			b > 0 ? f.css({
				top : b
			}) : f.css({
				top : 0
			})
		})
	}
	function n(b, d) {
		var e = this;
		if (e.oTable) {
			var f = i(b),
			g = k(f);
			a.extend(B, b),
			e.oTable.fnClearTable(),
			d && (f += "&detail=1"),
			"user" == b.type ? e.publish("ajax", {
				url : g
			}, c().done(function (a) {
					a && (z = a.teamtop, A = a.companytop)
				}).then(function () {
					o.call(e, f, e.oTable)
				})) : (z = null, A = null, o.call(e, f, e.oTable))
		}
	}
	function o(a, b) {
		var d = this;
		w = a,
		d.publish("ajax", {
			url : a
		}, c().done(function (a) {
				try {
					b.fnAddData(a.aaData),
					b.fnDraw()
				} catch (c) {
					d.publish("error/log", c.message, c.stack)
				}
			}))
	}
	function p(b, c, d, e, f) {
		if (!c.length)
			return a(b).parents("tfoot").hide(), !1;
		f.length ? a(b).parents("tfoot").show() : a(b).parents("tfoot").hide();
		var g,
		h,
		i,
		j,
		k = {};
		for (g = d; e > g; g += 1) {
			i = c[f[g]];
			for (h in i)
				"id" != h && "name" != h && (void 0 === k[h] && (k[h] = 0), k[h] += i[h])
		}
		a(b).find("th").each(function () {
			j = a(this),
			h = j.data("mapping"),
			j.html(k[h])
		}),
		q(a(b).parents("tfoot").find(".team"), z),
		q(a(b).parents("tfoot").find(".company"), A)
	}
	function q(b, c) {
		var d,
		e;
		c ? (b.show(), b.find("th").each(function () {
				e = a(this),
				d = e.data("mapping"),
				c[d] && c[d].name && e.html('<span class="highlight">' + c[d].value + "</span>" + ' (<a data-action="user/open" href="/user/preview#' + c[d].id + '">' + c[d].name + "</a>)")
			})) : b.hide()
	}
	function r(a) {
		var b = this,
		c = b.oTable.fnSettings().aoColumns[a].bVisible;
		b.oTable.fnSetColumnVis(a, c ? !1 : !0)
	}
	function s(b, d, e) {
		var f = this;
		f.publish("ajax", {
			url : b
		}, c().done(function (c) {
				var f,
				g,
				i = h(b);
				c && c.data && (c.data.length > 200 ? g = a('<p class="text-center text-error">系统仅支持显示200条以内的明细!</p>') : (g = a('<table class="table table-striped table-bordered table-candidate table_vam"></table>').data("ids", c.data), f = decodeURI(i.type), g.attr("data-weave", "app/widget/reporting/kpi/task-reporting/detail/main(ids)").weave()), d.fnOpen(e, g, "detailCell"))
			}))
	}
	function t() {
		var a = this;
		a.publish("ajax", {
			url : y.NOTE_CATEGORY
		}, c().done(function (b) {
				a._json.tasks = b,
				b.forEach(function (b) {
					a.COLUMNS.push({
						mData : b.code
					})
				}),
				c(function (b) {
					a.html(d, a._json, b)
				}).done(function () {
					u.call(a)
				})
			}))
	}
	function u() {
		var a = this;
		a.oTable = a.$element.find("table"),
		a.publish("ajax", {
			url : y.TEAM_LIST
		}, c().done(function (b) {
				v = b,
				l.call(a)
			}))
	}
	var v,
	w,
	x,
	y = {
		TEAM_LIST : "/rest/data/team/list",
		NOTE_CATEGORY : "/rest/data/options?type=todo_category",
		REPORT : "/rest/report/kpi?kpi_type=todo"
	},
	z = null,
	A = null,
	B = {
		type : "user",
		filter : "",
		filter_id : "",
		start : "",
		end : ""
	};
	return b.extend(function () {
		this.COLUMNS = [{
				mData : "id"
			}, {
				mData : "name"
			}, {
				mData : "todos"
			}
		],
		this.aoColumnDefs = [{
				bVisible : !1,
				aTargets : [0]
			}, {
				mRender : f,
				aTargets : [1]
			}
		]
	}, {
		"sig/stop" : function (a, b) {
			var c = this;
			c.oTable.fnDestroy(),
			b.resolve()
		},
		"hub:memory/kpi/show" : function (a, b) {
			function c() {
				if ("team" == b.type) {
					if (!v)
						return e.alert("error", "团队列表不存在"), void 0;
					for (var a = !1, c = 0; c < v.length; c += 1)
						v[c].parent_id == b.filter_id && (a = !0);
					a ? n.call(d, b, !0) : n.call(d, b)
				} else
					n.call(d, b)
			}
			var d = this;
			if (d.oTable && !d.oTable.hasClass("invisible"))
				c();
			else
				var f = setInterval(function () {
						d.oTable && !d.oTable.hasClass("invisible") && (c(), clearInterval(f))
					}, 100)
		},
		"hub:memory/context" : function (a, b) {
			this._user = b.user,
			t.call(this)
		},
		"hub/kpi/toggle/column" : function (a, b) {
			var c = this;
			r.call(c, b);
			var d = this.$element.find(".detailCell");
			if (d.length) {
				var e = d.eq(0).closest("tr").prev().children().length;
				d.attr("colspan", e)
			}
		},
		"dom/action.click" : a.noop,
		"dom/action/lookup.click" : function (b, c, d) {
			c.preventDefault();
			var f = this,
			g = a(c.target);
			if (!v)
				return e.alert("error", "团队列表不存在"), void 0;
			for (var h = !1, i = 0; i < v.length; i += 1)
				v[i].parent_id == d && (h = !0);
			B.filter = "team",
			B.filter_id = d,
			h ? this.publish("filter/kpi/update", B, g.html()) : (B.type = "user", this.publish("filter/kpi/update", B, g.html(), !0)),
			n.call(f, B, !0)
		},
		"dom/action/user/open.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			f = d.attr("href");
			e.window({
				url : f,
				name : "User Profile",
				width : "1024"
			})
		},
		"dom/action/details/show.click" : function (b, c, d, e) {
			var f = this,
			g = a(c.target),
			h = g.closest("tr"),
			i = h[0],
			k = {};
			k.type = d,
			k.filter = B.type,
			k.filter_id = e,
			k.start = B.start,
			k.end = B.end;
			var l = j(k);
			f.oTable.fnIsOpen(i) ? (f.oTable.fnClose(i), h.data("detail") !== d ? (s.call(f, l, f.oTable, i), h.data("detail", d), g.closest("td").addClass("selected").siblings().removeClass("selected")) : (h.data("detail", ""), g.closest("td").removeClass("selected"))) : (s.call(f, l, f.oTable, i), h.data("detail", d), g.closest("td").addClass("selected").siblings().removeClass("selected"))
		},
		"dom/action/export/csv.click" : function (a, b) {
			b.preventDefault();
			var c = w + "&output=csv";
			window.open(c)
		}
	})
}), define("troopjs-requirejs/template!app/widget/reporting/revenue/detailTable.html", [], function () {
	return function (a) {
		for (var b = '<colgroup>\n    <col>\n    <col>\n    <col>\n    <col width="180">\n    <col width="80">\n    <col width="80">\n    <!-- <col width="80">\n    <col width="80"> -->\n    <col width="80">\n    <col width="80">\n    <col>\n</colgroup>\n<thead>\n    <tr>\n        <th data-weave="shared/helper/translation" data-i18n="User"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Client"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Joborder"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Candidate"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Revenue"></th>\n        <th data-weave="shared/helper/translation" data-i18n="NewDate"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Offer Signed"></th>\n        <th data-weave="shared/helper/translation" data-i18n="预计入职"></th>\n        <th data-weave="shared/helper/translation" data-i18n="实际入职"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Probation"></th>\n        <th data-weave="shared/helper/translation" data-i18n="SentDate"></th>\n        <th data-weave="shared/helper/translation" data-i18n="ReceivedDate"></th>\n        <th data-weave="shared/helper/translation" data-i18n="Invoice Status"></th>\n    </tr>\n</thead>\n<tbody>\n    ', c = 0, d = a.length; d > c; c++) {
			b += "\n    ";
			var e = a[c];
			b += '\n    <tr>\n        <td>\n            <a data-action="user/open" href="/user/preview#\'' + e.user_id + '">' + e.user_ename + '</a>\n        </td>\n        <td>\n            <a target="_blank" href="/company#detail!id=' + e.client_id + '">' + e.clientname + '</a>\n        </td>\n        <td>\n            <a target="_blank" href="/job#detail!id=' + e.joborder_id + '">' + e.jobTitle + " (ID: " + e.joborder_id + ')</a>\n        </td>\n        <td>\n            <a target="_blank" href="/candidate#detail!id=' + e.candidate_id + '">' + [e.englishName, e.chineseName].join(" ").trim() + '</a>\n        </td>\n        <td>\n            <span class="currency">' + this.formatCurrency(e.revenue) + "</span>\n        </td>\n        <td>\n            " + (e.dateAdded ? e.dateAdded : "") + "\n        </td>\n        <td>\n            " + (e.signDate ? e.signDate : "") + "\n        </td>\n        <td>\n            " + (e.estimate_onboardDate ? e.estimate_onboardDate : "") + "\n        </td>\n        <td>\n            " + (e.onboardDate ? e.onboardDate : "") + "\n        </td>\n        <td>\n            " + (e.probationDate ? e.probationDate : "") + "\n        </td>\n        <td>\n            " + (e.sentDate ? e.sentDate : "") + "\n        </td>\n        <td>\n            " + (e.paymentReceivedDate ? e.paymentReceivedDate : "") + '\n        </td>\n        <td>\n            <span data-weave="shared/helper/translation" data-i18n="' + e.status + '"></span>\n        </td>\n    </tr>\n    '
		}
		return b += "\n</tbody>"
	}
}), define("app/widget/reporting/revenue/detailTable", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "template!./detailTable.html", "shared/helper/utils", "jquery.datatables"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		b.html(e, b._json, a)
	}
	function g(a) {
		var b = this;
		b.oTable = b.$element.dataTable({
				sDom : "t",
				bPaginate : !1,
				bLengthChange : !1,
				aaSorting : []
			}),
		a.resolve()
	}
	return b.extend(function (a, b, c) {
		this._json = c
	}, {
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"sig/start" : function (a, b) {
			g.call(this, b)
		}
	})
}), define("troopjs-requirejs/template!app/widget/reporting/revenue/filter/main.html", [], function () {
	return function (a) {
		var b = "",
		c = a.user.revenueReportView;
		switch (c) {
		case "Myself":
			c = 1;
			break;
		case "My Team":
			c = 2;
			break;
		case "All":
			c = 3
		}
		return b += '\n<div class="well well-small">\n    <ul class="nav nav-pills pull-right">\n        <li class="text-line">\n            <span class="period">\n                <span id="from"></span>\n                &ndash;\n                <span id="to"></span>\n            </span>\n            <span class="all">\n                <span data-weave="shared/helper/translation" data-i18n="All"></span>\n            </span>\n        <li>\n            <a href="#" data-action="change/date(\'today\')" data-weave="shared/helper/translation" data-i18n="Today"></a>\n        </li>\n        <li>\n            <a href="#" data-action="change/date(\'thisweek\')" data-weave="shared/helper/translation" data-i18n="This week"></a>\n        </li>\n        <li>\n            <a href="#" data-action="change/date(\'lastweek\')" data-weave="shared/helper/translation" data-i18n="Last week"></a>\n        </li>\n        <li>\n        <a href="#" data-action="change/date(\'thismonth\')" data-weave="shared/helper/translation" data-i18n="This month"></a>\n        </li>\n        <li>\n            <a href="#" data-action="change/date(\'lastmonth\')" data-weave="shared/helper/translation" data-i18n="Last month"></a>\n        </li>\n        </li>\n        <li>\n            <a href="#" data-action="change/date(\'thisyear\')" data-weave="shared/helper/translation" data-i18n="This year"></a>\n        </li>\n        <li>\n            <a href="#" data-action="change/date(\'lastyear\')" data-weave="shared/helper/translation" data-i18n="Last year"></a>\n        </li>\n        <li>\n            <a href="#" data-action="change/date(\'all\')" data-weave="shared/helper/translation" data-i18n="All"></a>\n        </li>\n        <li class="dropdown pull-right">\n            <a href="#" class="dropdown-toggle" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Custom date"></a>\n            <div class="dropdown-menu filter-content">\n                <form action="#">\n                    <div>\n                        <input type="text" name="from" class="date input-small" data-action="date" data-weave="shared/widget/common/date-picker/main">\n                        &ndash;\n                        <input type="text" name="to" class="date input-small" data-action="date" data-weave="shared/widget/common/date-picker/main">\n                    </div>\n                    <button id="filter-date" class="btn" type="submit" data-action="custom" data-weave="shared/helper/translation" data-i18n="Search"></button>\n                </form>\n            </div>\n        </li>\n    </ul>\n    <select name="data-type" class="input-small pull-right" style="margin: 0;" data-action="data/type">\n        <option value="signDate" data-weave="shared/helper/translation" data-i18n="Offer日期"></option>\n        <option value="sentDate" data-weave="shared/helper/translation" data-i18n="SentDate"></option>\n        <option value="paymentReceivedDate" data-weave="shared/helper/translation" data-i18n="到款日期"></option>\n        <option value="estimate_onboardDate" data-weave="shared/helper/translation" data-i18n="预计入职"></option>\n        <option value="onboardDate" data-weave="shared/helper/translation" data-i18n="实际入职"></option>\n        <option value="probationDate" data-weave="shared/helper/translation" data-i18n="保证期"></option>\n    </select>\n    <ul class="nav nav-pills">\n        <li class="active">\n        <a href="#" data-action="myself">Myself</a>\n        </li>\n        ',
		2 == c && (b += '\n        <li>\n        <a href="#' + a.user.team.id + '" data-action="myteam">My Team</a>\n        </li>\n        '),
		b += "\n        ",
		3 == c && (b += '\n        <li>\n        <a href="#0" data-action="myteam">My Team</a>\n        </li>\n        '),
		b += '\n        <li class="text-line hide">\n        <span id="category"></span>\n        </li>\n    </ul>\n</div>\n<div class="viewtype hide">\n    <label class="radio"><input name="viewtype" type="radio" value="user" checked="checked" data-action="viewtype" /><span data-weave="shared/helper/translation" data-i18n="By User"></span></label>\n    <label class="radio"><input name="viewtype" type="radio" value="team" data-action="viewtype" /><span data-weave="shared/helper/translation" data-i18n="By Team"></span></label>\n</div>'
	}
}), define("app/widget/reporting/revenue/filter/main", ["compose", "jquery", "shared/widget/filter/base", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d, e) {
	function f(a) {
		var b = new Date(a),
		c = b.getFullYear(),
		d = b.getMonth() + 1,
		e = b.getDate();
		return c + "-" + d + "-" + e
	}
	function g(a, b) {
		a.closest("ul").find(".active").removeClass("active"),
		a.closest("li").addClass("active"),
		this.publish("revenue/show", b)
	}
	function h(a, b) {
		var c = this;
		a && b ? (c.$from.text(a), c.$to.text(b), c.$period.show(), c.$all.hide()) : (c.$period.hide(), c.$all.show())
	}
	function i(a) {
		this.$element.find(".viewtype").toggleClass("hide", a)
	}
	function j() {
		var a = this;
		d(function (b) {
			a.html(e, a._json, b)
		}).then(function () {
			k.call(a)
		})
	}
	function k() {
		var a = this;
		a.$from = a.$element.find("#from"),
		a.$to = a.$element.find("#to"),
		a.$period = a.$element.find(".period"),
		a.$all = a.$element.find(".all"),
		t.filter = "user",
		t.filter_id = this._user.id,
		a.$element.find('[data-action*="thisyear"]').trigger("click")
	}
	var l = Date.now(),
	m = new Date,
	n = l - 864e5 * ((m.getDay() || 7) - 1),
	o = n + 5184e5,
	p = l - 864e5 * (m.getDate() - 1),
	q = new Date(m.getFullYear(), m.getMonth() + 1, 0),
	r = m.getFullYear() + "-01-01",
	s = m.getFullYear() + "-12-31";
	(new Date).getFullYear() - 1 + "-01-01",
	(new Date).getFullYear() - 1 + "-12-31";
	var t = {
		type : "user",
		filter : "",
		filter_id : "",
		start : r,
		end : s,
		dateType : "signDate"
	};
	return c.extend(function () {}, {
		"hub:memory/context" : function (a, b) {
			this._json.user = this._user = b.user,
			j.call(this)
		},
		"hub:memory/filter/kpi/update" : function (a, c, d, e) {
			b.extend(t, c);
			var f = this.$element.find("#category");
			f.closest("ul").find(".active").removeClass("active"),
			e ? (f.html(d).parent().removeClass("hide"), this.$element.find("input[value=user]").prop("checked", !0)) : (f.parent().addClass("hide"), f.parent().before(b('<li class="active">').append(b('<a data-action="myteam" href="#' + c.filter_id + '">' + d + "</a>"))))
		},
		"dom/action.change" : b.noop,
		"dom/action/myself.click" : function (a, c) {
			c.preventDefault();
			var d = this._user,
			e = b(c.target);
			t.type = "user",
			t.filter = "user",
			t.filter_id = d.id,
			i.call(this, !0),
			g.call(this, e, t)
		},
		"dom/action/myteam.click" : function (a, c) {
			c.preventDefault(),
			this._user;
			var d = b(c.target),
			e = d.attr("href").slice(1);
			d.parent().nextUntil(".text-line").remove(),
			d.parent().next(".text-line").addClass("hide"),
			t.type = this.$element.find(":radio:checked").val(),
			t.filter = "team",
			t.filter_id = e,
			i.call(this, !1),
			g.call(this, d, t)
		},
		"dom/action/date.click" : function (a, b) {
			b.stopPropagation()
		},
		"dom/action/custom.click" : function (a, c) {
			c.preventDefault(),
			this._user;
			var d = b(c.target),
			e = d.closest("form"),
			f = e.find("[name=from]").val(),
			i = e.find("[name=to]").val(),
			j = d.closest(".dropdown");
			t.start = f,
			t.end = i,
			h.call(this, t.start, t.end),
			g.call(this, d, t),
			j.removeClass("open")
		},
		"dom/action/viewtype.change" : function (a, b) {
			this._user,
			t.type = b.target.value,
			this.publish("revenue/show", t)
		},
		"dom/action/data/type.change" : function (a, c) {
			var d = b(c.target);
			t.dateType = d.val(),
			g.call(this, d, t)
		},
		"dom/action/change/date.click" : function (a, c, d) {
			c.preventDefault(),
			this._user;
			var e,
			i,
			j = b(c.target);
			switch (d) {
			case "today":
				t.start = f(m),
				t.end = f(m);
				break;
			case "thisweek":
				t.start = f(n),
				t.end = f(o);
				break;
			case "thismonth":
				t.start = f(p),
				t.end = f(q);
				break;
			case "thisyear":
				t.start = r,
				t.end = s;
				break;
			case "lastweek":
				i = m.getTime() - 1e3 * 60 * 60 * 24 * (m.getDay() ? m.getDay() : 7),
				e = new Date(i).getTime() - 5184e5,
				t.start = f(e),
				t.end = f(i);
				break;
			case "lastmonth":
				e = new Date(m.getFullYear(), m.getMonth() - 1, 1).getTime(),
				i = new Date(m.getFullYear(), m.getMonth(), 0).getTime(),
				t.start = f(e),
				t.end = f(i);
				break;
			case "lastyear":
				e = new Date(m.getFullYear() - 1, 0, 1).getTime(),
				i = new Date(m.getFullYear() - 1, 11, 31).getTime(),
				t.start = f(e),
				t.end = f(i);
				break;
			case "all":
				e = new Date("1900-1-1").getTime(),
				i = new Date("2099-12-31").getTime(),
				t.start = f(e),
				t.end = f(i)
			}
			"all" !== d ? h.call(this, t.start, t.end) : h.call(this),
			g.call(this, j, t)
		}
	})
}), define("troopjs-requirejs/template!app/widget/reporting/revenue/main.html", [], function () {
	return function () {
		var a = '<div class="row-fluid">\n    <div class="span12">\n        <p class="text-right">\n            <button class="btn" data-weave="shared/helper/translation" data-i18n="Export Reporting" data-action="export/csv"></button>    \n        </p>\n        \n        <table id="dt_e" class="table table-striped table-bordered dTableR revenue-reporting">\n            <thead>\n                <tr>\n                    <th data-mapping="id">ID</th>\n                    <th data-mapping="name" data-weave="shared/helper/translation" data-i18n="User"></th>\n                    <th data-mapping="invoiceNotSent" data-weave="shared/helper/translation" data-i18n="Invoice Not Sent"></th>\n                    <th data-mapping="invoiceSent" data-weave="shared/helper/translation" data-i18n="Invoice Sent Not Received"></th>\n                    <th data-mapping="paymentReceived"><span data-weave="shared/helper/translation" data-i18n="Payment Received Already"></span></th>\n                    <th data-mapping="paymentReceivedRate"><span class="report" data-weave="shared/helper/translation" data-i18n="Payment Received Rate"></span></th>\n                    <th data-mapping="revenue"><span data-weave="shared/helper/translation" data-i18n="Total Revenue"></span></th>\n                    <th data-mapping="revenueRate"><span class="report" data-weave="shared/helper/translation" data-i18n="Completion Rate"></span></th>\n                    <th data-mapping="annualTarget" data-weave="shared/helper/translation" data-i18n="Annual Target"></th>\n                </tr>\n            </thead>\n            <tbody>\n            </tbody>\n            <tfoot>\n                <tr class="sum">\n                    <th></th>\n                    <th data-weave="shared/helper/translation" data-i18n="Summary"></th>\n                    <th data-mapping="invoiceNotSent"></th>\n                    <th data-mapping="invoiceSent"></th>\n                    <th data-mapping="paymentReceived"></th>\n                    <th data-mapping="paymentReceivedRate"></th>\n                    <th data-mapping="revenue"></th>\n                    <th data-mapping="revenueRate"></th>\n                    <th data-mapping="annualTarget"></th>\n                </tr>\n            </tfoot>\n        </table>\n    </div>\n</div>';
		return a
	}
}), define("app/widget/reporting/revenue/main", ["compose", "jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "shared/helper/blurb", "jquery.datatables.fixedheader"], function (a, b, c, d, e, f, g, h) {
	function i(a) {
		var b = 100 * a;
		return b.toFixed(2) + "%"
	}
	function j(a, b, c) {
		var d,
		e = "";
		switch (z.type) {
		case "user":
			"Active" !== c.status && (e = "muted"),
			d = '<a class="' + e + '" data-action="user/open" href="/user/preview#' + c.id + '">' + a + "</a>";
			break;
		case "team":
			d = '<a href="#' + c.id + '" data-action="lookup(' + c.id + ')">' + a + "</a>";
			break;
		default:
			d = a
		}
		return d
	}
	function k(a) {
		var b = "/rest/report/revenue?type=<type>",
		c = "&filter=<filter>&<filter>_id=<id>",
		d = "&start=<start>&end=<end>",
		e = "&dateType=<dateType>";
		return a.filter && (a.filter_id || 0 === a.filter_id) && (b += c.replace(/<filter>/g, a.filter).replace(/<id>/, a.filter_id)),
		a.start && a.end && (b += d.replace(/<start>/, a.start).replace(/<end>/, a.end)),
		a.dateType && (b += e.replace("<dateType>", a.dateType)),
		b.replace(/<type>/, a.type)
	}
	function l(a) {
		var b = "/rest/report/revenuedetail?status=<type>",
		c = "&filter=<filter>&<filter>_id=<id>",
		d = "&start=<start>&end=<end>",
		e = "&dateType=<dateType>";
		return a.filter && (a.filter_id || 0 === a.filter_id) && (b += c.replace(/<filter>/g, a.filter).replace(/<id>/, a.filter_id)),
		a.start && a.end && (b += d.replace(/<start>/, a.start).replace(/<end>/, a.end)),
		a.dateType && (b += e.replace("<dateType>", a.dateType)),
		encodeURI(b.replace(/<type>/, a.type))
	}
	function m(a, c, d, e, f) {
		if (!c.length)
			return b(a).parents("tfoot").hide(), !1;
		f.length ? b(a).parents("tfoot").show() : b(a).parents("tfoot").hide();
		var g,
		h,
		j,
		k,
		l = {},
		m = 0,
		n = 0;
		for (g = d; e > g; g += 1) {
			j = c[f[g]],
			delete j.cn_name,
			delete j.status,
			delete j.team_name;
			for (h in j)
				"id" != h && "name" != h && (void 0 === l[h] && (l[h] = 0), l[h] = l[h] + j[h])
		}
		l.revenue > 0 && (m = l.paymentReceived / l.revenue),
		l.annualTarget > 0 && (n = l.revenue / l.annualTarget),
		b(a).find("th[data-mapping]").each(function () {
			k = b(this),
			h = k.data("mapping"),
			"paymentReceived" === h ? k.html('<span class="currency red">' + x(l[h].toFixed(2)) + "</span>") : "paymentReceivedRate" === h ? k.html("<span>" + i(m.toFixed(4)) + "</span>") : "revenueRate" === h ? k.html("<span>" + i(n.toFixed(4)) + "</span>") : k.html('<span class="currency">' + x(l[h].toFixed(2)) + "</span>")
		})
	}
	function n() {
		var a = this;
		a.oTable = a.$element.find("#dt_e").dataTable({
				sDom : "ifti",
				bPaginate : !1,
				bLengthChange : !1,
				aaSorting : [],
				aoColumns : w,
				aoColumnDefs : y,
				fnFooterCallback : m,
				fnInfoCallback : function (a, b, c, d, e) {
					return "总共: " + e + "条结果"
				},
				oLanguage : {
					sSearch : "搜索"
				}
			}),
		new h(a.oTable, {
			offsetTop : 40
		}),
		a.subscribe("revenue/show", !0, function (b, c) {
			if ("team" == c.type) {
				if (!t)
					return f.alert("error", "团队列表不存在"), void 0;
				for (var d = !1, e = 0; e < t.length; e += 1)
					t[e].parent_id == c.filter_id && (d = !0);
				d ? p.call(a, c, !0) : p.call(a, c)
			} else
				p.call(a, c)
		})
	}
	function o(a, b) {
		var c = this;
		u = a,
		c.publish("ajax", {
			url : a
		}, d().done(function (a) {
				b.fnClearTable(),
				b.fnAddData(a.aaData),
				b.fnDraw()
			}))
	}
	function p(a, c) {
		var d = this,
		e = k(a),
		f = b("#dt_e").dataTable();
		b.extend(z, a),
		c && (e += "&detail=1"),
		o.call(d, e, f)
	}
	function q(a, c) {
		var e = this;
		e.publish("ajax", {
			url : a
		}, d().done(function (a) {
				var f = b('<table class="table table-striped table-bordered table-condensed"></table>');
				f.data("json", a).attr("data-weave", "app/widget/reporting/revenue/detailTable(json)").weave(d().done(function () {
						e.oTable.fnOpen(c, f, "detailCell")
					}))
			}))
	}
	function r(a) {
		var b = this;
		d(function (a) {
			b.html(e, b._json, a)
		}).then(function () {
			a.resolve()
		}),
		b.publish("ajax", {
			url : v
		}, d().done(function (a) {
				t = a
			}))
	}
	function s() {
		var a = this;
		n.call(a)
	}
	var t,
	u,
	v = "/rest/data/team/list",
	w = [{
			mData : "id"
		}, {
			mData : "name"
		}, {
			mData : "invoiceNotSent"
		}, {
			mData : "invoiceSent"
		}, {
			mData : "paymentReceived"
		}, {
			mData : "paymentReceivedRate"
		}, {
			mData : "revenue"
		}, {
			mData : "revenueRate"
		}, {
			mData : "annualTarget"
		}
	];
	b.extend(jQuery.fn.dataTableExt.oSort, {
		"formatted-num-pre" : function (a) {
			return a = "-" === a ? 0 : a.replace(/\,/g, "").replace(/<span[^>]*>([^<]+)<\/span>/, "$1"),
			parseFloat(a)
		},
		"formatted-num-asc" : function (a, b) {
			return a - b
		},
		"formatted-num-desc" : function (a, b) {
			return b - a
		},
		"percent-pre" : function (a) {
			var b = "-" == a ? 0 : a.replace(/%/, "").replace(/<span[^>]*>([\d\.]+)<\/span>/, "$1");
			return parseFloat(b)
		},
		"percent-asc" : function (a, b) {
			return b > a ? -1 : a > b ? 1 : 0
		},
		"percent-desc" : function (a, b) {
			return b > a ? 1 : a > b ? -1 : 0
		}
	});
	var x,
	y = [{
			bVisible : !1,
			aTargets : [0]
		}, {
			mRender : j,
			aTargets : [1]
		}, {
			mRender : function (a) {
				return "<span class='currency'>" + x(+a) + "</span>"
			},
			aTargets : [2],
			sType : "formatted-num",
			fnCreatedCell : function (a, c, d) {
				d.invoiceNotSent > 0 && b(a).attr("data-action", 'details/show("New", ' + d.id + ")").addClass("info")
			}
		}, {
			mRender : function (a) {
				return "<span class='currency'>" + x(+a) + "</span>"
			},
			aTargets : [3],
			sType : "formatted-num",
			fnCreatedCell : function (a, c, d) {
				d.invoiceSent > 0 && b(a).attr("data-action", 'details/show("Sent", ' + d.id + ")").addClass("info")
			}
		}, {
			mRender : function (a) {
				return "<span class='currency red'>" + x(+a) + "</span>"
			},
			aTargets : [4],
			sType : "formatted-num",
			fnCreatedCell : function (a, c, d) {
				d.paymentReceived > 0 && b(a).attr("data-action", 'details/show("Received", ' + d.id + ")").addClass("info")
			}
		}, {
			mRender : function (a, b, c) {
				return i(c.paymentReceivedRate)
			},
			aTargets : [5],
			sType : "percent"
		}, {
			mRender : function (a) {
				return "<span class='currency'>" + x(+a) + "</span>"
			},
			aTargets : [6],
			sType : "formatted-num",
			fnCreatedCell : function (a, c, d) {
				d.revenue > 0 && b(a).attr("data-action", 'details/show("All", ' + d.id + ")").addClass("info")
			}
		}, {
			mRender : function (a, b, c) {
				return i(c.revenueRate)
			},
			aTargets : [7],
			sType : "percent"
		}, {
			mRender : function (a) {
				return '<span class="currency">' + x(+a) + "</span>"
			},
			aTargets : [8],
			sType : "formatted-num"
		}
	],
	z = {
		type : "user",
		filter : "",
		filter_id : "",
		start : "",
		end : "",
		dateType : "dateAdded"
	};
	return c.extend({
		"sig/initialize" : function (a, b) {
			r.call(this, b)
		},
		"hub:memory/context" : function (a, b) {
			this._user = b.user,
			x = this.formatCurrency,
			s.call(this)
		},
		"dom/action.click" : b.noop,
		"dom/action/lookup.click" : function (a, c, d) {
			c.preventDefault();
			var e = this,
			g = b(c.target);
			if (!t)
				return f.alert("error", "团队列表不存在"), void 0;
			for (var h = !1, i = 0; i < t.length; i += 1)
				t[i].parent_id == d && (h = !0);
			z.filter = "team",
			z.filter_id = d,
			h ? this.publish("filter/kpi/update", z, g.html()) : (z.type = "user", this.publish("filter/kpi/update", z, g.html(), !0)),
			p.call(e, z, !0)
		},
		"dom/action/user/open.click" : function (a, c) {
			c.preventDefault();
			var d = b(c.target),
			e = d.attr("href");
			f.window({
				url : e,
				name : "User Profile",
				width : "1024"
			})
		},
		"dom/action/details/show.click" : function (a, c, d, e) {
			var f = this,
			g = b(c.target),
			h = g.closest("tr"),
			i = h[0],
			j = {};
			j.type = d,
			j.filter = z.type,
			j.filter_id = e,
			j.start = z.start,
			j.end = z.end,
			j.dateType = z.dateType;
			var k = l(j);
			f.oTable.fnIsOpen(i) ? (f.oTable.fnClose(i), h.data("detail") !== d ? (q.call(f, k, i), h.data("detail", d), g.closest("td").addClass("selected").siblings().removeClass("selected")) : (h.data("detail", ""), g.closest("td").removeClass("selected"))) : (q.call(f, k, i), h.data("detail", d), g.closest("td").addClass("selected").siblings().removeClass("selected"))
		},
		"dom/action/export/csv.click" : function (a, b) {
			b.preventDefault();
			var c = u + "&output=csv";
			window.open(c)
		}
	})
}), define("troopjs-requirejs/template!app/widget/security-center/anti-copy/main.html", [], function () {
	return function () {
		var a = '<h3 class="heading" data-weave="shared/helper/translation" data-i18n="数据防复制"></h3>\n\n<form action="#" class="form-horizontal">\n    <p>开启后，候选人及客户联系人列表中的手机需要点击“查看”才能显示。</p>\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="是否开启"></span>\n        </label>\n        <div class="controls radio">\n            <label><input name="hide_contactinfo" class="load-key" value="1" type="radio" disabled="disabled" /><span data-weave="shared/helper/translation" data-i18n="No"></label>\n            <label><input name="hide_contactinfo" class="load-key" value="0" type="radio" disabled="disabled" /><span data-weave="shared/helper/translation" data-i18n="Yes"></label>\n            <button class="btn btn-primary action" data-action="setting/radio/edit" data-weave="shared/helper/translation" data-i18n="Edit"></button>\n            <button class="btn btn-primary action hide" data-action="setting/radio/save" data-weave="shared/helper/translation" data-i18n="Save"></button>\n            <button class="btn action hide" data-action="setting/textbox/cancel" data-weave="shared/helper/translation" data-i18n="Cancel"></button>\n        </div>\n    </div>\n</form>';
		return a
	}
}), define("app/widget/security-center/anti-copy/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d, e) {
	function f(a, b, d, f, g) {
		var h = this;
		if (f === g)
			e.alert("info", "Nothing changed at all !!!");
		else {
			var i = {
				id : a,
				type : b,
				name : d,
				value : f
			};
			f = isNaN(f) ? f : 1 === parseInt(f, 10) ? "True" : "False",
			h.publish("ajax", {
				url : l.CONFIG_ADD,
				data : {
					data : JSON.stringify(i)
				},
				type : "post"
			}, c().done(function (a) {
					a.status ? e.alert("success", "Saving [ " + f + " ] success.") : e.alert("error", a.message)
				}))
		}
	}
	function g() {
		var a = this,
		b = Array.prototype.slice.call(arguments).join(",");
		a.publish("ajax", {
			url : l.CONFIG_KEYS.replace("<keys>", b),
			type : "get",
			cache : !1
		}, c().done(function (a) {
				h(a)
			}))
	}
	function h(b) {
		for (var c, d, e, f = 0, g = b.length; g > f; f += 1)
			switch (d = b[f], c = a("[name=" + d.name + "]"), c.data("id", d.id), e = c.attr("type").toLowerCase()) {
			case "radio":
				c.filter("[value=" + d.value.toLowerCase() + "]").prop("checked", !0)
			}
	}
	function i(b) {
		var c = a(b.target).closest(".controls"),
		d = c.find("input").prop("disabled");
		c.find("input").prop("disabled", !d),
		c.find("button.action").toggleClass("hide")
	}
	function j(a) {
		var b = this;
		b.html(d, b._json, a)
	}
	function k(b) {
		var c = this,
		d = [];
		a(".load-key").each(function () {
			d.push(this.name)
		}),
		g.call(c, d.join(",")),
		b.resolve()
	}
	var l = {
		CONFIG_ADD : "/rest/data/configvalue/add",
		CONFIG_KEYS : "/rest/data/configvalue?keys=<keys>"
	};
	return b.extend({
		"sig/initialize" : function (a, b) {
			j.call(this, b)
		},
		"sig/start" : function (a, b) {
			k.call(this, b)
		},
		"dom/action.click" : a.noop,
		"dom/action/setting/textbox/cancel.click" : function (a, b) {
			b.preventDefault(),
			i(b)
		},
		"dom/action/setting/radio/edit.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target).closest(".controls").find("input"),
			e = d.filter(":checked");
			d.data("original", e.val()),
			i(c)
		},
		"dom/action/setting/radio/save.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target).closest(".controls").find("input"),
			g = e.filter(":checked"),
			h = g.data("id"),
			j = g.attr("name"),
			k = g.val(),
			l = g.data("original");
			f.call(d, h, "", j, k, l),
			i(c)
		}
	})
}), define("troopjs-requirejs/template!app/widget/security-center/invoice-email/main.html", [], function () {
	return function () {
		var a = "",
		b = this.emailEnabled;
		return a += '\n<h3 class="heading">财务信息邮件通知</h3>\n\n<form action="#" class="form-horizontal">\n    <p>开启后，与财务相关的操作，系统都将发送邮件通知相关用户。</p>\n\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="发票新增"></span>\n        </label>\n        <div class="controls radio">\n            <label><input name="Invoice-Added" value="true" type="radio" data-action="enable"><span data-weave="shared/helper/translation" data-i18n="Yes"></label>\n            <label><input name="Invoice-Added" value="false" type="radio" data-action="enable"><span data-weave="shared/helper/translation" data-i18n="No"></label>\n        </div>\n    </div>\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Send invoice"></span>\n        </label>\n        <div class="controls radio">\n            <label><input name="To-be-sent" value="true" type="radio" data-action="enable"><span data-weave="shared/helper/translation" data-i18n="Yes"></label>\n            <label><input name="To-be-sent" value="false" type="radio" data-action="enable"><span data-weave="shared/helper/translation" data-i18n="No"></label>\n        </div>\n    </div>\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Invoice Sent"></span>\n        </label>\n        <div class="controls radio">\n            <label><input name="Sent" value="true" type="radio" data-action="enable"><span data-weave="shared/helper/translation" data-i18n="Yes"></label>\n            <label><input name="Sent" value="false" type="radio" data-action="enable"><span data-weave="shared/helper/translation" data-i18n="No"></label>\n        </div>\n    </div>\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Invoice Received"></span>\n        </label>\n        <div class="controls radio">\n            <label><input name="Received" value="true" type="radio" data-action="enable"><span data-weave="shared/helper/translation" data-i18n="Yes"></label>\n            <label><input name="Received" value="false" type="radio" data-action="enable"><span data-weave="shared/helper/translation" data-i18n="No"></label>\n        </div>\n    </div>\n\n    <div class="receiver-setting hide">\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="自定义收件人"></span>\n            </label>\n            <div class="controls">    \n                ',
		a += b ? '\n                <div class="span8">\n                    <input type="text" name="To" autocomplete="off" data-url="" data-weave="shared/widget/common/tagit/main">\n                </div>\n                <div class="hint clear">\n                    请使用"回车键"或者"逗号"确认邮箱地址\n                </div>\n                ' : '\n                <input type="text" name="To" class="span8" autocomplete="off" disabled="disabled">\n                <p class="help-block clear">\n                    <sapn class="text-error">邮件功能还未启用，请在个人信息板块的邮件设置中心，填写管理员的邮箱密码，并测试通过！</sapn>\n                </p>\n                ',
		a += '\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="其他收件人"></span>\n            </label>\n            <div class="controls checkbox">\n                <label>\n                    ',
		a += b ? '\n                    <input type="checkbox" name="To-JobOrder-Users" value="true">\n                    ' : '\n                    <input type="checkbox" name="To-JobOrder-Users" value="true" disabled="disabled">\n                    ',
		a += '\n                    <span data-weave="shared/helper/translation" data-i18n="项目所有成员">\n                </label>\n            </div>\n        </div>\n    </div>\n\n    <div class="control-group">\n        <div class="controls">\n            <button class="btn btn-primary" data-weave="shared/helper/translation" data-i18n="Save" data-action="save"></button>\n        </div>\n    </div>\n</form>'
	}
}), define("app/widget/security-center/invoice-email/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d, e) {
	function f() {
		var a = this;
		a.publish("ajax", {
			url : l.CONFIG_KEYS.replace("<keys>", "invoice_alert"),
			type : "get",
			cache : !1
		}, c().done(function (b) {
				var c = b[0];
				c.value = JSON.parse(c.value),
				g.call(a, c.value),
				i.call(a)
			}))
	}
	function g(a) {
		var b,
		c,
		d = this;
		for (var e in a)
			c = a[e], b = d.$element.find('[name="' + e.replace(/ /g, "-") + '"]'), "boolean" == typeof c ? (b.filter('[value="' + c + '"]').prop("checked", !0), "radio" === b.attr("type") && (m += c === !0 ? 1 : 0)) : "string" == typeof c && h.call(d, b, c)
	}
	function h(a, b) {
		var c = this,
		d = b.split(",");
		if (c.emailEnabled)
			for (var e = 0, f = d.length; f > e; e++)
				a.tagit("createTag", d[e])
	}
	function i() {
		var a = this;
		m ? a.$recieverSetting.removeClass("hide") : a.$recieverSetting.addClass("hide")
	}
	function j() {
		var a = this;
		c(function (b) {
			a.html(d, a._json, b)
		}).done(function () {
			k.call(a)
		})
	}
	function k() {
		var a = this;
		a.$recieverSetting = a.$element.find(".receiver-setting"),
		f.call(a)
	}
	var l = {
		CONFIG_ADD : "/rest/data/configvalue/add",
		CONFIG_KEYS : "/rest/data/configvalue?keys=<keys>"
	},
	m = 0;
	return b.extend({
		"hub:memory/context" : function (a, b) {
			var c = this;
			b.user.emailpassword && (c.emailEnabled = !0),
			j.call(this)
		},
		"dom/action.click" : a.noop,
		"dom/action/save.click" : function (b, d) {
			d.preventDefault();
			var f = this,
			g = a(d.target),
			h = {};
			f.$element.find(":radio").filter(":checked").each(function () {
				var b = a(this);
				h[b.attr("name").replace(/-/g, " ")] = Boolean("true" === b.val())
			}),
			h.To = f.$element.find('[name="To"]').val(),
			h["To JobOrder Users"] = f.$element.find('[name="To-JobOrder-Users"]').is(":checked"),
			h = JSON.stringify(h);
			var i = {
				type : "",
				name : "invoice_alert",
				value : h
			};
			f.publish("ajax", {
				url : l.CONFIG_ADD,
				data : {
					data : JSON.stringify(i)
				},
				type : "post"
			}, c().done(function (a) {
					a.status ? e.alert("success", "Saving success.") : e.alert("error", a.data)
				}), g)
		},
		"dom/action/add/segment.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target);
			e.closest(".controls").before(d.$segmentCopy.clone())
		},
		"dom/action/remove/segment.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target);
			d.closest(".controls").remove()
		},
		"dom/action/enable.click" : function (b, c) {
			var d = this,
			e = a(c.target);
			m += "true" === e.val() ? 1 : -1,
			i.call(d)
		}
	})
}), define("troopjs-requirejs/template!app/widget/security-center/ip-privacy/main.html", [], function () {
	return function (a) {
		var b = "",
		c = this.emailEnabled,
		d = a.users || "";
		return b += '\n<h3 class="heading">用户IP访问限制</h3>\n\n<form action="#" class="form-horizontal">\n    <p>开启后，不允许的IP地址将无法访问系统。可通此功能，限制用户仅在Office才能访问系统。</p>\n\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="是否开启"></span>\n        </label>\n        <div class="controls radio">\n            <label><input name="enable" value="true" type="radio" data-action="enable"><span data-weave="shared/helper/translation" data-i18n="Yes"></label>\n            <label><input name="enable" value="false" type="radio" data-action="enable"><span data-weave="shared/helper/translation" data-i18n="No"></label>\n        </div>\n    </div>\n\n    <div class="ip-setting hide">\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="IP Whitelist"></span>\n            </label>\n            <div class="controls">\n                <div class="span6">\n                    <input type="text" name="ip-whitelist" data-weave="shared/widget/common/tagit/main">\n                </div>\n                <div class="hint clear">\n                    请使用"回车键"或者"逗号"确认IP地址\n                </div>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="IP Whitelist Segment"></span>\n            </label>\n            <div class="controls segment">\n                <input type="text" class="input-medium from" name="ipv4">\n                &minus;\n                <input type="text" class="input-medium to" name="ipv4">\n                <a href="#" class="icon-remove" data-action="remove/segment"></a>\n            </div>\n            <div class="controls text_line">\n                <a href="#" data-weave="shared/helper/translation" data-i18n="Add" data-action="add/segment"></a>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label">\n                <span data-weave="shared/helper/translation" data-i18n="User Whitelist"></span>\n            </label>\n            <div class="controls">\n                ',
		b += c ? '\n                <div class="span6 clearfix">\n                    <input type="text" name="user-whitelist" data-weave="shared/widget/common/tagit/main" value="' + d + '">\n                </div>\n                <div class="hint clear">请输入用户的Email地址，用逗号分割。白名单内的用户，将不受IP访问限制</div>\n                ' : '\n                <input type="text" disabled="disabled" class="span6">\n                <p class="help-block">\n                    <sapn class="text-error">邮件功能还未启用，请在个人信息板块的邮件设置中心，填写管理员的邮箱密码，并测试通过！</sapn>\n                </p>\n                ',
		b += '\n            </div>\n        </div>\n    </div>\n\n    <div class="control-group">\n        <div class="controls">\n            <button class="btn btn-primary" data-weave="shared/helper/translation" data-i18n="Save" data-action="save"></button>\n        </div>\n    </div>\n</form>'
	}
}), define("app/widget/security-center/ip-privacy/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "shared/helper/validate"], function (a, b, c, d, e, f) {
	function g() {
		var a = this;
		a.publish("ajax", {
			url : j.CONFIG_KEYS.replace("<keys>", "ip_whitelist"),
			type : "get",
			cache : !1
		}, c().done(function (b) {
				var c = b[0];
				a._json = JSON.parse(c.value),
				h.call(a)
			}))
	}
	function h() {
		var a = this;
		c(function (b) {
			a.html(d, a._json, b)
		}).done(function () {
			i.call(a)
		})
	}
	function i() {
		var a = this,
		b = a._json.ips,
		c = 0;
		a.$enable = a.$element.find('[name="enable"]'),
		a.$ipWhite = a.$element.find('[name="ip-whitelist"]'),
		a.$userWhite = a.$element.find('[name="user-whitelist"]'),
		a.$segmentCopy = a.$element.find(".segment").eq(0).clone(),
		a.$segmentAdd = a.$element.find('[data-action="add/segment"]'),
		a.$ipSetting = a.$element.find(".ip-setting"),
		a.$form = a.$element.find("form"),
		a.$enable.filter('[value="' + a._json.enable + '"]').prop("checked", !0).trigger("click"),
		b.forEach(function (b) {
			var d = b.match(/(.*)-(.*)/);
			d ? (c > 0 && a.$segmentAdd.trigger("click"), a.$element.find(".from").eq(c).val(d[1]), a.$element.find(".to").eq(c).val(d[2]), c++) : a.$ipWhite.tagit("createTag", b)
		}),
		f(a.$form, {
			rules : {
				ipv4 : {
					ipv4 : !0
				}
			}
		})
	}
	var j = {
		CONFIG_ADD : "/rest/data/configvalue/add",
		CONFIG_KEYS : "/rest/data/configvalue?keys=<keys>"
	};
	return b.extend({
		"hub:memory/context" : function (a, b) {
			var c = this;
			b.user.emailpassword && (c.emailEnabled = !0),
			g.call(c)
		},
		"dom/action.click" : a.noop,
		"dom/action/save.click" : function (b, d) {
			d.preventDefault();
			var f = this,
			g = a(d.target);
			if (f.$form.valid()) {
				var h = f.$ipWhite.val(),
				i = f.$userWhite.val(),
				k = function () {
					var b = [],
					c = f.$element.find(".to");
					return f.$element.find(".from").each(function (d) {
						var e = a(this);
						e.val().trim().length && b.push(e.val().trim() + "-" + c.eq(d).val().trim())
					}),
					b
				}
				(),
				l = h.split(",").concat(k),
				m = JSON.stringify({
						ips : l,
						users : i,
						enable : Boolean("true" === f.$enable.filter(":checked").val())
					}),
				n = {
					type : "",
					name : "ip_whitelist",
					value : m
				};
				f.publish("ajax", {
					url : j.CONFIG_ADD,
					data : {
						data : JSON.stringify(n)
					},
					type : "post"
				}, c().done(function (a) {
						a.status ? e.alert("success", "Saving success.") : e.alert("error", a.data)
					}), g)
			}
		},
		"dom/action/add/segment.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target);
			e.closest(".controls").before(d.$segmentCopy.clone())
		},
		"dom/action/remove/segment.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target);
			d.closest(".controls").remove()
		},
		"dom/action/enable.click" : function (b, c) {
			var d = this,
			e = a(c.target);
			"true" === e.val() ? d.$ipSetting.removeClass("hide") : d.$ipSetting.addClass("hide")
		}
	})
}), define("troopjs-requirejs/template!app/widget/security-center/login-log/filter/main.html", [], function () {
	return function () {
		var a = "";
		return function () {
			var a,
			b = new Date;
			return a = [b.getFullYear(), b.getMonth() + 1, b.getDate()].join("-")
		}
		(),
		a += '\n<ul class="nav nav-pills line_sep">\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Login Date"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <input type="text" class="input-medium" data-weave="shared/widget/common/date-picker/main">\n                </div>\n                <button class="btn" type="submit" data-action="form(\'loginDate\')" data-weave="shared/helper/translation" data-i18n="Add"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="User"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <select name="user" data-role="All" data-weave="shared/widget/common/user-list/main" data-placeholder="请选择用户..."></select>\n                </div>\n                <button class="btn" type="submit" data-action="form(\'user\')" data-weave="shared/helper/translation" data-i18n="Add"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="IP Address"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <input type="text" class="input-medium" autocomplete="off">\n                </div>\n                <button class="btn" type="submit" data-action="form(\'ipAddress\')" data-weave="shared/helper/translation" data-i18n="Add"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="IP City"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <input type="text" class="input-medium" autocomplete="off">\n                </div>\n                <button class="btn" type="submit" data-action="form(\'ipCity\')" data-weave="shared/helper/translation" data-i18n="Add"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Browser"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <input type="text" class="input-medium" autocomplete="off">\n                </div>\n                <button class="btn" type="submit" data-action="form(\'browser\')" data-weave="shared/helper/translation" data-i18n="Add"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Login Status"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <select class="input-medium" name="status">\n                        <option value="" data-weave="shared/helper/translation" data-i18n="Please select"></option>\n                        <option value="1">成功</option>\n                        <option value="0">失败</option>\n                    </select>\n                </div>\n                <button class="btn" type="submit" data-action="form(\'loginStatus\')" data-weave="shared/helper/translation" data-i18n="Add"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Multiple Login Times"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <input type="number" class="input-small" min="1">\n                </div>\n                <button class="btn" type="submit" data-action="form(\'multipleLogin\')" data-weave="shared/helper/translation" data-i18n="Add"></button>\n            </form>\n        </div>\n    </li>\n</ul>\n\n<p class="sepH_b">\n    <span class="tag label label-info hide deletable" data-query="loginDate" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Login Date"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="user" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="User"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="ipAddress" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="IP Address"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="ipCity" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="IP City"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="browser" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Browser"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="loginStatus" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Login Status"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="multipleLogin" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Multiple Login Times"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n</p>\n\n\n<p class="sepH_b">\n    <button class="btn" data-action="filter/search" data-weave="shared/helper/translation" data-i18n="Search"></button>\n</p>'
	}
}), define("app/widget/security-center/login-log/filter/main", ["compose", "jquery", "shared/widget/filter/base", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "shared/helper/utils", "shared/widget/filter/query"], function (a, b, c, d, e, f, g, h) {
	function i() {
		h.addAttr({
			loginDate : function (a) {
				var c = b.trim(a.find("input").val());
				c.length && (b('[data-query="loginDate"]').removeClass("hide").find("span").text(c), this.addQuery("loginDate", "date=" + c))
			},
			user : function (a) {
				var c = a.find('select[name="user"] :selected').text(),
				d = a.find('select[name="user"]').val();
				c.length && d.length && (b('[data-query="user"]').removeClass("hide").find("span").text(c), this.addQuery("user", "user__eq=" + d))
			},
			ipAddress : function (a) {
				var c = b.trim(a.find("input").val());
				c.length && (b('[data-query="ipAddress"]').removeClass("hide").find("span").text(c), this.addQuery("ipAddress", "ip__eq=" + c))
			},
			ipCity : function (a) {
				var c = b.trim(a.find("input").val());
				c.length && (b('[data-query="ipCity"]').removeClass("hide").find("span").text(c), this.addQuery("ipCity", "location=" + c))
			},
			browser : function (a) {
				var c = b.trim(a.find("input").val());
				c.length && (b('[data-query="browser"]').removeClass("hide").find("span").text(c), this.addQuery("browser", "browser=" + c))
			},
			loginStatus : function (a) {
				var c = parseInt(a.find("select").val(), 10),
				d = a.find("select :selected").text();
				(c.length || d.length) && (b('[data-query="loginStatus"]').removeClass("hide").find("span").text(d), this.addQuery("loginStatus", "success__eq=" + (0 === c ? "" : c)))
			},
			multipleLogin : function (a) {
				var c = b.trim(a.find("input").val());
				c.length && (b('[data-query="multipleLogin"]').removeClass("hide").find("span").text(c), this.addQuery("multipleLogin", "times=" + c))
			}
		})
	}
	function j(a) {
		this.html(f, this._json, a)
	}
	function k(a) {
		var b,
		c = this,
		d = a[0],
		e = a[1];
		switch (d.indexOf("_") > -1 && (d = d.substring(0, d.indexOf("_"))), d) {
		case "date":
			c.$element.find('[data-query="loginDate"]').removeClass("hide").find("span").text(e),
			h.addQuery("loginDate", "date=" + e);
			break;
		case "user":
			b = c.$element.find('select[name="user"]').find('[value="' + e + '"]').text(),
			c.$element.find('[data-query="user"]').removeClass("hide").find("span").text(b),
			h.addQuery("user", "user__eq=" + e);
			break;
		case "ip":
			c.$element.find('[data-query="ipAddress"]').removeClass("hide").find("span").text(e),
			h.addQuery("ipAddress", "ip__eq=" + e);
			break;
		case "location":
			c.$element.find('[data-query="ipCity"]').removeClass("hide").find("span").text(e),
			h.addQuery("ipCity", "location=" + e);
			break;
		case "browser":
			c.$element.find('[data-query="browser"]').removeClass("hide").find("span").text(e),
			this.addQuery("browser", "browser=" + e);
			break;
		case "success":
			b = c.$element.find('select[name="status"]').find('[value="' + e + '"]').text(),
			c.$element.find('[data-query="loginStatus"]').removeClass("hide").find("span").text(b),
			h.addQuery("loginStatus", "success__eq=" + e);
			break;
		case "times":
			c.$element.find('[data-query="multipleLogin"]').removeClass("hide").find("span").text(e),
			h.addQuery("multipleLogin", "times=" + e)
		}
	}
	return c.extend(function () {
		var a = this;
		a._setFilter = k,
		i.call(a)
	}, {
		"sig/initialize" : function (a, b) {
			j.call(this, b)
		},
		"hub:memory/route" : function (a, b) {
			var c = this,
			d = new Date;
			b.source || c.publish("make/route", {
				list : "",
				filter : "date=" + d.getFullYear() + "-" + (d.getMonth() + 1) + "-" + d.getDate(),
				page : 1
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/security-center/login-log/main.html", [], function () {
	return function () {
		var a = '<p>\n    <button class="btn" data-action="setting">异常登录邮件通知</button>\n</p>\n\n<table class="table table-striped table-bordered">\n    <thead>\n        <tr>\n            <th data-weave="shared/helper/translation" data-i18n="Login Date"></th>\n            <th data-weave="shared/helper/translation" data-i18n="User"></th>\n            <th data-weave="shared/helper/translation" data-i18n="IP Address"></th>\n            <th data-weave="shared/helper/translation" data-i18n="IP City"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Browser"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Login Status"></th>\n        </tr>\n    </thead>\n\n    <tbody></tbody>\n</table>';
		return a
	}
}), define("app/widget/security-center/login-log/main", ["jquery", "shared/widget/list/base", "shared/services/route", "template!./main.html", "troopjs-utils/deferred", "shared/helper/utils", "jquery.datatables.fixedheader"], function (a, b, c, d, e, f) {
	function g(a) {
		var b = this;
		b.html(d, a)
	}
	function h(b) {
		var c = this;
		c.$table = c.$element.find("table").dataTable({
				bPaginate : !1,
				bAutoWidth : !1,
				sAjaxDataProp : "list",
				aoColumns : j,
				sDom : "<row'i>t",
				fnInfoCallback : function (a, b, c, d, e) {
					return "总共: " + e + "条结果"
				},
				oLanguage : {
					sProcessing : "<div class='widget-spin'></div>",
					sLoadingRecords : "<div class='widget-spin'></div>"
				},
				fnServerData : function (b, c, d, e) {
					e.jqXHR = a.ajax({
							dataType : "json",
							type : "POST",
							url : b,
							data : c,
							cache : !0,
							success : function (a) {
								d(a)
							}
						})
				}
			}),
		c.$table.fnSort([[0, "desc"]]),
		b.resolve()
	}
	var i = {
		LOG : "/rest/loginlog/list?"
	},
	j = [{
			mData : "dateAdded"
		}, {
			mData : null,
			mRender : function (a, b, c) {
				var d,
				e = c.user;
				return d = e ? '<a href="/user/preview#' + e.id + '" data-action="profile/open">' + [e.englishName, e.chineseName].join(" ") + "</a>" : c.email
			}
		}, {
			mData : "ip"
		}, {
			mData : "location"
		}, {
			mData : "browser.ua_family",
			mRender : function (a) {
				return a ? a.replace(/.*(ucbrowser).*/gi, "$1") : "N/A"
			}
		}, {
			mData : "success",
			mRender : function (a) {
				var b;
				return b = a ? '<span class="label label-success">成功</span>' : '<span class="label label-important">失败</span>'
			}
		}
	];
	return b.extend(function () {
		c().start(),
		this._url = i.LOG
	}, {
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"sig/start" : function (a, b) {
			h.call(this, b)
		},
		renderList : function (a) {
			var b = this;
			b.$table.fnClearTable(),
			b.$table.fnAddData(b._json.list),
			b.$table.fnDraw(),
			a.resolve()
		},
		"hub:memory/route" : function (a, b) {
			var c = this;
			c.publish("service/route", b)
		},
		"dom/action.click" : a.noop,
		"dom/action/profile/open.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = d.attr("href");
			f.window({
				url : e,
				name : "User Profile",
				width : "1024"
			})
		},
		"dom/action/setting.click" : function (a, b) {
			b.preventDefault();
			var c = this;
			c.publish("modal/login-alert/show")
		}
	})
}), define("troopjs-requirejs/template!app/widget/security-center/user-activity/filter/main.html", [], function () {
	return function () {
		var a = '<button class="btn btn-primary" data-action="set/activity/alert">邮件提醒设置</button>\n\n<ul class="nav nav-pills pull-right">\n    <li class="text-line">\n    <span class="from"></span>\n    &ndash;\n    <span class="to"></span>\n    </li>\n    <li>\n        <a href="#" data-action="date(\'today\')" data-weave="shared/helper/translation" data-i18n="Today"></a>\n    </li>\n    <li>\n        <a href="#" data-action="date(\'thisWeek\')" data-weave="shared/helper/translation" data-i18n="This week"></a>\n    </li>\n    <li>\n    <a href="#" data-action="date(\'thisMonth\')" data-weave="shared/helper/translation" data-i18n="This month"></a>\n    </li>\n    <li>\n        <a href="#" data-action="date(thisYear)" data-weave="shared/helper/translation" data-i18n="This year"></a>\n    </li>\n    <li class="dropdown pull-right">\n        <a href="#" class="dropdown-toggle" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Custom date"></a>\n        <div class="dropdown-menu filter-content">\n            <form action="#">\n                <div>\n                    <input type="text" name="from" class="input-small" data-weave="shared/widget/common/date-picker/main">\n                    &ndash;\n                    <input type="text" name="to" class="input-small" data-weave="shared/widget/common/date-picker/main">\n                </div>\n                <button class="btn" type="submit" data-action="custom/date" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n</ul>';
		return a
	}
}), define("app/widget/security-center/user-activity/filter/main", ["compose", "jquery", "shared/widget/filter/base", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d, e) {
	function f(a) {
		var b = new Date(a),
		c = b.getFullYear(),
		d = b.getMonth() + 1,
		e = b.getDate();
		return c + "-" + d + "-" + e
	}
	function g(a, b) {
		var c = this;
		s.start = a || "",
		s.end = b || "",
		c.$from.text(a),
		c.$to.text(b)
	}
	function h(a) {
		a.closest("ul").find(".active").removeClass("active"),
		a.closest("li").addClass("active")
	}
	function i(a) {
		var b = this;
		b.html(e, b._json, a)
	}
	function j(a) {
		var b = this;
		b.$from = b.$element.find(".from"),
		b.$to = b.$element.find(".to"),
		b.$element.find("ul li a:eq(0)").trigger("click"),
		a.resolve()
	}
	var k = "modal/activity-alert/show",
	l = new Date,
	m = f(l),
	n = function () {
		var a = l.getDay(),
		b = l.getDate() - a + (0 === a ? -6 : 1);
		return f(new Date(l.setDate(b)))
	}
	(),
	o = f(l.setDate(1)),
	p = l.getFullYear() + "-01-01",
	q = {
		today : m,
		thisWeek : n,
		thisMonth : o,
		thisYear : p
	},
	r = "user-activity/set/filter",
	s = {
		start : "",
		end : ""
	};
	return c.extend({
		"sig/initialize" : function (a, b) {
			i.call(this, b)
		},
		"sig/start" : function (a, b) {
			j.call(this, b)
		},
		"dom/action.click" : b.noop,
		"dom/action/date.click" : function (a, c, d) {
			c.preventDefault();
			var e = this,
			f = b(c.target);
			d ? (g.call(e, q[d], q.today), e.publish(r, s)) : (g.call(e), e.publish(r)),
			h(f)
		},
		"dom/action/custom/date.click" : function (a, c) {
			c.preventDefault();
			var d = this,
			e = b(c.target),
			f = e.closest("form"),
			i = f.find('[name="from"]').val(),
			j = f.find('[name="to"]').val(),
			k = e.closest(".dropdown");
			i && j && (g.call(d, i, j), d.publish(r, s), h(k.find("a")), k.removeClass("open"))
		},
		"dom/action/set/activity/alert.click" : function (a, b) {
			b.preventDefault();
			var c = this;
			c.publish(k)
		}
	})
}), define("troopjs-requirejs/template!app/widget/security-center/user-activity/main.html", [], function () {
	return function () {
		var a = '<div class="report-filter well well-small" data-weave="app/widget/security-center/user-activity/filter/main"></div>\n\n<table class="table table-striped table-bordered">\n    <thead>\n        <tr>\n            <th data-weave="shared/helper/translation" data-i18n="User"></th>\n            <th data-weave="shared/helper/translation" data-i18n="View candidate\'s detail"></th>\n            <th data-weave="shared/helper/translation" data-i18n="View candidate\'s attachment"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Download candidate\'s attachment"></th>\n            <th data-weave="shared/helper/translation" data-i18n="候选人列表翻页"></th>\n        </tr>\n    </thead>\n\n    <tbody>\n    </tbody>\n</table>';
		return a
	}
}), define("app/widget/security-center/user-activity/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "jquery.datatables.fixedheader"], function (a, b, c, d, e, f) {
	function g(b, d, e) {
		var f,
		g = this;
		f = '<a data-action="profile/open" href="/candidate#<id>"><name></a>',
		g.publish("ajax", {
			url : b
		}, c().done(function (b) {
				var c = a("<ul>");
				if (b.length)
					for (var g, h = b.length; h--; ) {
						var i = "";
						g = b[h],
						g.count > 1 && (i = " ×" + g.count),
						a("<li>").html(f.replace("<id>", g.id).replace("<name>", [g.englishName, g.chineseName].join(" "))).append(i).appendTo(c)
					}
				else
					a("<li>").text("没有明细!").appendTo(c);
				d.fnOpen(e, c, "detailCell")
			}))
	}
	function h(a) {
		var b = k.DETAIL.replace("<type>", a.type).replace("<id>", a.id),
		c = "&start=<start>&end=<end>";
		return a.start && a.end && (b += c.replace(/<start>/, a.start).replace(/<end>/, a.end)),
		b
	}
	function i(a) {
		var b = this;
		b.html(d, b._json, a)
	}
	function j(a) {
		var b = this;
		b.$table = b.$element.find("table").dataTable({
				bPaginate : !1,
				bAutoWidth : !1,
				sAjaxDataProp : "",
				aoColumns : l,
				sDom : "<'row'fi>t",
				fnInfoCallback : function (a, b, c, d, e) {
					return "总共: " + e + "条结果"
				},
				oLanguage : {
					sSearch : "搜索"
				}
			}),
		new f(b.$table, {
			offsetTop : 40
		}),
		a.resolve()
	}
	var k = {
		LOG : "/rest/report/operationlog",
		DETAIL : "/rest/report/operationlogdetail?type=<type>&user_id=<id>"
	},
	l = [{
			mData : null,
			mRender : function (a, b, c) {
				var d = '<a href="/user/preview#' + c.id + '" data-action="profile/open">' + c.name + "</a>";
				return d
			}
		}, {
			mData : "CandidateView",
			sType : "numeric",
			fnCreatedCell : function (b, c, d) {
				c > 0 && a(b).attr("data-action", "details/show(" + d.id + ', "CandidateView")').addClass("info")
			}
		}, {
			mData : "CandidateAttachmentView",
			sType : "numeric",
			fnCreatedCell : function (b, c, d) {
				c > 0 && a(b).attr("data-action", "details/show(" + d.id + ', "CandidateAttachmentView")').addClass("info")
			}
		}, {
			mData : "CandidateAttachmentDownload",
			bSortable : "numeric",
			fnCreatedCell : function (b, c, d) {
				c > 0 && a(b).attr("data-action", "details/show(" + d.id + ', "CandidateAttachmentDownload")').addClass("info")
			}
		}, {
			mData : "CandidateList",
			sType : "numeric"
		}
	],
	m = {
		start : null,
		end : null
	};
	return b.extend({
		"sig/initialize" : function (a, b) {
			i.call(this, b)
		},
		"sig/start" : function (a, b) {
			j.call(this, b)
		},
		"hub:memory/user-activity/set/filter" : function (b, d) {
			var e = this;
			a.extend(m, d),
			e.publish("ajax", {
				url : k.LOG,
				data : d,
				type : "get"
			}, c().done(function (a) {
					e.$table.fnClearTable(),
					e.$table.fnAddData(a),
					e.$table.fnDraw()
				}))
		},
		"dom/action.click" : a.noop,
		"dom/action/profile/open.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			f = d.attr("href");
			e.window({
				url : f,
				name : "User Profile",
				width : "1024"
			})
		},
		"dom/action/details/show.click" : function (b, c, d, e) {
			var f = this,
			i = a(c.target),
			j = i.closest("tr"),
			k = j[0],
			l = h(a.extend(m, {
						type : e,
						id : d
					}));
			f.$table.fnIsOpen(k) ? (f.$table.fnClose(k), j.data("detail") !== e ? (g.call(f, l, f.$table, k), j.data("detail", e), i.closest("td").addClass("selected").siblings().removeClass("selected")) : (j.data("detail", ""), i.removeClass("selected"))) : (g.call(f, l, f.$table, k), j.data("detail", e), i.addClass("selected").siblings().removeClass("selected"))
		}
	})
}), define("troopjs-requirejs/template!app/widget/shortlist/history.html", [], function () {
	return function (a) {
		for (var b = "", c = a.length; c--; ) {
			b += "\n";
			var d = a[c],
			e = d.type,
			f = "";
			if (e.indexOf("Email Confirm") > -1 || e.indexOf("Send Email") > -1)
				f = "label-lightblue";
			else
				switch (e) {
				case "ClientInterview":
					f = "label-blue";
					break;
				case "Note":
					f = "label-orange";
					break;
				case "Shortlist":
					f = "label-purple";
					break;
				case "CVSent":
					f = "label-blue";
					break;
				case "OfferSign":
					f = "label-pink";
					break;
				case "Onboard":
					f = "label-red";
					break;
				case "Invoice":
					f = "label-red"
				}
			if (b += "\n<dt>" + (d.targetDate || d.dateAdded) + "</dt>\n<dd>\n    <div>\n        ", "Email" === e)
				b += '\n        <span class="icon-envelope icon-blue"></span>\n        <a href="/mail/center#detail!' + d.id + '" target="_blank">[<b>' + d.subject + '</b>]</a>\n        <a href="/user/preview#' + d.user.id + '" data-action="profile/open">' + d.user.englishName + "</a>\n        ";
			else {
				if (b += "\n\n        ", "Invoice" === e ? b += '\n        <span class="label label-red">\n            <span data-weave="shared/helper/translation" data-i18n="Revenue Allocation"></span>:\n            <span data-weave="shared/helper/translation" data-i18n="Currency symbol"></span> ' + this.formatCurrency(d.invoiceAmount) + "\n        </span>\n\n        " : "ClientInterview" === e ? (b += '\n        <span class="label ' + f + '" data-weave="shared/helper/translation" data-i18n="' + "Client Interview %d Round".replace("%d", d.round) + '"></span>\n        ', d.active ? (b += "\n        ", this.isInUsers(this.userId) && (b += '\n        <button class="btn btn-mini hide send-confirm" data-action="send/confirm" data-weave="shared/helper/translation" data-i18n="Send email confirm"></button>\n        '), b += "\n        ") : b += '\n        <span class="label label-inverse" data-weave="shared/helper/translation" data-i18n="Backout"></span>\n        ', b += "\n        ", this.view || d.user.id !== this.userId || (b += '\n        <button class="btn btn-mini hide edit-interview" data-action="edit/interview(\'' + JSON.stringify(d).replace(/"/g, "$") + '\')" data-weave="shared/helper/translation" data-i18n="Edit"></button>\n        '), b += "\n\n        ") : "Note" === e ? (b += '\n        <span class="label ' + f + '" data-weave="shared/helper/translation" data-i18n="Note"></span>\n        ', d.category && (b += '\n        <span class="label" style="background-color: ' + d.category.color + ';">' + d.category.value + "</span>\n        "), b += "\n        ", d.status && (b += '\n        <span class="label" style="background-color: ' + d.status.color + ';">' + d.status.value + "</span>\n        "), b += "\n        ") : b += '\n        <span class="label ' + f + '" data-weave="shared/helper/translation" data-i18n="' + e + '"></span>\n        ', b += "\n        ", "OfferSign" !== e || this.view || (b += "\n        ", d.active || (b += '\n        <span class="label label-inverse" data-weave="shared/helper/translation" data-i18n="Backout"></span>\n        '), b += "\n        ", this.view || d.user.id !== this.userId || (b += '\n        <button class="btn btn-mini" data-weave="shared/helper/translation" data-i18n="Edit" data-action="offer/edit"></button>\n        '), b += "\n       \n        "), b += "\n        ", "Onboard" !== e || this.view || (b += "\n        ", d.user.id === this.userId && (b += '\n        <button class="btn btn-mini" data-weave="shared/helper/translation" data-i18n="Edit" data-action="onboard/edit"></button>\n        '), b += "\n        "), b += "\n        ", "Invoice" === e && (b += "\n\n        ", d.active ? (b += '\n            <span class="label ', "To be sent" == d.status ? b += "label-lightblue" : "Received" == d.status ? b += "label-red" : "Sent" == d.status && (b += "label-blue"), b += '" data-weave="shared/helper/translation" data-i18n="' + d.status + '"></span>\n            \n            ', this.view || (b += "\n                ", d.user.id === this.userId && (b += '\n                <button class="btn btn-mini" data-action="invoice/edit(' + d.id + ')" data-weave="shared/helper/translation" data-i18n="Edit Revenue Allocation"></button>\n                '), b += "\n            \n                ", "Invoice Added" == d.status ? (b += "\n                ", this.isInUsers(this.userId) && (b += '\n                <button class="btn btn-mini" data-action="send/to/finance(' + d.id + ')" data-weave="shared/helper/translation" data-i18n="Send Invoice"></button>\n                '), b += "\n                ") : (b += "\n                ", d.user.id === this.userId && (b += '\n                <button class="btn btn-mini" data-action="edit/to/finance(' + d.id + ')" data-weave="shared/helper/translation" data-i18n="Edit Invoice"></button>\n                '), b += "\n                "), b += "\n                \n            "), b += "\n        ") : b += '\n            <span class="label label-inverse" data-weave="shared/helper/translation" data-i18n="Backout"></span>\n        ', b += " \n\n        "), b += "\n        ", "Note" === e) {
					b += "\n        ";
					var g = d.category;
					b += '\n        <span class="label" style="background-color: ' + this.getCommentLblClr(g) + ';">' + this.getCommentVal(g) + "</span>\n        ",
					this.view || d.user.id != this.userId || (b += '\n        <button class="btn btn-mini" data-weave="shared/helper/translation" data-i18n="Edit" data-action="comment/edit"></button>\n        '),
					b += "\n        "
				}
				b += '\n\n        <a href="/user/preview#' + d.user.id + '" data-action="profile/open">' + d.user.englishName + "</a>\n        "
			}
			if (b += "\n    </div>\n    ", "Note" === e && d.items) {
				b += '\n    <div class="activity-detail">\n        ';
				for (var h = 0, i = d.items.length; i > h; h++)
					b += "\n        ", d.items[h].field && (b += "\n        <h4>" + d.items[h].field + "</h4>\n        "), b += "\n        <p>\n            " + this.convertText(d.items[h].value) + "\n        </p>\n        ";
				b += "\n    </div>\n    "
			}
			b += "\n</dd>\n"
		}
		return b
	}
}), define("app/widget/shortlist/history", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "shared/helper/utils", "template!./history.html"], function (a, b, c, d, e) {
	function f() {
		var a = this;
		a.publish("ajax", {
			url : h.CATEGORY
		}, c().done(function (b) {
				a._category = {},
				b.forEach(function (b) {
					a._category[b.code] = {
						value : b.value,
						color : b.color
					}
				}),
				c(function (b) {
					a.html(e, a._json, b)
				}).done(function () {
					g.call(a)
				})
			}))
	}
	function g() {
		var a = this,
		b = a.$element.find("dd"),
		c = b.length - 1;
		a.view || (a.$element.find("button.edit-interview").eq(0).removeClass("hide"), a.$element.find("button.send-confirm").eq(0).removeClass("hide")),
		a._json.forEach(function (a, d) {
			b.eq(c - d).data("json", a)
		})
	}
	var h = {
		CATEGORY : "/rest/data/options?type=candidate_note_category"
	};
	return b.extend(function (b, c, d, e) {
		this._json = d,
		this._users = function () {
			var c = [];
			return a(b).data("users") && a(b).data("users").forEach(function (a) {
				c.push(a.user.id)
			}),
			c
		}
		(),
		"view" === e && (this.view = !0)
	}, {
		"hub:memory/context" : function (a, b) {
			var c = b.user;
			this.userId = c.id,
			f.call(this)
		},
		getCommentLblClr : function (a) {
			return this._category[a] ? this._category[a].color : ""
		},
		getCommentVal : function (a) {
			return this._category[a] ? this._category[a].value : ""
		},
		isInUsers : function (a) {
			return this._users.indexOf(a) > -1
		}
	})
}), define("troopjs-requirejs/template!app/widget/shortlist/detail-item.html", [], function () {
	return function (a) {
		var b = "",
		c = a.candidate;
		a.detail;
		var d = a.joborder,
		e = d.client;
		d.clientContact;
		var f,
		g = parseInt(this._context.config.hide_contactinfo);
		switch (a.currentStatus) {
		case "Rejected":
			f = 0;
			break;
		case "Shortlist":
			f = 1;
			break;
		case "CVSent":
			f = 2;
			break;
		case "ClientInterview":
			f = 3;
			break;
		case "OfferSign":
			f = 4;
			break;
		case "Onboard":
			f = 6;
			break;
		default:
			f = 10
		}
		var h = [c.englishName, c.chineseName].join(" ");
		return b += '\r\n<div class="span4 well well-small">\r\n    ',
		a.candidate.islimited ? (b += "\r\n    <h4>ID: " + c.id + "</a></h4>\r\n    ", c.title && (b += '\r\n    <p class="searchable text">' + c.title + "</p>\r\n    "), b += "\r\n    ", c.company && (b += '\r\n    <p class="text">\r\n        <a href="/company#detail!id=' + c.company.id + '" class="searchable" target="_blank">' + c.company.name + "</a>\r\n    </p>\r\n    "), b += "\r\n    ") : (b += '\r\n    <div class="clearfix sepH_b">\r\n        <h4 class="pull-left">\r\n            ', "coldcall" === c.type && (b += '\r\n            <span class="label" data-weave="shared/helper/translation" data-i18n="Cold Call"></span>\r\n            '), b += '\r\n            <a href="/candidate#detail!id=' + c.id + '" class="searchable candidate-name ', "contact" === c.type && (b += "red"), b += '" target="_blank">' + h + '</a>\r\n        </h4>\r\n\r\n        <span class="pull-left">\r\n            <span class="dropdown" data-weave="app/widget/common/attachment-view/main(' + c.attachment_count + ", 'candidate', " + c.id + ')"></span>\r\n            \r\n            <a href="/candidate#add!id=' + c.id + '" target="_blank" class="content-actions" data-i18n="Edit" data-weave="shared/helper/translation(\'title\')"><span class="icon-edit icon-blue"></span></a>\r\n        </span>\r\n\r\n        ', this._islimited || (b += '\r\n        <input class="pull-right" name="candidates" type="checkbox" value="' + c.id + '" data-sid="' + a.id + '" data-action="shortlist/check">\r\n        '), b += "\r\n    </div>\r\n    \r\n    ", c.title && (b += '\r\n    <p class="searchable text">' + c.title + "</p>\r\n    "), b += "\r\n    ", c.company && (b += '\r\n    <p class="text">\r\n        <a href="/company#detail!id=' + c.company.id + '" class="searchable ', c.company && c.company.type && "normal" !== c.company.type && "generated" !== c.company.type && (b += "red"), b += '" target="_blank">' + c.company.name + "</a>\r\n        ", c.experience_count && (b += '\r\n        <span class="dropdown dropdown-experience">\r\n            <a href="#" data-toggle="dropdown">\r\n                (' + c.experience_count + '<span data-weave="shared/helper/translation" data-i18n="Work Experiences"></span>)\r\n            </a>\r\n            <span class="dropdown-menu widget-spin">\r\n            </span>\r\n        </span>\r\n        '), b += "\r\n    </p>\r\n    "), b += "\r\n    ", c.mobile && (b += '\r\n    <p class="searchable text">\r\n        电话:\r\n\r\n        ', g ? (b += "\r\n        ", c.mobile && (b += '\r\n        <a href="tel:' + c.mobile + '">' + c.mobile + "</a>\r\n        "), b += "\r\n        ") : (b += '\r\n        <span data-weave="shared/helper/toggle">\r\n            <a href="#" data-weave="shared/helper/translation" data-i18n="View" data-action="helper/toggle/show" class="helper-toggle-show"></a>\r\n            <span class="hide" data-toggle="view">\r\n                ', c.mobile && (b += '\r\n                <a href="tel:' + c.mobile + '">' + c.mobile + "</a>\r\n                "), b += "\r\n            </span>\r\n        </span>\r\n        "), b += '\r\n\r\n        <span data-weave="shared/helper/translation" data-i18n="Owner"></span>: <a href="/user/preview#' + c.owner.id + '" data-action="profile/open">' + c.owner.englishName + "</a>\r\n    </p>\r\n    "), b += "\r\n\r\n    "),
		b += '\r\n</div>\r\n\r\n<div class="span7">\r\n    <dl class="dl-horizontal dl-shortlist" id="' + a.id + '">\r\n        \r\n    </dl>\r\n</div>\r\n\r\n',
		this._islimited || (b += '\r\n<div class="span1">\r\n    <div class="dropdown">\r\n        <a href="javascript: void(0);" class="dropdown-toggle" data-toggle="dropdown">\r\n            <i class="icon-list-alt"></i>\r\n            <span class="caret"></span>\r\n        </a>\r\n        <ul class="dropdown-menu">\r\n            <li ', (1 > f || f >= 4) && (b += 'class="disabled"'), b += '>\r\n                <a href="#" data-action="send/cv(' + a.id + ')" data-weave="shared/helper/translation" data-i18n="Send CV to Client"></a>\r\n            </li>\r\n            <li ', (2 > f || f >= 4) && (b += 'class="disabled"'), b += ' >\r\n                <a href="#" data-action="arrange/interview(' + a.id + ", '" + h + '\')" data-weave="shared/helper/translation" data-i18n="Arrange Client Interview"></a>\r\n            </li>\r\n\r\n            <li ', (3 > f || f >= 4) && (b += 'class="disabled"'), b += ' >\r\n                <a href="#" data-action="offer/signed(' + a.id + ", '" + h + '\')" data-weave="shared/helper/translation" data-i18n="Offer Signed"></a>\r\n            </li>\r\n\r\n            <li ', 4 > f && (b += 'class="disabled"'), b += ' >\r\n                <a href="#" data-action="allocation/revenue(' + c.id + ')" data-weave="shared/helper/translation" data-i18n="Revenue Allocation"></a>\r\n            </li>\r\n\r\n            <li ', (4 > f || 6 === f) && (b += 'class="disabled"'), b += '>\r\n                <a href="#" data-action="onboard(' + a.id + ", '" + h + '\')" data-weave="shared/helper/translation" data-i18n="Onboard"></a>\r\n            </li>\r\n            <li class="divider"></li>\r\n\r\n            <li class="always">\r\n                <a href="#" data-action="comment/add" data-weave="shared/helper/translation" data-i18n="Add notes"></a>\r\n            </li>\r\n            <li class="always">\r\n                <a href="#" data-action="send/email(\'' + h + "', '" + c.email + "', " + e.id + ", " + c.id + ", " + d.id + ')" data-weave="shared/helper/translation" data-i18n="Email"></a>\r\n            </li>\r\n            ', 1 === f && (b += '\r\n            <li class="divider"></li>\r\n            <li>\r\n                <a href="#" data-action="remove/from/job" data-weave="shared/helper/translation" data-i18n="Remove from job"></a>\r\n            </li>\r\n            '), b += "\r\n        </ul>\r\n    </div> \r\n</div>\r\n"),
		b
	}
}), define("troopjs-requirejs/template!app/widget/shortlist/list-item.html", [], function () {
	return function (a) {
		var b = "",
		c = a.candidate;
		a.detail;
		var d = a.joborder,
		e = d.client;
		d.clientContact;
		var f,
		g = parseInt(this._context.config.hide_contactinfo);
		switch (a.currentStatus) {
		case "Rejected":
			f = 0;
			break;
		case "Shortlist":
			f = 1;
			break;
		case "CVSent":
			f = 2;
			break;
		case "ClientInterview":
			f = 3;
			break;
		case "OfferSign":
			f = 4;
			break;
		case "Onboard":
			f = 6;
			break;
		default:
			f = 10
		}
		var h = [c.englishName, c.chineseName].join(" "),
		i = a.currentStatus;
		if (b += "\n<td>\n    ", this._islimited || (b += '\n    <input class="pull-right" name="candidates" type="checkbox" value="' + c.id + '" data-sid="' + a.id + '" data-action="shortlist/check">\n    '), b += "\n</td>\n<td>\n    ", "coldcall" === c.type && (b += '\n    <span class="label" data-weave="shared/helper/translation" data-i18n="Cold Call"></span>\n    '), b += "\n    ", c.islimited ? b += "\n    ID: " + c.id + "\n    " : (b += '\n        <a href="/candidate#detail!id=' + c.id + '" class="searchable candidate-name ', "contact" === c.type && (b += "red"), b += '" target="_blank">' + h + "</a>\n    "), b += "\n</td>\n<td>\n    ", c.islimited || (b += '\n    <span class="dropdown pull-left" data-weave="app/widget/common/attachment-view/main(' + c.attachment_count + ", 'candidate', " + c.id + ')"></span>\n    '), b += "\n</td>\n<td>\n    ", g ? (b += "\n    ", c.mobile && (b += '\n    <a href="tel:' + c.mobile + '">' + c.mobile + "</a>\n    "), b += "\n    ") : (b += '\n    <span data-weave="shared/helper/toggle">\n        <a href="#" data-weave="shared/helper/translation" data-i18n="View" data-action="helper/toggle/show" class="helper-toggle-show"></a>\n        <span class="hide" data-toggle="view">\n            ', c.mobile && (b += '\n            <a href="tel:' + c.mobile + '">' + c.mobile + "</a>\n            "), b += "\n        </span>\n    </span>\n    "), b += "\n</td>\n<td>\n    ", c.company && (b += '\n    <p class="fixed-width" title="' + c.company.name + '"><a href="/company#detail!id=' + c.company.id + '" class="searchable ', c.company && c.company.type && "normal" !== c.company.type && "generated" !== c.company.type && (b += "red"), b += '" target="_blank">' + c.company.name + "</a></p>\n    "), b += "\n</td>\n<td>\n    ", c.title && (b += '\n    <p class="fixed-width" title="' + c.title + '"><span class="searchable">' + c.title + "</span></p>\n    "), b += '\n</td>\n<td class="status">\n    ', "ClientInterview" === i) {
			b += "\n    ";
			for (var j = 1, k = a.detail.length; --k; )
				if ("ClientInterview" === a.detail[k].type) {
					j = a.detail[k].round;
					break
				}
			b += '\n    <span class="label ' + this.getLabelColor(i) + '" data-weave="shared/helper/translation" data-i18n="' + "Client Interview %d Round".replace("%d", j) + '"></span>\n    '
		} else
			b += '\n    <span class="label ' + this.getLabelColor(i) + '" data-weave="shared/helper/translation" data-i18n="' + i + '"></span>\n    ';
		return b += '\n</td>\n<td>\n    <a href="/user/preview#' + a.candidate.owner.id + '" data-action="profile/open">' + a.detail[0].user.englishName + "</a>\n</td>\n<td>\n    ",
		this._islimited || (b += '\n    <div class="dropdown">\n        <a href="javascript: void(0);" class="dropdown-toggle" data-toggle="dropdown">\n            <i class="icon-list-alt"></i>\n            <span class="caret"></span>\n        </a>\n        <ul class="dropdown-menu">\n            <li>\n                <a href="/candidate#add!id=' + a.candidate.id + '" target="_blank" data-weave="shared/helper/translation" data-i18n="Edit People"></a>\n            </li>\n            <li class="divider"></li>\n            <li ', (1 > f || f >= 4) && (b += 'class="disabled"'), b += '>\n                <a href="#" data-action="send/cv(' + a.id + ')" data-weave="shared/helper/translation" data-i18n="Send CV to Client"></a>\n            </li>\n            <li ', (2 > f || f >= 4) && (b += 'class="disabled"'), b += ' >\n                <a href="#" data-action="arrange/interview(' + a.id + ", '" + h + '\')" data-weave="shared/helper/translation" data-i18n="Arrange Client Interview"></a>\n            </li>\n\n            <li ', (3 > f || f >= 4) && (b += 'class="disabled"'), b += ' >\n                <a href="#" data-action="offer/signed(' + a.id + ", '" + h + '\')" data-weave="shared/helper/translation" data-i18n="Offer Signed"></a>\n            </li>\n\n            <li ', 4 > f && (b += 'class="disabled"'), b += ' >\n                <a href="#" data-action="allocation/revenue(' + c.id + ')" data-weave="shared/helper/translation" data-i18n="Revenue Allocation"></a>\n            </li>\n\n            <li ', (4 > f || 6 === f) && (b += 'class="disabled"'), b += '>\n                <a href="#" data-action="onboard(' + a.id + ", '" + h + '\')" data-weave="shared/helper/translation" data-i18n="Onboard"></a>\n            </li>\n            <li class="divider"></li>\n\n            <li class="always">\n                <a href="#" data-action="comment/add" data-weave="shared/helper/translation" data-i18n="Add notes"></a>\n            </li>\n            <li class="always">\n                <a href="#" data-action="send/email(\'' + h + "', '" + c.email + "', " + e.id + ", " + c.id + ", " + d.id + ')" data-weave="shared/helper/translation" data-i18n="Email"></a>\n            </li>\n            ', 1 === f && (b += '\n            <li class="divider"></li>\n            <li>\n                <a href="#" data-action="remove/from/job" data-weave="shared/helper/translation" data-i18n="Remove from job"></a>\n            </li>\n            '), b += "\n        </ul>\n    </div> \n    "),
		b += "\n</td>"
	}
}), define("app/widget/shortlist/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "shared/helper/utils", "template!./detail-item.html", "template!./history.html", "template!./list-item.html", "shared/helper/blurb"], function (a, b, c, d, e, f, g, h) {
	function i() {
		var a = this;
		a.publish("ajax", {
			url : l.SHORTLIST.replace("<id>", a._json.joborder.id).replace("<sid>", a._json.id)
		}, c().done(function (b) {
				if ("started" === a.phase) {
					b.joborder = a._json.joborder,
					a._json = b;
					var d = a.$element.data("status");
					"OfferSign" !== d && "Invoice" !== d && "Onboard" !== d && (a.publish("job/live-job/update/count", d, b.currentStatus), a.$element.data("status", b.currentStatus)),
					c(function (b) {
						j.call(a, b)
					}).done(function () {
						k.call(a)
					})
				}
			}))
	}
	function j(a) {
		var b = this;
		c(function (a) {
			b.viewType ? b.html(g, b._json, a) : b.html(e, b._json, a)
		}).done(function () {
			a && k.call(b, a)
		})
	}
	function k(b) {
		var d = this;
		d.$dropdown = d.$element.find("button.dropdown-toggle"),
		d.$history = d.$element.find(".dl-horizontal"),
		d.$checkbox = d.$element.find('[data-action="shortlist/check"]').data("json", d._json),
		b = b || c(),
		b.done(function () {
			d._json.candidate.islimited && d.$element.find(".btn-group").remove(),
			d._islimited && d.$element.find("button").remove()
		}),
		"OfferSign" === d._json.currentStatus || "Invoice" === d._json.currentStatus || "Onboard" === d._json.currentStatus ? d.$element.attr("data-status", "offer") : d.$element.attr("data-status", d._json.currentStatus),
		d.$element.find(".dropdown-experience").one("show", function () {
			a(this).find(".dropdown-menu").data("id", d._json.candidate.id).attr("data-weave", m + "(id)").weave()
		});
		var e,
		f,
		g,
		h,
		i;
		d.$element.on("mouseenter", "a.candidate-name", function (b) {
			var c = a(b.target);
			"A" !== c.prop("tagName") && (c = c.closest("a")),
			c.closest(".slide-helper").length || (h = function (b) {
				clearTimeout(f),
				a(this).off(b)
			}, i = function (b) {
				g = setTimeout(function () {
						d.publish("slide-helper/detail/close"),
						a(this).off(b)
					}, 600)
			}, a(".slide-helper").off("mouseenter.helper", h).off("mouseleave.helper", i), clearTimeout(e), clearTimeout(f), clearTimeout(g), e = setTimeout(function () {
						d.publish("slide-helper/detail/reload", d._json.candidate.id, "candidate")
					}, 500), c.on("mouseleave", function (b) {
					clearTimeout(e),
					f = setTimeout(function () {
							d.publish("slide-helper/detail/close"),
							a(".slide-helper").off("mouseenter.helper", h).off("mouseleave.helper", i)
						}, 600),
					a(".slide-helper").on("mouseenter.helper", h).on("mouseleave.helper", i),
					c.off(b)
				}))
		}),
		d.$history.data("json", d._json.detail).data("users", d._json.joborder.users).attr("data-weave", "app/widget/shortlist/history(json)").weave(b)
	}
	var l = {
		SEND_CV : "/rest/joborder/<id>/sendcvstoclient",
		SAVE_INVOICE : "/rest/joborder/shortlist/<id>/addinvoice",
		LOAD_INVOICES : "/rest/invoice/list?paginate_by=1000&active__eq=1&jobsubmission__id__eq=<id>",
		EMAIL_TO_CANDIDATE : "/rest/joborder/shortlist/<sid>/emailtocandidate",
		SHORTLIST : "/rest/joborder/<id>/shortlist/<sid>",
		REMOVE : "/rest/joborder/<id>/shortlist/del"
	},
	m = "app/widget/candidate/work-experience/main",
	n = {
		email1 : h.t("Work email")
	};
	return b.extend(function (a, b, c, d, e) {
		var f = c.joborder.users;
		this._json = c,
		this._islimited = d,
		this.currentStatus = c.currentStatus,
		this.viewType = e,
		this.mainConsultant = function () {
			for (var a, b = f.length; b--; )
				if ("Main Consultant" === f[b].type) {
					a = f[b];
					break
				}
			return a
		}
		(),
		this.consultants = function () {
			for (var a = [], b = f.length; b--; ) {
				var c = f[b].user;
				a.filter(function (a) {
					return a.id === c.id
				}).length || a.push({
					id : c.id,
					name : c.englishName
				})
			}
			return a
		}
		()
	}, {
		"hub:memory/context" : function (a, b) {
			var d = this;
			d._context = b,
			j.call(d, c())
		},
		"hub/list/check/all" : function () {
			var a = this;
			a.$element.is(":hidden") || a.$checkbox.filter(":not(:disabled)").prop("checked", !0)
		},
		"hub/list/uncheck/all" : function () {
			var a = this;
			a.$element.is(":hidden") || a.$checkbox.filter(":not(:disabled)").prop("checked", !1)
		},
		"dom/action.click.mouseover.mouseout" : a.noop,
		"dom/action/send/cv.click" : function (b, c, e) {
			c.preventDefault();
			var f = this,
			g = a(c.target),
			h = g.closest("li"),
			j = l.SEND_CV.replace("<id>", f._json.joborder.id);
			if (h.hasClass("disabled"))
				return c.preventDefault(), void 0;
			var k,
			m,
			o = f._json,
			p = o.joborder.contacts,
			q = [],
			r = [],
			s = [];
			p.forEach(function (a) {
				var b,
				c,
				d = a.clientContact;
				m = [d.englishName, d.chineseName].join(" ").trim(),
				d.email ? (b = "email", c = d.email) : d.email1 ? (b = "email1", c = d.email1) : d.email2 && (b = "email2", c = d.email2),
				c ? (k || (k = d.id), q.push('"' + m + '" [' + n.email1 + "]"), r.push(c)) : s.push('<a href="/candidate#detail!id=' + d.id + '" target="_blank">' + m + "</a>")
			}),
			s.length && d.alert("info", "以下人才没有邮箱:<br>" + s.join(", "));
			var t = [];
			f.consultants.forEach(function (a) {
				t.push({
					id : a.id,
					text : a.name
				})
			}),
			f.publish("modal/sendemail/show", {
				parseEmail : !0,
				individually : !1,
				sender : t,
				myId : f._context.user.id,
				names : q,
				emails : r,
				sids : [o.id],
				cvSendUrl : j,
				emailTemplate : "cv_sent",
				category : "CV Sent",
				type : "cv_sent",
				jobsubmissionId : e,
				onSuccess : function () {
					i.call(f)
				},
				skipSend : !0,
				attachment : {
					candidate : o.candidate.id
				},
				checkAttachment : !0,
				templateVariable : {
					candidate_id : o.candidate.id,
					clientcontact_id : k,
					job_id : o.joborder.id
				}
			})
		},
		"dom/action/arrange/interview.click" : function (b, c, e, f) {
			c.preventDefault();
			var g = this,
			h = a(c.target),
			j = h.closest("li");
			if (j.hasClass("disabled"))
				return c.preventDefault(), void 0;
			var k = g._json,
			l = k.candidate,
			m = k.joborder,
			n = k.joborder.contacts,
			o = [],
			p = [],
			q = [];
			n.forEach(function (a) {
				var b = a.clientContact;
				q.push(b.id),
				o.push([b.englishName, b.chineseName].join(" ").trim()),
				p.push(b.email)
			}),
			g.publish("modal/interview/show", {
				id : e,
				sid : k.id,
				name : f,
				onSuccess : function (a) {
					a.status ? i.call(g) : d.alert("error", a.message)
				},
				jobsubmissionId : k.id,
				jobid : m.id,
				client : {
					id : m.client.id,
					contact : {
						ids : q,
						names : o,
						emails : p
					}
				},
				candidate : {
					id : l.id,
					name : [l.englishName, l.chineseName].join(" "),
					email : l.email
				}
			})
		},
		"dom/action/offer/signed.click" : function (b, c, e, f) {
			c.preventDefault();
			var g = this,
			h = a(c.target),
			j = h.closest("li"),
			k = g.mainConsultant ? g.mainConsultant.user.id : null;
			return j.hasClass("disabled") ? (c.preventDefault(), void 0) : (g.publish("modal/offersigned/show", {
					id : e,
					name : f,
					userlist : g.consultants,
					mainConsultantId : k,
					onSuccess : function (a) {
						a.status ? i.call(g) : d.alert("error")
					}
				}), void 0)
		},
		"dom/action/allocation/revenue.click" : function (b, d, e) {
			d.preventDefault();
			var f = this,
			g = a(d.target),
			h = g.closest("li"),
			j = function () {
				i.call(f)
			};
			return h.hasClass("disabled") ? (d.preventDefault(), void 0) : (f.publish("job/set/jobAttr", f), f.publish("ajax", {
					url : l.LOAD_INVOICES.replace("<id>", f._json.id)
				}, c().done(function (a) {
						a.list.length ? f.publish("modal/invoice-alert/show", {
							id : f._json.id,
							owner : f._json.candidate.owner,
							invoices : a.list,
							name : name,
							candidateId : e,
							onSuccess : j
						}) : f.publish("job/item/open/invoice/modal", {
							id : f._json.id,
							owner : f._json.candidate.owner,
							candidateId : e,
							onSuccess : j
						})
					})), void 0)
		},
		"dom/action/invoice/edit.click" : function (b, c, d) {
			c.preventDefault();
			var e = this;
			a(c.target),
			e.publish("job/set/jobAttr", e);
			var f = l.SAVE_INVOICE.replace("<id>", e._json.id);
			e.publish("modal/allocation-revenue/show", {
				saveUrl : f,
				jobAttr : e.jobAttr,
				onSuccess : a.noop,
				invoiceId : d,
				operator : "consultant"
			})
		},
		"dom/action/onboard.click" : function (b, c, e, f) {
			c.preventDefault();
			var g = this,
			h = a(c.target),
			j = h.closest("li");
			return j.hasClass("disabled") ? (c.preventDefault(), void 0) : (e ? g.publish("modal/onboard/show", {
					id : e,
					name : f,
					onSuccess : function () {
						i.call(g)
					}
				}) : d.alert("error", "对不起，信息有丢失，请刷新页面后重试！"), void 0)
		},
		"dom/action/comment/add.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target);
			e.closest("li");
			var f = d._json;
			d.publish("modal/add-note/show", {
				externalType : "candidate",
				optionType : "jobsubmission_note_category",
				id : f.candidate.id,
				jobsubmissionId : d._json.id,
				onSuccess : function () {
					i.call(d)
				}
			})
		},
		"dom/action/comment/edit.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target);
			e.closest("li");
			var f = d._json;
			d.publish("modal/add-note/show", {
				externalType : "candidate",
				optionType : "jobsubmission_note_category",
				id : f.id,
				data : e.closest("dd").data("json"),
				jobsubmissionId : d._json.id,
				onSuccess : function () {
					i.call(d)
				}
			})
		},
		"dom/action/send/email.click" : function (a, b, c, d, e, f, g) {
			b.preventDefault();
			var h = this;
			h.publish("modal/sendemail/show", {
				names : [c],
				emails : [d],
				emailTemplate : "candidate_email",
				category : "emailtocandidate",
				jobsubmissionId : h._json.id,
				onSuccess : function () {
					i.call(h)
				},
				attachment : {
					joborder : g,
					clientcompany : e
				},
				templateVariable : {
					candidate_id : f,
					job_id : g
				}
			})
		},
		"dom/action/send/to/finance.click" : function (b, c, d) {
			c.preventDefault();
			var e = this;
			a(c.target);
			var f = e._json;
			e.publish("job/set/jobAttr", e);
			var g = e._json.detail.filter(function (a) {
					return "OfferSign" === a.type
				});
			g = g[g.length - 1],
			e.publish("modal/invoice-finance/show", {
				name : [f.candidate.chineseName, f.candidate.englishName].join(" ").trim(),
				jobAttr : e.jobAttr,
				onSuccess : function () {
					i.call(e)
				},
				invoiceId : d,
				offerInfo : g,
				operator : "consultant"
			})
		},
		"dom/action/edit/to/finance.click" : function (b, d, e) {
			d.preventDefault();
			var f = this;
			a(d.target);
			var g = f._json,
			h = f._json.detail.filter(function (a) {
					return "OfferSign" === a.type
				});
			h = h[h.length - 1],
			f.publish("ajax", {
				url : "/rest/invoice/" + e
			}, c().done(function (a) {
					f.publish("modal/invoice-finance/show", {
						name : [g.candidate.chineseName, g.candidate.englishName].join(" ").trim(),
						invoiceId : e,
						data : a,
						operator : "consultant",
						offerInfo : h,
						onSuccess : function () {
							i.call(f)
						}
					})
				}))
		},
		"dom/action/open/profile.click" : function (b, c) {
			c.preventDefault();
			var e = a(c.target),
			f = e.attr("href");
			d.window({
				url : f,
				name : "User Profile",
				width : "1024"
			})
		},
		"dom/action/edit/interview.click" : function (b, c, d) {
			c.preventDefault();
			var e = this;
			a(c.target);
			var f = e._json,
			g = f.candidate,
			h = f.joborder;
			e.publish("modal/interview/show", {
				id : e._json.id,
				data : JSON.parse(d.replace(/\$/g, '"')),
				name : [g.chineseName, g.englishName].join(" ").trim(),
				onSuccess : function () {
					i.call(e)
				},
				client : {
					id : h.client.id
				}
			})
		},
		"dom/action/offer/edit.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target),
			f = d._json;
			d.publish("modal/offersigned/show", {
				id : f.id,
				name : [f.candidate.chineseName, f.candidate.englishName].join(" ").trim(),
				detail : e.closest("dd").data("json"),
				userlist : d.consultants,
				onSuccess : function () {
					i.call(d)
				}
			})
		},
		"dom/action/onboard/edit.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target),
			f = d._json;
			d.publish("modal/onboard/show", {
				id : f.id,
				name : [f.candidate.chineseName, f.candidate.englishName].join(" ").trim(),
				detail : e.closest("dd").data("json"),
				onSuccess : function () {
					i.call(d)
				}
			})
		},
		"dom/action/remove/from/job.click" : function (b, e) {
			e.preventDefault();
			var f = this,
			g = a(e.target),
			h = window.confirm("确定要将该候选人从项目中移出吗?");
			h && f.publish("ajax", {
				url : l.REMOVE.replace("<id>", f._json.joborder.id),
				type : "post",
				data : {
					data : JSON.stringify({
						candidate_ids : [f._json.candidate.id]
					})
				}
			}, c().done(function (a) {
					a.status ? (d.alert("success", "移除成功"), g.closest(".shortlist-steps").remove()) : d.alert("error", a.message)
				}))
		},
		"dom/action/profile/open.click" : function (b, c) {
			c.preventDefault();
			var e = a(c.target),
			f = e.attr("href");
			d.window({
				url : f,
				name : "User Profile",
				width : "1024"
			})
		},
		"dom/action/shortlist/check.click" : function () {
			var a = this;
			a.publish("shortlist/toggle/mass/action")
		},
		"dom/action/send/confirm.click" : function () {
			var a = this,
			b = a._json,
			c = b.candidate,
			d = b.joborder,
			e = b.joborder.contacts,
			f = [],
			g = [],
			h = [],
			i = [];
			e.forEach(function (a) {
				var b,
				c = a.clientContact;
				h.push(c.id),
				f.push([c.englishName, c.chineseName].join(" ").trim()),
				c.email ? (b = c.email, i.push("email")) : c.email1 ? (b = c.email1, i.push("email1")) : c.email2 && (b = c.email2, i.push("email2")),
				g.push(b)
			}),
			a.publish("modal/email/confirm/show", {
				client : {
					id : d.client.id,
					contact : {
						ids : h,
						names : f,
						emails : g,
						types : i
					}
				},
				candidate : {
					id : c.id,
					name : [c.englishName, c.chineseName].join(" "),
					email : c.email
				},
				jobid : d.id,
				sid : a._json.id,
				jobsubmissionId : a._json.id
			})
		},
		getLabelColor : function (a) {
			var b = "";
			if (a.indexOf("Email Confirm") > -1 || a.indexOf("Send Email") > -1)
				b = "label-lightblue";
			else
				switch (a) {
				case "ClientInterview":
					b = "label-blue";
					break;
				case "Comment":
					b = "label-orange";
					break;
				case "Shortlist":
					b = "label-purple";
					break;
				case "CVSent":
					b = "label-blue";
					break;
				case "OfferSign":
					b = "label-pink";
					break;
				case "Onboard":
					b = "label-red";
					break;
				case "Rejected":
					b = "label-inverse";
					break;
				case "Invoice":
					b = "label-red"
				}
			return b
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/attachment-type/main.html", [], function () {
	return function () {
		var a = '<h3 class="heading">附件: 类型设置</h3>\n\n<ul class="nav nav-tabs" id="myTab">\n    <li class="active"><a data-toggle="tab" href="#people-tab" data-weave="shared/helper/translation" data-i18n="人才附件"></a></li>\n    <li><a data-toggle="tab" href="#company-tab" data-weave="shared/helper/translation" data-i18n="公司附件"></a></li>\n    <li><a data-toggle="tab" href="#job-tab" data-weave="shared/helper/translation" data-i18n="项目附件"></a></li>\n</ul>\n\n<div class="tab-content">\n    <div class="tab-pane active" id="people-tab" data-weave="app/widget/system/attachment-type/tab/main(\'candidate_attachment_category\')"></div>\n\n    <div class="tab-pane" id="company-tab"></div>\n\n    <div class="tab-pane" id="job-tab"></div>\n</div>';
		return a
	}
}), define("app/widget/system/attachment-type/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		b.html(d, a)
	}
	function f(a) {
		var b = this,
		c = b.$element;
		c.find('a[href="#company-tab"]').one("show", function () {
			c.find("#company-tab").attr("data-weave", g + '("client_attachment_category")').weave()
		}),
		c.find('a[href="#job-tab"]').one("show", function () {
			c.find("#job-tab").attr("data-weave", g + '("joborder_attachment_category")').weave()
		}),
		a.resolve()
	}
	var g = "app/widget/system/attachment-type/tab/main";
	return b.extend({
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		},
		"sig/start" : function (a, b) {
			f.call(this, b)
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/attachment-type/tab/item.html", [], function () {
	return function (a) {
		var b = "",
		c = this.randomKey();
		return b += '\n<div class="control-group">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="Category"></span>\n    </label>\n    <div class="controls">\n        <input type="text" name="en_US-' + c + '" class="input-medium required" value="' + (a.en_US || "") + '" placeholder="English" ',
		a.en_US && (b += "readonly='readonly'"),
		b += '>\n        <input type="text" name="zh_CN-' + c + '" class="input-medium required" value="' + (a.zh_CN || "") + '" placeholder="中文">\n        \n        <div class="pull-right actions">\n            ',
		a.code && (b += '\n            <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="转移到..." data-action="transfer/category"></button>\n            '),
		b += '\n            <button class="btn btn-small btn-danger" data-weave="shared/helper/translation" data-i18n="Delete category" data-action="delete/category"></button>\n            <span class="handler"><span class="icon-move-ns icon-blue"></span></span>\n        </div>\n    </div>\n</div>\n<div class="control-group">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="标签背景色"></span>\n    </label>\n    <div class="controls">\n        <input type="color" name="color" class="input-mini" value="' + a.color + '">\n    </div>\n</div>'
	}
}), define("app/widget/system/attachment-type/tab/item", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./item.html", "shared/helper/utils"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		c(function (a) {
			b.html(d, b._json, a)
		}).done(function () {
			b.$element.find('[data-action="delete/question"]').eq(0).remove(),
			a.resolve()
		})
	}
	return b.extend(function (a, b, c) {
		this._json = c || {}

	}, {
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		},
		"dom/action.click" : a.noop,
		"dom/action/transfer/category" : function (b, c) {
			c.preventDefault();
			var d = this;
			a(c.target);
			var e = {};
			d.publish("system/get/data", e),
			d.publish("system/modal/merge-node/show", {
				type : e.type,
				selected : {
					id : d._json.code,
					name : d._json.value
				},
				data : e.data,
				onSuccess : function () {}

			})
		},
		"dom/action/delete/category" : function (b, c) {
			c.preventDefault();
			var d = this;
			a(c.target);
			var e = window.confirm("确认要删除此类型吗?");
			e && d.$element.remove()
		},
		randomKey : function () {
			return parseInt(1e5 * Math.random(), 10)
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/attachment-type/tab/main.html", [], function () {
	return function () {
		var a = '<form action="#" class="form-horizontal">\n    <div class="control-group">\n        <label class="control-label">\n            <a href="#" data-weave="shared/helper/translation" data-i18n="新增类型" data-action="add/category"></a>\n        </label>\n    </div>\n\n    <div class="control-group">\n        <div class="controls">\n            <button class="btn btn-primary" data-weave="shared/helper/translation" data-i18n="Save" data-action="save"></button>\n        </div>\n    </div>\n    \n</form>';
		return a
	}
}), define("app/widget/system/attachment-type/tab/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "shared/helper/validate", "jquery.ui"], function (a, b, c, d, e, f) {
	function g(b) {
		var e = this;
		e.html(d, e._json, b),
		e.publish("ajax", {
			url : i.CONFIG_KEYS.replace("<type>", e._type),
			cache : !1
		}, c().done(function (b) {
				e._json = b,
				b.forEach(function (b) {
					var d = a('<div class="category-block"></div>');
					d.data("json", b).attr("data-weave", j + "(json)").weave(c(function () {
							e.$element.find('[data-action="add/category"]').closest(".control-group").before(d)
						}))
				})
			}))
	}
	function h(a) {
		var b = this;
		b.$form = b.$element.find("form"),
		b.$form.sortable({
			items : ".category-block",
			handle : ".handler",
			cursor : "move",
			axis : "y"
		}),
		f(b.$form),
		a.resolve()
	}
	var i = {
		CONFIG_KEYS : "/rest/data/options?type=<type>",
		CONFIG_ADD : "/rest/data/options/add"
	},
	j = "app/widget/system/attachment-type/tab/item";
	return b.extend(function (a, b, c) {
		this._type = c
	}, {
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"sig/start" : function (a, b) {
			h.call(this, b)
		},
		"dom/action.click" : a.noop,
		"dom/action/add/category.click" : function (b, d) {
			d.preventDefault();
			var e = a(d.target),
			f = a('<div class="category-block"></div>');
			f.attr("data-weave", j).weave(c(function () {
					e.closest(".control-group").before(f)
				}))
		},
		"dom/action/save.click" : function (b, d) {
			d.preventDefault();
			var f = this,
			g = a(d.target),
			h = {},
			j = [];
			return g.hasClass("disabled") || !f.$form.valid() ? !1 : (g.addClass("disabled"), f.$element.find(".category-block").each(function () {
					var b = a(this),
					c = [];
					b.find('[name*="question"]').each(function () {
						a(this),
						c.push({
							field : a(this).val().trim(),
							required : !0
						})
					}),
					j.push({
						code : b.find('[name*="en_US"]').val().trim(),
						zh_CN : b.find('[name*="zh_CN"]').val().trim(),
						en_US : b.find('[name*="en_US"]').val().trim(),
						color : b.find('[name*="color"]').val() || "",
						is_buildin : !1,
						ext : JSON.stringify(c)
					})
				}), h = {
					type : f._type,
					values : j
				}, f.publish("ajax", {
					url : i.CONFIG_ADD,
					data : {
						data : JSON.stringify(h)
					},
					type : "post"
				}, c().done(function (a) {
						a.status ? (e.alert("success", "保存成功!"), a.data && a.data.length && e.alert("info", a.data.join(", ") + "已经被关联，请刷新页面，并选择“转移到”，将关联数据移除后再删除！")) : e.alert("error", a.message)
					}).always(function () {
						g.removeClass("disabled")
					})), void 0)
		},
		"hub/system/get/data" : function (b, c) {
			var d = this;
			c.type = d._type,
			c.data = [],
			d.$element.find(".category-block").each(function () {
				var b = a(this);
				c.data.push({
					id : b.find('[name*="en_US"]').val().trim(),
					label : b.find('[name*="zh_CN"]').val().trim()
				})
			})
		}
	})
}), define("app/widget/system/base/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "shared/helper/utils", "shared/helper/blurb"], function (a, b, c, d, e) {
	function f(b, c, d, e, f) {
		for (var g, h, i = 0, j = f.length; j > i; i += 1)
			h = f[i], e && h.parent_id != ("null" === e ? null : e) || (g = h.content || h.value, c = a("<option>").val(h.id).text(h.name).data("text", g), h.title && c.data("title", h.title), c.appendTo(d));
		b.replaceWith(d)
	}
	function g(b, d, e) {
		var g = this,
		h = b.clone().empty(),
		i = a("<option>").val("").text(p.PLEASE_SELECT).prop("disabled", !0).prop("selected", !0);
		g.publish("ajax", {
			url : d,
			type : "get",
			cache : !1
		}, c().done(function (a) {
				i.appendTo(h),
				d.match(/emailtemplate/) ? g._personal ? f(b, i, h, e, a.user) : f(b, i, h, e, a.system) : f(b, i, h, e, a)
			}))
	}
	function h(a, b) {
		for (var c, d = JSON.parse(b), e = 0, f = d.length; f > e; e++)
			c = '<div class="controls"><input disabled="disabled" data-pairs="name" type="text" value="' + d[e].name + '" placeholder="链接名称"> <input data-pairs="value" disabled="disabled" type="text" value="' + d[e].value + '" placeholder="http://"> <a class="hide" href="#" data-action="remove/field"><span class="icon-remove"></span></a></div>', a.before(c)
	}
	function i() {
		var a = this,
		b = Array.prototype.slice.call(arguments).join(",");
		a.publish("ajax", {
			url : o.CONFIG_KEYS.replace("<keys>", b),
			type : "get",
			cache : !1
		}, c().done(function (a) {
				j(a)
			}))
	}
	function j(b) {
		for (var c, e, f, g = 0, i = b.length; i > g; g += 1)
			switch (e = b[g], c = a("[name=" + e.name + "]"), c.data("id", e.id), f = c.attr("type").toLowerCase()) {
			case "text":
				c.val(e.value);
				break;
			case "radio":
				c.filter("[value=" + e.value.toLowerCase() + "]").prop("checked", !0);
				break;
			case "pairs":
				h(c.closest(".controls"), e.value);
				break;
			default:
				d.alert("error", "Bind config keys error.")
			}
	}
	function k(b, c, e, f, g) {
		if (f === g)
			d.alert("info", "Nothing changed at all !!!");
		else {
			var h = {
				id : b,
				type : c,
				name : e,
				value : f
			};
			f = isNaN(f) ? f : 1 === parseInt(f, 10) ? "True" : "False",
			a.ajax({
				url : o.CONFIG_ADD,
				data : {
					data : JSON.stringify(h)
				},
				type : "post"
			}).done(function (a) {
				a.status ? d.alert("success", "保存成功!") : d.alert("error", a.message)
			}).fail(function (a) {
				d.alert("error", JSON.parse(a.responseText).message)
			})
		}
	}
	function l(b, c) {
		var d = a(b.target).closest(".controls");
		d.find("select").toggleClass("hide"),
		d.find("input").val(c).toggleClass("hide"),
		d.find("button.action").toggleClass("hide"),
		b.preventDefault()
	}
	function m(b) {
		var c = a(b.target).closest(".controls"),
		d = c.find("input").prop("disabled");
		c.find("input").prop("disabled", !d),
		c.find("button").toggleClass("hide"),
		b.preventDefault()
	}
	function n(b) {
		var c = this,
		d = [];
		a(".load-key").each(function () {
			d.push(this.name)
		}),
		i.call(c, d.join(",")),
		a(".load-dropdown").each(function () {
			var b = this.name,
			d = a(this),
			e = d.data("type");
			"function" === this.name || "industry" === this.name ? g.call(c, a(this), o[e.toUpperCase()].replace("<type>", b), "null") : g.call(c, a(this), o[e.toUpperCase()].replace("<type>", b))
		}),
		b.resolve()
	}
	var o = {
		CONFIG_ADD : "/rest/data/configvalue/add",
		CONFIG_DEL : "/rest/data/configvalue/del",
		CONFIG_KEYS : "/rest/data/configvalue?keys=<keys>",
		CONFIG : "/rest/data/configvalue?type=<type>",
		LIST_ADD : "/rest/data/<type>/add",
		LIST_DEL : "/rest/data/<type>/del",
		LIST : "/rest/data/<type>/list",
		EMAIL_ADD : "/rest/data/emailtemplate/add",
		EMAIL_DEL : "/rest/data/emailtemplate/del",
		EMAIL : "/rest/data/emailtemplate/<type>"
	},
	p = {
		PLEASE_SELECT : e.t("Please select")
	};
	return b.extend({
		"sig/start" : function (a, b) {
			n.call(this, b)
		},
		"dom/action.click.change" : a.noop,
		"dom/action/setting/textbox/edit.click" : function (b, c) {
			var d = a(c.target).closest(".controls").find("input"),
			e = d.val();
			d.data("original", e),
			m(c)
		},
		"dom/action/setting/textbox/cancel.click" : function (a, b) {
			m(b)
		},
		"dom/action/setting/textbox/save.click" : function (b, c) {
			var d = a(c.target).closest(".controls").find("input"),
			e = d.data("id"),
			f = d.attr("name"),
			g = d.val(),
			h = d.data("original");
			k(e, "", f, g, h),
			m(c)
		},
		"dom/action/setting/radio/edit.click" : function (b, c) {
			var d = a(c.target).closest(".controls").find("input"),
			e = d.filter(":checked");
			d.data("original", e.val()),
			m(c)
		},
		"dom/action/setting/radio/save.click" : function (b, c) {
			var d = a(c.target).closest(".controls").find("input"),
			e = d.filter(":checked"),
			f = e.data("id"),
			g = e.attr("name"),
			h = e.val(),
			i = e.data("original");
			k(f, "", g, h, i),
			m(c)
		},
		"dom/action/setting/popup/add.click" : function (b, c, d, e) {
			var f = this,
			h = a(c.target).closest(".controls").find("select"),
			i = h.attr("name"),
			j = h.data("type"),
			k = function () {
				g.call(f, h, o[j.toUpperCase()].replace("<type>", i))
			};
			this.publish("modal/setting-" + d + "/show", o[j.toUpperCase() + "_ADD"], k, i, null, null, null, null, e, f._userId),
			c.preventDefault()
		},
		"dom/action/reorder/template.click" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = a(c.target),
			f = e.closest(".controls").find("select"),
			h = f.attr("name"),
			i = f.data("type"),
			j = function () {
				var b = [];
				return f.find("option").each(function () {
					var c = a(this);
					c.val() && b.push({
						id : c.val(),
						label : c.text()
					})
				}),
				b
			}
			();
			d.publish("system/modal/reorder-email-template/show", j, function () {
				g.call(d, f, o[i.toUpperCase()].replace("<type>", h))
			})
		},
		"dom/action/setting/popup/edit.click" : function (b, c, e, f) {
			var h,
			i,
			j,
			k,
			l,
			m,
			n = this,
			p = a(c.target).closest(".controls").find("select"),
			q = p.find(":selected"),
			r = q.val(),
			s = q.prop("disabled");
			return c.preventDefault(),
			!r || s ? (d.alert("info", "Please choose one to EDIT"), p.focus(), void 0) : (h = p.attr("name"), i = q.text(), j = q.data("title"), k = q.data("text"), m = p.data("type"), l = function () {
				g.call(n, p, o[m.toUpperCase()].replace("<type>", h))
			}, this.publish("modal/setting-" + e + "/show", o[m.toUpperCase() + "_ADD"], l, h, r, i, j, k, f), void 0)
		},
		"dom/action/setting/popup/delete.click" : function (b, c) {
			var e,
			f,
			h = this,
			i = a(c.target).closest(".controls").find("select"),
			j = i.attr("name"),
			k = i.find(":selected"),
			l = k.val(),
			m = k.prop("disabled"),
			n = {};
			return c.preventDefault(),
			!l || m ? (d.alert("info", "Please choose one to DELETE"), i.focus(), void 0) : (n.id = l, e = k.text(), f = i.data("type"), window.confirm("Do you really need to delete [ " + e + " ] ?") && a.ajax({
					url : o[f.toUpperCase() + "_DEL"],
					data : {
						data : JSON.stringify(n)
					},
					type : "post"
				}).done(function (a) {
					a.status ? (d.alert("success", "Deleting [ " + e + " ] success."), g.call(h, i, o[f.toUpperCase()].replace("<type>", j))) : d.alert("error", a.message)
				}).fail(function (a) {
					d.alert("error", JSON.parse(a.responseText).message)
				}), void 0)
		},
		"dom/action/setting/dropdown/add.click" : function (b, c) {
			var d = a(c.target).closest(".controls").find("input");
			d.data("id", ""),
			l(c, "")
		},
		"dom/action/setting/dropdown/edit.click" : function (b, c) {
			var e = a(c.target).closest(".controls").find(":selected"),
			f = e.val(),
			g = e.text(),
			h = e.prop("disabled"),
			i = a(c.target).closest(".controls").find("input");
			i.data("id", f),
			i.data("original", g),
			f && !h ? l(c, g) : (c.preventDefault(), d.alert("info", "Please choose one to EDIT"), e.parent().focus())
		},
		"dom/action/setting/dropdown/delete.click" : function (b, e) {
			var f,
			h,
			i = this,
			j = a(e.target).closest(".controls").find("select"),
			k = j.attr("name"),
			l = j.find(":selected"),
			m = l.val(),
			n = l.text(),
			p = l.prop("disabled"),
			q = {
				id : m
			};
			("function" === j.attr("name") || "industry" === j.attr("name")) && (h = "null"),
			j.hasClass("subfunction") && (h = a(".load-dropdown[name=function]").val(), q.parent_id = h),
			j.hasClass("subindustry") && (h = a(".load-dropdown[name=industry]").val(), q.parent_id = h),
			m && !p ? (e.preventDefault(), window.confirm("Do you really need to delete [ " + n + " ] ?") && i.publish("ajax", {
					url : o.LIST_DEL.replace("<type>", k),
					data : {
						data : JSON.stringify(q)
					},
					type : "post"
				}, c().done(function (a) {
						a.status ? (d.alert("success", "Deleting [ " + n + " ] success."), f = j.data("type"), g.call(i, j, o[f.toUpperCase()].replace("<type>", k), h)) : d.alert("error", a.message)
					}))) : (e.preventDefault(), d.alert("info", "Please choose one to DELETE"), l.parent().focus())
		},
		"dom/action/setting/dropdown/save.click" : function (b, e) {
			var f = this,
			h = a(e.target).closest(".controls").find("select"),
			i = h.attr("name"),
			j = a(e.target).closest(".controls").find("input"),
			k = j.data("id");
			j.attr("name");
			var m,
			n,
			p,
			q = j.val(),
			r = j.data("original");
			q === r ? d.alert("info", "Nothing changed at all !!!") : (m = k ? {
					id : k,
					name : q
				}
				 : {
				name : q
			}, ("function" === h.attr("name") || "industry" === h.attr("name")) && (p = "null"), h.hasClass("subfunction") && (p = a(".load-dropdown[name=function]").val(), m.parent_id = p), h.hasClass("subindustry") && (p = a(".load-dropdown[name=industry]").val(), m.parent_id = p), f.publish("ajax", {
					url : o.LIST_ADD.replace("<type>", i),
					data : {
						data : JSON.stringify(m)
					},
					type : "post"
				}, c().done(function (a) {
						a.status ? (d.alert("success", "Saving [ " + q + " ] success."), n = h.data("type"), g.call(f, h, o[n.toUpperCase()].replace("<type>", i), p)) : d.alert("error", a.message)
					}))),
			l(e, "")
		},
		"dom/action/setting/dropdown/cancel.click" : function (a, b) {
			l(b, "")
		},
		"dom/action/setting/pairs/edit.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = d.closest(".control-group");
			e.find("input:text").prop("disabled", !1),
			e.find('a[data-action="remove/field"]').removeClass("hide"),
			m(c)
		},
		"dom/action/setting/pairs/add.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = d.closest(".controls");
			e.before('<div class="controls"><input data-pairs="name" type="text" placeholder="链接名称"> <input data-pairs="value" type="text" placeholder="http://"> <a href="#" data-action="remove/field"><span class="icon-remove"></span></a></div>')
		},
		"dom/action/setting/pairs/save.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = d.closest(".control-group"),
			f = [],
			g = e.find(".load-key").data(g),
			h = "",
			i = e.find(".load-key").attr("name");
			e.find("input:text").prop("disabled", !0),
			e.find('a[data-action="remove/field"]').addClass("hide"),
			e.find("input:text").each(function () {
				var b = a(this);
				b.val().length || b.closest(".controls").remove()
			}),
			e.find('[data-pairs="name"]').each(function () {
				f.push({
					name : a(this).val(),
					value : a(this).next('[data-pairs="value"]').val()
				})
			}),
			f = JSON.stringify(f),
			k(g, h, i, f, null),
			m(c)
		},
		"dom/action/setting/pairs/cancel.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = d.closest(".control-group");
			e.find("input:text").prop("disabled", !0),
			e.find('a[data-action="remove/field"]').addClass("hide"),
			e.find("input:text").each(function () {
				var b = a(this);
				b.val().length || b.closest(".controls").remove()
			}),
			m(c)
		},
		"dom/action/remove/field.click" : function (b, c) {
			c.preventDefault();
			var d = window.confirm("确定要删除此项吗?");
			d && a(c.target).closest(".controls").remove()
		}
	})
}), define("app/widget/system/base/options-config", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "shared/helper/utils", "shared/helper/validate", "jquery.ui"], function (a, b, c, d, e) {
	function f(b) {
		var d = this;
		d.html(d._template, d._json, b),
		d.publish("ajax", {
			url : h.CONFIG_KEYS.replace("<type>", d._type),
			cache : !1
		}, c().done(function (b) {
				d._json = b,
				b.forEach(function (b) {
					var e = a('<div class="category-block"></div>');
					e.data("json", b).attr("data-weave", d._itemWidget + "(json)").weave(c(function () {
							d.$element.find('[data-action="add/status"]').closest(".control-group").before(e)
						}))
				})
			}))
	}
	function g(a) {
		var b = this;
		b.$form = b.$element.find("form"),
		b.$form.sortable({
			items : ".category-block",
			handle : ".handler",
			cursor : "move",
			axis : "y"
		}),
		e(b.$form),
		a.resolve()
	}
	var h = {
		CONFIG_KEYS : "/rest/data/options?type=<type>",
		CONFIG_ADD : "/rest/data/options/add"
	};
	return b.extend({
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"sig/start" : function (a, b) {
			g.call(this, b)
		},
		"dom/action.click" : a.noop,
		"dom/action/add/status.click" : function (b, d) {
			d.preventDefault();
			var e = this,
			f = a(d.target),
			g = a('<div class="category-block"></div>');
			g.attr("data-weave", e._itemWidget).weave(c(function () {
					f.closest(".control-group").before(g)
				}))
		},
		"dom/action/save.click" : function (b, e) {
			e.preventDefault();
			var f = this,
			g = a(e.target),
			i = {},
			j = [];
			return f.$form.valid() ? (f.$element.find(".category-block").each(function () {
					var b = a(this);
					j.push({
						code : b.find('[name*="en_US"]').val().trim(),
						zh_CN : b.find('[name*="zh_CN"]').val().trim(),
						en_US : b.find('[name*="en_US"]').val().trim(),
						color : b.find('[name*="color"]').val() || "",
						is_buildin : 1 == b.find('[name*="is_buildin"]').val()
					})
				}), i = {
					type : f._type,
					values : j
				}, f.publish("ajax", {
					url : h.CONFIG_ADD,
					data : {
						data : JSON.stringify(i)
					},
					type : "post"
				}, c().done(function (a) {
						a.status ? (d.alert("success", "保存成功!"), a.data && a.data.length && d.alert("info", a.data.join(", ") + "已经被关联，请刷新页面，并选择“转移到”，将关联数据移除后再删除!")) : d.alert("error", a.message)
					}), g), void 0) : !1
		},
		"hub/system/get/data" : function (b, c) {
			var d = this;
			c.type = d._type,
			c.data = [],
			d.$element.find(".category-block").each(function () {
				var b = a(this);
				c.data.push({
					id : b.find('[name*="en_US"]').val().trim(),
					label : b.find('[name*="zh_CN"]').val().trim()
				})
			})
		}
	})
}), define("app/widget/system/base/options-item", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "shared/helper/utils"], function (a, b) {
	function c(a) {
		var b = this;
		b.html(b._template, b._json, a)
	}
	return b.extend(function (a, b, c) {
		this._json = c || {}

	}, {
		"sig/initialize" : function (a, b) {
			c.call(this, b)
		},
		"dom/action.click" : a.noop,
		"dom/action/delete/status.click" : function (b, c) {
			c.preventDefault();
			var d = this;
			a(c.target);
			var e = window.confirm("确认要删除这条吗?");
			e && d.$element.remove()
		},
		"dom/action/transfer/status.click" : function (b, c) {
			c.preventDefault();
			var d = this;
			a(c.target);
			var e = {};
			d.publish("system/get/data", e),
			d.publish("system/modal/merge-node/show", {
				type : e.type,
				selected : {
					id : d._json.code,
					name : d._json.value
				},
				data : e.data,
				onSuccess : function () {}

			})
		},
		randomKey : function () {
			return parseInt(1e5 * Math.random(), 10)
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/candidate-fields/config/main.html", [], function () {
	return function () {
		var a = "";
		return a
	}
}), define("troopjs-requirejs/template!app/widget/system/candidate-fields/config/text.html", [], function () {
	return function (a) {
		var b = '<form>\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Field Title"></span>\n        </label>\n        <div class="controls">\n            <input type="text" class="span10" value="' + a.label + '" name="label">\n        </div>\n    </div>\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Required Field"></span>\n        </label>\n        <div class="controls">\n            <label class="radio inline">\n                <input type="radio" name="required" value="true" ';
		return a.required && (b += 'checked="true"'),
		b += '> <span data-weave="shared/helper/translation" data-i18n="Yes"></span>\n            </label>\n            <label class="radio inline">\n                <input type="radio" name="required" value="false" ',
		a.required || (b += 'checked="true"'),
		b += '> <span data-weave="shared/helper/translation" data-i18n="No"></span>\n            </label>\n        </div>\n    </div>\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Description"></span>\n        </label>\n        <div class="controls">\n            <input type="text" name="help" class="span10" value="' + a.help + '">\n        </div>\n    </div>\n</form>'
	}
}), define("troopjs-requirejs/template!app/widget/system/candidate-fields/config/multiline.html", [], function () {
	return function (a) {
		var b = '<form>\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Field Title"></span>\n        </label>\n        <div class="controls">\n            <input type="text" class="span10" value="' + a.label + '" name="label">\n        </div>\n    </div>\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Required Field"></span>\n        </label>\n        <div class="controls">\n            <label class="radio inline">\n                <input type="radio" name="required" value="true" ';
		return a.required && (b += 'checked="true"'),
		b += '> <span data-weave="shared/helper/translation" data-i18n="Yes"></span>\n            </label>\n            <label class="radio inline">\n                <input type="radio" name="required" value="false" ',
		a.required || (b += 'checked="true"'),
		b += '> <span data-weave="shared/helper/translation" data-i18n="No"></span>\n            </label>\n        </div>\n    </div>\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Description"></span>\n        </label>\n        <div class="controls">\n            <input type="text" name="help" class="span10" value="' + a.help + '">\n        </div>\n    </div>\n</form>'
	}
}), define("troopjs-requirejs/template!app/widget/system/candidate-fields/config/radio.html", [], function () {
	return function (a) {
		var b = '<form>\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Field Title"></span>\n        </label>\n        <div class="controls">\n            <input type="text" class="span10" value="' + a.label + '" name="label">\n        </div>\n    </div>\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Required Field"></span>\n        </label>\n        <div class="controls">\n            <label class="radio inline">\n                <input type="radio" name="required" value="true" ';
		a.required && (b += 'checked="true"'),
		b += '> <span data-weave="shared/helper/translation" data-i18n="Yes"></span>\n            </label>\n            <label class="radio inline">\n                <input type="radio" name="required" value="false" ',
		a.required || (b += 'checked="true"'),
		b += '> <span data-weave="shared/helper/translation" data-i18n="No"></span>\n            </label>\n        </div>\n    </div>\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Options"></span>\n        </label>\n        <div class="controls">\n            ';
		for (var c = 0, d = a.options.length; d > c; c++)
			b += '\n            <div>\n                <input type="text" value="' + a.options[c] + '" name="option"> <a href="#" data-action="remove/option"><i class="icon-remove"></i></a>\n            </div>\n            ';
		return b += '\n            <div>\n                <a href="#" data-action="add/option" data-weave="shared/helper/translation" data-i18n="Add"></a>\n            </div>\n        </div>\n    </div>\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Description"></span>\n        </label>\n        <div class="controls">\n            <input type="text" name="help" class="span10" value="' + a.help + '">\n        </div>\n    </div>\n</form>'
	}
}), define("troopjs-requirejs/template!app/widget/system/candidate-fields/config/checkbox.html", [], function () {
	return function (a) {
		var b = '<form>\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Field Title"></span>\n        </label>\n        <div class="controls">\n            <input type="text" class="span10" value="' + a.label + '" name="label">\n        </div>\n    </div>\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Required Field"></span>\n        </label>\n        <div class="controls">\n            <label class="radio inline">\n                <input type="radio" name="required" value="true" ';
		a.required && (b += 'checked="true"'),
		b += '> <span data-weave="shared/helper/translation" data-i18n="Yes"></span>\n            </label>\n            <label class="radio inline">\n                <input type="radio" name="required" value="false" ',
		a.required || (b += 'checked="true"'),
		b += '> <span data-weave="shared/helper/translation" data-i18n="No"></span>\n            </label>\n        </div>\n    </div>\n\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Options"></span>\n        </label>\n        <div class="controls">\n            ';
		for (var c = 0, d = a.options.length; d > c; c++)
			b += '\n            <div>\n                <input type="text" value="' + a.options[c] + '" name="option"> <a href="#" data-action="remove/option"><i class="icon-remove"></i></a>\n            </div>\n            ';
		return b += '\n            <div>\n                <a href="#" data-action="add/option" data-weave="shared/helper/translation" data-i18n="Add"></a>\n            </div>\n        </div>\n    </div>\n\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Description"></span>\n        </label>\n        <div class="controls">\n            <input type="text" name="help" class="span10" value="' + a.help + '">\n        </div>\n    </div>\n</form>'
	}
}), define("troopjs-requirejs/template!app/widget/system/candidate-fields/config/dropdown.html", [], function () {
	return function (a) {
		var b = '<form>\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Field Title"></span>\n        </label>\n        <div class="controls">\n            <input type="text" class="span10" value="' + a.label + '" name="label">\n        </div>\n    </div>\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Required Field"></span>\n        </label>\n        <div class="controls">\n            <label class="radio inline">\n                <input type="radio" name="required" value="true" ';
		a.required && (b += 'checked="true"'),
		b += '> <span data-weave="shared/helper/translation" data-i18n="Yes"></span>\n            </label>\n            <label class="radio inline">\n                <input type="radio" name="required" value="false" ',
		a.required || (b += 'checked="true"'),
		b += '> <span data-weave="shared/helper/translation" data-i18n="No"></span>\n            </label>\n        </div>\n    </div>\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Options"></span>\n        </label>\n        <div class="controls">\n            ';
		for (var c = 0, d = a.options.length; d > c; c++)
			b += '\n            <div>\n                <input type="text" value="' + a.options[c] + '" name="option"> <a href="#" data-action="remove/option"><i class="icon-remove"></i></a>\n            </div>\n            ';
		return b += '\n            <div>\n                <a href="#" data-action="add/option" data-weave="shared/helper/translation" data-i18n="Add"></a>\n            </div>\n        </div>\n    </div>\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Description"></span>\n        </label>\n        <div class="controls">\n            <input type="text" name="help" class="span10" value="' + a.help + '">\n        </div>\n    </div>\n</form>'
	}
}), define("troopjs-requirejs/template!app/widget/system/candidate-fields/config/date.html", [], function () {
	return function (a) {
		var b = '<form>\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Field Title"></span>\n        </label>\n        <div class="controls">\n            <input type="text" class="span10" value="' + a.label + '" name="label">\n        </div>\n    </div>\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Required Field"></span>\n        </label>\n        <div class="controls">\n            <label class="radio inline">\n                <input type="radio" name="required" value="true" ';
		return a.required && (b += 'checked="true"'),
		b += '> <span data-weave="shared/helper/translation" data-i18n="Yes"></span>\n            </label>\n            <label class="radio inline">\n                <input type="radio" name="required" value="false" ',
		a.required || (b += 'checked="true"'),
		b += '> <span data-weave="shared/helper/translation" data-i18n="No"></span>\n            </label>\n        </div>\n    </div>\n    <div class="control-group">\n        <label class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="Description"></span>\n        </label>\n        <div class="controls">\n            <input type="text" name="help" class="span10" value="' + a.help + '">\n        </div>\n    </div>\n</form>'
	}
}), define("app/widget/system/candidate-fields/config/main", ["require", "jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "template!app/widget/system/candidate-fields/config/text.html", "template!app/widget/system/candidate-fields/config/multiline.html", "template!app/widget/system/candidate-fields/config/radio.html", "template!app/widget/system/candidate-fields/config/checkbox.html", "template!app/widget/system/candidate-fields/config/dropdown.html", "template!app/widget/system/candidate-fields/config/date.html", "shared/helper/utils", "jquery.ui"], function (a, b, c, d, e, f, g, h, i, j, k) {
	function l(a) {
		var b = this;
		b.html(e, b._json, a)
	}
	function m(a) {
		function c() {
			var a = b(this),
			c = a.prop("tagName"),
			e = a.attr("type"),
			f = a.attr("name"),
			g = a.val().trim();
			if ("INPUT" === c)
				if ("text" === e)
					if ("option" === f) {
						var h = [];
						d.$element.find('[name="option"]').each(function () {
							h.push(b(this).val().trim())
						}),
						d._json.options = h
					} else
						d._json[f] = g;
				else
					"radio" === e && "required" === f && (g = "true" === g, d._json[f] = g);
			d.publish("system/customize/form/update", d._json)
		}
		var d = this;
		d.$element.on("input", 'input[type="text"]', c),
		d.$element.on("change", 'input[type="radio"]', c),
		a.resolve()
	}
	var n = {
		text : f,
		multiline : g,
		radio : h,
		checkbox : i,
		dropdown : j,
		date : k
	};
	return c.extend({
		"sig/initialize" : function (a, b) {
			l.call(this, b)
		},
		"sig/start" : function (a, b) {
			m.call(this, b)
		},
		"hub/system/customize/form/config" : function (a, b) {
			var c = this;
			if (b) {
				var d = b.type;
				c._json = b,
				c.html(n[d], b)
			}
		},
		"dom/action.click" : b.noop,
		"dom/action/remove/option.click" : function (a, c) {
			c.preventDefault();
			var d = this,
			e = b(c.target);
			e.closest("div").remove();
			var f = [];
			d.$element.find('[name="option"]').each(function () {
				f.push(b(this).val().trim())
			}),
			d._json.options = f,
			d.publish("system/customize/form/update", d._json)
		},
		"dom/action/add/option.click" : function (a, c) {
			c.preventDefault();
			var d = this,
			e = b(c.target);
			e.closest("div").before('<div><input type="text" value="" name="option"> <a href="#" data-action="remove/option"><i class="icon-remove"></i></a></div>');
			var f = [];
			d.$element.find('[name="option"]').each(function () {
				f.push(b(this).val().trim())
			}),
			d._json.options = f,
			d.publish("system/customize/form/update", d._json)
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/candidate-fields/main.html", [], function () {
	return function () {
		var a = '<h3 class="heading">人才: 新增字段</h3>\n\n<div class="row-fluid">\n    <div class="span6">\n        <form action="#" class="form-horizontal custom-form">\n            <p>拖拽或双击左边可选组件自定义新增字段，选中字段可以进行编辑</p>\n        </form>\n\n        <button class="btn btn-primary pull-right" data-weave="shared/helper/translation" data-i18n="Save" data-action="save"></button>\n    </div>\n\n    <div class="span6">\n        \n        <ul class="nav nav-tabs">\n            <li class="active"><a data-toggle="tab" href="#components-tab" data-weave="shared/helper/translation" data-i18n="Available components"></a></li>\n            <li><a data-toggle="tab" href="#edit-tab" data-weave="shared/helper/translation" data-i18n="Edit component"></a></li>\n        </ul>\n\n        <div class="tab-content">\n            <div class="tab-pane active" id="components-tab">\n                <ul class="unstyled components-list clearfix">\n                    <li>\n                        <div class="component" data-type="text" data-action="add/component">\n                            <div><span data-weave="shared/helper/translation" data-i18n="Text box"></span></div>\n                        </div>\n                    </li>\n                    <li>\n                        <div class="component" data-type="multiline" data-action="add/component">\n                            <div><span data-weave="shared/helper/translation" data-i18n="Multi-line text box"></span></div>\n                        </div>\n                    </li>\n                    <li>\n                        <div class="component" data-type="radio" data-action="add/component">\n                            <div><span data-weave="shared/helper/translation" data-i18n="Radio button"></span></div>\n                        </div>\n                    </li>\n                    <li>\n                        <div class="component" data-type="checkbox" data-action="add/component">\n                            <div><span data-weave="shared/helper/translation" data-i18n="Check box"></span></div>\n                        </div>\n                    </li>\n                    <li>\n                        <div class="component" data-type="dropdown" data-action="add/component">\n                            <div><span data-weave="shared/helper/translation" data-i18n="Dropdown list"></span></div>\n                        </div>\n                    </li>\n                    <li>\n                        <div class="component" data-type="date" data-action="add/component">\n                            <div><span data-weave="shared/helper/translation" data-i18n="Date control"></span></div>\n                        </div>\n                    </li>\n                </ul>\n            </div>\n\n            <div class="tab-pane" id="edit-tab" data-weave="app/widget/system/candidate-fields/config/main"></div>\n        </div>\n\n    </div>\n</div>';
		return a
	}
}), define("troopjs-requirejs/template!app/widget/system/candidate-fields/components/text.html", [], function () {
	return function (a) {
		var b = '<div class="control-group" data-action="component">\n    <span class="icon-remove" data-action="remove/component"></span>\n    <label class="control-label">\n    	<span class="icon-move-ns icon-blue pull-left"></span>\n        ' + a.label + '\n        <span class="f_req ';
		return a.required || (b += "hide"),
		b += '">*</span>\n    </label>\n    <div class="controls">\n        <input type="text" class="input-medium" disabled="true">\n        <p class="hint ',
		a.help.length || (b += "hide"),
		b += '">' + a.help + "</p>\n    </div>\n</div>"
	}
}), define("troopjs-requirejs/template!app/widget/system/candidate-fields/components/multiline.html", [], function () {
	return function (a) {
		var b = '<div class="control-group" data-action="component">\n    <span class="icon-remove" data-action="remove/component"></span>\n    <label class="control-label">\n    	<span class="icon-move-ns icon-blue pull-left"></span>\n        ' + a.label + '\n        <span class="f_req ';
		return a.required || (b += "hide"),
		b += '">*</span>\n    </label>\n    <div class="controls">\n        <textarea cols="30" rows="10" disabled="true"></textarea>\n        <p class="hint ',
		a.help.length || (b += "hide"),
		b += '">' + a.help + "</p>\n    </div>\n</div>"
	}
}), define("troopjs-requirejs/template!app/widget/system/candidate-fields/components/radio.html", [], function () {
	return function (a) {
		var b = '<div class="control-group" data-action="component">\n    <span class="icon-remove" data-action="remove/component"></span>\n    <label class="control-label">\n        <span class="icon-move-ns icon-blue pull-left"></span>\n        ' + a.label + '\n        <span class="f_req ';
		a.required || (b += "hide"),
		b += '">*</span>\n    </label>\n    <div class="controls">\n        ';
		for (var c = 0, d = a.options.length; d > c; c++)
			b += '\n            <label class="radio">\n                <input type="radio" value="' + a.options[c] + '" disabled="true"> ' + a.options[c] + "\n            </label>\n        ";
		return b += '\n        <p class="hint ',
		a.help.length || (b += "hide"),
		b += '">' + a.help + "</p>\n    </div>\n</div>"
	}
}), define("troopjs-requirejs/template!app/widget/system/candidate-fields/components/checkbox.html", [], function () {
	return function (a) {
		var b = '<div class="control-group" data-action="component">\n    <span class="icon-remove" data-action="remove/component"></span>\n    <label class="control-label">\n        <span class="icon-move-ns icon-blue"></span>\n        ' + a.label + '\n        <span class="f_req ';
		a.required || (b += "hide"),
		b += '">*</span>\n    </label>\n    <div class="controls">\n        ';
		for (var c = 0, d = a.options.length; d > c; c++)
			b += '\n            <label class="checkbox">\n                <input type="checkbox" value="' + a.options[c] + '" disabled="true"> ' + a.options[c] + "\n            </label>\n        ";
		return b += '\n        <p class="hint ',
		a.help.length || (b += "hide"),
		b += '">' + a.help + "</p>\n    </div>\n</div>"
	}
}), define("troopjs-requirejs/template!app/widget/system/candidate-fields/components/dropdown.html", [], function () {
	return function (a) {
		var b = '<div class="control-group" data-action="component">\n    <span class="icon-remove" data-action="remove/component"></span>\n    <label class="control-label">\n        <span class="icon-move-ns icon-blue pull-left"></span>\n        ' + a.label + '\n        <span class="f_req ';
		a.required || (b += "hide"),
		b += '">*</span>\n    </label>\n    <div class="controls">\n        <select disabled="true">\n            ';
		for (var c = 0, d = a.options.length; d > c; c++)
			b += '\n                <option value="' + a.options[c] + '">' + a.options[c] + "</option>\n            ";
		return b += '\n        </select>\n        <p class="hint ',
		a.help.length || (b += "hide"),
		b += '">' + a.help + "</p>\n    </div>\n</div>"
	}
}), define("troopjs-requirejs/template!app/widget/system/candidate-fields/components/date.html", [], function () {
	return function (a) {
		var b = '<div class="control-group" data-action="component">\n	<span class="icon-remove" data-action="remove/component"></span>\n    <label class="control-label">\n    	<span class="icon-move-ns icon-blue pull-left"></span>\n        ' + a.label + '\n        <span class="f_req ';
		return a.required || (b += "hide"),
		b += '">*</span>\n    </label>\n    <div class="controls">\n        <input type="text" class="input-medium" disabled="true">\n        <p class="hint ',
		a.help.length || (b += "hide"),
		b += '">' + a.help + "</p>\n    </div>\n</div>"
	}
}), define("app/widget/system/candidate-fields/main", ["require", "jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "template!./components/text.html", "template!./components/multiline.html", "template!./components/radio.html", "template!./components/checkbox.html", "template!./components/dropdown.html", "template!./components/date.html", "shared/helper/utils", "shared/helper/validate", "shared/helper/blurb", "jquery.ui"], function (a, b, c, d, e, f, g, h, i, j, k, l, m, n) {
	function o(a, c, d) {
		var e = b(s[c.type](c));
		return a.replaceWith(e),
		e.data("control", c).addClass(function () {
			return d ? "selected" : ""
		}),
		e
	}
	function p() {
		var a = this;
		a.publish("ajax", {
			url : t.TABLE,
			cache : !1
		}, d().done(function (c) {
				c.forEach(function (c) {
					var d = b("<div></div>");
					a.$customForm.append(d),
					c.options && c.options.length && (c.options = JSON.parse(c.options)),
					o.call(a, d, c)
				})
			}))
	}
	function q(a) {
		var b = this;
		b.html(e, b._json, a)
	}
	function r(a) {
		var c = this,
		d = c.$element;
		c.$customForm = d.find(".custom-form"),
		c.$customForm.sortable({
			containment : c.$customForm,
			handle : ".icon-move-ns",
			update : function (a, d) {
				var e,
				f = d.item,
				g = f.data("type"),
				h = b.extend(!0, {}, u[g]);
				20 === c.$customForm.find(".control-group").length && (f.remove(), alert("最多添加20个字段!")),
				g && (e = o.call(c, f, h), e.trigger("click"))
			}
		}).disableSelection(),
		d.find(".components-list .component").draggable({
			connectToSortable : c.$customForm,
			helper : "clone",
			revert : "invalid",
			start : function (a, b) {
				b.helper.height(40)
			}
		}),
		p.call(c),
		a.resolve()
	}
	var s = {
		text : f,
		multiline : g,
		radio : h,
		checkbox : i,
		dropdown : j,
		date : k
	},
	t = {
		TABLE : "/rest/data/fields?table=candidate",
		ADD : "/rest/data/fields/add"
	},
	u = {
		text : {
			type : "text",
			label : "文本框",
			help : "",
			required : !1,
			options : "",
			size : "input-medium"
		},
		multiline : {
			type : "multiline",
			label : "多行文本框",
			help : "",
			required : !1,
			options : "",
			size : "input-medium"
		},
		checkbox : {
			type : "checkbox",
			label : "多选框",
			help : "",
			required : !1,
			options : ["选项", "选项", "选项"],
			size : ""
		},
		radio : {
			type : "radio",
			label : "单选框",
			help : "",
			required : !1,
			options : ["选项", "选项", "选项"],
			size : ""
		},
		dropdown : {
			type : "dropdown",
			label : "下拉框",
			help : "",
			required : !1,
			options : ["选项", "选项", "选项"],
			size : ""
		},
		date : {
			type : "date",
			label : "日期",
			help : "",
			required : !1,
			options : "",
			size : ""
		}
	};
	return c.extend({
		"sig/initialize" : function (a, b) {
			q.call(this, b)
		},
		"sig/start" : function (a, b) {
			r.call(this, b)
		},
		"hub/system/customize/form/update" : function (a, b) {
			var c = this,
			d = c.$element.find(".control-group").filter(".selected");
			o.call(c, d, b, !0)
		},
		"dom/action.click.dblclick" : b.noop,
		"dom/action/remove/component.click" : function (a, c) {
			c.preventDefault();
			var d = b(c.target);
			d.closest(".control-group").fadeOut(500, function () {
				b(this).remove()
			})
		},
		"dom/action/component.click" : function (a, c) {
			var d = this,
			e = b(c.target);
			e.hasClass("selected") || (d.publish("system/customize/form/config", e.data("control")), e.siblings().removeClass("selected"), e.addClass("selected"))
		},
		"dom/action/add/component.dblclick" : function (a, c) {
			var d,
			e = this,
			f = b("<div></div>"),
			g = b(c.target),
			h = b.extend(!0, {}, u[g.data("type")]);
			return e.$customForm.append(f),
			20 === e.$customForm.find(".control-group").length ? (alert("最多添加20个字段!"), void 0) : (d = o.call(e, f, h), d.trigger("click"), void 0)
		},
		"dom/action/save.click" : function (a, c) {
			c.preventDefault();
			var e = this,
			f = b(c.target);
			f.prop("disabled", !0);
			var g = function () {
				var a = [];
				return e.$element.find(".custom-form .control-group").each(function () {
					var c = b.extend(!0, {}, b(this).data("control"));
					c.options = JSON.stringify(c.options),
					a.push(c)
				}), {
					table : "candidate",
					fields : a
				}
			}
			();
			e.publish("ajax", {
				url : t.ADD,
				data : {
					data : JSON.stringify(g)
				},
				type : "post"
			}, d().done(function (a) {
					a.status ? (l.alert("success", n.t("Operate successfully")), e.$element.find(".custom-form .control-group").remove(), p.call(e)) : l.alert("error", a.message)
				}), f)
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/candidate-required-fields/main.html", [], function () {
	return function () {
		var a = '<h3 class="heading">人才: 必填字段设置</h3>\n\n<form action="#" class="form-horizontal">\n    <div class="control-group">\n        <label class="control-label"><span data-weave="shared/helper/translation" data-i18n="English Name"></label>\n        <div class="controls">\n            <label class="radio inline"><input name="englishName" value="true" type="radio" data-action="required(1)"><span data-weave="shared/helper/translation" data-i18n="Required"></label>\n            <label class="radio inline"><input name="englishName" value="false" type="radio" data-action="required(1)"><span data-weave="shared/helper/translation" data-i18n="Optional"></label>\n        </div>\n    </div>\n    <div class="control-group">\n        <label class="control-label"><span data-weave="shared/helper/translation" data-i18n="Chinese Name"></label>\n        <div class="controls">\n            <label class="radio inline"><input name="chineseName" value="true" type="radio" data-action="required(1)"><span data-weave="shared/helper/translation" data-i18n="Required"></label>\n            <label class="radio inline"><input name="chineseName" value="false" type="radio" data-action="required(1)"><span data-weave="shared/helper/translation" data-i18n="Optional"></label>\n        </div>\n    </div>\n    <div class="control-group">\n        <label class="control-label"><span data-weave="shared/helper/translation" data-i18n="English Name or Chinese Name"></label>\n        <div class="controls">\n            <label class="radio inline"><input name="englishName_or_chineseName" value="true" type="radio" data-action="required/one(1)"><span data-weave="shared/helper/translation" data-i18n="Required"></label>\n            <label class="radio inline"><input name="englishName_or_chineseName" value="false" type="radio" data-action="required/one(1)"><span data-weave="shared/helper/translation" data-i18n="Optional"></label>\n        </div>\n    </div>\n    <div class="control-group">\n        <label class="control-label"><span data-weave="shared/helper/translation" data-i18n="Mobile"></label>\n        <div class="controls">\n            <label class="radio inline"><input name="mobile" value="true" type="radio" data-action="required(2)"><span data-weave="shared/helper/translation" data-i18n="Required"></label>\n            <label class="radio inline"><input name="mobile" value="false" type="radio" data-action="required(2)"><span data-weave="shared/helper/translation" data-i18n="Optional"></label>\n        </div>\n    </div>\n\n    <div class="well well-small">\n        <strong data-weave="shared/helper/translation" data-i18n="Work Experiences"></strong>\n        <div class="control-group">\n            <label class="control-label"><span data-weave="shared/helper/translation" data-i18n="Company Name"></label>\n            <div class="controls">\n                <label class="radio inline"><input name="company" value="true" type="radio" data-action="required"><span data-weave="shared/helper/translation" data-i18n="Required"></label>\n                <label class="radio inline"><input name="company" value="false" type="radio" checked="checked" data-action="required"><span data-weave="shared/helper/translation" data-i18n="Optional"></label>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label"><span data-weave="shared/helper/translation" data-i18n="Function"></label>\n            <div class="controls">\n                <label class="radio inline"><input name="function" value="true" type="radio" data-action="required"><span data-weave="shared/helper/translation" data-i18n="Required"></label>\n                <label class="radio inline"><input name="function" value="false" type="radio" checked="checked" data-action="required"><span data-weave="shared/helper/translation" data-i18n="Optional"></label>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label"><span data-weave="shared/helper/translation" data-i18n="Title"></label>\n            <div class="controls">\n                <label class="radio inline"><input name="title" value="true" type="radio" data-action="required"><span data-weave="shared/helper/translation" data-i18n="Required"></label>\n                <label class="radio inline"><input name="title" value="false" type="radio" checked="checked" data-action="required"><span data-weave="shared/helper/translation" data-i18n="Optional"></label>\n            </div>\n        </div>\n\n        <div class="control-group">\n            <label class="control-label"><span data-weave="shared/helper/translation" data-i18n="Description"></label>\n            <div class="controls">\n                <label class="radio inline"><input name="job_description" value="true" type="radio" data-action="required"><span data-weave="shared/helper/translation" data-i18n="Required"></label>\n                <label class="radio inline"><input name="job_description" value="false" type="radio" checked="checked" data-action="required"><span data-weave="shared/helper/translation" data-i18n="Optional"></label>\n            </div>\n        </div>\n    </div>\n\n    <div class="control-group">\n        <label class="control-label"><span data-weave="shared/helper/translation" data-i18n="Current City"></label>\n        <div class="controls">\n            <label class="radio inline"><input name="city" value="true" type="radio" data-action="required"><span data-weave="shared/helper/translation" data-i18n="Required"></label>\n            <label class="radio inline"><input name="city" value="false" type="radio" checked="checked" data-action="required"><span data-weave="shared/helper/translation" data-i18n="Optional"></label>\n        </div>\n    </div>\n\n    <div class="control-group">\n        <label class="control-label"><span data-weave="shared/helper/translation" data-i18n="Intention City"></label>\n        <div class="controls">\n            <label class="radio inline"><input name="intention_city" value="true" type="radio" data-action="required"><span data-weave="shared/helper/translation" data-i18n="Required"></label>\n            <label class="radio inline"><input name="intention_city" value="false" type="radio" checked="checked" data-action="required"><span data-weave="shared/helper/translation" data-i18n="Optional"></label>\n        </div>\n    </div>\n\n    <div class="control-group">\n        <label class="control-label"><span data-weave="shared/helper/translation" data-i18n="Annual Salary"></label>\n        <div class="controls">\n            <label class="radio inline"><input name="annual_salary" value="true" type="radio" data-action="required"><span data-weave="shared/helper/translation" data-i18n="Required"></label>\n            <label class="radio inline"><input name="annual_salary" value="false" type="radio" checked="checked" data-action="required"><span data-weave="shared/helper/translation" data-i18n="Optional"></label>\n        </div>\n    </div>\n\n    <div class="control-group">\n        <label class="control-label"><span data-weave="shared/helper/translation" data-i18n="Gender"></label>\n        <div class="controls">\n            <label class="radio inline"><input name="gender" value="true" type="radio" data-action="required"><span data-weave="shared/helper/translation" data-i18n="Required"></label>\n            <label class="radio inline"><input name="gender" value="false" type="radio" checked="checked" data-action="required"><span data-weave="shared/helper/translation" data-i18n="Optional"></label>\n        </div>\n    </div>\n\n    <div class="control-group">\n        <label class="control-label"><span data-weave="shared/helper/translation" data-i18n="Date of birth"></label>\n        <div class="controls">\n            <label class="radio inline"><input name="date_of_birth" value="true" type="radio" data-action="required"><span data-weave="shared/helper/translation" data-i18n="Required"></label>\n            <label class="radio inline"><input name="date_of_birth" value="false" type="radio" checked="checked" data-action="required"><span data-weave="shared/helper/translation" data-i18n="Optional"></label>\n        </div>\n    </div>\n\n    <div class="control-group">\n        <label class="control-label"><span data-weave="shared/helper/translation" data-i18n="Address"></label>\n        <div class="controls">\n            <label class="radio inline"><input name="address" value="true" type="radio" data-action="required"><span data-weave="shared/helper/translation" data-i18n="Required"></label>\n            <label class="radio inline"><input name="address" value="false" type="radio" checked="checked" data-action="required"><span data-weave="shared/helper/translation" data-i18n="Optional"></label>\n        </div>\n    </div>\n\n    <div class="control-group">\n        <label class="control-label"><span data-weave="shared/helper/translation" data-i18n="Tags"></label>\n        <div class="controls">\n            <label class="radio inline"><input name="tags" value="true" type="radio" data-action="required"><span data-weave="shared/helper/translation" data-i18n="Required"></label>\n            <label class="radio inline"><input name="tags" value="false" type="radio" checked="checked" data-action="required"><span data-weave="shared/helper/translation" data-i18n="Optional"></label>\n        </div>\n    </div>\n\n    <div class="control-group">\n        <label class="control-label"><span data-weave="shared/helper/translation" data-i18n="LinkedIn"></label>\n        <div class="controls">\n            <label class="radio inline"><input name="linkedin" value="true" type="radio" data-action="required"><span data-weave="shared/helper/translation" data-i18n="Required"></label>\n            <label class="radio inline"><input name="linkedin" value="false" type="radio" checked="checked" data-action="required"><span data-weave="shared/helper/translation" data-i18n="Optional"></label>\n        </div>\n    </div>\n\n    <div class="control-group">\n        <div class="controls"><button class="btn btn-primary" data-weave="shared/helper/translation" data-i18n="Save" data-action="save"></button></div>\n    </div>\n</form>';
		return a
	}
}), define("app/widget/system/candidate-required-fields/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "shared/helper/validate"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		b.publish("ajax", {
			url : i.CONFIG_KEYS.replace("<keys>", h),
			cache : !1
		}, c().done(function (c) {
				b._json = JSON.parse(c[0].value),
				b._configId = c[0].id,
				b.html(d, a)
			}))
	}
	function g(a) {
		var b = this,
		c = b.$element.find("form");
		for (var d in b._json)
			c.find('[name="' + d + '"]').filter('[value="' + b._json[d] + '"]').prop("checked", !0);
		a.resolve()
	}
	var h = "candidate_require_fields",
	i = {
		CONFIG_KEYS : "/rest/data/configvalue?keys=<keys>",
		CONFIG_ADD : "/rest/data/configvalue/add"
	};
	return b.extend({
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"sig/start" : function (a, b) {
			g.call(this, b)
		},
		"dom/action.click" : a.noop,
		"dom/action/save.click" : function (b, d) {
			d.preventDefault();
			var f = this,
			g = a(d.target),
			j = {},
			k = f.$element.find("form");
			if (k.valid()) {
				k.find("input:radio:checked").each(function () {
					var b = a(this);
					j[b.attr("name")] = "true" === b.val()
				});
				var l = {
					id : f._configId,
					type : "",
					name : h,
					value : JSON.stringify(j)
				};
				f.publish("ajax", {
					url : i.CONFIG_ADD,
					data : {
						data : JSON.stringify(l)
					},
					type : "post"
				}, c().done(function (a) {
						a.status ? e.alert("success", "保存成功!") : e.alert("error", a.message)
					}), g)
			}
		},
		"dom/action/required" : function (b, c, d) {
			var e = this,
			f = a(c.target);
			"true" === f.val() && d && e.$element.find('[data-action="required/one(' + d + ')"]').filter("[value=false]").prop("checked", !0)
		},
		"dom/action/required/one.click" : function (b, c, d) {
			var e = this,
			f = a(c.target);
			"true" === f.val() && e.$element.find('[data-action="required(' + d + ')"]').filter("[value=false]").prop("checked", !0)
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/company-fields/main.html", [], function () {
	return function (a) {
		var b = '<h3 class="heading">公司: 新增字段</h3>\n\n<p>若将字段留空，则该字段将不会出现在新增公司中</p>\n\n<form action="#" class="form-horizontal">\n    <div class="control-group">\n        <label for="name" class="control-label"><span data-weave="shared/helper/translation" data-i18n="公司名称"></span><span class="f_req">*</span></label>\n        <div class="controls">\n            <input type="text" id="name" name="name" class="input-medium" value="' + a.name + '">\n        </div>\n    </div>\n    <div class="control-group">\n        <label for="name1" class="control-label"><span data-weave="shared/helper/translation" data-i18n="公司别名1"></span></label>\n        <div class="controls">\n            <input type="text" id="name1" name="name1" class="input-medium" value="' + a.name1 + '">\n        </div>\n    </div>\n    <div class="control-group">\n        <label for="name2" class="control-label"><span data-weave="shared/helper/translation" data-i18n="公司别名2"></span></label>\n        <div class="controls">\n            <input type="text" id="name2" name="name2" class="input-medium" value="' + a.name2 + '">\n        </div>\n    </div>\n    <div class="control-group">\n        <label for="ext1" class="control-label"><span data-weave="shared/helper/translation" data-i18n="扩展字段1"></span></label>\n        <div class="controls">\n            <input type="text" id="ext1" name="ext1" class="input-medium" value="' + a.ext1 + '">\n        </div>\n    </div>\n    <div class="control-group">\n        <label for="ext2" class="control-label"><span data-weave="shared/helper/translation" data-i18n="扩展字段2"></span></label>\n        <div class="controls">\n            <input type="text" id="ext2" name="ext2" class="input-medium" value="' + a.ext2 + '">\n        </div>\n    </div>\n    <div class="control-group">\n        <label for="ext3" class="control-label"><span data-weave="shared/helper/translation" data-i18n="扩展字段3"></span></label>\n        <div class="controls">\n            <input type="text" id="ext3" name="ext3" class="input-medium" value="' + a.ext3 + '">\n        </div>\n    </div>\n    <div class="control-group">\n        <label for="ext4" class="control-label"><span data-weave="shared/helper/translation" data-i18n="扩展字段4"></span></label>\n        <div class="controls">\n            <input type="text" id="ext4" name="ext4" class="input-medium" value="' + a.ext4 + '">\n        </div>\n    </div>\n    <div class="control-group">\n        <label for="ext5" class="control-label"><span data-weave="shared/helper/translation" data-i18n="扩展字段5"></span></label>\n        <div class="controls">\n            <input type="text" id="ext5" name="ext5" class="input-medium" value="' + a.ext5 + '">\n        </div>\n    </div>\n    <div class="control-group">\n        <label for="ext6" class="control-label"><span data-weave="shared/helper/translation" data-i18n="扩展字段6"></span></label>\n        <div class="controls">\n            <input type="text" id="ext6" name="ext6" class="input-medium" value="' + a.ext6 + '">\n        </div>\n    </div>\n    <div class="control-group">\n        <div class="controls">\n            <button class="btn btn-primary" data-weave="shared/helper/translation" data-i18n="Save" data-action="save"></button>\n        </div>\n    </div>\n</form>';
		return b
	}
}), define("app/widget/system/company-fields/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "shared/helper/validate"], function (a, b, c, d, e, f) {
	function g(a) {
		var b = this;
		b.publish("ajax", {
			url : j.CONFIG_KEYS.replace("<keys>", i),
			cache : !1
		}, c().done(function (c) {
				b._json = JSON.parse(c[0].value),
				b._configId = c[0].id,
				b.html(d, b._json, a)
			}))
	}
	function h(a) {
		var b = this,
		c = b.$element.find("form");
		f(c, {
			rules : {
				name : {
					required : !0
				}
			}
		}),
		a.resolve()
	}
	var i = "company_field_names",
	j = {
		CONFIG_KEYS : "/rest/data/configvalue?keys=<keys>",
		CONFIG_ADD : "/rest/data/configvalue/add"
	};
	return b.extend({
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"sig/start" : function (a, b) {
			h.call(this, b)
		},
		"dom/action.click" : a.noop,
		"dom/action/save.click" : function (b, d) {
			d.preventDefault();
			var f = this,
			g = a(d.target),
			h = {},
			k = f.$element.find("form");
			if (k.valid()) {
				h = {
					name : k.find("#name").val().trim(),
					name1 : k.find("#name1").val().trim(),
					name2 : k.find("#name2").val().trim(),
					ext1 : k.find("#ext1").val().trim(),
					ext2 : k.find("#ext2").val().trim(),
					ext3 : k.find("#ext3").val().trim(),
					ext4 : k.find("#ext4").val().trim(),
					ext5 : k.find("#ext5").val().trim(),
					ext6 : k.find("#ext6").val().trim()
				};
				var l = {
					id : f._configId,
					type : "",
					name : i,
					value : JSON.stringify(h)
				};
				f.publish("ajax", {
					url : j.CONFIG_ADD,
					data : {
						data : JSON.stringify(l)
					},
					type : "post"
				}, c().done(function (a) {
						a.status ? e.alert("success", "保存成功!") : e.alert("error", a.message)
					}), g)
			}
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/company-info/main.html", [], function () {
	return function () {
		var a = '<h3 class="heading">公司信息设置</h3>\n\n<form action="#" class="form-horizontal">\n    <div class="control-group formSep">\n        <label class="control-label"><span data-weave="shared/helper/translation" data-i18n="Company Name"></span></label>\n        <div class="controls">\n            <input type="text" class="load-key" name="company_name" disabled="disabled" />\n            <button class="btn btn-primary action" data-action="setting/textbox/edit" data-weave="shared/helper/translation" data-i18n="Edit"></button>\n            <button class="btn btn-primary action hide" data-action="setting/textbox/save" data-weave="shared/helper/translation" data-i18n="Save"></button>\n            <button class="btn action hide" data-action="setting/textbox/cancel" data-weave="shared/helper/translation" data-i18n="Cancel"></button>\n        </div>\n    </div>\n</form>\n\n<form action="#" class="form-horizontal">\n    <div class="control-group formSep">\n        <label class="control-label"><span data-weave="shared/helper/translation" data-i18n="首页链接"></span></label>\n        \n        <div class="controls">\n            <input type="pairs" class="load-key hide" name="homepage_links" disabled="disabled">\n            <button class="btn btn-primary" data-action="setting/pairs/edit" data-weave="shared/helper/translation" data-i18n="Edit"></button>\n            <button class="btn btn-primary hide" data-action="setting/pairs/add" data-weave="shared/helper/translation" data-i18n="Add"></button>\n            <button class="btn btn-primary hide" data-action="setting/pairs/save" data-weave="shared/helper/translation" data-i18n="Save"></button>\n            <button class="btn hide" data-action="setting/pairs/cancel" data-weave="shared/helper/translation" data-i18n="Cancel"></button>\n        </div>\n    </div>\n</form>\n\n<form action="#" class="form-horizontal">\n    <div class="control-group formSep">\n        <label for="" class="control-label"><span data-weave="shared/helper/translation" data-i18n="Title"></span></label>\n        <div class="controls">\n            <select class="load-dropdown" data-type="list" name="title">\n            </select>\n            <input type="text" name="title" class="hide" placeholder="Add another ..." />\n            <button class="btn btn-primary action" data-action="setting/dropdown/edit" data-weave="shared/helper/translation" data-i18n="Edit"></button>\n            <button class="btn btn-warning action" data-action="setting/dropdown/delete" data-weave="shared/helper/translation" data-i18n="Delete"></button>\n            <button class="btn btn-primary action" data-action="setting/dropdown/add" data-weave="shared/helper/translation" data-i18n="Add"></button>\n            <button class="btn btn-primary action hide" data-action="setting/dropdown/save" data-weave="shared/helper/translation" data-i18n="Save"></button>\n            <button class="btn action hide" data-action="setting/dropdown/cancel" data-weave="shared/helper/translation" data-i18n="Cancel"></button>\n        </div>\n    </div>\n</form>\n\n<form action="#" class="form-horizontal">\n    <div class="control-group formSep">\n        <label for="" class="control-label"><span data-weave="shared/helper/translation" data-i18n="Default Password"></label>\n        <div class="controls">\n            <input type="text" class="load-key" name="default_password" disabled="disabled" />\n            <button class="btn btn-primary action" data-action="setting/textbox/edit" data-weave="shared/helper/translation" data-i18n="Edit"></button>\n            <button class="btn btn-primary action hide" data-action="setting/textbox/save" data-weave="shared/helper/translation" data-i18n="Save"></button>\n            <button class="btn action hide" data-action="setting/textbox/cancel" data-weave="shared/helper/translation" data-i18n="Cancel"></button>\n        </div>\n    </div>\n</form>';
		return a
	}
}), define("app/widget/system/company-info/main", ["jquery", "app/widget/system/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		b.html(d, a)
	}
	return b.extend({
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/company-note-config/item.html", [], function () {
	return function (a) {
		var b = "",
		c = this.randomKey();
		if (b += '\n<div class="control-group">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="备注类型"></span>\n    </label>\n    <div class="controls">\n        <input type="text" name="en_US-' + c + '" class="input-medium required" value="' + (a.en_US || "") + '" placeholder="English" ', a.en_US && (b += "readonly='readonly'"), b += '>\n        <input type="text" name="zh_CN-' + c + '" class="input-medium required" value="' + (a.zh_CN || "") + '" placeholder="中文">\n        \n        <div class="pull-right actions">\n            ', a.code && (b += '\n            <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="转移到..." data-action="transfer/category"></button>\n            '), b += '\n            <button class="btn btn-small btn-danger" data-weave="shared/helper/translation" data-i18n="Delete category" data-action="delete/category"></button>\n            <span class="handler"><span class="icon-move-ns icon-blue"></span></span>\n        </div>\n        \n    </div>\n</div>\n<div class="control-group">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="标签背景色"></span>\n    </label>\n    <div class="controls">\n        <input type="color" name="color" class="input-mini" value="' + a.color + '">\n    </div>\n</div>\n\n<div class="control-group formSep">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="Question"></span>\n    </label>\n\n    ', a.ext) {
			b += "\n    ";
			for (var d = JSON.parse(a.ext), e = 0, f = d.length; f > e; e++)
				b += '\n    <div class="controls">\n        <input type="text" class="input-xxlarge" value="' + d[e].field + '" name="question">\n        <button class="btn btn-danger btn-small pull-right btn-delete" data-weave="shared/helper/translation" data-i18n="Delete Question" data-action="delete/question"></button>\n    </div>\n    ';
			b += "\n    "
		} else
			b += '\n    <div class="controls">\n        <input type="text" class="input-xxlarge " name="question">\n        <button class="btn btn-danger btn-small pull-right btn-delete" data-weave="shared/helper/translation" data-i18n="Delete Question" data-action="delete/question"></button>\n    </div>\n    ';
		return b += '\n    <div class="controls text_line">\n        <a href="#" data-weave="shared/helper/translation" data-i18n="新增问题" data-action="add/question"></a>\n    </div>\n</div>'
	}
}), define("troopjs-requirejs/template!app/widget/system/base/question.html", [], function () {
	return function () {
		var a = '<div class="controls">\n    <input type="text" class="input-xxlarge"  name="question">\n    <button class="btn pull-right btn-danger btn-small btn-delete" data-weave="shared/helper/translation" data-i18n="Delete Question" data-action="delete/question"></button>\n</div>';
		return a
	}
}), define("app/widget/system/company-note-config/item", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./item.html", "template!app/widget/system/base/question.html", "shared/helper/utils"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		c(function (a) {
			b.html(d, b._json, a)
		}).done(function () {
			b.$element.find('[data-action="delete/question"]').eq(0).remove(),
			a.resolve()
		})
	}
	return b.extend(function (a, b, c) {
		this._json = c || {}

	}, {
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"dom/action.click" : a.noop,
		"dom/action/delete/category" : function (b, c) {
			c.preventDefault();
			var d = this;
			a(c.target);
			var e = window.confirm("确认要删除此类型吗?");
			e && d.$element.remove()
		},
		"dom/action/transfer/category" : function (b, c) {
			c.preventDefault();
			var d = this;
			a(c.target);
			var e = {};
			d.publish("system/get/data", e),
			d.publish("system/modal/merge-node/show", {
				type : e.type,
				selected : {
					id : d._json.code,
					name : d._json.value
				},
				data : e.data,
				onSuccess : function () {}

			})
		},
		"dom/action/delete/question" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = window.confirm("确认要删除此问题吗?");
			e && d.closest(".controls").remove()
		},
		"dom/action/add/question" : function (b, d) {
			d.preventDefault();
			var f = a(d.target);
			if (10 === f.closest(".control-group").find(".controls:not(.text_line)").length)
				return alert("最多添加十个问题!"), void 0;
			var g = a(e());
			g.find("[data-weave]").weave(c(function () {
					f.closest(".controls").before(g)
				}))
		},
		randomKey : function () {
			return parseInt(1e5 * Math.random(), 10)
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/company-note-config/main.html", [], function () {
	return function () {
		var a = '<h3 class="heading">公司: 备注类型设置</h3>\n\n<form action="#" class="form-horizontal">\n    \n\n    <div class="control-group">\n        <label class="control-label">\n            <a href="#" data-weave="shared/helper/translation" data-i18n="新增备注类型" data-action="add/category"></a>\n        </label>\n    </div>\n\n    <div class="control-group">\n        <div class="controls">\n            <button class="btn btn-primary" data-weave="shared/helper/translation" data-i18n="Save" data-action="save"></button>\n        </div>\n    </div>\n    \n</form>';
		return a
	}
}), define("app/widget/system/company-note-config/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "shared/helper/validate", "jquery.ui"], function (a, b, c, d, e, f) {
	function g(b) {
		var e = this;
		e.html(d, e._json, b),
		e.publish("ajax", {
			url : j.CONFIG_KEYS.replace("<type>", i),
			cache : !1
		}, c().done(function (b) {
				e._json = b,
				b.forEach(function (b) {
					var d = a('<div class="category-block"></div>');
					d.data("json", b).attr("data-weave", "app/widget/system/company-note-config/item(json)").weave(c(function () {
							e.$element.find('[data-action="add/category"]').closest(".control-group").before(d)
						}))
				})
			}))
	}
	function h(a) {
		var b = this;
		b.$form = b.$element.find("form"),
		b.$form.sortable({
			items : ".category-block",
			handle : ".handler",
			cursor : "move",
			axis : "y"
		}),
		f(b.$form),
		a.resolve()
	}
	var i = "client_note_category",
	j = {
		CONFIG_KEYS : "/rest/data/options?type=<type>",
		CONFIG_ADD : "/rest/data/options/add"
	};
	return b.extend({
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"sig/start" : function (a, b) {
			h.call(this, b)
		},
		"dom/action.click" : a.noop,
		"dom/action/add/category.click" : function (b, d) {
			d.preventDefault();
			var e = a(d.target),
			f = a('<div class="category-block"></div>');
			f.attr("data-weave", "app/widget/system/company-note-config/item").weave(c(function () {
					e.closest(".control-group").before(f)
				}))
		},
		"dom/action/save.click" : function (b, d) {
			d.preventDefault();
			var f = this,
			g = a(d.target),
			h = {},
			k = [];
			return g.hasClass("disabled") || !f.$form.valid() ? !1 : (g.addClass("disabled"), f.$element.find(".category-block").each(function () {
					var b = a(this),
					c = [];
					b.find('[name*="question"]').each(function () {
						a(this),
						c.push({
							field : a(this).val().trim(),
							required : !0
						})
					}),
					k.push({
						code : b.find('[name*="en_US"]').val().trim(),
						zh_CN : b.find('[name*="zh_CN"]').val().trim(),
						en_US : b.find('[name*="en_US"]').val().trim(),
						color : b.find('[name*="color"]').val() || "",
						is_buildin : !1,
						ext : JSON.stringify(c)
					})
				}), h = {
					type : i,
					values : k
				}, f.publish("ajax", {
					url : j.CONFIG_ADD,
					data : {
						data : JSON.stringify(h)
					},
					type : "post"
				}, c().done(function (a) {
						a.status ? (e.alert("success", "保存成功!"), a.data && a.data.length && e.alert("info", a.data.join(", ") + "已经被关联，请刷新页面，并选择“转移到”，将关联数据移除后再删除！")) : e.alert("error", a.message)
					}).always(function () {
						g.removeClass("disabled")
					})), void 0)
		},
		"hub/system/get/data" : function (b, c) {
			var d = this;
			c.type = i,
			c.data = [],
			d.$element.find(".category-block").each(function () {
				var b = a(this);
				c.data.push({
					id : b.find('[name*="en_US"]').val().trim(),
					label : b.find('[name*="zh_CN"]').val().trim()
				})
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/core-config/base/main.html", [], function () {
	return function () {
		var a = '<p>\n    <button class="btn btn-primary" data-weave="shared/helper/translation" data-i18n="Save" data-action="config/save"></button>\n</p>\n<div class="tree sepH_a"></div>\n<p>\n    <button class="btn btn-primary" data-weave="shared/helper/translation" data-i18n="Save" data-action="config/save"></button>    \n</p>\n\n<ul class="context-menu hide">\n    <li>\n        <a href="#" data-weave="shared/helper/translation" data-i18n="Rename" data-action="config/rename"></a>\n    </li>\n    <li>\n        <a href="#" data-weave="shared/helper/translation" data-i18n="Add After" data-action="config/add(\'after\')"></a>\n    </li>\n    <li>\n        <a href="#" data-weave="shared/helper/translation" data-i18n="Add Before" data-action="config/add(\'before\')"></a>\n    </li>\n    <li>\n        <a href="#" data-weave="shared/helper/translation" data-i18n="Add Parent" data-action="config/add(\'parent\')"></a>\n    </li>\n    <li>\n        <a href="#" data-weave="shared/helper/translation" data-i18n="Add Child" data-action="config/add(\'append\')"></a>\n    </li>\n    <li>\n        <a href="#" data-weave="shared/helper/translation" data-i18n="转移到..." data-action="config/merge"></a>\n    </li>\n    <li>\n        <a href="#" data-weave="shared/helper/translation" data-i18n="Delete Node" data-action="config/delete"></a>\n    </li>\n</ul>';
		return a
	}
}), define("app/widget/system/core-config/base/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "jquery.tree"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		b.publish("ajax", {
			url : h.LIST.replace("<type>", b._type),
			cache : !1
		}, c().done(function (e) {
				b._json = e,
				c(function (a) {
					b.html(d, a)
				}).done(function () {
					g.call(b, a)
				})
			}))
	}
	function g(b) {
		var c = this;
		c.$tree = c.$element.find(".tree"),
		c.$contextmenu = c.$element.find(".context-menu"),
		c.$tree.tree({
			data : c._json,
			dragAndDrop : !0
		}),
		c.$tree.on("tree.move", function (a) {
			var b = a.move_info.moved_node;
			b.parent_id = b.parent.id
		}),
		c.$tree.on("tree.contextmenu", function (b) {
			var d = b.node,
			e = b.click_event.pageX,
			f = b.click_event.pageY;
			c.$tree.tree("getSelectedNode") !== d && c.$tree.tree("selectNode", d),
			c.$contextmenu.css({
				left : e - 10,
				top : f - 10
			}).removeClass("hide"),
			a(document).on("click.contextmenu", function (b) {
				a(b.target).closest(c.$contextmenu).length || (c.$contextmenu.addClass("hide"), a(this).off(b))
			})
		}),
		b.resolve()
	}
	var h = {
		LIST : "/rest/data/<type>",
		ADD : "/rest/data/<type>_add"
	},
	i = "modal/tree-config/show";
	return b.extend(function (a, b, c) {
		this._type = c
	}, {
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"sig/stop" : function (b, c) {
			a(document).off("click.contextmenu"),
			c.resolve()
		},
		"dom/action.click" : a.noop,
		"dom/action/config/rename" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = d.$tree.tree("getSelectedNode");
			d.$contextmenu.addClass("hide"),
			a(document).off("click.contextmenu"),
			d.publish(i, {
				$tree : d.$tree,
				node : e,
				operation : "edit"
			})
		},
		"dom/action/config/add" : function (b, c, d) {
			c.preventDefault();
			var e = this,
			f = e.$tree.tree("getSelectedNode");
			e.$contextmenu.addClass("hide"),
			a(document).off("click.contextmenu"),
			e.publish(i, {
				$tree : e.$tree,
				node : f,
				operation : d
			})
		},
		"dom/action/config/delete" : function (b, c) {
			c.preventDefault();
			var d = this,
			e = d.$tree.tree("getSelectedNode");
			d.$contextmenu.addClass("hide"),
			a(document).off("click.contextmenu");
			var f = window.confirm("确定要删除这个节点吗？");
			f && d.$tree.tree("removeNode", e)
		},
		"dom/action/config/save" : function (b, d) {
			d.preventDefault();
			var f = this,
			g = a(d.target);
			f.publish("ajax", {
				url : h.ADD.replace("<type>", f._type),
				type : "post",
				data : {
					data : f.$tree.tree("toJson")
				}
			}, c().done(function (a) {
					a.status ? (e.alert("success", "保存设置成功!"), a.data.length && e.alert("error", a.data.join(", ") + "为关联项目不能删除！请刷新页面，右击该节点，并选择“转移到”，将关联数据移除后再删除！")) : e.alert("error", a.message)
				}), g)
		},
		"dom/action/config/merge.click" : function (b, d) {
			d.preventDefault();
			var e = this,
			f = e.$tree.tree("getSelectedNode");
			e.$contextmenu.addClass("hide"),
			a(document).off("click.contextmenu"),
			e.publish("system/modal/merge-node/show", {
				type : e._type,
				selected : f,
				data : JSON.parse(e.$tree.tree("toJson")),
				onSuccess : function () {
					e.publish("ajax", {
						url : h.LIST.replace("<type>", e._type),
						cache : !1
					}, c().done(function (a) {
							e._json = a,
							e.$tree.tree("loadData", e._json)
						}))
				}
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/core-config/main.html", [], function () {
	return function () {
		var a = '<h3 class="heading">核心参数设置</h3>\n\n<p class="muted">编辑说明：上下拖拽节点可以排序或调整上下级关系；鼠标右键点击参数可以新增，编辑或删除；修改后请点击“保存”按钮确认。</p>\n\n<ul class="nav nav-tabs" id="myTab">\n    <li class="active"><a data-toggle="tab" href="#city-tab" data-weave="shared/helper/translation" data-i18n="City"></a></li>\n    <li><a data-toggle="tab" href="#fn-tab" data-weave="shared/helper/translation" data-i18n="Function"></a></li>\n    <li><a data-toggle="tab" href="#industry-tab" data-weave="shared/helper/translation" data-i18n="Industry"></a></li>\n    <li><a data-toggle="tab" href="#team-tab" data-weave="shared/helper/translation" data-i18n="Team"></a></li>\n</ul>\n\n<div class="tab-content">\n    <div class="tab-pane active" id="city-tab" data-weave="app/widget/system/core-config/base/main(\'city\')"></div>\n\n    <div class="tab-pane" id="fn-tab"></div>\n\n    <div class="tab-pane" id="industry-tab"></div>\n    \n    <div class="tab-pane" id="team-tab"></div>\n</div>';
		return a
	}
}), define("app/widget/system/core-config/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		b.html(d, a)
	}
	function f(a) {
		var b = this,
		c = b.$element;
		c.find('a[href="#fn-tab"]').one("show", function () {
			c.find("#fn-tab").attr("data-weave", g + '("function")').weave()
		}),
		c.find('a[href="#industry-tab"]').one("show", function () {
			c.find("#industry-tab").attr("data-weave", g + '("industry")').weave()
		}),
		c.find('a[href="#team-tab"]').one("show", function () {
			c.find("#team-tab").attr("data-weave", g + '("team")').weave()
		}),
		a.resolve()
	}
	var g = "app/widget/system/core-config/base/main";
	return b.extend({
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		},
		"sig/start" : function (a, b) {
			f.call(this, b)
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/document-permission/main.html", [], function () {
	return function () {
		var a = '<h3 class="heading">文档: 权限设置</h3>\n\n<form action="#" class="form-horizontal">\n    <div class="control-group formSep">\n        <label class="control-label"><span data-weave="shared/helper/translation" data-i18n="下载权限"></span></label>\n        <div class="controls">\n            <label class="radio inline"><input name="attachment_allow_download" class="load-key" value="1" type="radio" disabled="disabled" /><span data-weave="shared/helper/translation" data-i18n="所有用户"></label>\n            <label class="radio inline"><input name="attachment_allow_download" class="load-key" value="0" type="radio" disabled="disabled" /><span data-weave="shared/helper/translation" data-i18n="仅上传者"></label>\n            <button class="btn btn-primary action" data-action="setting/radio/edit" data-weave="shared/helper/translation" data-i18n="Edit"></button>\n            <button class="btn btn-primary action hide" data-action="setting/radio/save" data-weave="shared/helper/translation" data-i18n="Save"></button>\n            <button class="btn action hide" data-action="setting/textbox/cancel" data-weave="shared/helper/translation" data-i18n="Cancel"></button>\n        </div>\n    </div>\n</form>';
		return a
	}
}), define("app/widget/system/document-permission/main", ["jquery", "app/widget/system/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		b.html(d, a)
	}
	return b.extend({
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/education-background/item.html", [], function () {
	return function (a) {
		var b = "",
		c = this.randomKey();
		return b += '\n<div class="control-group">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="状态类型"></span>\n    </label>\n    <div class="controls">\n        <input type="text" name="en_US-' + c + '" class="input-medium required" value="' + (a.en_US || "") + '" placeholder="English" ',
		a.en_US && (b += "readonly='readonly'"),
		b += '>\n        <input type="text" name="zh_CN-' + c + '" class="input-medium required" value="' + (a.zh_CN || "") + '" placeholder="中文">\n        \n        <span class="pull-right handler"><span class="icon-move-ns icon-blue"></span></span>\n        \n        <button class="btn pull-right" data-weave="shared/helper/translation" data-i18n="删除学历类型" data-action="delete/status"></button>\n        \n    </div>\n</div>'
	}
}), define("app/widget/system/education-background/item", ["jquery", "app/widget/system/base/options-item", "troopjs-utils/deferred", "template!./item.html"], function (a, b, c, d) {
	return b.extend(function () {
		this._template = d
	})
}), define("troopjs-requirejs/template!app/widget/system/education-background/main.html", [], function () {
	return function () {
		var a = '<h3 class="heading">人才: 学历设置</h3>\n\n<form action="#" class="form-horizontal">\n    \n\n    <div class="control-group">\n        <label class="control-label">\n            <a href="#" data-weave="shared/helper/translation" data-i18n="新增学历类型" data-action="add/status"></a>\n        </label>\n    </div>\n\n    <div class="control-group">\n        <div class="controls">\n            <button class="btn btn-primary" data-weave="shared/helper/translation" data-i18n="Save" data-action="save"></button>\n        </div>\n    </div>\n    \n</form>';
		return a
	}
}), define("app/widget/system/education-background/main", ["jquery", "app/widget/system/base/options-config", "troopjs-utils/deferred", "template!./main.html"], function (a, b, c, d) {
	var e = "education_background",
	f = "app/widget/system/education-background/item";
	return b.extend(function () {
		this._type = e,
		this._itemWidget = f,
		this._template = d
	})
}), define("troopjs-requirejs/template!app/widget/system/email-config/main.html", [], function () {
	return function () {
		var a = '<h3 class="heading">邮件: 服务器设置</h3>\n<form action="#" class="form-horizontal">\n    <div class="control-group">\n        <label for="" class="control-label"><span data-weave="shared/helper/translation" data-i18n="POP3 Server"></label>\n        <div class="controls">\n            <input type="text" class="load-key" name="pop3_server_host" disabled="disabled" />\n            <button class="btn btn-primary action" data-action="setting/textbox/edit" data-weave="shared/helper/translation" data-i18n="Edit"></button>\n            <button class="btn btn-primary action hide" data-action="setting/textbox/save" data-weave="shared/helper/translation" data-i18n="Save"></button>\n            <button class="btn action hide" data-action="setting/textbox/cancel" data-weave="shared/helper/translation" data-i18n="Cancel"></button>\n        </div>\n    </div>\n</form>\n<form action="#" class="form-horizontal">\n    <div class="control-group">\n        <label for="" class="control-label"><span data-weave="shared/helper/translation" data-i18n="POP3 Port"></label>\n        <div class="controls">\n            <input type="text" class="load-key" name="pop3_server_port" disabled="disabled" />\n            <button class="btn btn-primary action" data-action="setting/textbox/edit" data-weave="shared/helper/translation" data-i18n="Edit"></button>\n            <button class="btn btn-primary action hide" data-action="setting/textbox/save" data-weave="shared/helper/translation" data-i18n="Save"></button>\n            <button class="btn action hide" data-action="setting/textbox/cancel" data-weave="shared/helper/translation" data-i18n="Cancel"></button>\n        </div>\n    </div>\n</form>\n<form action="#" class="form-horizontal">\n    <div class="control-group formSep">\n        <label for="" class="control-label"><span data-weave="shared/helper/translation" data-i18n="POP3 Use SSL"></label>\n        <div class="controls">\n            <label class="radio inline"><input name="pop3_server_ssl" class="load-key" value="1" type="radio" disabled="disabled" /><span data-weave="shared/helper/translation" data-i18n="Yes"></label>\n            <label class="radio inline"><input name="pop3_server_ssl" class="load-key" value="0" type="radio" disabled="disabled" /><span data-weave="shared/helper/translation" data-i18n="No"></label>\n            <button class="btn btn-primary action" data-action="setting/radio/edit" data-weave="shared/helper/translation" data-i18n="Edit"></button>\n            <button class="btn btn-primary action hide" data-action="setting/radio/save" data-weave="shared/helper/translation" data-i18n="Save"></button>\n            <button class="btn action hide" data-action="setting/textbox/cancel" data-weave="shared/helper/translation" data-i18n="Cancel"></button>\n        </div>\n    </div>\n</form>\n<form action="#" class="form-horizontal">\n    <div class="control-group">\n        <label for="" class="control-label"><span data-weave="shared/helper/translation" data-i18n="SMTP Server"></label>\n        <div class="controls">\n            <input type="text" class="load-key" name="smtp_server_host" disabled="disabled" />\n            <button class="btn btn-primary action" data-action="setting/textbox/edit" data-weave="shared/helper/translation" data-i18n="Edit"></button>\n            <button class="btn btn-primary action hide" data-action="setting/textbox/save" data-weave="shared/helper/translation" data-i18n="Save"></button>\n            <button class="btn action hide" data-action="setting/textbox/cancel" data-weave="shared/helper/translation" data-i18n="Cancel"></button>\n        </div>\n    </div>\n</form>\n<form action="#" class="form-horizontal">\n    <div class="control-group">\n        <label for="" class="control-label"><span data-weave="shared/helper/translation" data-i18n="SMTP Port"></label>\n        <div class="controls">\n            <input type="text" class="load-key" name="smtp_server_port" disabled="disabled" />\n            <button class="btn btn-primary action" data-action="setting/textbox/edit" data-weave="shared/helper/translation" data-i18n="Edit"></button>\n            <button class="btn btn-primary action hide" data-action="setting/textbox/save" data-weave="shared/helper/translation" data-i18n="Save"></button>\n            <button class="btn action hide" data-action="setting/textbox/cancel" data-weave="shared/helper/translation" data-i18n="Cancel"></button>\n        </div>\n    </div>\n</form>\n<form action="#" class="form-horizontal">\n    <div class="control-group formSep">\n        <label for="" class="control-label"><span data-weave="shared/helper/translation" data-i18n="SMTP Use SSL"></label>\n        <div class="controls">\n            <label class="radio inline"><input name="smtp_server_ssl" class="load-key" value="1" type="radio" disabled="disabled" /><span data-weave="shared/helper/translation" data-i18n="Yes"></label>\n            <label class="radio inline"><input name="smtp_server_ssl" class="load-key" value="0" type="radio" disabled="disabled" /><span data-weave="shared/helper/translation" data-i18n="No"></label>\n            <button class="btn btn-primary action" data-action="setting/radio/edit" data-weave="shared/helper/translation" data-i18n="Edit"></button>\n            <button class="btn btn-primary action hide" data-action="setting/radio/save" data-weave="shared/helper/translation" data-i18n="Save"></button>\n            <button class="btn action hide" data-action="setting/textbox/cancel" data-weave="shared/helper/translation" data-i18n="Cancel"></button>\n        </div>\n    </div>\n</form>\n<form action="#" class="form-horizontal">\n    <div class="control-group formSep">\n        <label class="control-label" data-weave="shared/helper/translation" data-i18n="Email bcc to user"></label>\n        <div class="controls">\n            <label class="radio inline"><input name="mail_bcc" class="load-key" value="1" type="radio" disabled="disabled" /><span data-weave="shared/helper/translation" data-i18n="Yes"></span></label>\n            <label class="radio inline"><input name="mail_bcc" class="load-key" value="0" type="radio" disabled="disabled" /><span data-weave="shared/helper/translation" data-i18n="No"></span></label>\n            <button class="btn btn-primary action" data-action="setting/radio/edit" data-weave="shared/helper/translation" data-i18n="Edit"></button>\n            <button class="btn btn-primary action hide" data-action="setting/radio/save" data-weave="shared/helper/translation" data-i18n="Save"></button>\n            <button class="btn action hide" data-action="setting/textbox/cancel" data-weave="shared/helper/translation" data-i18n="Cancel"></button>\n        </div>\n    </div>\n</form>';
		return a
	}
}), define("app/widget/system/email-config/main", ["jquery", "app/widget/system/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		b.html(d, a)
	}
	return b.extend({
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/email-template-config/main.html", [], function () {
	return function () {
		var a = '<h3 class="heading">邮件: 模板设置</h3>\n\n<p class="muted">在使用前请您耐心仔细阅读地<a href="http://support.gllue.com/?p=1379" target="_blank" data-weave="shared/helper/translation" data-i18n="Tutorial"></a>。</p>\n\n<h5>人才模块</h5>\n\n<form action="#" class="form-horizontal">\n    <div class="control-group formSep">\n        <label for="" class="control-label"><span data-weave="shared/helper/translation" data-i18n="Send email to people"></label>\n        <div class="controls">\n            <select class="load-dropdown" data-type="email" name="candidate_email">\n            </select>\n            <button class="btn btn-primary action" data-action="setting/popup/edit(email, people)" data-weave="shared/helper/translation" data-i18n="Edit"></button>\n            <button class="btn btn-primary action" data-action="setting/popup/add(email, people)" data-weave="shared/helper/translation" data-i18n="Add"></button>\n            <button class="btn action" data-action="reorder/template" data-weave="shared/helper/translation" data-i18n="排序"></button>\n            <button class="btn btn-danger action" data-action="setting/popup/delete(email)" data-weave="shared/helper/translation" data-i18n="Delete"></button>\n        </div>\n    </div>\n</form>\n\n<form action="#" class="form-horizontal">\n    <div class="control-group formSep">\n        <label for="" class="control-label"><span data-weave="shared/helper/translation" data-i18n="Floating"></label>\n        <div class="controls">\n            <select class="load-dropdown" data-type="email" name="floating">\n            </select>\n            <button class="btn btn-primary action" data-action="setting/popup/edit(email, people)" data-weave="shared/helper/translation" data-i18n="Edit"></button>\n            <button class="btn btn-primary action" data-action="setting/popup/add(email, people)" data-weave="shared/helper/translation" data-i18n="Add"></button>\n            <button class="btn action" data-action="reorder/template" data-weave="shared/helper/translation" data-i18n="排序"></button>\n            <button class="btn btn-danger action" data-action="setting/popup/delete(email)" data-weave="shared/helper/translation" data-i18n="Delete"></button>\n        </div>\n    </div>\n</form>\n\n<h5>项目模块</h5>\n\n<form action="#" class="form-horizontal">\n    <div class="control-group formSep">\n        <label for="" class="control-label"><span data-weave="shared/helper/translation" data-i18n="CV Sent"></label>\n        <div class="controls">\n            <select class="load-dropdown" data-type="email" name="cv_sent">\n            </select>\n            <button class="btn btn-primary action" data-action="setting/popup/edit(email)" data-weave="shared/helper/translation" data-i18n="Edit"></button>\n            <button class="btn btn-primary action" data-action="setting/popup/add(email)" data-weave="shared/helper/translation" data-i18n="Add"></button>\n            <button class="btn action" data-action="reorder/template" data-weave="shared/helper/translation" data-i18n="排序"></button>\n            <button class="btn btn-danger action" data-action="setting/popup/delete(email)" data-weave="shared/helper/translation" data-i18n="Delete"></button>\n        </div>\n    </div>\n</form>\n<form action="#" class="form-horizontal">\n    <div class="control-group formSep">\n        <label for="" class="control-label"><span data-weave="shared/helper/translation" data-i18n="Email Confirm Candidate"></label>\n        <div class="controls">\n            <select class="load-dropdown" data-type="email" name="candidate_interview">\n            </select>\n            <button class="btn btn-primary action" data-action="setting/popup/edit(email)" data-weave="shared/helper/translation" data-i18n="Edit"></button>\n            <button class="btn btn-primary action" data-action="setting/popup/add(email)" data-weave="shared/helper/translation" data-i18n="Add"></button>\n            <button class="btn action" data-action="reorder/template" data-weave="shared/helper/translation" data-i18n="排序"></button>\n            <button class="btn btn-danger action" data-action="setting/popup/delete(email)" data-weave="shared/helper/translation" data-i18n="Delete"></button>\n        </div>\n    </div>\n</form>\n<form action="#" class="form-horizontal">\n    <div class="control-group formSep">\n        <label for="" class="control-label"><span data-weave="shared/helper/translation" data-i18n="Email Confirm Client"></label>\n        <div class="controls">\n            <select class="load-dropdown" data-type="email" name="client_interview">\n            </select>\n            <button class="btn btn-primary action" data-action="setting/popup/edit(email)" data-weave="shared/helper/translation" data-i18n="Edit"></button>\n            <button class="btn btn-primary action" data-action="setting/popup/add(email)" data-weave="shared/helper/translation" data-i18n="Add"></button>\n            <button class="btn action" data-action="reorder/template" data-weave="shared/helper/translation" data-i18n="排序"></button>\n            <button class="btn btn-danger action" data-action="setting/popup/delete(email)" data-weave="shared/helper/translation" data-i18n="Delete"></button>\n        </div>\n    </div>\n</form>';
		return a
	}
}), define("app/widget/system/email-template-config/main", ["jquery", "app/widget/system/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		b.html(d, a)
	}
	return b.extend(function (a, b, c) {
		this._personal = c
	}, {
		"hub:memory/context" : function (a, b) {
			var d = this;
			d._personal && (d._userId = b.user.id),
			e.call(d, c())
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/email/main.html", [], function () {
	return function () {
		var a = '<h3 class="heading" data-weave="shared/helper/translation" data-i18n="Email Setting"></h3>\r\n<form action="#" class="form-horizontal">\r\n    <div class="control-group">\r\n        <label for="originpass" class="control-label" data-weave="shared/helper/translation" data-i18n="Email Address"></label>\r\n        <div class="controls">\r\n            <input type="text" name="username" disabled="disabled" />\r\n        </div>\r\n    </div>\r\n    <div class="control-group">\r\n        <label for="newpass" class="control-label" data-weave="shared/helper/translation" data-i18n="Email Password"></label>\r\n        <div class="controls">\r\n            <input type="password" name="password" />\r\n        </div>\r\n    </div>\r\n\r\n    <div class="control-group">\r\n        <label for="newpass" class="control-label" data-weave="shared/helper/translation" data-i18n="是否启用Gllue收取邮件"></label>\r\n        <div class="controls">\r\n            <label class="radio inline">\r\n                <input type="radio" name="enablepop" value="true" data-action="enablepop">是\r\n            </label>\r\n            <label class="radio inline">\r\n                <input type="radio" name="enablepop" value="false" data-action="enablepop">否\r\n            </label>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="control-group when-group hide">\r\n        <label for="newpass" class="control-label" data-weave="shared/helper/translation" data-i18n="收取邮件天数"></label>\r\n        <div class="controls">\r\n            <label class="radio inline">\r\n                <input type="radio" name="when" value="7" checked="checked">\r\n                <span data-weave="shared/helper/translation" data-i18n="1 Week"></span>\r\n            </label>\r\n            <label class="radio inline">\r\n                <input type="radio" name="when" value="30">\r\n                <span data-weave="shared/helper/translation" data-i18n="1 Month"></span>\r\n            </label>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="control-group">\r\n        <div class="controls">\r\n            <button class="btn btn-primary" data-action="save" data-weave="shared/helper/translation" data-i18n="Save"></button>\r\n        </div>\r\n    </div>\r\n</form>\r\n<div class="divSep">\r\n    <button class="btn" data-action="test" data-weave="shared/helper/translation" data-i18n="Send test email"></button>\r\n</div>\r\n<div>\r\n    <button class="btn" data-action="edit" data-weave="shared/helper/translation" data-i18n="Edit Email Signature"></button>\r\n</div>';
		return a
	}
}), define("app/widget/system/email/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "shared/helper/utils"], function (a, b, c, d, e, f) {
	function g(a) {
		var b = this;
		b.html(e, b._json, a)
	}
	var h = {
		ENABLE : "/rest/user/enablepop",
		EMAIL_SETTING : "/rest/user/changeemailpassword"
	};
	return b.extend({
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"hub:memory/context" : function (a, b) {
			var c = this;
			c.$whenGroup = c.$element.find(".when-group"),
			c._user = b.user,
			c.$element.find("[name=username]").val(c._user.email),
			c.$element.find("[name=password]").val(c._user.emailpassword),
			c._user.enablePop ? c.$element.find('[name="enablepop"]').filter('[value="true"]').prop("checked", !0) : c.$element.find('[name="enablepop"]').filter('[value="false"]').prop("checked", !0)
		},
		"dom/action.click" : a.noop,
		"dom/action/enablepop.click" : function (b, c) {
			var d = this,
			e = a(c.target);
			"true" === e.val() ? d.$whenGroup.removeClass("hide") : d.$whenGroup.addClass("hide")
		},
		"dom/action/save.click" : function (b, e) {
			e.preventDefault();
			var g = a(e.target),
			i = this,
			j = a(e.target).parents("form"),
			k = j.find("[name=password]").val(),
			l = {},
			m = {};
			if (!k)
				return f.alert("error", "Password can not be empty."), void 0;
			var n,
			o,
			p = [],
			q = c(),
			r = c();
			p.push(q.promise(), r.promise()),
			l.id = this._user.id,
			l.emailpassword = k,
			m = {
				enablePop : "true" === i.$element.find('[name="enablepop"]:checked').val(),
				when : i.$element.find('[name="when"]:checked').val()
			},
			i.publish("ajax", {
				url : h.EMAIL_SETTING,
				data : {
					data : JSON.stringify(l)
				},
				type : "post"
			}, q.done(function (a) {
					n = a,
					o && (n.status && o.status ? f.alert("success", "Email setting success!") : (n.status || f.alert("error", n.message), o.status || f.alert("error", o.message)))
				}), g),
			i.publish("ajax", {
				url : h.ENABLE,
				data : {
					data : JSON.stringify(m)
				},
				type : "post"
			}, r.done(function (a) {
					o = a,
					n && (n.status && o.status ? f.alert("success", "Email setting success!") : (n.status || f.alert("error", n.message), o.status || f.alert("error", o.message)))
				}), g),
			d.call(a, p)
		},
		"dom/action/edit.click" : function (a, b) {
			b.preventDefault(),
			this.publish("modal/email-signature/show")
		},
		"dom/action/test.click" : function (b, d) {
			d.preventDefault();
			var e = this,
			g = a(d.target),
			h = this.$element.find("[name=password]");
			return h.val() ? (e.publish("ajax", {
					url : "/rest/user/testmail"
				}, c().done(function (a) {
						a.status ? f.alert("success", "Send test email success.") : f.alert("error", "Send test email failed. You may not [ Save ] it before send or invalid password.")
					}), g), void 0) : (h.focus(), f.alert("error", "Password can not be empty."), void 0)
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/job-note-config/item.html", [], function () {
	return function (a) {
		var b = "",
		c = this.randomKey();
		if (b += '\n<div class="control-group">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="备注类型"></span>\n    </label>\n    <div class="controls">\n        <input type="text" name="en_US-' + c + '" class="input-medium required" value="' + (a.en_US || "") + '" placeholder="English" ', a.en_US && (b += "readonly='readonly'"), b += '>\n        <input type="text" name="zh_CN-' + c + '" class="input-medium required" value="' + (a.zh_CN || "") + '" placeholder="中文">\n        \n        <div class="pull-right actions">\n            ', a.code && (b += '\n            <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="转移到..." data-action="transfer/category"></button>\n            '), b += '\n            <button class="btn btn-small btn-danger" data-weave="shared/helper/translation" data-i18n="Delete category" data-action="delete/category"></button>\n            <span class="handler"><span class="icon-move-ns icon-blue"></span></span>\n        </div>\n    </div>\n</div>\n<div class="control-group">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="标签背景色"></span>\n    </label>\n    <div class="controls">\n        <input type="color" name="color" class="input-mini" value="' + a.color + '">\n    </div>\n</div>\n\n<div class="control-group formSep">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="Question"></span>\n    </label>\n\n    ', a.ext) {
			b += "\n    ";
			for (var d = JSON.parse(a.ext), e = 0, f = d.length; f > e; e++)
				b += '\n    <div class="controls">\n        <input type="text" class="input-xxlarge" value="' + d[e].field + '" name="question">\n        <button class="btn btn-danger btn-small pull-right btn-delete" data-weave="shared/helper/translation" data-i18n="Delete Question" data-action="delete/question"></button>\n    </div>\n    ';
			b += "\n    "
		} else
			b += '\n    <div class="controls">\n        <input type="text" class="input-xxlarge " name="question">\n        <button class="btn btn-danger btn-small pull-right btn-delete" data-weave="shared/helper/translation" data-i18n="Delete Question" data-action="delete/question"></button>\n    </div>\n    ';
		return b += '\n    <div class="controls text_line">\n        <a href="#" data-weave="shared/helper/translation" data-i18n="新增问题" data-action="add/question"></a>\n    </div>\n</div>'
	}
}), define("app/widget/system/job-note-config/item", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./item.html", "template!app/widget/system/base/question.html", "shared/helper/utils"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		c(function (a) {
			b.html(d, b._json, a)
		}).done(function () {
			b.$element.find('[data-action="delete/question"]').eq(0).remove(),
			a.resolve()
		})
	}
	return b.extend(function (a, b, c) {
		this._json = c || {}

	}, {
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"dom/action.click" : a.noop,
		"dom/action/transfer/category" : function (b, c) {
			c.preventDefault();
			var d = this;
			a(c.target);
			var e = {};
			d.publish("system/get/data", e),
			d.publish("system/modal/merge-node/show", {
				type : e.type,
				selected : {
					id : d._json.code,
					name : d._json.value
				},
				data : e.data,
				onSuccess : function () {}

			})
		},
		"dom/action/delete/category" : function (b, c) {
			c.preventDefault();
			var d = this;
			a(c.target);
			var e = window.confirm("确认要删除此类型吗?");
			e && d.$element.remove()
		},
		"dom/action/delete/question" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = window.confirm("确认要删除此问题吗?");
			e && d.closest(".controls").remove()
		},
		"dom/action/add/question" : function (b, d) {
			d.preventDefault();
			var f = a(d.target),
			g = a(e());
			g.find("[data-weave]").weave(c(function () {
					f.closest(".controls").before(g)
				}))
		},
		randomKey : function () {
			return parseInt(1e5 * Math.random(), 10)
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/job-note-config/main.html", [], function () {
	return function () {
		var a = '<h3 class="heading">项目: 备注类型设置</h3>\n\n<form action="#" class="form-horizontal">\n    <div class="control-group">\n        <label class="control-label">\n            <a href="#" data-weave="shared/helper/translation" data-i18n="新增备注类型" data-action="add/category"></a>\n        </label>\n    </div>\n\n    <div class="control-group">\n        <div class="controls">\n            <button class="btn btn-primary" data-weave="shared/helper/translation" data-i18n="Save" data-action="save"></button>\n        </div>\n    </div>\n    \n</form>';
		return a
	}
}), define("app/widget/system/job-note-config/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "shared/helper/validate", "jquery.ui"], function (a, b, c, d, e, f) {
	function g(b) {
		var e = this;
		e.html(d, e._json, b),
		e.publish("ajax", {
			url : j.CONFIG_KEYS.replace("<type>", i),
			cache : !1
		}, c().done(function (b) {
				e._json = b,
				b.forEach(function (b) {
					var d = a('<div class="category-block"></div>');
					d.data("json", b).attr("data-weave", "app/widget/system/job-note-config/item(json)").weave(c(function () {
							e.$element.find('[data-action="add/category"]').closest(".control-group").before(d)
						}))
				})
			}))
	}
	function h(a) {
		var b = this;
		b.$form = b.$element.find("form"),
		b.$form.sortable({
			items : ".category-block",
			handle : ".handler",
			cursor : "move",
			axis : "y"
		}),
		f(b.$form),
		a.resolve()
	}
	var i = "joborder_note_category",
	j = {
		CONFIG_KEYS : "/rest/data/options?type=<type>",
		CONFIG_ADD : "/rest/data/options/add"
	};
	return b.extend({
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"sig/start" : function (a, b) {
			h.call(this, b)
		},
		"dom/action.click" : a.noop,
		"dom/action/add/category.click" : function (b, d) {
			d.preventDefault();
			var e = a(d.target),
			f = a('<div class="category-block"></div>');
			f.attr("data-weave", "app/widget/system/job-note-config/item").weave(c(function () {
					e.closest(".control-group").before(f)
				}))
		},
		"dom/action/save.click" : function (b, d) {
			d.preventDefault();
			var f = this,
			g = a(d.target),
			h = {},
			k = [];
			return g.hasClass("disabled") || !f.$form.valid() ? !1 : (g.addClass("disabled"), f.$element.find(".category-block").each(function () {
					var b = a(this),
					c = [];
					b.find('[name*="question"]').each(function () {
						a(this),
						c.push({
							field : a(this).val().trim(),
							required : !0
						})
					}),
					k.push({
						code : b.find('[name*="en_US"]').val().trim(),
						zh_CN : b.find('[name*="zh_CN"]').val().trim(),
						en_US : b.find('[name*="en_US"]').val().trim(),
						color : b.find('[name*="color"]').val() || "",
						is_buildin : !1,
						ext : JSON.stringify(c)
					})
				}), h = {
					type : i,
					values : k
				}, f.publish("ajax", {
					url : j.CONFIG_ADD,
					data : {
						data : JSON.stringify(h)
					},
					type : "post"
				}, c().done(function (a) {
						a.status ? (e.alert("success", "保存成功!"), a.data && a.data.length && e.alert("info", a.data.join(", ") + "已经被关联，请刷新页面，并选择“转移到”，将关联数据移除后再删除！")) : e.alert("error", a.message)
					}).always(function () {
						g.removeClass("disabled")
					})), void 0)
		},
		"hub/system/get/data" : function (b, c) {
			var d = this;
			c.type = i,
			c.data = [],
			d.$element.find(".category-block").each(function () {
				var b = a(this);
				c.data.push({
					id : b.find('[name*="en_US"]').val().trim(),
					label : b.find('[name*="zh_CN"]').val().trim()
				})
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/joborder-fields/main.html", [], function () {
	return function (a) {
		var b = '<h3 class="heading">项目: 新增字段</h3>\n\n<p>若将字段留空，则该字段将不会出现在新增项目中</p>\n\n<form action="#" class="form-horizontal">\n    <div class="control-group">\n        <label for="ext1" class="control-label"><span data-weave="shared/helper/translation" data-i18n="扩展字段1"></span></label>\n        <div class="controls">\n            <input type="text" id="ext1" name="ext1" class="input-medium" value="' + a.ext1 + '">\n        </div>\n    </div>\n    <div class="control-group">\n        <label for="ext2" class="control-label"><span data-weave="shared/helper/translation" data-i18n="扩展字段2"></span></label>\n        <div class="controls">\n            <input type="text" id="ext2" name="ext2" class="input-medium" value="' + a.ext2 + '">\n        </div>\n    </div>\n    <div class="control-group">\n        <label for="ext3" class="control-label"><span data-weave="shared/helper/translation" data-i18n="扩展字段3"></span></label>\n        <div class="controls">\n            <input type="text" id="ext3" name="ext3" class="input-medium" value="' + a.ext3 + '">\n        </div>\n    </div>\n    <div class="control-group">\n        <label for="ext4" class="control-label"><span data-weave="shared/helper/translation" data-i18n="扩展字段4"></span></label>\n        <div class="controls">\n            <input type="text" id="ext4" name="ext4" class="input-medium" value="' + a.ext4 + '">\n        </div>\n    </div>\n    <div class="control-group">\n        <label for="ext5" class="control-label"><span data-weave="shared/helper/translation" data-i18n="扩展字段5"></span></label>\n        <div class="controls">\n            <input type="text" id="ext5" name="ext5" class="input-medium" value="' + a.ext5 + '">\n        </div>\n    </div>\n    <div class="control-group">\n        <label for="ext6" class="control-label"><span data-weave="shared/helper/translation" data-i18n="扩展字段6"></span></label>\n        <div class="controls">\n            <input type="text" id="ext6" name="ext6" class="input-medium" value="' + a.ext6 + '">\n        </div>\n    </div>\n    <div class="control-group">\n        <div class="controls">\n            <button class="btn btn-primary" data-weave="shared/helper/translation" data-i18n="Save" data-action="save"></button>\n        </div>\n    </div>\n</form>';
		return b
	}
}), define("app/widget/system/joborder-fields/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		b.publish("ajax", {
			url : i.CONFIG_KEYS.replace("<keys>", h),
			cache : !1
		}, c().done(function (c) {
				b._json = JSON.parse(c[0].value),
				b._configId = c[0].id,
				b.html(d, b._json, a)
			}))
	}
	function g(a) {
		a.resolve()
	}
	var h = "joborder_field_names",
	i = {
		CONFIG_KEYS : "/rest/data/configvalue?keys=<keys>",
		CONFIG_ADD : "/rest/data/configvalue/add"
	};
	return b.extend({
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"sig/start" : function (a, b) {
			g.call(this, b)
		},
		"dom/action.click" : a.noop,
		"dom/action/save.click" : function (b, d) {
			d.preventDefault();
			var f = this,
			g = a(d.target),
			j = {},
			k = f.$element.find("form");
			if (k.valid()) {
				j = {
					ext1 : k.find("#ext1").val().trim(),
					ext2 : k.find("#ext2").val().trim(),
					ext3 : k.find("#ext3").val().trim(),
					ext4 : k.find("#ext4").val().trim(),
					ext5 : k.find("#ext5").val().trim(),
					ext6 : k.find("#ext6").val().trim()
				};
				var l = {
					id : f._configId,
					type : "",
					name : h,
					value : JSON.stringify(j)
				};
				f.publish("ajax", {
					url : i.CONFIG_ADD,
					data : {
						data : JSON.stringify(l)
					},
					type : "post"
				}, c().done(function (a) {
						a.status ? e.alert("success", "保存成功!") : e.alert("error", a.message)
					}), g)
			}
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/jobsubmission-note-config/item.html", [], function () {
	return function (a) {
		var b = "",
		c = this.randomKey();
		if (b += '\n<div class="control-group">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="备注类型"></span>\n    </label>\n    <div class="controls">\n        <input type="text" name="en_US-' + c + '" class="input-medium required" value="' + (a.en_US || "") + '" placeholder="English" ', a.en_US && (b += "readonly='readonly'"), b += '>\n        <input type="text" name="zh_CN-' + c + '" class="input-medium required" value="' + (a.zh_CN || "") + '" placeholder="中文">\n        \n        <div class="pull-right actions">\n            ', a.code && (b += '\n            <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="转移到..." data-action="transfer/category"></button>\n            '), b += '\n            <button class="btn btn-small btn-danger" data-weave="shared/helper/translation" data-i18n="Delete category" data-action="delete/category"></button>\n            <span class="handler"><span class="icon-move-ns icon-blue"></span></span>\n        </div>\n    </div>\n</div>\n<div class="control-group">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="标签背景色"></span>\n    </label>\n    <div class="controls">\n        <input type="color" name="color" class="input-mini" value="' + a.color + '">\n    </div>\n</div>\n\n<div class="control-group formSep ', a.is_buildin && (b += "hide"), b += '">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="Question"></span>\n    </label>\n\n    ', a.ext) {
			b += "\n    ";
			for (var d = JSON.parse(a.ext), e = 0, f = d.length; f > e; e++)
				b += '\n    <div class="controls">\n        <input type="text" class="input-xxlarge" value="' + d[e].field + '" name="question">\n        <button class="btn btn-danger btn-small pull-right btn-delete" data-weave="shared/helper/translation" data-i18n="Delete Question" data-action="delete/question"></button>\n    </div>\n    ';
			b += "\n    "
		} else
			b += '\n    <div class="controls">\n        <input type="text" class="input-xxlarge " name="question">\n        <button class="btn btn-danger btn-small pull-right btn-delete" data-weave="shared/helper/translation" data-i18n="Delete Question" data-action="delete/question"></button>\n    </div>\n    ';
		return b += '\n    <div class="controls text_line">\n        <a href="#" data-weave="shared/helper/translation" data-i18n="新增问题" data-action="add/question"></a>\n    </div>\n</div>'
	}
}), define("app/widget/system/jobsubmission-note-config/item", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./item.html", "template!app/widget/system/base/question.html", "shared/helper/utils"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		c(function (a) {
			b.html(d, b._json, a)
		}).done(function () {
			b.$element.find('[data-action="delete/question"]').eq(0).remove(),
			a.resolve()
		})
	}
	return b.extend(function (a, b, c) {
		this._json = c || {}

	}, {
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"dom/action.click" : a.noop,
		"dom/action/transfer/category" : function (b, c) {
			c.preventDefault();
			var d = this;
			a(c.target);
			var e = {};
			d.publish("system/get/data", e),
			d.publish("system/modal/merge-node/show", {
				type : e.type,
				selected : {
					id : d._json.code,
					name : d._json.value
				},
				data : e.data,
				onSuccess : function () {}

			})
		},
		"dom/action/delete/category" : function (b, c) {
			c.preventDefault();
			var d = this;
			a(c.target);
			var e = window.confirm("确认要删除此类型吗?");
			e && d.$element.remove()
		},
		"dom/action/delete/question" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = window.confirm("确认要删除此问题吗?");
			e && d.closest(".controls").remove()
		},
		"dom/action/add/question" : function (b, d) {
			d.preventDefault();
			var f = a(d.target);
			if (10 === f.closest(".control-group").find(".controls:not(.text_line)").length)
				return alert("最多添加十个问题!"), void 0;
			var g = a(e());
			g.find("[data-weave]").weave(c(function () {
					f.closest(".controls").before(g)
				}))
		},
		randomKey : function () {
			return parseInt(1e5 * Math.random(), 10)
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/jobsubmission-note-config/main.html", [], function () {
	return function () {
		var a = '<h3 class="heading">项目流程: 备注类型设置</h3>\n\n<form action="#" class="form-horizontal">\n    <div class="control-group">\n        <label class="control-label">\n            <a href="#" data-weave="shared/helper/translation" data-i18n="新增备注类型" data-action="add/category"></a>\n        </label>\n    </div>\n\n    <div class="control-group">\n        <div class="controls">\n            <button class="btn btn-primary" data-weave="shared/helper/translation" data-i18n="Save" data-action="save"></button>\n        </div>\n    </div>\n    \n</form>';
		return a
	}
}), define("app/widget/system/jobsubmission-note-config/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "shared/helper/validate", "jquery.ui"], function (a, b, c, d, e, f) {
	function g(b) {
		var e = this;
		e.html(d, e._json, b),
		e.publish("ajax", {
			url : j.CONFIG_KEYS.replace("<type>", i),
			cache : !1
		}, c().done(function (b) {
				e._json = b,
				b.forEach(function (b) {
					var d = a('<div class="category-block"></div>');
					d.data("json", b).attr("data-weave", "app/widget/system/jobsubmission-note-config/item(json)").weave(c(function () {
							e.$element.find('[data-action="add/category"]').closest(".control-group").before(d)
						}))
				})
			}))
	}
	function h(a) {
		var b = this;
		b.$form = b.$element.find("form"),
		b.$form.sortable({
			items : ".category-block",
			handle : ".handler",
			cursor : "move",
			axis : "y"
		}),
		f(b.$form),
		a.resolve()
	}
	var i = "jobsubmission_note_category",
	j = {
		CONFIG_KEYS : "/rest/data/options?type=<type>",
		CONFIG_ADD : "/rest/data/options/add"
	};
	return b.extend({
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"sig/start" : function (a, b) {
			h.call(this, b)
		},
		"dom/action.click" : a.noop,
		"dom/action/add/category.click" : function (b, d) {
			d.preventDefault();
			var e = a(d.target),
			f = a('<div class="category-block"></div>');
			f.attr("data-weave", "app/widget/system/jobsubmission-note-config/item").weave(c(function () {
					e.closest(".control-group").before(f)
				}))
		},
		"dom/action/save.click" : function (b, d) {
			d.preventDefault();
			var f = this,
			g = a(d.target),
			h = {},
			k = [];
			return g.hasClass("disabled") || !f.$form.valid() ? !1 : (g.addClass("disabled"), f.$element.find(".category-block").each(function () {
					var b = a(this),
					c = [];
					b.find('[name*="question"]').each(function () {
						a(this),
						c.push({
							field : a(this).val().trim(),
							required : !0
						})
					}),
					k.push({
						code : b.find('[name*="en_US"]').val().trim(),
						zh_CN : b.find('[name*="zh_CN"]').val().trim(),
						en_US : b.find('[name*="en_US"]').val().trim(),
						color : b.find('[name*="color"]').val() || "",
						is_buildin : !1,
						ext : JSON.stringify(c)
					})
				}), h = {
					type : i,
					values : k
				}, f.publish("ajax", {
					url : j.CONFIG_ADD,
					data : {
						data : JSON.stringify(h)
					},
					type : "post"
				}, c().done(function (a) {
						a.status ? (e.alert("success", "保存成功!"), a.data && a.data.length && e.alert("info", a.data.join(", ") + "已经被关联，请刷新页面，并选择“转移到”，将关联数据移除后再删除！")) : e.alert("error", a.message)
					}).always(function () {
						g.removeClass("disabled")
					})), void 0)
		},
		"hub/system/get/data" : function (b, c) {
			var d = this;
			c.type = i,
			c.data = [],
			d.$element.find(".category-block").each(function () {
				var b = a(this);
				c.data.push({
					id : b.find('[name*="en_US"]').val().trim(),
					label : b.find('[name*="zh_CN"]').val().trim()
				})
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/jobsubmission-note-status/item.html", [], function () {
	return function (a) {
		var b = "",
		c = this.randomKey();
		return b += '\n<div class="control-group">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="状态类型"></span>\n    </label>\n    <div class="controls">\n        <input type="text" name="en_US-' + c + '" class="input-medium required" value="' + (a.en_US || "") + '" placeholder="English" ',
		a.en_US && (b += "readonly='readonly'"),
		b += '>\n        <input type="text" name="zh_CN-' + c + '" class="input-medium required" value="' + (a.zh_CN || "") + '" placeholder="中文">\n        \n        <div class="pull-right actions">\n            ',
		a.code && (b += '\n            <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="转移到..." data-action="transfer/status"></button>\n            '),
		b += '\n            <button class="btn btn-small btn-danger" data-weave="shared/helper/translation" data-i18n="删除状态" data-action="delete/status"></button>\n            <span class="handler"><span class="icon-move-ns icon-blue"></span></span>\n        </div>\n        \n    </div>\n</div>\n<div class="control-group formSep">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="标签背景色"></span>\n    </label>\n    <div class="controls">\n        <input type="color" name="color" class="input-mini" value="' + a.color + '">\n    </div>\n</div>'
	}
}), define("app/widget/system/jobsubmission-note-status/item", ["jquery", "app/widget/system/base/options-item", "troopjs-utils/deferred", "template!./item.html"], function (a, b, c, d) {
	return b.extend(function () {
		this._template = d
	})
}), define("troopjs-requirejs/template!app/widget/system/jobsubmission-note-status/main.html", [], function () {
	return function () {
		var a = '<h3 class="heading">项目流程: 备注状态设置</h3>\n\n<form action="#" class="form-horizontal">\n    \n    <div class="control-group">\n        <label class="control-label">\n            <a href="#" data-weave="shared/helper/translation" data-i18n="新增状态类型" data-action="add/status"></a>\n        </label>\n    </div>\n\n    <div class="control-group">\n        <div class="controls">\n            <button class="btn btn-primary" data-weave="shared/helper/translation" data-i18n="Save" data-action="save"></button>\n        </div>\n    </div>\n    \n</form>';
		return a
	}
}), define("app/widget/system/jobsubmission-note-status/main", ["jquery", "app/widget/system/base/options-config", "troopjs-utils/deferred", "template!./main.html"], function (a, b, c, d) {
	var e = "jobsubmission_status",
	f = "app/widget/system/jobsubmission-note-status/item";
	return b.extend(function () {
		this._type = e,
		this._itemWidget = f,
		this._template = d
	})
}), define("troopjs-requirejs/template!app/widget/system/license/main.html", [], function () {
	return function (a) {
		var b = '<h3 class="heading" data-weave="shared/helper/translation" data-i18n="License Management"></h3>\n<div class="vcard">\n    <ul class="full-width">\n        <li>\n            <span class="item-key" data-weave="shared/helper/translation" data-i18n="Company"></span>\n            <div class="vcard-item">' + a.name + '</div>\n        </li>\n        <li>\n            <span class="item-key" data-weave="shared/helper/translation" data-i18n="License Number"></span>\n            <div class="vcard-item">' + a.userlimit + '</div>\n        </li>\n        <li>\n            <span class="item-key" data-weave="shared/helper/translation" data-i18n="Activated User Number"></span>\n            <div class="vcard-item">' + a.current_count + '</div>\n        </li>\n        <li>\n            <span class="item-key" data-weave="shared/helper/translation" data-i18n="Contract Start Date"></span>\n            <div class="vcard-item">' + a.startDate + '</div>\n        </li>\n        <li>\n            <span class="item-key" data-weave="shared/helper/translation" data-i18n="Contract Expire Date"></span>\n            <div class="vcard-item">' + a.expireDate + "</div>\n        </li>\n    </ul>\n</div>";
		return b
	}
}), define("app/widget/system/license/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		b.publish("ajax", {
			url : f.INFO
		}, c().done(function (c) {
				b._json = c,
				b.html(d, b._json, a)
			}))
	}
	var f = {
		INFO : "/rest/data/clientinfo"
	};
	return b.extend({
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/modal/merge-node/main.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3 data-weave="shared/helper/translation" data-i18n="转移数据"></h3>\n</div>\n<div class="modal-body modal-body-fixed" id="merge-node-form">\n\n	<form>\n		<div class="control-group">\n			<label class="control-label">\n				将 <b class="name"></b> 转移到:\n			</label>\n			<div class="controls">\n				<div class="comtree span3" data-name="to" data-weave="shared/widget/common/comtree/main"></div>\n			</div>\n		</div>\n	</form>\n	\n</div>\n<div class="modal-footer">\n	<input type="hidden" name="from">\n    <button class="btn btn-danger" data-action="transfer" data-weave="shared/helper/translation" data-i18n="转移" form="merge-node-form"></button>\n</div>';
		return a
	}
}), define("app/widget/system/modal/merge-node/main", ["jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "shared/helper/utils", "shared/helper/validate"], function (a, b, c, d, e, f) {
	function g(a) {
		var b = this;
		b.html(d, a)
	}
	function h(a) {
		var b = this;
		b.$comtree = b.$element.find(".comtree"),
		b.comtree = b.$comtree.woven()[0],
		b.$name = b.$element.find(".name"),
		b.$from = b.$element.find('[name="from"]'),
		b.$to = b.$element.find('[name="to"]'),
		b.$form = b.$element.find("form"),
		f(b.$form, {
			rules : {
				to : {
					required : !0
				}
			}
		}),
		b.$element.on("hidden", function () {
			b.comtree.reset(),
			b.$from.val(""),
			b.$to.val(""),
			b.$name.text("")
		}),
		a.resolve()
	}
	var i = {
		MOVE : "/rest/manage/fk_mv"
	};
	return c.extend({
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"sig/start" : function (a, b) {
			h.call(this, b)
		},
		"hub/system/modal/merge-node/show" : function (a, b) {
			var c = this;
			c._onSuccess = b.onSuccess,
			c._type = b.type,
			c.$name.text(b.selected.name),
			c.$from.val(b.selected.id),
			c.comtree.loadData(b.data),
			c.$element.modal("show")
		},
		"dom/action.click" : a.noop,
		"dom/action/transfer.click" : function (c, d) {
			d.preventDefault();
			var f,
			g = this,
			h = a(d.target),
			j = g._type;
			g.$form.valid() && (f = window.confirm("确定要转移所以相关数据到所选节点下吗?此操作不可逆!"), f && g.publish("ajax", {
					url : i.MOVE,
					data : {
						data : JSON.stringify({
							table_type : j,
							from_value : g.$from.val(),
							to_value : g.$to.val()
						})
					},
					type : "post"
				}, b().done(function (a) {
						g.$element.modal("hide"),
						a.status ? g._onSuccess && g._onSuccess(a) : e.alert("error", a.message)
					}), h))
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/modal/reorder-email-template/main.html", [], function () {
	return function () {
		var a = '<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">×</button>\n    <h3 data-weave="shared/helper/translation" data-i18n="排序邮件模版"></h3>\n</div>\n<div class="modal-body">\n    <div class="tree"></div>\n</div>\n<div class="modal-footer">\n    <button class="btn btn-primary" data-action="save" data-weave="shared/helper/translation" data-i18n="Save"></button>\n</div>';
		return a
	}
}), define("app/widget/system/modal/reorder-email-template/main", ["jquery", "troopjs-utils/deferred", "shared/widget/modal/base", "template!./main.html", "shared/helper/utils", "jquery.tree"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		b.html(d, a)
	}
	function g(a) {
		var b = this;
		b.$tree = b.$element.find(".tree"),
		b.$tree.tree({
			dragAndDrop : !0,
			onCanMoveTo : function (a, b, c) {
				return "inside" === c ? !1 : !0
			}
		}),
		a.resolve()
	}
	var h = {
		REORDER : "/rest/data/reorder"
	};
	return c.extend({
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"sig/start" : function (a, b) {
			g.call(this, b)
		},
		"hub/system/modal/reorder-email-template/show" : function (a, b, c) {
			var d = this;
			d._onSuccess = c,
			d.$tree.tree("loadData", b),
			d.$element.modal("show")
		},
		"dom/action.click" : a.noop,
		"dom/action/save.click" : function (c, d) {
			d.preventDefault();
			var f = this,
			g = a(d.target),
			i = JSON.parse(f.$tree.tree("toJson")),
			j = [];
			i.forEach(function (a) {
				j.push(a.id)
			}),
			f.publish("ajax", {
				url : h.REORDER,
				data : {
					data : JSON.stringify({
						type : "emailtemplate",
						ids : j
					})
				},
				type : "post"
			}, b().done(function (a) {
					f.$element.modal("hide"),
					a.status ? (e.alert("success", "排序成功!"), f._onSuccess && f._onSuccess(a)) : e.alert("error", a.message)
				}), g)
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/people-note-config/item.html", [], function () {
	return function (a) {
		var b = "",
		c = this.randomKey();
		if (b += '\n<div class="control-group ', a.is_buildin && (b += "hide"), b += '">\n    <input type="hidden" name="is_buildin" value="' + (a.is_buildin ? 1 : 0) + '">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="备注类型"></span>\n    </label>\n    <div class="controls">\n        <input type="text" name="en_US-' + c + '" class="input-medium required" value="' + (a.en_US || "") + '" placeholder="English" ', a.en_US && (b += "readonly='readonly'"), b += '>\n        <input type="text" name="zh_CN-' + c + '" class="input-medium required" value="' + (a.zh_CN || "") + '" placeholder="中文">\n        \n\n        <div class="pull-right actions">\n            ', a.code && (b += '\n            <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="转移到..." data-action="transfer/category"></button>\n            '), b += '\n            <button class="btn btn-small btn-danger" data-weave="shared/helper/translation" data-i18n="Delete category" data-action="delete/category"></button>\n            <span class="handler"><span class="icon-move-ns icon-blue"></span></span>\n        </div>\n    </div>\n</div>\n\n<div class="control-group ', a.is_buildin && (b += "hide"), b += '">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="标签背景色"></span>\n    </label>\n    <div class="controls">\n        <input type="color" name="color" class="input-mini" value="' + a.color + '">\n    </div>\n</div>\n\n<div class="control-group formSep ', a.is_buildin && (b += "hide"), b += '">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="Question"></span>\n    </label>\n\n    ', a.ext) {
			b += "\n    ";
			for (var d = JSON.parse(a.ext), e = 0, f = d.length; f > e; e++)
				b += '\n    <div class="controls">\n        <input type="text" class="input-xxlarge" value="' + d[e].field + '" name="question">\n        <button class="btn btn-danger btn-small pull-right btn-delete" data-weave="shared/helper/translation" data-i18n="Delete Question" data-action="delete/question"></button>\n    </div>\n    ';
			b += "\n    "
		} else
			b += '\n    <div class="controls">\n        <input type="text" class="input-xxlarge " name="question">\n        <button class="btn btn-danger btn-small pull-right btn-delete" data-weave="shared/helper/translation" data-i18n="Delete Question" data-action="delete/question"></button>\n    </div>\n    ';
		return b += '\n    <div class="controls text_line">\n        <a href="#" data-weave="shared/helper/translation" data-i18n="新增问题" data-action="add/question"></a>\n    </div>\n</div>'
	}
}), define("app/widget/system/people-note-config/item", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./item.html", "template!app/widget/system/base/question.html", "shared/helper/utils"], function (a, b, c, d, e) {
	function f(a) {
		var b = this;
		c(function (a) {
			b.html(d, b._json, a)
		}).done(function () {
			b.$element.find('[data-action="delete/question"]').eq(0).remove(),
			a.resolve()
		})
	}
	return b.extend(function (a, b, c) {
		this._json = c || {}

	}, {
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"dom/action.click" : a.noop,
		"dom/action/delete/category" : function (b, c) {
			c.preventDefault();
			var d = this;
			a(c.target);
			var e = window.confirm("确认要删除此类型吗?");
			e && d.$element.remove()
		},
		"dom/action/transfer/category" : function (b, c) {
			c.preventDefault();
			var d = this;
			a(c.target);
			var e = {};
			d.publish("system/get/data", e),
			d.publish("system/modal/merge-node/show", {
				type : e.type,
				selected : {
					id : d._json.code,
					name : d._json.value
				},
				data : e.data,
				onSuccess : function () {}

			})
		},
		"dom/action/delete/question" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = window.confirm("确认要删除此问题吗?");
			e && d.closest(".controls").remove()
		},
		"dom/action/add/question" : function (b, d) {
			d.preventDefault();
			var f = a(d.target);
			if (10 === f.closest(".control-group").find(".controls:not(.text_line)").length)
				return alert("最多添加十个问题!"), void 0;
			var g = a(e());
			g.find("[data-weave]").weave(c(function () {
					f.closest(".controls").before(g)
				}))
		},
		randomKey : function () {
			return parseInt(1e5 * Math.random(), 10)
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/people-note-config/main.html", [], function () {
	return function () {
		var a = '<h3 class="heading">人才: 备注类型设置</h3>\n\n<form action="#" class="form-horizontal">\n    \n\n    <div class="control-group">\n        <label class="control-label">\n            <a href="#" data-weave="shared/helper/translation" data-i18n="新增备注类型" data-action="add/category"></a>\n        </label>\n    </div>\n\n    <div class="control-group">\n        <div class="controls">\n            <button class="btn btn-primary" data-weave="shared/helper/translation" data-i18n="Save" data-action="save"></button>\n        </div>\n    </div>\n    \n</form>';
		return a
	}
}), define("app/widget/system/people-note-config/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "shared/helper/validate", "jquery.ui"], function (a, b, c, d, e, f) {
	function g(b) {
		var e = this;
		e.html(d, e._json, b),
		e.publish("ajax", {
			url : j.CONFIG_KEYS.replace("<type>", i),
			cache : !1
		}, c().done(function (b) {
				e._json = b,
				b.forEach(function (b) {
					var d = a('<div class="category-block"></div>');
					d.data("json", b).attr("data-weave", "app/widget/system/people-note-config/item(json)").weave(c(function () {
							e.$element.find('[data-action="add/category"]').closest(".control-group").before(d)
						}))
				})
			}))
	}
	function h(a) {
		var b = this;
		b.$form = b.$element.find("form"),
		b.$form.sortable({
			items : ".category-block",
			handle : ".handler",
			cursor : "move",
			axis : "y"
		}),
		f(b.$form),
		a.resolve()
	}
	var i = "candidate_note_category",
	j = {
		CONFIG_KEYS : "/rest/data/options?type=<type>",
		CONFIG_ADD : "/rest/data/options/add"
	};
	return b.extend({
		"sig/initialize" : function (a, b) {
			g.call(this, b)
		},
		"sig/start" : function (a, b) {
			h.call(this, b)
		},
		"dom/action.click" : a.noop,
		"dom/action/add/category.click" : function (b, d) {
			d.preventDefault();
			var e = a(d.target),
			f = a('<div class="category-block"></div>');
			f.attr("data-weave", "app/widget/system/people-note-config/item").weave(c(function () {
					e.closest(".control-group").before(f)
				}))
		},
		"dom/action/save.click" : function (b, d) {
			d.preventDefault();
			var f = this,
			g = a(d.target),
			h = {},
			k = [];
			return f.$form.valid() ? (f.$element.find(".category-block").each(function () {
					var b = a(this),
					c = [];
					b.find('[name*="question"]').each(function () {
						a(this),
						c.push({
							field : a(this).val().trim(),
							required : !0
						})
					}),
					k.push({
						code : b.find('[name*="en_US"]').val().trim(),
						zh_CN : b.find('[name*="zh_CN"]').val().trim(),
						en_US : b.find('[name*="en_US"]').val().trim(),
						color : b.find('[name*="color"]').val() || "",
						is_buildin : !1,
						ext : JSON.stringify(c)
					})
				}), h = {
					type : i,
					values : k
				}, f.publish("ajax", {
					url : j.CONFIG_ADD,
					data : {
						data : JSON.stringify(h)
					},
					type : "post"
				}, c().done(function (a) {
						a.status ? (e.alert("success", "保存成功!"), a.data && a.data.length && e.alert("info", a.data.join(", ") + "已经被关联，请刷新页面，并选择“转移到”，将关联数据移除后再删除！")) : e.alert("error", a.message)
					}).fail(function (a) {
						e.alert("error", JSON.parse(a.responseText).message)
					}), g), void 0) : !1
		},
		"hub/system/get/data" : function (b, c) {
			var d = this;
			c.type = i,
			c.data = [],
			d.$element.find(".category-block").each(function () {
				var b = a(this);
				c.data.push({
					id : b.find('[name*="en_US"]').val().trim(),
					label : b.find('[name*="zh_CN"]').val().trim()
				})
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/people-status-config/item.html", [], function () {
	return function (a) {
		var b = "",
		c = this.randomKey();
		return b += '\n<div class="control-group">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="状态类型"></span>\n    </label>\n    <div class="controls">\n        <input type="text" name="en_US-' + c + '" class="input-medium required" value="' + (a.en_US || "") + '" placeholder="English" ',
		a.en_US && (b += "readonly='readonly'"),
		b += '>\n        <input type="text" name="zh_CN-' + c + '" class="input-medium required" value="' + (a.zh_CN || "") + '" placeholder="中文">\n        \n        <div class="pull-right actions">\n            ',
		a.code && (b += '\n            <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="转移到..." data-action="transfer/status"></button>\n            '),
		b += '\n            <button class="btn btn-small btn-danger" data-weave="shared/helper/translation" data-i18n="删除状态" data-action="delete/status"></button>\n            <span class="handler"><span class="icon-move-ns icon-blue"></span></span>\n        </div>\n        \n    </div>\n</div>\n<div class="control-group formSep">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="标签背景色"></span>\n    </label>\n    <div class="controls">\n        <input type="color" name="color" class="input-mini" value="' + a.color + '">\n    </div>\n</div>'
	}
}), define("app/widget/system/people-status-config/item", ["jquery", "app/widget/system/base/options-item", "troopjs-utils/deferred", "template!./item.html"], function (a, b, c, d) {
	return b.extend(function () {
		this._template = d
	})
}), define("troopjs-requirejs/template!app/widget/system/people-status-config/main.html", [], function () {
	return function () {
		var a = '<h3 class="heading">人才: 备注状态设置</h3>\n\n<form action="#" class="form-horizontal">\n    \n\n    <div class="control-group">\n        <label class="control-label">\n            <a href="#" data-weave="shared/helper/translation" data-i18n="新增状态类型" data-action="add/status"></a>\n        </label>\n    </div>\n\n    <div class="control-group">\n        <div class="controls">\n            <button class="btn btn-primary" data-weave="shared/helper/translation" data-i18n="Save" data-action="save"></button>\n        </div>\n    </div>\n    \n</form>';
		return a
	}
}), define("app/widget/system/people-status-config/main", ["jquery", "app/widget/system/base/options-config", "troopjs-utils/deferred", "template!./main.html"], function (a, b, c, d) {
	var e = "candidate_status",
	f = "app/widget/system/people-status-config/item";
	return b.extend(function () {
		this._type = e,
		this._itemWidget = f,
		this._template = d
	})
}), define("troopjs-requirejs/template!app/widget/system/revenue-invalid-config/item.html", [], function () {
	return function (a) {
		var b = "",
		c = this.randomKey();
		return b += '\n<div class="control-group ',
		a.is_buildin && (b += "hide"),
		b += '">\n	<input type="hidden" name="is_buildin" value="' + (a.is_buildin ? 1 : 0) + '">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="原因类型"></span>\n    </label>\n    <div class="controls">\n        <input type="text" name="en_US-' + c + '" class="input-medium required" value="' + (a.en_US || "") + '" placeholder="English" ',
		a.en_US && (b += "readonly='readonly'"),
		b += '>\n        <input type="text" name="zh_CN-' + c + '" class="input-medium required" value="' + (a.zh_CN || "") + '" placeholder="中文">\n        \n        <div class="pull-right actions">\n            ',
		a.code && (b += '\n            <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="转移到..." data-action="transfer/status"></button>\n            '),
		b += '\n            <button class="btn btn-small btn-danger" data-weave="shared/helper/translation" data-i18n="删除原因" data-action="delete/status"></button>\n            <span class="handler"><span class="icon-move-ns icon-blue"></span></span>\n        </div>\n        \n    </div>\n</div>'
	}
}), define("app/widget/system/revenue-invalid-config/item", ["jquery", "app/widget/system/base/options-item", "troopjs-utils/deferred", "template!./item.html"], function (a, b, c, d) {
	return b.extend(function () {
		this._template = d
	})
}), define("troopjs-requirejs/template!app/widget/system/revenue-invalid-config/main.html", [], function () {
	return function () {
		var a = '<h3 class="heading">项目流程: 业绩作废原因设置</h3>\n\n<form action="#" class="form-horizontal">\n    \n\n    <div class="control-group">\n        <label class="control-label">\n            <a href="#" data-weave="shared/helper/translation" data-i18n="新增原因" data-action="add/status"></a>\n        </label>\n    </div>\n\n    <div class="control-group">\n        <div class="controls">\n            <button class="btn btn-primary" data-weave="shared/helper/translation" data-i18n="Save" data-action="save"></button>\n        </div>\n    </div>\n    \n</form>';
		return a
	}
}), define("app/widget/system/revenue-invalid-config/main", ["jquery", "app/widget/system/base/options-config", "troopjs-utils/deferred", "template!./main.html"], function (a, b, c, d) {
	var e = "invoice_invalid_reason",
	f = "app/widget/system/revenue-invalid-config/item";
	return b.extend(function () {
		this._type = e,
		this._itemWidget = f,
		this._template = d
	})
}), define("app/widget/system/route", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "shared/helper/utils"], function (a, b) {
	function c() {
		var a = this,
		b = a.$element;
		b.html(""),
		b.append("<div></div>"),
		b.find("div").attr("data-weave", "app/widget/system/" + a.type + "/main").weave()
	}
	var d = /^type=[-a-zA-Z]+$/i;
	return b.extend({
		"hub:memory/route" : function (a, b) {
			var e = this;
			b.source && d.test(b.source) ? (e.type = b.source.split("=")[1], c.call(e)) : window.location.hash = "type=company-info"
		}
	})
}), define("troopjs-requirejs/template!app/widget/system/task-category-config/item.html", [], function () {
	return function (a) {
		var b = "",
		c = this.randomKey();
		return b += '\n<div class="control-group ',
		a.is_buildin && (b += "hide"),
		b += '">\n    <input type="hidden" name="is_buildin" value="' + (a.is_buildin ? 1 : 0) + '">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="任务类型"></span>\n    </label>\n    <div class="controls">\n        <input type="text" name="en_US-' + c + '" class="input-medium required" value="' + (a.en_US || "") + '" placeholder="English" ',
		a.en_US && (b += "readonly='readonly'"),
		b += '>\n        <input type="text" name="zh_CN-' + c + '" class="input-medium required" value="' + (a.zh_CN || "") + '" placeholder="中文">\n        \n        <div class="pull-right actions">\n            ',
		a.code && (b += '\n            <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="转移到..." data-action="transfer/status"></button>\n            '),
		b += '\n            <button class="btn btn-small btn-danger" data-weave="shared/helper/translation" data-i18n="删除类型" data-action="delete/status"></button>\n            <span class="handler"><span class="icon-move-ns icon-blue"></span></span>\n        </div>\n        \n    </div>\n</div>\n\n<div class="control-group ',
		a.is_buildin && (b += "hide"),
		b += '">\n    <label class="control-label">\n        <span data-weave="shared/helper/translation" data-i18n="标签背景色"></span>\n    </label>\n    <div class="controls">\n        <input type="color" name="color" class="input-mini" value="' + a.color + '">\n    </div>\n</div>'
	}
}), define("app/widget/system/task-category-config/item", ["jquery", "app/widget/system/base/options-item", "troopjs-utils/deferred", "template!./item.html"], function (a, b, c, d) {
	return b.extend(function () {
		this._template = d
	})
}), define("troopjs-requirejs/template!app/widget/system/task-category-config/main.html", [], function () {
	return function () {
		var a = '<h3 class="heading">任务: 类型设置</h3>\n\n<form action="#" class="form-horizontal">\n    \n\n    <div class="control-group">\n        <label class="control-label">\n            <a href="#" data-weave="shared/helper/translation" data-i18n="新增类型" data-action="add/status"></a>\n        </label>\n    </div>\n\n    <div class="control-group">\n        <div class="controls">\n            <button class="btn btn-primary" data-weave="shared/helper/translation" data-i18n="Save" data-action="save"></button>\n        </div>\n    </div>\n    \n</form>';
		return a
	}
}), define("app/widget/system/task-category-config/main", ["jquery", "app/widget/system/base/options-config", "troopjs-utils/deferred", "template!./main.html"], function (a, b, c, d) {
	var e = "todo_category",
	f = "app/widget/system/task-category-config/item";
	return b.extend(function () {
		this._type = e,
		this._itemWidget = f,
		this._template = d
	})
}), define("troopjs-requirejs/template!app/widget/system/valid-new-company/main.html", [], function () {
	return function () {
		var a = '<h3 class="heading">公司: 客户审核设置</h3>\n\n<p>开启后，新增的客户公司，需要管理员审核通过，才能进行后续操作（如添加公司备注，添加客户联系人以及添加项目）</p>\n\n<form action="#" class="form-horizontal">\n    <div class="control-group formSep">\n        <label for="" class="control-label">\n            <span data-weave="shared/helper/translation" data-i18n="审核新建的客户公司"></span>\n        </label>\n        <div class="controls radio">\n            <label><input name="client_need_verify" class="load-key" value="1" type="radio" disabled="disabled" /><span data-weave="shared/helper/translation" data-i18n="Yes"></label>\n            <label><input name="client_need_verify" class="load-key" value="0" type="radio" disabled="disabled" /><span data-weave="shared/helper/translation" data-i18n="No"></label>\n            <button class="btn btn-primary action" data-action="setting/radio/edit" data-weave="shared/helper/translation" data-i18n="Edit"></button>\n            <button class="btn btn-primary action hide" data-action="setting/radio/save" data-weave="shared/helper/translation" data-i18n="Save"></button>\n            <button class="btn action hide" data-action="setting/textbox/cancel" data-weave="shared/helper/translation" data-i18n="Cancel"></button>\n        </div>\n    </div>\n</form>';
		return a
	}
}), define("app/widget/system/valid-new-company/main", ["jquery", "app/widget/system/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		b.html(d, a)
	}
	return b.extend({
		"sig/initialize" : function (a, b) {
			e.call(this, b)
		}
	})
}), define("troopjs-requirejs/template!app/widget/task/filter/main.html", [], function () {
	return function (a) {
		for (var b = '<ul class="nav nav-pills line_sep">\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="任务类型"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <select name="category">\n                        <option value="" data-weave="shared/helper/translation" data-i18n="Please select"></option>\n                        ', c = 0, d = a.length; d > c; c++)
			b += '\n                        <option value="' + a[c].code + '">' + a[c].value + "</option>\n                        ";
		return b += '\n                    </select>\n                </div>\n                <button class="btn" type="submit" data-action="form(\'category\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="任务时间"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <ul class="nav nav-pills">\n                    <li>\n                        <a href="#date__until_today=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="Until today"></a>\n                    </li>\n                    <li>\n                        <a href="#date__until_this_week=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="Until this week"></a>\n                    </li>\n                    <li>\n                        <a href="#date__until_this_month=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="Until this month"></a>\n                    </li>\n                    <li>\n                        <a href="#date__today=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="Today"></a>\n                    </li>\n                    <li>\n                        <a href="#date__this_week=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="This week"></a>\n                    </li>\n                    <li>\n                        <a href="#date__this_month=" data-action="lastupdate" data-weave="shared/helper/translation" data-i18n="This month"></a>\n                    </li>\n                </ul>\n                <button class="btn hide" type="submit" data-action="form(\'date\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="任务状态"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <select name="done__eq">\n                        <option value="1" data-weave="shared/helper/translation" data-i18n="Done"></option>\n                        <option value="" data-weave="shared/helper/translation" data-i18n="Not done"></option>\n                    </select>\n                </div>\n                <button class="btn" type="submit" data-action="form(\'done__eq\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Participant"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <select data-placeholder="Choose a user..." name="user_id" class="input-large" data-weave="shared/widget/common/user-list/main"></select>\n                </div>\n                <button class="btn" type="submit" data-action="form(\'user_id\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Creator"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <select data-placeholder="Choose a user..." name="addedBy__eq" class="input-large" data-weave="shared/widget/common/user-list/main"></select>\n                </div>\n                <button class="btn" type="submit" data-action="form(\'addedBy__eq\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Team"></a>\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <div class="comtree span" data-name="team_id" data-url="/rest/data/team" data-weave="shared/widget/common/comtree/main"></div>\n                </div>\n                <div class="control-group help-block">\n                    搜索团队拥有的候选人\n                </div>\n                <button class="btn" type="submit" data-action="form(\'team_id\')" data-weave="shared/helper/translation" data-i18n="Search"></button>\n            </form>\n        </div>\n    </li>\n</ul>\n\n<p class="sepH_b">\n    <span class="tag label label-info deletable hide" data-query="category" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="任务类型"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="date" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="任务时间"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="done__eq" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="任务状态"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="user_id" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Participant"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="addedBy__eq" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Creator"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="team_id" data-action="tag/remove"><b data-weave="shared/helper/translation" data-i18n="Team"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <a href="#" class="hide save-filter" data-action="filter/save/toggle" data-weave="shared/helper/translation" data-i18n="Save as"></a>\n</p>\n\n<form action="#" class="form-horizontal save-filter-form hide">\n    <input type="text" class="input-medium">\n    <button class="btn" data-action="filter/save" data-weave="shared/helper/translation" data-i18n="Save"></button>\n    <button class="btn" data-action="filter/save/toggle" data-weave="shared/helper/translation" data-i18n="Close"></button>\n</form>'
	}
}), define("app/widget/task/filter/main", ["compose", "jquery", "shared/widget/filter/base", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "shared/widget/filter/query", "shared/helper/utils"], function (a, b, c, d, e, f, g) {
	function h() {
		g.addAttr({
			category : function (a) {
				var b = a.find(":selected").val();
				b.length && this.addQuery("category", "category=" + b)
			},
			date : function () {},
			user_id : function (a) {
				var b = a.find(":selected"),
				c = b.val();
				c ? this.addQuery("user_id", "user_id=" + c) : this.deleteQuery("user_id")
			},
			addedBy__eq : function (a) {
				var b = a.find(":selected"),
				c = b.val();
				c ? this.addQuery("addedBy__eq", "addedBy__eq=" + c) : this.deleteQuery("addedBy__eq")
			},
			done__eq : function (a) {
				var b = a.find(":selected"),
				c = b.val();
				this.addQuery("done__eq", "done__eq=" + c)
			},
			team_id : function (a) {
				var b = a.find('[name="team_id"]').val();
				b.length && this.addQuery("team_id", "team_id=" + b)
			}
		})
	}
	function i(a) {
		var b = this;
		b.publish("ajax", {
			url : l.CATEGORY
		}, d().done(function (c) {
				b._json = c,
				b.html(f, b._json, a)
			}))
	}
	function j(a) {
		var c,
		d = this,
		e = a[0],
		f = a[1];
		switch (e.indexOf("date") > -1 && (e = "date"), e) {
		case "date":
			d.$element.find('a[data-action="lastupdate"]').each(function () {
				return b(this).attr("href").substring(1) == a[0] + "=" ? (c = b(this).text(), !1) : void 0
			}),
			d.$element.find('[data-query="date"]').removeClass("hide").find("span").text(c),
			g.addQuery("date", a[0] + "=" + f);
			break;
		case "user_id":
		case "category":
		case "done__eq":
		case "addedBy__eq":
			c = d.$element.find('[name="' + e + '"]').find('[value="' + window.decodeURIComponent(f) + '"]').text(),
			d.$element.find('[data-query="' + e + '"]').removeClass("hide").find("span").text(c),
			g.addQuery(e, e + "=" + f);
			break;
		case "team_id":
			c = d.$element.find('[data-name="' + e + '"]').woven()[0].getNodeNameById(window.decodeURIComponent(f)),
			d.$element.find('[data-query="' + e + '"]').removeClass("hide").find("span").text(c),
			g.addQuery(e, e + "=" + f);
			break;
		case "byfilter":
			break;
		default:
			d.$element.find('[data-query="' + e + '"]').removeClass("hide").find("span").text(window.decodeURIComponent(f)),
			g.addQuery(e, e + "=" + f)
		}
	}
	var k = new Date;
	({
		YEAR : k.getFullYear(),
		MONTH : k.getMonth(),
		DATE : k.getDate(),
		DAY : k.getDay()
	});
	var l = {
		SAVE_FILTER : "/rest/data/queryfilter/todo/add",
		CATEGORY : "/rest/data/options?type=todo_category"
	};
	return c.extend(function () {
		var a = this;
		g.url = l.SAVE_FILTER,
		a._setFilter = j,
		h.call(a)
	}, {
		"sig/initialize" : function (a, b) {
			i.call(this, b)
		},
		"hub:momery/filter/set" : a.around(function (a) {
			return function (b, c) {
				a.call(this, b, c)
			}
		}),
		"dom/action.click" : b.noop,
		"dom/action/lastupdate.click" : function (a, c) {
			c.preventDefault();
			var d = b(c.target);
			b('[data-query="date"]').removeClass("hide").find("span").text(d.text()),
			g.addQuery("date", d.attr("href").substring(1)),
			d.closest("form").find("button").trigger("click")
		}
	})
}), define("troopjs-requirejs/template!app/widget/task/item.html", [], function () {
	return function (a) {
		var b,
		c = "",
		d = a.category;
		c += '\n<td>\n    <input data-id="' + a.id + '" type="checkbox" ',
		a.done && (c += 'checked="checked"'),
		c += ' data-action="check/one" ',
		this.userId === a.addedBy.id || this.isParticipant() || (c += 'disabled="disabled"'),
		c += '>\n</td>\n<td>\n    <span class="label" style="background-color: ' + d.color + ';">' + d.value + "</span>\n</td>\n<td>\n    ",
		"joborder" === a.external_type ? c += '\n        <a href="/job#detail!id=' + a.target.id + '" target="_blank">' + a.target.name + "</a>\n    " : "client" === a.external_type ? c += '\n        <a href="/company#detail!id=' + a.target.id + '" target="_blank">' + a.target.name + "</a>\n    " : a.target && a.target.candidate ? (c += "\n        ", b = a.target.candidate, c += "\n\n        ", c += b.islimited ? "\n        ID: " + b.id + "\n        " : '\n        <a href="/candidate#detail!id=' + b.id + '" target="_blank">' + [b.englishName, b.chineseName].join(" ").trim() + "</a>\n        ", c += "\n\n    ") : a.target && (c += "\n        ", c += a.target.islimited ? "\n        ID: " + a.target.id + "\n        " : '\n        <a href="/candidate#detail!id=' + a.target.id + '" target="_blank">' + a.target.name + "</a>\n        ", c += "\n    "),
		c += "\n</td>\n<td>\n    ",
		a.target && a.target.joborder ? c += '\n    <a href="job#detail!id=' + a.target.joborder.id + '" target="_blank">' + a.target.joborder.jobTitle + " (ID: " + a.target.joborder.id + ")</a>\n    " : (c += "\n        ", b ? b && !b.islimited && (c += "\n        " + (a.content || "") + "\n        ") : c += "\n        " + (a.content || "") + "\n        ", c += "\n    "),
		c += "\n</td>\n<td>\n    ",
		c += a.allday ? "\n    " + this.getDate(a.date) + "\n    " : "\n    " + a.date + "\n    ",
		c += "\n</td>\n<td>\n    ";
		for (var e = 0, f = a.users.length; f > e; e++) {
			c += "\n    ";
			var g = a.users[e];
			c += '\n    <div><a href="/user/preview#' + g.id + '" data-action="open/profile">' + g.englishName + "</a></div>\n    "
		}
		return c += '\n</td>\n<td>\n    <a href="/user/preview#' + a.addedBy.id + '" data-action="open/profile">' + a.addedBy.englishName + "</a>\n</td> \n<td>\n    ",
		a.category.is_buildin || this.userId !== a.addedBy.id && !this.isParticipant() || (c += '\n    <button class="btn btn-mini" data-weave="shared/helper/translation" data-i18n="Edit" data-action="edit/todo"></button>\n    '),
		c += "\n</td>"
	}
}), define("app/widget/task/item", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./item.html", "shared/helper/utils", "shared/helper/blurb"], function (a, b, c, d, e) {
	function f() {
		var a = this;
		a.html(d, a._json)
	}
	var g = {
		DONE : "/rest/todo/done"
	};
	return b.extend(function (a, b, c) {
		var d = this;
		d._json = c
	}, {
		"hub:memory/context" : function (a, b) {
			var c = this;
			c.userId = b.user.id,
			f.call(c)
		},
		"dom/action.click.change" : a.noop,
		"dom/action/check/one.change" : function (b, d) {
			var f = this,
			h = a(d.target),
			i = h.data("id"),
			j = h.is(":checked");
			f.publish("ajax", {
				url : g.DONE,
				data : {
					data : JSON.stringify({
						ids : [i],
						done : j
					})
				},
				type : "POST"
			}, c().done(function (a) {
					a.status ? e.alert("success", "任务状态更改成功!") : e.alert("error", a.message)
				}))
		},
		"dom/action/edit/todo.click" : function (a, b) {
			b.preventDefault();
			var d = this,
			e = null,
			g = d._json;
			"joborder" === g.external_type || "client" === g.external_type ? e = g.target.name : g.target && g.target.candidate ? e = [g.candidate.englishName, g.candidate.chineseName].join(" ").trim() : g.target && (e = g.target.name),
			d.publish("modal/add/task/show", {
				name : e,
				id : g.target ? g.target.id : null,
				onSuccess : function (a) {
					d._json = a,
					f.call(d, c())
				},
				type : g.external_type,
				data : g
			})
		},
		"dom/action/open/profile.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			f = d.attr("href");
			e.window({
				url : f,
				name : "User Profile",
				width : "1024"
			})
		},
		getDate : function (a) {
			var b = new Date(a.split(" ")[0]);
			return b.getFullYear() + "-" + (parseInt(b.getMonth(), 10) + 1) + "-" + b.getDate()
		},
		isParticipant : function () {
			for (var a = !1, b = this, c = b._json.users, d = 0, e = c.length; e > d; d++)
				if (b.userId === c[d].id) {
					a = !0;
					break
				}
			return a
		}
	})
}), define("troopjs-requirejs/template!app/widget/task/list/main.html", [], function () {
	return function () {
		var a = '<div class="well well-small action-bar clearfix">\n    <div class="pull-left">\n        <button class="btn btn-small" data-weave="shared/helper/translation" data-i18n="Add Task" data-action="add/task"></button>\n    </div>\n    <div class="pull-right">\n        <span>显示: </span>\n        <select class="sort input-small" data-weave="shared/widget/list-paginate/main(' + this._listType + ')" data-action="paginate">\n            <option value="10">10</option>\n            <option value="25">25</option>\n            <option value="50">50</option>\n        </select>\n        <select class="sort input-medium" data-weave="shared/widget/list-ordering/main(' + this._listType + ')" data-action="ordering">\n            <option value="-date">按任务时间倒序</option>\n            <option value="date">按任务时间顺序</option>\n            <option value="category">按任务类型排序</option>\n            <option value="user_id">按用户排序</option>\n        </select>\n    </div>\n</div>\n\n<!-- pagination -->\n<div class="pagination clearfix hide" data-weave="shared/widget/pagination/main(\'' + this._listType + '\')"></div>\n\n<div class="loading-area widget-spin">\n    <table class="table table-striped table-bordered table_vam">  \n        <colgroup>\n            <col width="30">\n            <col width="150">\n            <col width="150">\n            <col>\n            <col width="150">\n            <col width="150">\n            <col width="150">\n            <col width="70">\n        </colgroup>\n        <thead>\n            <tr>\n                <th>\n                    <input type="checkbox" data-action="check/all">\n                </th>\n                <th>任务类别</th>\n                <th>任务对象</th>\n                <th>任务备注</th> \n                <th>任务时间</th>\n                <th data-weave="shared/helper/translation" data-i18n="Participant"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Creator"></th> \n                <th data-weave="shared/helper/translation" data-i18n="Operation"></th>\n            </tr>\n        </thead>\n        <tbody></tbody>\n    </table>\n</div>\n\n<!-- pagination -->\n<div class="pagination clearfix hide" data-weave="shared/widget/pagination/main(\'' + this._listType + "')\"></div>";
		return a
	}
}), define("app/widget/task/list/main", ["jquery", "shared/widget/list/base", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d, e) {
	function f(a) {
		var b = this,
		c = b._json.list;
		c.length ? (b.$container.removeClass("hide"), b.$element.find("tbody").children().remove(), b.appendItems(c)) : b.$container.addClass("hide"),
		a.resolve()
	}
	var g = {
		DONE : "/rest/todo/done"
	};
	return b.extend(function () {
		this._url = "/rest/todo/list?",
		this._listType = "todo"
	}, {
		"sig/initialize" : function (a, b) {
			var e = this;
			c(function (a) {
				e.html(d, a)
			}).done(function () {
				e.$container = e.$element.find("table"),
				b.resolve()
			})
		},
		appendItems : function (a) {
			var b = this;
			a.forEach(function (a) {
				b.$element.find("tbody").append("<tr></tr>"),
				b.$element.find("tbody").children().last().data("json", a).attr("data-weave", "app/widget/task/item(json)").weave()
			})
		},
		renderList : function (a) {
			f.call(this, a)
		},
		"dom/action.change.click" : a.noop,
		"dom/action/check/all.change" : function (b, d) {
			var f,
			h = this,
			i = a(d.target),
			j = i.is(":checked"),
			k = [];
			j ? (f = h.$element.find("tbody :checkbox").filter(":not(:disabled)").filter(":not(:checked)"), f.prop("checked", !0)) : (f = h.$element.find("tbody :checkbox").filter(":not(:disabled)").filter(":checked"), f.prop("checked", !1)),
			f.each(function () {
				k.push(a(this).data("id"))
			}),
			k.length && h.publish("ajax", {
				url : g.DONE,
				data : {
					data : JSON.stringify({
						ids : k,
						done : j
					})
				},
				type : "POST"
			}, c().done(function (a) {
					a.status ? e.alert("success", "任务状态更改成功!") : e.alert("error", a.data || a.message)
				}))
		},
		"dom/action/add/task.click" : function (a, b) {
			b.preventDefault();
			var c = this;
			c.publish("modal/add/task/show", {
				onSuccess : function () {
					c.publish("list/reload")
				}
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/user/add/main.html", [], function () {
	return function (a) {
		var b = "",
		c = this.editMode;
		if (c)
			var d = a.email || "", e = a.email_login_name || "", f = a.englishName || "", g = a.chineseName || "", h = a.dateOfBirth || "", i = a.joinInDate || "", j = a.annualTarget || "", k = a.mobile || "", l = a.officeTel || "", m = a.isleader === !0 ? !0 : !1, n = a.kpiHide === !0 ? !0 : !1, o = a.revenueHide === !0 ? !0 : !1, p = a.leaveDate || "", q = a.team.id;
		return b += '\r\n<div class="span12">\r\n    <div class="pull-right">\r\n        <a href="#" class="btn" data-action="history/back">\r\n            <i class="icon-arrow-left"></i>\r\n        </a>\r\n    </div>\r\n    ',
		b += c ? '\r\n    <h3 class="heading" data-weave="shared/helper/translation" data-i18n="Edit User"></h3>\r\n    ' : '\r\n    <h3 class="heading" data-weave="shared/helper/translation" data-i18n="New User"></h3>\r\n    ',
		b += '\r\n    <form action="#" id="addCandidateForm" class="form-horizontal">\r\n        <fieldset>\r\n\r\n            <div class="control-group">\r\n                <label for="uid" class="control-label">\r\n                    ID\r\n                </label>\r\n                <div class="controls">\r\n                    <input type="text" id="uid" class="input-medium" value="' + (c ? a.uid : "") + '">\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <label class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Name"></span>\r\n                    <span class="f_req">*</span>\r\n                </label>\r\n                <div class="controls">\r\n                    <input type="text" class="input-small" id="englishName" name="englishName" placeholder="English Name" value="' + (c ? f : "") + '">\r\n                    <input type="text" class="input-small" id="chineseName" name="chineseName" placeholder="中文名" value="' + (c ? g : "") + '">\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <label for="title" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Title"></span>\r\n                    <span class="f_req">*</span>\r\n                </label>\r\n                <div class="controls">\r\n                    <select id="title" name="title" class="input-medium"></select>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group formSep">\r\n                <label for="" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Team"></span>\r\n                    <span class="f_req">*</span>\r\n                </label>\r\n                <div class="controls clearfix">\r\n                    <div class="comtree span3" data-name="team" data-url="/rest/data/team" data-weave="shared/widget/common/comtree/main(' + q + ')"></div>\r\n                </div>\r\n                <div class="controls">\r\n                    <label class="checkbox">\r\n                        <input type="checkbox" name="isleader" value="true" ',
		c && m && (b += 'checked="checked"'),
		b += '> <span data-weave="shared/helper/translation" data-i18n="Set as leader"></span>\r\n                    </label>\r\n                </div>    \r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <label for="dateOfBirth" class="control-label" data-weave="shared/helper/translation" data-i18n="Date of birth"></label>\r\n                <div class="controls">\r\n                    <input type="text" class="input-medium" id="dateOfBirth" name="dateOfBirth" data-weave="shared/widget/common/date-picker/main" value="' + (c ? h : "") + '">\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <label for="mobile" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Mobile"></span>\r\n                </label>\r\n                <div class="controls">\r\n                    <input type="text" class="input-medium" id="mobile" name="mobile" value="' + (c ? k : "") + '">\r\n                </div>\r\n                <div class="controls duplicate-info hide"></div>\r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <label for="officeTel" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Office Tel"></span>\r\n                </label>\r\n                <div class="controls">\r\n                    <input type="text" class="input-medium" id="officeTel" name="officeTel" value="' + (c ? l : "") + '">\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <label for="email" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Email Address"></span>\r\n                    <span class="f_req">*</span>\r\n                </label>\r\n                <div class="controls">\r\n                    <input type="text" id="email" name="email" placeholder="john@abc.com" value="' + (c ? d : "") + '" data-action="email/change">\r\n                    <span class="hint" data-weave="shared/helper/translation" data-i18n="Email address will be used as username"></span>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group formSep">\r\n                <label for="email-login-name" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Email Login Name"></span>\r\n                </label>\r\n                <div class="controls">\r\n                    <input type="text" id="email-login-name" name="email-login-name" value="' + (c ? e : "") + '">\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <label for="joinInDate" class="control-label" data-weave="shared/helper/translation" data-i18n="Join Date"></label>\r\n                <div class="controls">\r\n                    <input type="text" class="input-medium" id="joinInDate" name="joinInDate" data-weave="shared/widget/common/date-picker/main" value="' + (c ? i : "") + '">\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <label for="status" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Employ Status">\r\n                    </span>\r\n                    <span class="f_req">*</span>\r\n                </label>\r\n                <div class="controls">\r\n                    <select id="status" name="status" class="input-medium" data-action="employ/status">\r\n                        <option value="Active" data-weave="shared/helper/translation" data-i18n="On Job"></option>\r\n                        <option value="Inactive" data-weave="shared/helper/translation" data-i18n="Frozen"></option>\r\n                        <option value="Leave" data-weave="shared/helper/translation" data-i18n="Leave"></option>\r\n                    </select>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group leave-date-control hide">\r\n                <label for="status" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Leave Date">\r\n                    </span>\r\n                    <span class="f_req">*</span>\r\n                </label>\r\n                <div class="controls">\r\n                    <input type="text" class="input-medium" name="leaveDate" data-weave="shared/widget/common/date-picker/main" value="' + (c ? p : "") + '">\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <label for="role" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="User Role">\r\n                    </span>\r\n                 <span class="f_req">*</span></label>\r\n                <div class="controls">\r\n                    <select id="role" name="role" class="input-medium">\r\n                        <option value="Regular">Regular</option>\r\n                        <option value="Finance" data-weave="shared/helper/translation" data-i18n="Finance"></option>\r\n                        <option value="Admin" data-weave="shared/helper/translation" data-i18n="Admin"></option>\r\n                    </select>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <label for="kpiReportView" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="KPI Viewer">\r\n                    </span>\r\n                    <span class="f_req">*</span></label>\r\n                <div class="controls">\r\n                    <select id="kpiReportView" name="kpiReportView" class="input-medium">\r\n                        <option value="Myself">Myself</option>\r\n                        <option value="My Team">My Team</option>\r\n                        <option value="All">All</option>\r\n                    </select>\r\n                </div>\r\n                <div class="controls">\r\n                    <label class="checkbox">\r\n                        <input type="checkbox" name="kpiHide" value="true" ',
		n && (b += 'checked="checked"'),
		b += '>\r\n                        <span>将用户从KPI报表中隐藏</span>\r\n                    </label>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <label for="revenueReportView" class="control-label">\r\n                    <span data-weave="shared/helper/translation" data-i18n="Revenue Viewer">\r\n                    </span> <span class="f_req">*</span></label>\r\n                <div class="controls">\r\n                    <select id="revenueReportView" name="revenueReportView" class="input-medium">\r\n                        <option value="Myself">Myself</option>\r\n                        <option value="My Team">My Team</option>\r\n                        <option value="All">All</option>\r\n                    </select>\r\n                </div>\r\n\r\n                <div class="controls">\r\n                    <label class="checkbox">\r\n                        <input type="checkbox" name="revenueHide" value="true" ',
		c && o && (b += 'checked="checked"'),
		b += '>\r\n                        <span>将用户从业绩报表中隐藏</span>\r\n                    </label>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group formSep">\r\n                <label for="annualTarget" class="control-label" data-weave="shared/helper/translation" data-i18n="Annual Target"></label>\r\n                <div class="controls">\r\n                    <input type="text" id="annualTarget" name="annualTarget" data-weave="shared/helper/translation(\'placeholder\')" data-i18n="Currency symbol" value="' + (c ? j : "") + '">\r\n                </div>\r\n            </div>\r\n\r\n            <div class="control-group">\r\n                <div class="controls">\r\n                    <button class="btn btn-primary" type="submit" data-action="user/add" data-weave="shared/helper/translation" data-i18n="Save"></button>\r\n                </div>\r\n            </div>\r\n        </fieldset>\r\n    </form>\r\n</div>'
	}
}), define("app/widget/user/add/main", ["compose", "jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils", "shared/helper/validate"], function (a, b, c, d, e, f, g) {
	function h() {
		var a = this;
		a.editMode !== m && (a.editMode ? j.call(a) : k.call(a))
	}
	function i(a, b) {
		for (var c = [], d = 0, e = b.length; e > d; d++)
			c.push("<option value='" + b[d].id + "'>" + b[d].name + "</option>");
		a.append(c.join(""))
	}
	function j(a) {
		var b = this;
		b.publish("ajax", {
			url : n.USER.replace("<id>", b._id)
		}, d().done(function (c) {
				b._json = c,
				k.call(b, a)
			}))
	}
	function k() {
		var a = this;
		d(function (b) {
			a.html(e, a._json, b)
		}).then(function () {
			l.call(a)
		})
	}
	function l() {
		var a = this;
		a.$form = a.$element.find("form"),
		a.$leaveDateControl = a.$form.find(".leave-date-control"),
		a.$leaveDate = a.$form.find('[name="leaveDate"]'),
		a.$title = a.$form.find("#title"),
		a.$emailLoginName = a.$form.find("#email-login-name"),
		a.publish("ajax", {
			url : n.TITLE
		}, d().done(function (b) {
				b.length && i(a.$title, b),
				a.editMode && a.$title.val(a._json.title.id)
			})),
		g(a.$form, {
			rules : {
				englishName : {
					required : !0
				},
				title : {
					required : !0
				},
				mobile : {
					number : !0
				},
				email : {
					required : !0,
					email : !0
				},
				status : {
					required : !0
				},
				role : {
					required : !0
				},
				kpiReportView : {
					required : !0
				},
				revenueReportView : {
					required : !0
				},
				team : {
					required : !0
				},
				annualTarget : {
					number : !0
				}
			}
		}),
		a.editMode && (b("#role").val(a._json.role), b("#kpiReportView").val(a._json.kpiReportView), b("#revenueReportView").val(a._json.revenueReportView), b("#status").val(a._json.status).trigger("change")),
		f.widgetLoaded.call(a)
	}
	var m,
	n = {
		TITLE : "/rest/data/title/list",
		USER : "/rest/user/<id>",
		ADD : "/rest/user/add"
	};
	return c.extend({
		"hub:memory/add/id/change" : function (a, b) {
			var c = this;
			c._id = b,
			c.editMode = c._id !== m ? !0 : !1,
			h.call(c)
		},
		"dom/action.click.change.input" : b.noop,
		"dom/action/history/back.click" : function (a, b) {
			b.preventDefault(),
			window.history.back()
		},
		"dom/action/employ/status.change" : function (a, c) {
			c.preventDefault();
			var d = this,
			e = b(c.target);
			"Leave" === e.val() ? (d.$leaveDateControl.removeClass("hide"), d.$leaveDate.rules("add", {
					required : !0
				})) : (d.$leaveDateControl.addClass("hide"), d.$leaveDate.rules("remove"))
		},
		"dom/action/email/change.input" : function (a, c) {
			var d = this,
			e = b(c.target);
			d.$emailLoginName.val(e.val().trim())
		},
		"dom/action/user/add.click" : function (a, c) {
			c.preventDefault();
			var e = this,
			g = b(c.target);
			if (e.$form.valid()) {
				var h = {
					englishName : b("#englishName").val().trim(),
					chineseName : b("#chineseName").val().trim(),
					title : b("#title").val(),
					team : b('[name="team"]').val(),
					dateOfBirth : b("#dateOfBirth").val() || null,
					joinInDate : b("#joinInDate").val() || null,
					email : b("#email").val().trim(),
					mobile : b("#mobile").val().trim(),
					officeTel : b("#officeTel").val().trim(),
					status : b("#status").val(),
					role : b("#role").val(),
					kpiReportView : b("#kpiReportView").val(),
					revenueReportView : b("#revenueReportView").val(),
					annualTarget : b("#annualTarget").val().trim() || null,
					isleader : b('[name="isleader"]:checked').val() || !1,
					kpiHide : b('[name="kpiHide"]:checked').val() || !1,
					revenueHide : b('[name="revenueHide"]:checked').val() || !1,
					leaveDate : e.$leaveDate.val() || null,
					email_login_name : e.$emailLoginName.val().trim(),
					uid : e.$element.find("#uid").val().trim()
				};
				e.editMode && (h.id = e._json.id),
				e.publish("ajax", {
					url : n.ADD,
					data : {
						data : JSON.stringify(h)
					},
					type : "post"
				}, d().done(function (a) {
						a.status ? e.editMode ? (f.alert("success", "编辑用户成功!"), window.location.hash = "detail!id=" + e._json.id) : (f.alert("success", "新增用户成功!"), window.location.hash = "list") : f.alert("error", a.message)
					}), g)
			}
		}
	})
}), define("troopjs-requirejs/template!app/widget/user/detail/main.html", [], function () {
	return function (a) {
		var b = " ",
		c = a.chineseName || "&nbsp;",
		d = a.dateOfBirth || "&nbsp;",
		e = a.mobile || "&nbsp;",
		f = a.officeTel || "&nbsp;";
		a.fax || "&nbsp;";
		var g = a.joinInDate || "&nbsp;",
		h = a.annualTarget || "&nbsp;";
		return b += "\n",
		this._isAdmin && (b += '\n<div class="clearfix">\n    <a href="#" class="btn pull-right" data-action="history/back">\n        <i class="icon-arrow-left"></i>\n    </a>\n</div>\n'),
		b += '\n<div class="vcard">\n    <ul class="full-width">\n        <li class="v-heading">\n            <span data-weave="shared/helper/translation" data-i18n="User Profile"></span>\n        \n        ',
		this._isAdmin && (b += '\n            <span class="pull-right">\n                <a href="/user#add!id=' + a.id + '" class="btn btn-primary btn-small" data-weave="shared/helper/translation" data-i18n="Edit"></a>\n                <button class="btn btn-primary btn-small" data-weave="shared/helper/translation" data-i18n="Reset Password" data-action="reset/password(\'' + a.email + "')\"></button>\n            </span>\n        "),
		b += '\n        </li>\n        <li class="clearfix">\n            <span class="item-key">ID</span>\n            <div class="vcard-item">' + a.uid + '</div>\n        </li>\n        <li class="clearfix">\n            <span class="item-key" data-weave="shared/helper/translation" data-i18n="English Name"></span>\n            <div class="vcard-item">' + a.englishName + '</div>\n        </li>\n        <li class="clearfix">\n            <span class="item-key" data-weave="shared/helper/translation" data-i18n="Chinese Name"></span>\n            <div class="vcard-item">' + c + '</div>\n        </li>\n        <li class="clearfix">\n            <span class="item-key" data-weave="shared/helper/translation" data-i18n="Title"></span>\n            <div class="vcard-item">' + a.title.name + '</div>\n        </li>\n        <li class="clearfix">\n            <span class="item-key">Team</span>\n            <div class="vcard-item">\n                ' + a.team.name + "\n\n                ",
		a.isleader && (b += '\n                <span class="label label-pink" data-weave="shared/helper/translation" data-i18n="Leader"></span>\n                '),
		b += '\n            </div>\n        </li>\n        <li class="clearfix">\n            <span class="item-key" data-weave="shared/helper/translation" data-i18n="Date of birth"></span>\n            <div class="vcard-item">' + d + '</div>\n        </li>\n        <li class="clearfix">\n            <span class="item-key" data-weave="shared/helper/translation" data-i18n="Mobile"></span>\n            <div class="vcard-item">' + e + '</div>\n        </li>\n        <li>\n            <span class="item-key" data-weave="shared/helper/translation" data-i18n="Office Tel"></span>\n            <div class="vcard-item">' + f + '</div>\n        </li>\n        <li class="clearfix">\n            <span class="item-key" data-weave="shared/helper/translation" data-i18n="Email"></span>\n            <div class="vcard-item">' + a.email + '</div>\n        </li>\n        <li class="clearfix">\n            <span class="item-key" data-weave="shared/helper/translation" data-i18n="Email Login Name"></span>\n            <div class="vcard-item">' + a.email_login_name + '</div>\n        </li>\n        <li class="clearfix">\n            <span class="item-key" data-weave="shared/helper/translation" data-i18n="Join Date"></span>\n            <div class="vcard-item">' + g + '</div>\n        </li>\n        <li class="clearfix">\n            <span class="item-key" data-weave="shared/helper/translation" data-i18n="Employ Status"></span>\n            <div class="vcard-item" data-weave="shared/helper/translation" data-i18n="User ' + a.status + '"></div>\n        </li>\n        <li class="clearfix">\n            <span class="item-key" data-weave="shared/helper/translation" data-i18n="User Role"></span>\n            <div class="vcard-item">' + a.role + '</div>\n        </li>\n        <li class="clearfix">\n            <span class="item-key" data-weave="shared/helper/translation" data-i18n="KPI Viewer"></span>\n            <div class="vcard-item">\n                ' + a.kpiReportView + "\n                ",
		a.kpiHide && (b += "\n                (该用户不显示在KPI报表中)\n                "),
		b += '\n            </div>\n        </li>\n        <li class="clearfix">\n            <span class="item-key" data-weave="shared/helper/translation" data-i18n="Revenue Viewer"></span>\n            <div class="vcard-item">\n                ' + a.revenueReportView + "\n                ",
		a.revenueHide && (b += "\n                (该用户不显示在业绩报表中)\n                "),
		b += '\n            </div>\n        </li>\n        <li class="clearfix">\n            <span class="item-key" data-weave="shared/helper/translation" data-i18n="Annual Target"></span>\n            <div class="vcard-item">' + h + "</div>\n        </li>\n    </ul>\n</div>"
	}
}), define("app/widget/user/detail/main", ["compose", "jquery", "shared/widget/base/main", "troopjs-utils/deferred", "shared/helper/utils", "template!./main.html"], function (a, b, c, d, e, f) {
	function g() {
		var a = this;
		a._id !== i && a._isAdmin !== i && a.publish("ajax", {
			url : j.USER.replace("<id>", a._id)
		}, d().done(function (b) {
				a._json = b,
				h.call(a)
			}))
	}
	function h() {
		var a = this,
		b = d();
		b.done(function () {
			e.widgetLoaded.call(a)
		}),
		a.html(f, a._json, b)
	}
	var i,
	j = {
		USER : "/rest/user/<id>",
		EDIT_USER : "/user/edit#",
		RESET_PASSWORD : "/rest/user/resetpassword"
	};
	return c.extend({
		"hub:memory/detail/id/change" : function (a, b) {
			var c = this;
			c._id = b,
			g.call(c)
		},
		"hub:memory/context" : function (a, b) {
			var c = this;
			c._isAdmin = "Admin" === b.user.role ? !0 : !1,
			g.call(c)
		},
		"dom/action.click" : b.noop,
		"dom/action/history/back.click" : function (a, b) {
			b.preventDefault(),
			window.history.back()
		},
		"dom/action/edit/user.click" : function (a, b, c) {
			b.preventDefault(),
			window.location.href = j.EDIT_USER + c
		},
		"dom/action/reset/password.click" : function (a, b, c) {
			b.preventDefault();
			var f = this,
			g = window.confirm("Do you really want to reset this user's passowrd?");
			g && f.publish("ajax", {
				url : j.RESET_PASSWORD,
				data : {
					data : JSON.stringify({
						email : c
					})
				},
				type : "post"
			}, d().done(function (a) {
					a.status ? e.alert("success", "Reset user's passowrd successfully!") : e.alert("error", a.message)
				}))
		}
	})
}), define("troopjs-requirejs/template!app/widget/user/filter/main.html", [], function () {
	return function () {
		var a = '<ul class="nav nav-pills line_sep">\n    <li class="dropdown">\n        <a href="#" class="dropdown-toggle" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Name"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <input type="text" class="input-medium" autocomplete="off">\n                <button class="btn" type="submit" data-action="form(\'name\')" data-weave="shared/helper/translation" data-i18n="Add"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" class="dropdown-toggle" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Team"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <div class="comtree span" data-name="team_id" data-url="/rest/data/team" data-weave="shared/widget/common/comtree/main"></div>\n                </div>\n                <div class="control-group help-block">\n                    搜索团队拥有的候选人\n                </div>\n\n                <button class="btn" type="submit" data-action="form(\'team_id\')" data-weave="shared/helper/translation" data-i18n="Add"></button>\n            </form>\n        </div>\n    </li>\n    <li class="divider"></li>\n    <li class="dropdown">\n        <a href="#" class="dropdown-toggle" data-action="dropdown" data-weave="shared/helper/translation" data-i18n="Status"></a>\n\n        <div class="dropdown-menu filter-content">\n            <form action="#" class="form-horizontal">\n                <div class="control-group">\n                    <select name="status__eq">\n                        <option value="Active" data-weave="shared/helper/translation" data-i18n="On Job"></option>\n                        <option value="Inactive" data-weave="shared/helper/translation" data-i18n="Frozen"></option>\n                        <option value="Leave" data-weave="shared/helper/translation" data-i18n="Leave"></option>\n                    </select>\n                </div>\n                \n                <button class="btn" type="submit" data-action="form(\'status__eq\')" data-weave="shared/helper/translation" data-i18n="Add"></button>\n            </form>\n        </div>\n    </li>\n</ul>\n\n<p class="sepH_b">\n    <span class="tag label label-info deletable hide" data-query="name" data-action="tag/remove"><b data-i18n="Name" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="team_id" data-action="tag/remove"><b data-i18n="Team" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <span class="tag label label-info deletable hide" data-query="status__eq" data-action="tag/remove"><b data-i18n="Status" data-weave="shared/helper/translation"></b>: <span></span> <i class="icon-remove-small icon-transparent"></i></span>\n    <a href="#" class="hide save-filter" data-action="filter/save/toggle" data-weave="shared/helper/translation" data-i18n="Save as"></a>\n</p>\n\n<form action="#" class="form-horizontal save-filter-form hide">\n    <input type="text" class="input-medium">\n    <button class="btn" data-action="filter/save" data-weave="shared/helper/translation" data-i18n="Save"></button>\n    <button class="btn" data-action="filter/save/toggle" data-weave="shared/helper/translation" data-i18n="Close"></button>\n</form>';
		return a
	}
}), define("app/widget/user/filter/main", ["jquery", "shared/widget/filter/base", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "shared/widget/filter/query", "shared/helper/utils"], function (a, b, c, d, e, f) {
	function g() {
		f.addAttr({
			name : function (b) {
				var c = a.trim(b.find("input").val());
				c.length && this.addQuery("name", "name=" + encodeURIComponent(c))
			},
			team_id : function (a) {
				var b = a.find('[name="team_id"]').val();
				b.length && this.addQuery("team", "team_id=" + b)
			},
			status__eq : function (a) {
				var b = a.find('select[name="status__eq"] :selected').text(),
				c = a.find("select").val();
				b.length && this.addQuery("status__eq", "status__eq=" + c)
			}
		})
	}
	function h(a) {
		var b = this;
		b.html(e, b._json, a)
	}
	function i(a) {
		var b,
		c = this,
		d = a[0],
		e = a[1];
		switch (d) {
		case "status__eq":
			b = c.$element.find('[name="' + d + '"]').find('[value="' + window.decodeURIComponent(e) + '"]').text(),
			c.$element.find('[data-query="' + d + '"]').removeClass("hide").find("span").text(b),
			f.addQuery(d, d + "=" + e);
			break;
		case "team_id":
			b = c.$element.find('[data-name="' + d + '"]').woven()[0].getNodeNameById(window.decodeURIComponent(e)),
			c.$element.find('[data-query="' + d + '"]').removeClass("hide").find("span").text(b),
			f.addQuery(d, d + "=" + e);
			break;
		case "byfilter":
			break;
		default:
			c.$element.find('[data-query="' + d + '"]').removeClass("hide").find("span").text(window.decodeURIComponent(e)),
			f.addQuery(d, d + "=" + e)
		}
	}
	var j = {
		SAVE_FILTER : "/rest/data/queryfilter/user/add"
	};
	return b.extend(function () {
		var a = this;
		f.url = j.SAVE_FILTER,
		a._setFilter = i,
		g.call(a)
	}, {
		"sig/initialize" : function (a, b) {
			h.call(this, b)
		}
	})
}), define("troopjs-requirejs/template!app/widget/user/item/detail.html", [], function () {
	return function (a) {
		var b = "",
		c = a.englishName + " " + a.chineseName,
		d = a.status,
		e = "Admin" === this.role;
		return b += '\n<div class="search_content full-width">\n    <div class="search_item_tags pull-right clearfix">\n        ',
		d && (b += "\n        ", e && "Leave" === d && (b += '\n        <a class="btn btn-small" data-weave="shared/helper/translation" data-i18n="Data migrate" href="/user/migrate#id!' + a.id + '"></a>\n        '), b += '\n        <span class="label ' + a.status.toLowerCase() + '" data-weave="shared/helper/translation" data-i18n="User ' + d + '">' + d + "</span>\n        ", "Leave" === d && a.leaveDate && (b += '\n        <span class="muted">' + a.leaveDate + "</span>\n        "), b += "\n        "),
		b += '\n    </div>\n\n    <h4 class="pull-left item-title">\n        ',
		b += e ? '\n        <a href="/user#detail!id=' + a.id + '" class="title">' + c + "</a>\n        " : '\n        <a href="/user/preview#' + a.id + '" class="title" data-action="profile/open">' + c + "</a>\n        ",
		b += '\n    </h4>\n\n    <p class="sepH_b item_description clearfix">\n    ' + a.title.name + "&nbsp;\n    at&nbsp;" + a.team.name + '\n    <span class="pull-right">\n        ',
		a.mobile && (b += '\n        <span><span class="muted" data-weave="shared/helper/translation" data-i18n="Mobile"></span>: <a href="tel:\\' + a.mobile + '">' + a.mobile + "</a></span>\n        "),
		b += "\n        ",
		a.officeTel && (b += '\n        <span><span class="muted" data-weave="shared/helper/translation" data-i18n="Office Tel"></span>: <a href="tel:\\' + a.officeTel + '">' + a.officeTel + "</a></span>\n        "),
		b += "\n        ",
		a.fax && (b += '\n        <span><span class="muted" data-weave="shared/helper/translation" data-i18n="Fax"></span>: ' + a.fax + "</span>\n        "),
		b += "\n        ",
		a.email && (b += '\n        <span><span class="muted" data-weave="shared/helper/translation" data-i18n="Email"></span>: <a href="mailto:' + a.email + '">' + a.email + "</a></span>\n        "),
		b += "\n    </span>\n    </p>\n</div>"
	}
}), define("troopjs-requirejs/template!app/widget/user/item/list.html", [], function () {
	return function (a) {
		var b = "";
		a.englishName + " " + a.chineseName;
		var c = a.status,
		d = "Admin" === this.role;
		return b += "\n<td>\n    ",
		b += d ? '\n    <a href="#detail!id=' + a.id + '" class="title">' + a.englishName + "</a>\n    " : '\n    <a href="/user/preview#' + a.id + '" class="title" data-action="profile/open">' + a.englishName + "</a>\n    ",
		b += "\n</td>\n<td>\n    " + a.chineseName + "\n</td>\n<td>\n    " + a.team.name + "\n</td>\n<td>\n    " + a.title.name + "\n</td>\n<td>\n    ",
		a.mobile && (b += '\n    <a href="tel:\\' + a.mobile + '">' + a.mobile + "</a>\n    "),
		b += "\n</td>\n<td>\n    ",
		a.officeTel && (b += '\n    <a href="tel:\\' + a.officeTel + '">' + a.officeTel + "</a>\n    "),
		b += "\n</td>\n<td>\n    ",
		a.email && (b += '\n    <a href="mailto:' + a.email + '">' + a.email + "</a>\n    "),
		b += "\n</td>\n<td>\n    ",
		c && (b += '\n    <span class="label ' + a.status.toLowerCase() + '" data-weave="shared/helper/translation" data-i18n="User ' + c + '">' + c + "</span>\n    ", "Leave" === c && a.leaveDate && (b += '\n    <span class="muted">' + a.leaveDate + "</span>\n    "), b += "\n    "),
		b += "\n</td>\n<td>\n    ",
		d && "Leave" === c && (b += '\n    <a class="btn btn-small" data-weave="shared/helper/translation" data-i18n="Data migrate" href="/user/migrate#id!' + a.id + '"></a>\n    '),
		b += "\n</td>"
	}
}), define("app/widget/user/item/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!./detail.html", "template!./list.html", "shared/helper/utils"], function (a, b, c, d, e, f) {
	function g() {
		var a = this;
		a.viewType ? a.html(e, a._json) : a.html(d, a._json)
	}
	return b.extend(function (a, b, c, d) {
		var e = this;
		e._json = c,
		e.viewType = d
	}, {
		"hub:memory/context" : function (a, b) {
			var c = this;
			this.role = b.user.role,
			g.call(c)
		},
		"dom/action.click" : a.noop,
		"dom/action/profile/open.click" : function (b, c) {
			c.preventDefault();
			var d = a(c.target),
			e = d.attr("href");
			f.window({
				url : e,
				name : "User Profile",
				width : "1024"
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/user/list/main.html", [], function () {
	return function () {
		var a = '<div class="well well-small action-bar clearfix">\n    <div class="pull-left">\n        ';
		return "Admin" === this.context.user.role && (a += '\n        <a href="#add" class="btn btn-small" data-i18n="Add User" data-weave="shared/helper/translation"></a>\n        '),
		a += '\n    </div>\n    <div class="pull-right">\n        <span>显示: </span>\n        <select class="sort input-small" data-weave="shared/widget/list-paginate/main(' + this._listType + ')" data-action="paginate">\n            <option value="10">10</option>\n            <option value="25">25</option>\n            <option value="50">50</option>\n        </select>\n        <button class="btn btn-small" data-action="listview" data-toggle="tooltip"><span class="icon-test"></span></button>\n    </div>\n</div>\n\n<!-- pagination -->\n<div class="pagination clearfix hide" data-weave="shared/widget/pagination/main(\'' + this._listType + '\')"></div>\n\n<div class="loading-area widget-spin">\n    ',
		a += this.viewType ? '\n    <table class="table table_vam table-bl">\n        <thead>\n            <tr>\n                <th data-weave="shared/helper/translation" data-i18n="English Name"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Chinese Name"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Team"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Title"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Mobile"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Office Tel"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Email"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Status"></th>\n                <th data-weave="shared/helper/translation" data-i18n="Operation"></th>\n            </tr>\n        </thead>\n        <tbody class="list-container">\n        </tbody>\n    </table>\n    ' : '\n    <div class="search_panel list-container clearfix"></div>\n    ',
		a += '\n</div>\n\n<!-- pagination -->\n<div class="pagination clearfix hide" data-weave="shared/widget/pagination/main(\'' + this._listType + "')\"></div>"
	}
}), define("app/widget/user/list/main", ["jquery", "shared/widget/list/base", "troopjs-utils/deferred", "template!./main.html", "shared/helper/utils"], function (a, b, c, d) {
	function e(a) {
		var b = this;
		c(function (a) {
			b.html(d, a)
		}).done(function () {
			b.$container = b.$element.find(".list-container"),
			b.$massActions = b.$element.find(".mass-action .btn"),
			b.$toggleAll = b.$element.find('[data-action="list/toggle/all"]'),
			b.$listview = b.$element.find('[data-action="listview"]'),
			b.viewType ? b.$listview.addClass("table-view").attr("title", "切换为详细视图").find("span").attr("class", "icon-sqaures") : b.$listview.addClass("detail-view").attr("title", "切换为列表视图").find("span").attr("class", "icon-list"),
			b.$element.tooltip({
				selector : '[data-toggle="tooltip"]',
				trigger : "hover"
			}),
			a.resolve()
		})
	}
	var f = "/rest/user/fulllist?",
	g = "app/widget/user/item/main";
	return b.extend(function () {
		this._url = f,
		this._listType = "user"
	}, {
		render : function (a) {
			e.call(this, a)
		},
		appendItems : function (a) {
			var b = this;
			b.$toggleAll.prop("checked", !1),
			b.$toggleAll.prop("indeterminate", !1),
			b.viewType ? a.forEach(function (a) {
				b.$container.append("<tr></tr>"),
				b.$container.children().last().data("json", a).attr("data-weave", g + "(json, " + b.viewType + ")").weave()
			}) : a.forEach(function (a) {
				b.$container.append('<div class="search_item clearfix"></div>'),
				b.$container.children().last().data("json", a).attr("data-weave", g + "(json, " + b.viewType + ")").weave()
			})
		}
	})
}), define("troopjs-requirejs/template!app/widget/user/migrate/main.html", [], function () {
	return function (a) {
		var b = "",
		c = a.user,
		d = [c.englishName, c.chineseName].join(" "),
		e = a.overview,
		f = e.Candidate,
		g = e.Client;
		e.ClientContact;
		var h = e.LiveJobs,
		i = e.SucessfulJobs;
		return b += '\n\n<div class="pull-right">\n    <a class="btn" href="javascript:history.back();">\n        <i class="icon-arrow-left"></i>\n    </a>\n</div>\n<h3 class="heading" data-weave="shared/helper/translation" data-i18n="Data Migration"></h3>\n\n<p class="muted">' + d + '拥有的系统数据：</p>\n\n<table class="table table-striped table-bordered">\n    <thead>\n        <tr>\n            <th data-weave="shared/helper/translation" data-i18n="Data Type"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Number"></th>\n            <th data-weave="shared/helper/translation" data-i18n="Operation"></th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr>\n            <td>People</td>\n            <td>' + f + '</td>\n            <td>\n                <button class="btn btn-small ',
		0 == f && (b += "disabled"),
		b += '" data-weave="shared/helper/translation" data-i18n="Data Migration" data-action="open/migration(\'Candidate\', true)"></button>\n            </td>\n        </tr>\n        <tr>\n            <td data-weave="shared/helper/translation" data-i18n="Company"></td>\n            <td>' + g + '</td>\n            <td>\n                <button class="btn btn-small ',
		0 == g && (b += "disabled"),
		b += '" data-weave="shared/helper/translation" data-i18n="Data Migration" data-action="open/migration(\'Client\', true)"></button>\n            </td>\n        </tr>\n        <tr>\n            <td data-weave="shared/helper/translation" data-i18n="Live Jobs"></td>\n            <td>' + h + '</td>\n            <td>\n                <button class="btn btn-small ',
		0 == h && (b += "disabled"),
		b += '" data-weave="shared/helper/translation" data-i18n="Data Migration" data-action="open/migration(\'LiveJobs\', false)"></button>\n            </td>\n        </tr>\n        <tr>\n            <td data-weave="shared/helper/translation" data-i18n="Successed jobs but not received payment"></td>\n            <td>' + i + '</td>\n            <td>\n                <button class="btn btn-small ',
		0 == i && (b += "disabled"),
		b += '" data-weave="shared/helper/translation" data-i18n="Data Migration" data-action="open/migration(\'SucessfulJobs\', false)"></button>\n            </td>\n        </tr>\n    </tbody>\n</table>'
	}
}), define("app/widget/user/migrate/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "troopjs-utils/when", "template!./main.html", "shared/helper/utils"], function (a, b, c, d, e) {
	function f(b) {
		var f = this,
		g = [];
		if (f.uid) {
			var i = c(),
			j = c();
			g.push(i.promise(), j.promise()),
			f.publish("ajax", {
				url : h.USER.replace("<id>", f.uid)
			}, i.done(function (a) {
					f._json.user = a
				})),
			f.publish("ajax", {
				url : h.OVERVIEW.replace("<id>", f.uid)
			}, j.done(function (a) {
					f._json.overview = a
				})),
			d.apply(a, g).done(function () {
				f.html(e, f._json, b)
			})
		} else
			b.reject()
	}
	function g(a) {
		var b = this;
		b.username = [b._json.user.englishName, b._json.user.chineseName].join(" "),
		a.resolve()
	}
	var h = {
		USER : "/rest/user/<id>",
		OVERVIEW : "/rest/manage/datamigration/<id>/overview"
	};
	return b.extend(function () {
		var a = window.location.hash.replace(/^#/, "");
		this.uid = a.match(/(?:\D*)(\d*)(?:\D*)/)[1]
	}, {
		"sig/initialize" : function (a, b) {
			f.call(this, b)
		},
		"sig/start" : function (a, b) {
			g.call(this, b)
		},
		"dom/action.click" : a.noop,
		"dom/action/open/migration.click" : function (b, c, d, e) {
			c.preventDefault();
			var f = this,
			g = a(c.target);
			g.hasClass("disabled") || f.publish("modal/data-migration/show", {
				id : this.uid,
				name : f.username,
				hasShare : e,
				onSuccess : function () {
					g.closest("td").prev("td").text("0"),
					g.addClass("disabled")
				},
				type : d,
				number : f._json.overview[d]
			})
		}
	})
}), define("app/widget/user/my-profile/main", ["jquery", "shared/widget/base/main", "troopjs-utils/deferred", "template!app/widget/user/detail/main.html", "shared/helper/utils"], function (a, b, c, d) {
	return b.extend({
		"hub:memory/context" : function (a, b) {
			var c = this;
			c.html(d, b.user)
		}
	})
}), define("troopjs-requirejs/template!app/widget/user/preview/main.html", [], function () {
	return function () {
		var a = '<div class="vcard" data-weave="app/widget/user/detail/main"></div>';
		return a
	}
}), define("app/widget/user/preview/main", ["jquery", "shared/widget/base/main", "template!./main.html"], function (a, b, c) {
	function d(a) {
		var b = this;
		b.html(c, a)
	}
	return b.extend({
		"sig/initialize" : function (a, b) {
			d.call(this, b)
		},
		"hub:memory/route" : function (a, b) {
			var c = this;
			c.publish("detail/id/change", b.path[0])
		}
	})
});
